[0m19:00:49.430247 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m19:00:49.431164 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: BEGIN
[0m19:00:49.431596 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:49.449511 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:00:49.450245 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m19:00:49.450697 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */

  create view "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_tmp"
    
    
  as (
    SELECT *
FROM "postgres"."public"."fields"
  );
[0m19:00:49.453133 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m19:00:49.460279 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m19:00:49.460845 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */
alter table "postgres"."public_pipedrive_analytics"."base_pipedrive__fields" rename to "base_pipedrive__fields__dbt_backup"
[0m19:00:49.463784 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:00:49.467414 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m19:00:49.467999 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */
alter table "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_tmp" rename to "base_pipedrive__fields"
[0m19:00:49.469697 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:00:49.492851 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: COMMIT
[0m19:00:49.493606 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m19:00:49.494422 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: COMMIT
[0m19:00:49.498145 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m19:00:49.508261 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_backup"
[0m19:00:49.513889 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m19:00:49.514408 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */
drop view if exists "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_backup" cascade
[0m19:00:49.518592 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m19:00:49.521392 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: Close
[0m19:00:49.523054 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f849113-6da9-430d-a8a1-2d98a7ee07ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102cf5bb0>]}
[0m19:00:49.523926 [info ] [Thread-1 (]: 1 of 36 OK created sql view model public_pipedrive_analytics.base_pipedrive__fields  [[32mCREATE VIEW[0m in 0.15s]
[0m19:00:49.524886 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.base_pipedrive__fields
[0m19:00:49.525454 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__activity
[0m19:00:49.526207 [info ] [Thread-1 (]: 2 of 36 START sql view model public_pipedrive_analytics.stg_pipedrive__activity  [RUN]
[0m19:00:49.526779 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.base_pipedrive__fields, now model.enpal_assessment_project.stg_pipedrive__activity)
[0m19:00:49.527204 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__activity
[0m19:00:49.531526 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__activity"
[0m19:00:49.532418 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__activity
[0m19:00:49.535928 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__activity"
[0m19:00:49.536731 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m19:00:49.537152 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: BEGIN
[0m19:00:49.537545 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:49.556805 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m19:00:49.557560 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m19:00:49.558019 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_tmp"
    
    
  as (
    -- This model is a staging table for the activity table in the Pipedrive database.
-- Renaming a couple of columns to avoid using reserved keywords
-- Rename others for consistency with other models: model.id, model.reference_model_id
WITH base_activity AS (
    SELECT
        activity_id AS id,
        type AS activity_type,
        assigned_to_user AS user_id,
        deal_id,
        done AS is_done,
        due_to::TIMESTAMP AS due_time
    FROM "postgres"."public"."activity"
)
SELECT 
    id,
    activity_type,
    user_id,
    deal_id,
    is_done,
    due_time,
    
    EXTRACT(MONTH FROM due_time) AS month_number,
    TO_CHAR(due_time, 'Month') AS month_name

FROM base_activity
  );
[0m19:00:49.560813 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m19:00:49.564288 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m19:00:49.564761 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity" rename to "stg_pipedrive__activity__dbt_backup"
[0m19:00:49.566715 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:00:49.570109 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m19:00:49.570620 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_tmp" rename to "stg_pipedrive__activity"
[0m19:00:49.572376 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:00:49.574040 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: COMMIT
[0m19:00:49.574472 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m19:00:49.574872 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: COMMIT
[0m19:00:49.576855 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m19:00:49.579522 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_backup"
[0m19:00:49.580247 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m19:00:49.580668 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_backup" cascade
[0m19:00:49.584661 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m19:00:49.586301 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: Close
[0m19:00:49.586910 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f849113-6da9-430d-a8a1-2d98a7ee07ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a407a0>]}
[0m19:00:49.587602 [info ] [Thread-1 (]: 2 of 36 OK created sql view model public_pipedrive_analytics.stg_pipedrive__activity  [[32mCREATE VIEW[0m in 0.06s]
[0m19:00:49.588346 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__activity
[0m19:00:49.588866 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m19:00:49.589728 [info ] [Thread-1 (]: 3 of 36 START sql view model public_pipedrive_analytics.stg_pipedrive__activity_types  [RUN]
[0m19:00:49.590478 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__activity, now model.enpal_assessment_project.stg_pipedrive__activity_types)
[0m19:00:49.590925 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m19:00:49.593633 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m19:00:49.594434 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m19:00:49.599574 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m19:00:49.600468 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m19:00:49.600902 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: BEGIN
[0m19:00:49.601299 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:49.619359 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:00:49.619955 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m19:00:49.620631 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_tmp"
    
    
  as (
    -- This model is generated from the `activity_types` table in the `pipedrive` schema.
-- Renaming a couple of columns to avoid using reserved keywords
-- The `active` column is a string with just two possible value. It makes more sense as a bool
SELECT
    id,
    name AS activity_name,
    CASE
        WHEN active = 'Yes' THEN TRUE
        ELSE FALSE
    END AS is_active,
    type AS activity_type
FROM "postgres"."public"."activity_types"
  );
[0m19:00:49.623393 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m19:00:49.626872 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m19:00:49.627354 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types" rename to "stg_pipedrive__activity_types__dbt_backup"
[0m19:00:49.628957 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:00:49.632258 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m19:00:49.632911 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_tmp" rename to "stg_pipedrive__activity_types"
[0m19:00:49.634778 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:00:49.636540 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: COMMIT
[0m19:00:49.637081 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m19:00:49.637542 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: COMMIT
[0m19:00:49.639410 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m19:00:49.641920 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_backup"
[0m19:00:49.642569 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m19:00:49.642996 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_backup" cascade
[0m19:00:49.645380 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m19:00:49.646975 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: Close
[0m19:00:49.647580 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f849113-6da9-430d-a8a1-2d98a7ee07ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ac4e90>]}
[0m19:00:49.648809 [info ] [Thread-1 (]: 3 of 36 OK created sql view model public_pipedrive_analytics.stg_pipedrive__activity_types  [[32mCREATE VIEW[0m in 0.06s]
[0m19:00:49.650018 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m19:00:49.650567 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m19:00:49.651357 [info ] [Thread-1 (]: 4 of 36 START sql view model public_pipedrive_analytics.stg_pipedrive__deal_changes  [RUN]
[0m19:00:49.652124 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__activity_types, now model.enpal_assessment_project.stg_pipedrive__deal_changes)
[0m19:00:49.652602 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m19:00:49.657381 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m19:00:49.658275 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m19:00:49.661685 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m19:00:49.662502 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m19:00:49.662923 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: BEGIN
[0m19:00:49.663344 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:49.684286 [debug] [Thread-1 (]: SQL status: BEGIN in 0.021 seconds
[0m19:00:49.684958 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m19:00:49.685448 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_tmp"
    
    
  as (
    -- This model is generated from the `deal_changes` table in the `pipedrive` schema.
-- This is not a source deals table, and deal_id is not a PK (UNIQUE), so leave deal_id named as is
WITH base_deal_changes AS (
    SELECT
        deal_id,
        change_time::TIMESTAMP AS change_time,
        changed_field_key,
        new_value
    FROM "postgres"."public"."deal_changes"
)
SELECT
    deal_id,
    changed_field_key,
    new_value,
    change_time,
    
    EXTRACT(MONTH FROM change_time) AS month_number,
    TO_CHAR(change_time, 'Month') AS month_name

FROM base_deal_changes
  );
[0m19:00:49.688267 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m19:00:49.691713 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m19:00:49.692230 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes" rename to "stg_pipedrive__deal_changes__dbt_backup"
[0m19:00:49.693922 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:00:49.697497 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m19:00:49.698180 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_tmp" rename to "stg_pipedrive__deal_changes"
[0m19:00:49.699819 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:00:49.701535 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: COMMIT
[0m19:00:49.701997 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m19:00:49.702408 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: COMMIT
[0m19:00:49.704238 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m19:00:49.706865 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_backup"
[0m19:00:49.707541 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m19:00:49.707964 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_backup" cascade
[0m19:00:49.710457 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m19:00:49.712051 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: Close
[0m19:00:49.712622 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f849113-6da9-430d-a8a1-2d98a7ee07ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a9a7e0>]}
[0m19:00:49.713309 [info ] [Thread-1 (]: 4 of 36 OK created sql view model public_pipedrive_analytics.stg_pipedrive__deal_changes  [[32mCREATE VIEW[0m in 0.06s]
[0m19:00:49.714088 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m19:00:49.714827 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__stages
[0m19:00:49.716085 [info ] [Thread-1 (]: 5 of 36 START sql view model public_pipedrive_analytics.stg_pipedrive__stages .. [RUN]
[0m19:00:49.716918 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__deal_changes, now model.enpal_assessment_project.stg_pipedrive__stages)
[0m19:00:49.717416 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__stages
[0m19:00:49.720683 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__stages"
[0m19:00:49.721520 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__stages
[0m19:00:49.724995 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__stages"
[0m19:00:49.725781 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m19:00:49.726209 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: BEGIN
[0m19:00:49.726612 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:49.744451 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:00:49.745176 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m19:00:49.745709 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_tmp"
    
    
  as (
    /* NOT USED. 
    The source table has it's origins in the fields table, which is not used in the final model.
    I would rather keep stages and lost_reasons standardised in the final model.
    My assumption is that the fields table is used to store custom fields,
    and if this were to be updated by a sysadmin, the static stages table would not reflect the changes.
NOT USED. */

-- This model is generated from the `stages` table in the `pipedrive` schema.
-- Renaming a couple of columns to avoid using reserved keywords and standardise
SELECT
    stage_id AS id,
    stage_name
FROM "postgres"."public"."stages"
  );
[0m19:00:49.748346 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m19:00:49.751899 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m19:00:49.752367 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages" rename to "stg_pipedrive__stages__dbt_backup"
[0m19:00:49.753844 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:00:49.758483 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m19:00:49.758967 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_tmp" rename to "stg_pipedrive__stages"
[0m19:00:49.760557 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:00:49.762184 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: COMMIT
[0m19:00:49.762651 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m19:00:49.763064 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: COMMIT
[0m19:00:49.765120 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m19:00:49.767656 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_backup"
[0m19:00:49.768320 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m19:00:49.768748 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_backup" cascade
[0m19:00:49.771042 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m19:00:49.772614 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: Close
[0m19:00:49.773180 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f849113-6da9-430d-a8a1-2d98a7ee07ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b17260>]}
[0m19:00:49.773841 [info ] [Thread-1 (]: 5 of 36 OK created sql view model public_pipedrive_analytics.stg_pipedrive__stages  [[32mCREATE VIEW[0m in 0.06s]
[0m19:00:49.774554 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__stages
[0m19:00:49.775046 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__users
[0m19:00:49.775697 [info ] [Thread-1 (]: 6 of 36 START sql view model public_pipedrive_analytics.stg_pipedrive__users ... [RUN]
[0m19:00:49.776300 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__stages, now model.enpal_assessment_project.stg_pipedrive__users)
[0m19:00:49.776745 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__users
[0m19:00:49.779917 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__users"
[0m19:00:49.780796 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__users
[0m19:00:49.784959 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__users"
[0m19:00:49.785823 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m19:00:49.786267 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: BEGIN
[0m19:00:49.786670 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:49.802210 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m19:00:49.802901 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m19:00:49.803396 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_tmp"
    
    
  as (
    -- This model is generated from the `users` table in the `pipedrive` schema.
-- Renaming a couple of columns to avoid using reserved keywords and standardise
WITH base_users AS (
    SELECT
        id,
        name AS user_name,
        email AS user_email,
        modified::TIMESTAMP AS modified_time
    FROM "postgres"."public"."users"
)
SELECT
    id,
    user_name,
    user_email,
    modified_time,
    
    EXTRACT(MONTH FROM modified_time) AS month_number,
    TO_CHAR(modified_time, 'Month') AS month_name

FROM base_users
  );
[0m19:00:49.806120 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m19:00:49.809594 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m19:00:49.810065 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__users" rename to "stg_pipedrive__users__dbt_backup"
[0m19:00:49.812781 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:00:49.816302 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m19:00:49.816804 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_tmp" rename to "stg_pipedrive__users"
[0m19:00:49.818315 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:00:49.819897 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: COMMIT
[0m19:00:49.820340 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m19:00:49.820819 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: COMMIT
[0m19:00:49.822630 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m19:00:49.825392 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_backup"
[0m19:00:49.826090 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m19:00:49.826524 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_backup" cascade
[0m19:00:49.828867 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m19:00:49.830507 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: Close
[0m19:00:49.831138 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f849113-6da9-430d-a8a1-2d98a7ee07ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105992360>]}
[0m19:00:49.832012 [info ] [Thread-1 (]: 6 of 36 OK created sql view model public_pipedrive_analytics.stg_pipedrive__users  [[32mCREATE VIEW[0m in 0.05s]
[0m19:00:49.832734 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__users
[0m19:00:49.833244 [debug] [Thread-1 (]: Began running node seed.enpal_assessment_project.minor_stages
[0m19:00:49.833912 [info ] [Thread-1 (]: 7 of 36 START seed file public.minor_stages .................................... [RUN]
[0m19:00:49.834611 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__users, now seed.enpal_assessment_project.minor_stages)
[0m19:00:49.835043 [debug] [Thread-1 (]: Began compiling node seed.enpal_assessment_project.minor_stages
[0m19:00:49.835458 [debug] [Thread-1 (]: Began executing node seed.enpal_assessment_project.minor_stages
[0m19:00:49.865815 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m19:00:49.866340 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: BEGIN
[0m19:00:49.866766 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:49.882480 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m19:00:49.883045 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m19:00:49.883494 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "seed.enpal_assessment_project.minor_stages"} */
truncate table "postgres"."public"."minor_stages"
[0m19:00:49.886036 [debug] [Thread-1 (]: SQL status: TRUNCATE TABLE in 0.002 seconds
[0m19:00:49.903747 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m19:00:49.904307 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: 
          insert into "postgres"."public"."minor_stages" ("id", "activity_type", "stage_id", "minor_stage_id") values
          (%s,%s,%s,%s),(%s,%s,%s,%s)
      ...
[0m19:00:49.906206 [debug] [Thread-1 (]: SQL status: INSERT 0 2 in 0.001 seconds
[0m19:00:49.912203 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.enpal_assessment_project.minor_stages"
[0m19:00:49.914069 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: COMMIT
[0m19:00:49.914496 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m19:00:49.914974 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: COMMIT
[0m19:00:49.917560 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m19:00:49.918482 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: Close
[0m19:00:49.919050 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f849113-6da9-430d-a8a1-2d98a7ee07ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b2d0a0>]}
[0m19:00:49.919662 [info ] [Thread-1 (]: 7 of 36 OK loaded seed file public.minor_stages ................................ [[32mINSERT 2[0m in 0.08s]
[0m19:00:49.920428 [debug] [Thread-1 (]: Finished running node seed.enpal_assessment_project.minor_stages
[0m19:00:49.920935 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m19:00:49.921567 [info ] [Thread-1 (]: 8 of 36 START test assert_timestamp_equal_add_time_new_value ................... [RUN]
[0m19:00:49.922347 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.enpal_assessment_project.minor_stages, now test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value)
[0m19:00:49.922848 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m19:00:49.924977 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m19:00:49.925779 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m19:00:49.946166 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m19:00:49.947051 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m19:00:49.947485 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: BEGIN
[0m19:00:49.947907 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:49.965520 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:00:49.966170 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m19:00:49.966644 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- Assert that the change_time is equal to the new_value when the changed_field_key is 'add_time'
-- With this test, it's OK to ignore the new_value field for add_time changes
SELECT * FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
	WHERE changed_field_key = 'add_time'
	AND change_time != new_value::TIMESTAMP
      
    ) dbt_internal_test
[0m19:00:49.973793 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.007 seconds
[0m19:00:49.977937 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: ROLLBACK
[0m19:00:49.979536 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: Close
[0m19:00:49.980414 [info ] [Thread-1 (]: 8 of 36 PASS assert_timestamp_equal_add_time_new_value ......................... [[32mPASS[0m in 0.06s]
[0m19:00:49.981248 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m19:00:49.981848 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m19:00:49.982893 [info ] [Thread-1 (]: 9 of 36 START sql view model public_pipedrive_analytics.stg_pipedrive__fields_lost_reasons  [RUN]
[0m19:00:49.983707 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value, now model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons)
[0m19:00:49.984259 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m19:00:49.987241 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m19:00:49.988255 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m19:00:49.991956 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m19:00:49.992782 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m19:00:49.993216 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: BEGIN
[0m19:00:49.993616 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:50.010609 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m19:00:50.011370 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m19:00:50.011874 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_tmp"
    
    
  as (
    -- This model is generated from the `base_pipedrive__fields` model, which has the values buried in a JSON array.
-- ids should be INTEGER as a rule, even though one DBT test is comparing this to a STRING, I still prefer to cast to INTEGER here and in the test.
-- because in the real world, collaborators would be confused to see numeric-looking values as STRINGs.
WITH expand_array AS (
	SELECT 
		jsonb_array_elements(field_value_options) AS field_value_options
	FROM "postgres"."public_pipedrive_analytics"."base_pipedrive__fields"
	WHERE field_key = 'lost_reason'
)
SELECT
	CAST(field_value_options ->> 'id' AS INTEGER) AS id,
	field_value_options ->> 'label' AS label
FROM expand_array
  );
[0m19:00:50.015584 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:00:50.019011 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m19:00:50.019532 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_tmp" rename to "stg_pipedrive__fields_lost_reasons"
[0m19:00:50.021616 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:00:50.023178 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: COMMIT
[0m19:00:50.023620 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m19:00:50.024027 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: COMMIT
[0m19:00:50.026088 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m19:00:50.028526 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_backup"
[0m19:00:50.029172 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m19:00:50.029601 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_backup" cascade
[0m19:00:50.031136 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:00:50.032789 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: Close
[0m19:00:50.033405 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f849113-6da9-430d-a8a1-2d98a7ee07ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b42990>]}
[0m19:00:50.034090 [info ] [Thread-1 (]: 9 of 36 OK created sql view model public_pipedrive_analytics.stg_pipedrive__fields_lost_reasons  [[32mCREATE VIEW[0m in 0.05s]
[0m19:00:50.034810 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m19:00:50.035309 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m19:00:50.035979 [info ] [Thread-1 (]: 10 of 36 START sql view model public_pipedrive_analytics.stg_pipedrive__fields_stages  [RUN]
[0m19:00:50.036752 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons, now model.enpal_assessment_project.stg_pipedrive__fields_stages)
[0m19:00:50.037211 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m19:00:50.040116 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m19:00:50.040939 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m19:00:50.044433 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m19:00:50.045265 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m19:00:50.045715 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: BEGIN
[0m19:00:50.046127 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:50.063105 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m19:00:50.063892 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m19:00:50.064812 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_stages"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_tmp"
    
    
  as (
    -- This model is generated from the `base_pipedrive__fields` model, which has the values buried in a JSON array.
-- ids should be INTEGER as a rule, even though one DBT test is comparing this to a STRING, I still prefer to cast to INTEGER here and in the test.
-- because in the real world, collaborators would be confused to see numeric-looking values as STRINGs.
WITH expand_array AS (
	SELECT 
		jsonb_array_elements(field_value_options) AS field_value_options
	FROM "postgres"."public_pipedrive_analytics"."base_pipedrive__fields"
	WHERE field_key = 'stage_id'
)
SELECT
	CAST(field_value_options ->> 'id' AS INTEGER) AS id,
	field_value_options ->> 'label' AS label
FROM expand_array
  );
[0m19:00:50.068562 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:00:50.072294 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m19:00:50.072951 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_stages"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_tmp" rename to "stg_pipedrive__fields_stages"
[0m19:00:50.075817 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:00:50.078597 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: COMMIT
[0m19:00:50.079275 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m19:00:50.079758 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: COMMIT
[0m19:00:50.083337 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m19:00:50.086027 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_backup"
[0m19:00:50.086791 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m19:00:50.087263 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_stages"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_backup" cascade
[0m19:00:50.088910 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:00:50.090766 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: Close
[0m19:00:50.091698 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f849113-6da9-430d-a8a1-2d98a7ee07ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ada3c0>]}
[0m19:00:50.092887 [info ] [Thread-1 (]: 10 of 36 OK created sql view model public_pipedrive_analytics.stg_pipedrive__fields_stages  [[32mCREATE VIEW[0m in 0.05s]
[0m19:00:50.093754 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m19:00:50.094629 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m19:00:50.095347 [info ] [Thread-1 (]: 11 of 36 START test not_null_stg_pipedrive__activity_deal_id ................... [RUN]
[0m19:00:50.095888 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__fields_stages, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e)
[0m19:00:50.096328 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m19:00:50.108387 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m19:00:50.109202 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m19:00:50.111506 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m19:00:50.112355 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m19:00:50.112813 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: BEGIN
[0m19:00:50.113231 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:50.139305 [debug] [Thread-1 (]: SQL status: BEGIN in 0.026 seconds
[0m19:00:50.140086 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m19:00:50.140588 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select deal_id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where deal_id is null



      
    ) dbt_internal_test
[0m19:00:50.143590 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m19:00:50.145392 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: ROLLBACK
[0m19:00:50.147182 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: Close
[0m19:00:50.148219 [info ] [Thread-1 (]: 11 of 36 PASS not_null_stg_pipedrive__activity_deal_id ......................... [[32mPASS[0m in 0.05s]
[0m19:00:50.149851 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m19:00:50.151200 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m19:00:50.152446 [info ] [Thread-1 (]: 12 of 36 START test not_null_stg_pipedrive__activity_due_time .................. [RUN]
[0m19:00:50.153486 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191)
[0m19:00:50.154194 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m19:00:50.161026 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m19:00:50.161875 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m19:00:50.223831 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m19:00:50.224812 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m19:00:50.225283 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: BEGIN
[0m19:00:50.225726 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:50.244078 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:00:50.244796 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m19:00:50.245333 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select due_time
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where due_time is null



      
    ) dbt_internal_test
[0m19:00:50.249778 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.004 seconds
[0m19:00:50.251883 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: ROLLBACK
[0m19:00:50.253487 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: Close
[0m19:00:50.254306 [info ] [Thread-1 (]: 12 of 36 PASS not_null_stg_pipedrive__activity_due_time ........................ [[32mPASS[0m in 0.10s]
[0m19:00:50.255145 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m19:00:50.255683 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m19:00:50.256313 [info ] [Thread-1 (]: 13 of 36 START test not_null_stg_pipedrive__activity_id ........................ [RUN]
[0m19:00:50.257069 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb)
[0m19:00:50.257534 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m19:00:50.262018 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m19:00:50.263186 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m19:00:50.266348 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m19:00:50.267245 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m19:00:50.267711 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: BEGIN
[0m19:00:50.268166 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:50.288199 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m19:00:50.289046 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m19:00:50.289773 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where id is null



      
    ) dbt_internal_test
[0m19:00:50.292588 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m19:00:50.294313 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: ROLLBACK
[0m19:00:50.295951 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: Close
[0m19:00:50.296779 [info ] [Thread-1 (]: 13 of 36 PASS not_null_stg_pipedrive__activity_id .............................. [[32mPASS[0m in 0.04s]
[0m19:00:50.298534 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m19:00:50.299516 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m19:00:50.300614 [info ] [Thread-1 (]: 14 of 36 START test not_null_stg_pipedrive__activity_is_done ................... [RUN]
[0m19:00:50.301774 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543)
[0m19:00:50.302347 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m19:00:50.307021 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m19:00:50.307851 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m19:00:50.310227 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m19:00:50.311065 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m19:00:50.311522 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: BEGIN
[0m19:00:50.312030 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:50.332969 [debug] [Thread-1 (]: SQL status: BEGIN in 0.021 seconds
[0m19:00:50.333836 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m19:00:50.334386 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select is_done
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where is_done is null



      
    ) dbt_internal_test
[0m19:00:50.337153 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m19:00:50.339557 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: ROLLBACK
[0m19:00:50.341520 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: Close
[0m19:00:50.342739 [info ] [Thread-1 (]: 14 of 36 PASS not_null_stg_pipedrive__activity_is_done ......................... [[32mPASS[0m in 0.04s]
[0m19:00:50.343717 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m19:00:50.344515 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m19:00:50.345358 [info ] [Thread-1 (]: 15 of 36 START test relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_  [RUN]
[0m19:00:50.346242 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543, now test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8)
[0m19:00:50.346973 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m19:00:50.359019 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m19:00:50.359888 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m19:00:50.363613 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m19:00:50.364826 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m19:00:50.365766 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: BEGIN
[0m19:00:50.366465 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:50.389122 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m19:00:50.389999 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m19:00:50.390542 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select activity_type as from_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
    where activity_type is not null
),

parent as (
    select activity_type as to_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m19:00:50.395822 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m19:00:50.398345 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: ROLLBACK
[0m19:00:50.400123 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: Close
[0m19:00:50.401244 [info ] [Thread-1 (]: 15 of 36 PASS relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_  [[32mPASS[0m in 0.05s]
[0m19:00:50.402597 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m19:00:50.403453 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m19:00:50.404351 [info ] [Thread-1 (]: 16 of 36 START test accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time  [RUN]
[0m19:00:50.405206 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8, now test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0)
[0m19:00:50.405712 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m19:00:50.421346 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m19:00:50.422402 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m19:00:50.425133 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m19:00:50.426483 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m19:00:50.427257 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: BEGIN
[0m19:00:50.427789 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:50.446788 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m19:00:50.447758 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m19:00:50.448587 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        changed_field_key as value_field,
        count(*) as n_records

    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
    group by changed_field_key

)

select *
from all_values
where value_field not in (
    'user_id','stage_id','lost_reason','add_time'
)



      
    ) dbt_internal_test
[0m19:00:50.454284 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m19:00:50.456135 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: ROLLBACK
[0m19:00:50.457909 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: Close
[0m19:00:50.458692 [info ] [Thread-1 (]: 16 of 36 PASS accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time  [[32mPASS[0m in 0.05s]
[0m19:00:50.459666 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m19:00:50.460337 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m19:00:50.460991 [info ] [Thread-1 (]: 17 of 36 START test not_null_stg_pipedrive__deal_changes_change_time ........... [RUN]
[0m19:00:50.461690 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0, now test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d)
[0m19:00:50.462160 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m19:00:50.466634 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m19:00:50.467498 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m19:00:50.469876 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m19:00:50.470700 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m19:00:50.471142 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: BEGIN
[0m19:00:50.471544 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:50.489594 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:00:50.490313 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m19:00:50.490886 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select change_time
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
where change_time is null



      
    ) dbt_internal_test
[0m19:00:50.494322 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m19:00:50.496033 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: ROLLBACK
[0m19:00:50.497608 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: Close
[0m19:00:50.498769 [info ] [Thread-1 (]: 17 of 36 PASS not_null_stg_pipedrive__deal_changes_change_time ................. [[32mPASS[0m in 0.04s]
[0m19:00:50.499914 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m19:00:50.500456 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m19:00:50.501123 [info ] [Thread-1 (]: 18 of 36 START test not_null_stg_pipedrive__deal_changes_deal_id ............... [RUN]
[0m19:00:50.501756 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d, now test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d)
[0m19:00:50.502209 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m19:00:50.507977 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m19:00:50.508881 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m19:00:50.511214 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m19:00:50.512024 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m19:00:50.512462 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: BEGIN
[0m19:00:50.512863 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:50.530522 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:00:50.531254 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m19:00:50.532040 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select deal_id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
where deal_id is null



      
    ) dbt_internal_test
[0m19:00:50.535484 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m19:00:50.537193 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: ROLLBACK
[0m19:00:50.538626 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: Close
[0m19:00:50.539407 [info ] [Thread-1 (]: 18 of 36 PASS not_null_stg_pipedrive__deal_changes_deal_id ..................... [[32mPASS[0m in 0.04s]
[0m19:00:50.540221 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m19:00:50.540753 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m19:00:50.541327 [info ] [Thread-1 (]: 19 of 36 START test not_null_stg_pipedrive__deal_changes_new_value ............. [RUN]
[0m19:00:50.541975 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d, now test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96)
[0m19:00:50.542463 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m19:00:50.546614 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m19:00:50.547430 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m19:00:50.549958 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m19:00:50.550776 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m19:00:50.551235 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: BEGIN
[0m19:00:50.551636 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:50.569267 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:00:50.569849 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m19:00:50.570345 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select new_value
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
where new_value is null



      
    ) dbt_internal_test
[0m19:00:50.573619 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m19:00:50.575326 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: ROLLBACK
[0m19:00:50.576739 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: Close
[0m19:00:50.577459 [info ] [Thread-1 (]: 19 of 36 PASS not_null_stg_pipedrive__deal_changes_new_value ................... [[32mPASS[0m in 0.04s]
[0m19:00:50.578198 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m19:00:50.578725 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_change_user_references_user_id
[0m19:00:50.579331 [info ] [Thread-1 (]: 20 of 36 START test assert_change_user_references_user_id ...................... [RUN]
[0m19:00:50.580316 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96, now test.enpal_assessment_project.assert_change_user_references_user_id)
[0m19:00:50.580820 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_change_user_references_user_id
[0m19:00:50.584086 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m19:00:50.584967 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_change_user_references_user_id
[0m19:00:50.587224 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m19:00:50.588050 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m19:00:50.588514 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: BEGIN
[0m19:00:50.588917 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:50.606887 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:00:50.607629 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m19:00:50.608247 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_change_user_references_user_id"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- CTE to pre-filter deal_changes for stage_id changes
-- to safely cast new_value to an integer when we're sure all the values can be implicitly casted
WITH deal_change_user AS (
	SELECT changed_field_key, new_value FROM deal_changes
	WHERE changed_field_key = 'user_id'
)
SELECT *
FROM deal_change_user d
LEFT OUTER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__users" u
ON CAST(d.new_value AS INTEGER) = u.id
WHERE u.id IS NULL -- Any non referential values in d will return a NULL s.id
      
    ) dbt_internal_test
[0m19:00:50.613629 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m19:00:50.615781 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: ROLLBACK
[0m19:00:50.617374 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: Close
[0m19:00:50.618279 [info ] [Thread-1 (]: 20 of 36 PASS assert_change_user_references_user_id ............................ [[32mPASS[0m in 0.04s]
[0m19:00:50.619185 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_change_user_references_user_id
[0m19:00:50.619772 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m19:00:50.620539 [info ] [Thread-1 (]: 21 of 36 START test not_null_stg_pipedrive__users_id ........................... [RUN]
[0m19:00:50.621456 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_change_user_references_user_id, now test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817)
[0m19:00:50.621991 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m19:00:50.626376 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m19:00:50.627194 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m19:00:50.629515 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m19:00:50.630471 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m19:00:50.630951 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: BEGIN
[0m19:00:50.631670 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:50.650068 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:00:50.650836 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m19:00:50.651368 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where id is null



      
    ) dbt_internal_test
[0m19:00:50.653717 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m19:00:50.655720 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: ROLLBACK
[0m19:00:50.657297 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: Close
[0m19:00:50.658110 [info ] [Thread-1 (]: 21 of 36 PASS not_null_stg_pipedrive__users_id ................................. [[32mPASS[0m in 0.04s]
[0m19:00:50.658931 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m19:00:50.659470 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m19:00:50.660106 [info ] [Thread-1 (]: 22 of 36 START test not_null_stg_pipedrive__users_modified_time ................ [RUN]
[0m19:00:50.660976 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817, now test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5)
[0m19:00:50.661442 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m19:00:50.665887 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m19:00:50.666832 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m19:00:50.669382 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m19:00:50.670322 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m19:00:50.670979 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: BEGIN
[0m19:00:50.671541 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:50.695323 [debug] [Thread-1 (]: SQL status: BEGIN in 0.024 seconds
[0m19:00:50.696335 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m19:00:50.697223 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select modified_time
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where modified_time is null



      
    ) dbt_internal_test
[0m19:00:50.700427 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m19:00:50.702605 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: ROLLBACK
[0m19:00:50.704727 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: Close
[0m19:00:50.705588 [info ] [Thread-1 (]: 22 of 36 PASS not_null_stg_pipedrive__users_modified_time ...................... [[32mPASS[0m in 0.04s]
[0m19:00:50.706691 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m19:00:50.707285 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m19:00:50.707822 [info ] [Thread-1 (]: 23 of 36 START test not_null_stg_pipedrive__users_user_email ................... [RUN]
[0m19:00:50.708643 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5, now test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157)
[0m19:00:50.709135 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m19:00:50.713330 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m19:00:50.714638 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m19:00:50.717637 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m19:00:50.718514 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m19:00:50.718954 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: BEGIN
[0m19:00:50.719384 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:50.737614 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:00:50.738328 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m19:00:50.738913 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select user_email
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where user_email is null



      
    ) dbt_internal_test
[0m19:00:50.741514 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m19:00:50.743389 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: ROLLBACK
[0m19:00:50.744975 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: Close
[0m19:00:50.746011 [info ] [Thread-1 (]: 23 of 36 PASS not_null_stg_pipedrive__users_user_email ......................... [[32mPASS[0m in 0.04s]
[0m19:00:50.746977 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m19:00:50.747905 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m19:00:50.749061 [info ] [Thread-1 (]: 24 of 36 START test not_null_stg_pipedrive__users_user_name .................... [RUN]
[0m19:00:50.750245 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157, now test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5)
[0m19:00:50.750749 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m19:00:50.757139 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m19:00:50.758008 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m19:00:50.760258 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m19:00:50.761066 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m19:00:50.761579 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: BEGIN
[0m19:00:50.762048 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:50.779444 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m19:00:50.780013 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m19:00:50.780523 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select user_name
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where user_name is null



      
    ) dbt_internal_test
[0m19:00:50.783531 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m19:00:50.785427 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: ROLLBACK
[0m19:00:50.787354 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: Close
[0m19:00:50.788263 [info ] [Thread-1 (]: 24 of 36 PASS not_null_stg_pipedrive__users_user_name .......................... [[32mPASS[0m in 0.04s]
[0m19:00:50.789281 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m19:00:50.789833 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m19:00:50.790537 [info ] [Thread-1 (]: 25 of 36 START test relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_  [RUN]
[0m19:00:50.791250 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5, now test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d)
[0m19:00:50.791714 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m19:00:50.798074 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m19:00:50.798965 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m19:00:50.801917 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m19:00:50.803398 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m19:00:50.804157 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: BEGIN
[0m19:00:50.804905 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:50.825743 [debug] [Thread-1 (]: SQL status: BEGIN in 0.021 seconds
[0m19:00:50.826550 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m19:00:50.827162 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select user_id as from_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
    where user_id is not null
),

parent as (
    select id as to_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m19:00:50.834843 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.007 seconds
[0m19:00:50.836881 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: ROLLBACK
[0m19:00:50.838578 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: Close
[0m19:00:50.839767 [info ] [Thread-1 (]: 25 of 36 PASS relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_  [[32mPASS[0m in 0.05s]
[0m19:00:50.841156 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m19:00:50.841859 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m19:00:50.842699 [info ] [Thread-1 (]: 26 of 36 START test assert_change_stage_references_lost_reason_id .............. [RUN]
[0m19:00:50.843303 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d, now test.enpal_assessment_project.assert_change_stage_references_lost_reason_id)
[0m19:00:50.843757 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m19:00:50.846967 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m19:00:50.848128 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m19:00:50.852050 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m19:00:50.853068 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m19:00:50.853732 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: BEGIN
[0m19:00:50.854455 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:50.874760 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m19:00:50.875652 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m19:00:50.876457 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- CTE to pre-filter deal_changes for stage_id changes
-- to safely cast new_value to an integer when we're sure all the values can be implicitly casted
WITH deal_change_stage AS (
	SELECT changed_field_key, new_value FROM deal_changes
	WHERE changed_field_key = 'lost_reason'
)
SELECT *
FROM deal_change_stage d
LEFT OUTER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons" s
ON CAST(d.new_value AS INTEGER) = s.id
WHERE s.id IS NULL -- Any non referential values in d will return a NULL s.id
      
    ) dbt_internal_test
[0m19:00:50.881905 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m19:00:50.883946 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: ROLLBACK
[0m19:00:50.885709 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: Close
[0m19:00:50.886555 [info ] [Thread-1 (]: 26 of 36 PASS assert_change_stage_references_lost_reason_id .................... [[32mPASS[0m in 0.04s]
[0m19:00:50.887386 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m19:00:50.887933 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m19:00:50.888384 [info ] [Thread-1 (]: 27 of 36 START test assert_change_stage_references_stage_id .................... [RUN]
[0m19:00:50.889208 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_change_stage_references_lost_reason_id, now test.enpal_assessment_project.assert_change_stage_references_stage_id)
[0m19:00:50.889691 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m19:00:50.892548 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m19:00:50.893362 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m19:00:50.895607 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m19:00:50.896565 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m19:00:50.897165 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: BEGIN
[0m19:00:50.897635 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:50.915099 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m19:00:50.916022 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m19:00:50.916603 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_change_stage_references_stage_id"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- CTE to pre-filter deal_changes for stage_id changes
-- to safely cast new_value to an integer when we're sure all the values can be implicitly casted
WITH deal_change_stage AS (
	SELECT changed_field_key, new_value FROM deal_changes
	WHERE changed_field_key = 'stage_id'
)
SELECT *
FROM deal_change_stage d
LEFT OUTER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages" s
ON CAST(d.new_value AS INTEGER) = s.id
WHERE s.id IS NULL -- Any non referential values in d will return a NULL s.id
      
    ) dbt_internal_test
[0m19:00:50.924169 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.007 seconds
[0m19:00:50.925946 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: ROLLBACK
[0m19:00:50.927729 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: Close
[0m19:00:50.928503 [info ] [Thread-1 (]: 27 of 36 PASS assert_change_stage_references_stage_id .......................... [[32mPASS[0m in 0.04s]
[0m19:00:50.929274 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m19:00:50.929825 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_activity_join_activity_type
[0m19:00:50.930461 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_change_stage_references_stage_id, now model.enpal_assessment_project.int_activity_join_activity_type)
[0m19:00:50.931416 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_activity_join_activity_type
[0m19:00:50.935479 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_activity_join_activity_type"
[0m19:00:50.936622 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_activity_join_activity_type
[0m19:00:50.937111 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m19:00:50.937639 [info ] [Thread-1 (]: 28 of 36 START sql view model public_pipedrive_analytics.int_deal_changes_dedupe_new_deal  [RUN]
[0m19:00:50.938310 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_activity_join_activity_type, now model.enpal_assessment_project.int_deal_changes_dedupe_new_deal)
[0m19:00:50.938779 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m19:00:50.941497 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m19:00:50.942413 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m19:00:50.945955 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m19:00:50.946907 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m19:00:50.947389 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: BEGIN
[0m19:00:50.947940 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:50.966589 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m19:00:50.967472 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m19:00:50.967993 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"} */

  create view "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_tmp"
    
    
  as (
    -- Separate new deals model from the deal_changes model
-- There are a handful of dupe deals in the deal_changes model (assumption - deals should not have more than one added date)
-- Materialize as a view so it can be tested for deduplication
SELECT
	deal_id, 
	MAX(change_time) AS created_time
FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
WHERE changed_field_key = 'add_time'
GROUP BY
	deal_id
  );
[0m19:00:50.972058 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:00:50.976121 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m19:00:50.976789 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"} */
alter table "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_tmp" rename to "int_deal_changes_dedupe_new_deal"
[0m19:00:50.978789 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:00:50.980697 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: COMMIT
[0m19:00:50.981205 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m19:00:50.981660 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: COMMIT
[0m19:00:50.985312 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m19:00:50.990745 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_backup"
[0m19:00:50.991459 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m19:00:50.991942 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"} */
drop view if exists "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_backup" cascade
[0m19:00:50.994872 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m19:00:50.996520 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: Close
[0m19:00:50.997378 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f849113-6da9-430d-a8a1-2d98a7ee07ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ad3920>]}
[0m19:00:50.998561 [info ] [Thread-1 (]: 28 of 36 OK created sql view model public_pipedrive_analytics.int_deal_changes_dedupe_new_deal  [[32mCREATE VIEW[0m in 0.06s]
[0m19:00:50.999454 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m19:00:51.000096 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_user
[0m19:00:51.000992 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_dedupe_new_deal, now model.enpal_assessment_project.int_deal_changes_user)
[0m19:00:51.001572 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_user
[0m19:00:51.005156 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_user"
[0m19:00:51.006446 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_user
[0m19:00:51.006965 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m19:00:51.007604 [info ] [Thread-1 (]: 29 of 36 START sql view model public_pipedrive_analytics.int_deal_changes_dedupe_lost_reason  [RUN]
[0m19:00:51.008411 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_user, now model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason)
[0m19:00:51.009078 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m19:00:51.014056 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m19:00:51.015360 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m19:00:51.020708 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m19:00:51.022003 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m19:00:51.022671 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: BEGIN
[0m19:00:51.023158 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:51.046636 [debug] [Thread-1 (]: SQL status: BEGIN in 0.023 seconds
[0m19:00:51.047546 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m19:00:51.048703 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"} */

  create view "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_tmp"
    
    
  as (
    WITH deal_changes_lost_reason AS (
	SELECT
		ROW_NUMBER() OVER(PARTITION BY deal_id ORDER BY change_time DESC) AS reverse_order,
		deal_id,
		new_value AS lost_reason_id,
		change_time,
		month_name,
		month_number
	FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
	WHERE changed_field_key = 'lost_reason'
),
deal_changes_lost_reason_cast_id AS (
	SELECT
		deal_id,
		CAST(lost_reason_id AS INTEGER) AS lost_reason_id, -- do it here once rather than twice in the final select & join clauses
		change_time,
		month_name,
		month_number
	FROM deal_changes_lost_reason
	WHERE reverse_order = 1
)
SELECT
dcr.deal_id,
dcr.lost_reason_id,
lost_reasons.label,
dcr.change_time,
dcr.month_name,
dcr.month_number
FROM deal_changes_lost_reason_cast_id dcr
INNER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons" lost_reasons
ON dcr.lost_reason_id = lost_reasons.id
  );
[0m19:00:51.054417 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:00:51.059580 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m19:00:51.060332 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"} */
alter table "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_tmp" rename to "int_deal_changes_dedupe_lost_reason"
[0m19:00:51.063405 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:00:51.066042 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: COMMIT
[0m19:00:51.066772 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m19:00:51.067437 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: COMMIT
[0m19:00:51.069964 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m19:00:51.073770 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_backup"
[0m19:00:51.074845 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m19:00:51.075573 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"} */
drop view if exists "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_backup" cascade
[0m19:00:51.077570 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:00:51.080179 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: Close
[0m19:00:51.081262 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f849113-6da9-430d-a8a1-2d98a7ee07ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10440b080>]}
[0m19:00:51.082712 [info ] [Thread-1 (]: 29 of 36 OK created sql view model public_pipedrive_analytics.int_deal_changes_dedupe_lost_reason  [[32mCREATE VIEW[0m in 0.07s]
[0m19:00:51.084158 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m19:00:51.084995 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m19:00:51.086198 [info ] [Thread-1 (]: 30 of 36 START sql view model public_pipedrive_analytics.int_deal_changes_dedupe_stage  [RUN]
[0m19:00:51.087205 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason, now model.enpal_assessment_project.int_deal_changes_dedupe_stage)
[0m19:00:51.087976 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m19:00:51.093839 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m19:00:51.095331 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m19:00:51.101927 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m19:00:51.102984 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m19:00:51.103698 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: BEGIN
[0m19:00:51.104386 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:51.129486 [debug] [Thread-1 (]: SQL status: BEGIN in 0.025 seconds
[0m19:00:51.130483 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m19:00:51.131353 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_stage"} */

  create view "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_tmp"
    
    
  as (
    -- Separate new deals model from the deal_changes model
-- There are a handful of dupe deals in the deal_changes model (assumption - deals should not have more of each stage id)
-- Materialize as a view so it can be tested for deduplication
-- Method: row_number in reverse order and then pick the first row. 
-- This pattern is better because we don't know how many duplicate rows there could be, but the latest will always be row number 1.
-- Can't just take MAX(new_value) as was done for new_deals, because there are multiple stage_ids and all that appear need to be presented to the model.
WITH deal_changes_stage AS (
	SELECT
		ROW_NUMBER() OVER(PARTITION BY deal_id, new_value ORDER BY new_value, change_time DESC) AS reverse_order,
		deal_id,
		new_value AS stage_id,
		change_time,
		month_name,
		month_number
	FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
	WHERE changed_field_key = 'stage_id'
),
deal_changes_stage_cast_id AS (
	SELECT
		deal_id,
		CAST(stage_id AS INTEGER) AS stage_id, -- do it here once rather than twice in the final select & join clauses
		change_time,
		month_name,
		month_number
	FROM deal_changes_stage
	WHERE reverse_order = 1
)
SELECT
dcs.deal_id,
dcs.stage_id,
stages.label,
dcs.change_time,
dcs.month_name,
dcs.month_number
FROM deal_changes_stage_cast_id dcs
INNER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages" stages
ON dcs.stage_id = stages.id
  );
[0m19:00:51.137058 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:00:51.142635 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m19:00:51.143455 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_stage"} */
alter table "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_tmp" rename to "int_deal_changes_dedupe_stage"
[0m19:00:51.146188 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:00:51.149228 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: COMMIT
[0m19:00:51.149971 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m19:00:51.150614 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: COMMIT
[0m19:00:51.153242 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m19:00:51.157597 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_backup"
[0m19:00:51.158832 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m19:00:51.159764 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_stage"} */
drop view if exists "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_backup" cascade
[0m19:00:51.163731 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:00:51.169575 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: Close
[0m19:00:51.170683 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f849113-6da9-430d-a8a1-2d98a7ee07ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1029320c0>]}
[0m19:00:51.172246 [info ] [Thread-1 (]: 30 of 36 OK created sql view model public_pipedrive_analytics.int_deal_changes_dedupe_stage  [[32mCREATE VIEW[0m in 0.08s]
[0m19:00:51.174142 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m19:00:51.174965 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m19:00:51.175925 [info ] [Thread-1 (]: 31 of 36 START test unique_int_deal_changes_dedupe_new_deal_deal_id ............ [RUN]
[0m19:00:51.176886 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_dedupe_stage, now test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc)
[0m19:00:51.177713 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m19:00:51.190550 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m19:00:51.191951 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m19:00:51.199753 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m19:00:51.201206 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m19:00:51.202080 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: BEGIN
[0m19:00:51.202776 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:51.231631 [debug] [Thread-1 (]: SQL status: BEGIN in 0.028 seconds
[0m19:00:51.232579 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m19:00:51.233351 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    deal_id as unique_field,
    count(*) as n_records

from "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal"
where deal_id is not null
group by deal_id
having count(*) > 1



      
    ) dbt_internal_test
[0m19:00:51.242221 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.008 seconds
[0m19:00:51.245055 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: ROLLBACK
[0m19:00:51.246931 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: Close
[0m19:00:51.248953 [info ] [Thread-1 (]: 31 of 36 PASS unique_int_deal_changes_dedupe_new_deal_deal_id .................. [[32mPASS[0m in 0.07s]
[0m19:00:51.250932 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m19:00:51.252461 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m19:00:51.253630 [info ] [Thread-1 (]: 32 of 36 START test unique_int_deal_changes_dedupe_lost_reason_deal_id ......... [RUN]
[0m19:00:51.254697 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc, now test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907)
[0m19:00:51.255529 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m19:00:51.262788 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m19:00:51.264121 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m19:00:51.268437 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m19:00:51.269709 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m19:00:51.270624 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: BEGIN
[0m19:00:51.271334 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:51.294614 [debug] [Thread-1 (]: SQL status: BEGIN in 0.023 seconds
[0m19:00:51.295501 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m19:00:51.296007 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    deal_id as unique_field,
    count(*) as n_records

from "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason"
where deal_id is not null
group by deal_id
having count(*) > 1



      
    ) dbt_internal_test
[0m19:00:51.304398 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.008 seconds
[0m19:00:51.306256 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: ROLLBACK
[0m19:00:51.307805 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: Close
[0m19:00:51.308723 [info ] [Thread-1 (]: 32 of 36 PASS unique_int_deal_changes_dedupe_lost_reason_deal_id ............... [[32mPASS[0m in 0.05s]
[0m19:00:51.309596 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m19:00:51.310233 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_unique_deal_stage
[0m19:00:51.310815 [info ] [Thread-1 (]: 33 of 36 START test assert_unique_deal_stage ................................... [RUN]
[0m19:00:51.311731 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907, now test.enpal_assessment_project.assert_unique_deal_stage)
[0m19:00:51.312356 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_unique_deal_stage
[0m19:00:51.315405 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_unique_deal_stage"
[0m19:00:51.316355 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_unique_deal_stage
[0m19:00:51.318618 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_unique_deal_stage"
[0m19:00:51.319383 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_unique_deal_stage"
[0m19:00:51.319805 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: BEGIN
[0m19:00:51.320198 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:51.341202 [debug] [Thread-1 (]: SQL status: BEGIN in 0.021 seconds
[0m19:00:51.341842 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_unique_deal_stage"
[0m19:00:51.342695 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_unique_deal_stage"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT
    COUNT(*),
    deal_id,
    stage_id
FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage"
GROUP BY
    deal_id,
    stage_id
HAVING COUNT(*) > 1
      
    ) dbt_internal_test
[0m19:00:51.365783 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.022 seconds
[0m19:00:51.367543 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: ROLLBACK
[0m19:00:51.369015 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: Close
[0m19:00:51.369746 [info ] [Thread-1 (]: 33 of 36 PASS assert_unique_deal_stage ......................................... [[32mPASS[0m in 0.06s]
[0m19:00:51.370563 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_unique_deal_stage
[0m19:00:51.371227 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_activity
[0m19:00:51.372022 [info ] [Thread-1 (]: 34 of 36 START sql view model public_pipedrive_analytics.int_deal_changes_activity  [RUN]
[0m19:00:51.372852 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_unique_deal_stage, now model.enpal_assessment_project.int_deal_changes_activity)
[0m19:00:51.373350 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_activity
[0m19:00:51.379705 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_activity"
[0m19:00:51.380581 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.int_deal_changes_activity
[0m19:00:51.385258 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.int_deal_changes_activity"
[0m19:00:51.386182 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_activity"
[0m19:00:51.386688 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_activity: BEGIN
[0m19:00:51.387114 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:51.404941 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:00:51.405642 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_activity"
[0m19:00:51.406150 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_activity"} */

  create view "postgres"."public_pipedrive_analytics"."int_deal_changes_activity__dbt_tmp"
    
    
  as (
    with __dbt__cte__int_activity_join_activity_type as (
-- Simple Intermediate Model to join activity and activity_types
-- thus providing the friendly name of the activity type
-- Filter out inactive activity types, they are not used in the final report


SELECT
	a.user_id,
	a.deal_id,
	t.activity_name,
	ms.stage_id,
	ms.minor_stage_id,
	t.is_active, -- this would be a mart level filter: business logic determines when to include deactivated activity types
	a.is_done, -- this would be a report level filter: analyst determines when to exclude incomplete activities
	a.due_time,
	a.month_name,
	a.month_number
FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity" a
INNER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types" t
	ON a.activity_type = t.activity_type
INNER JOIN "postgres"."public"."minor_stages" ms
	ON t.activity_type = ms.activity_type
) -- brings in the activity data for each deal in the deal_changes table
-- Note that there are very few rows compared to the total number of deals
-- These will just be the ones with call activities against them
SELECT
    nd.deal_id,
    act.activity_name,
    act.stage_id,
    act.minor_stage_id,
    act.is_active, -- this would be a mart level filter: business logic determines when to include deactivated activity types
    act.is_done, -- this would be a report level filter: analyst determines when to exclude incomplete activities
    act.month_number,
    act.month_name
FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal" nd
INNER JOIN __dbt__cte__int_activity_join_activity_type act
ON nd.deal_id = act.deal_id
  );
[0m19:00:51.409863 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:00:51.413479 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_activity"
[0m19:00:51.414131 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_activity"} */
alter table "postgres"."public_pipedrive_analytics"."int_deal_changes_activity__dbt_tmp" rename to "int_deal_changes_activity"
[0m19:00:51.416350 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:00:51.418011 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_activity: COMMIT
[0m19:00:51.418505 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_activity"
[0m19:00:51.418936 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_activity: COMMIT
[0m19:00:51.421113 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m19:00:51.423792 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."int_deal_changes_activity__dbt_backup"
[0m19:00:51.424505 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_activity"
[0m19:00:51.424952 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_activity"} */
drop view if exists "postgres"."public_pipedrive_analytics"."int_deal_changes_activity__dbt_backup" cascade
[0m19:00:51.426600 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:00:51.428126 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_activity: Close
[0m19:00:51.428718 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f849113-6da9-430d-a8a1-2d98a7ee07ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102e227e0>]}
[0m19:00:51.429401 [info ] [Thread-1 (]: 34 of 36 OK created sql view model public_pipedrive_analytics.int_deal_changes_activity  [[32mCREATE VIEW[0m in 0.06s]
[0m19:00:51.430173 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_activity
[0m19:00:51.431069 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.mrt_deals_stages
[0m19:00:51.431968 [info ] [Thread-1 (]: 35 of 36 START sql table model public_pipedrive_analytics.mrt_deals_stages ..... [RUN]
[0m19:00:51.432515 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_activity, now model.enpal_assessment_project.mrt_deals_stages)
[0m19:00:51.433028 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.mrt_deals_stages
[0m19:00:51.436616 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.mrt_deals_stages"
[0m19:00:51.437626 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.mrt_deals_stages
[0m19:00:51.463204 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.mrt_deals_stages"
[0m19:00:51.464152 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m19:00:51.464584 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: BEGIN
[0m19:00:51.464977 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:51.480920 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m19:00:51.481598 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m19:00:51.482451 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */

  
    

  create  table "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_tmp"
  
  
    as
  
  (
    WITH all_deal_changes_and_activity AS (
    SELECT
        deal_id,
        stage_id,
        minor_stage_id,
        is_done, -- this would be a report level filter: analyst determines when to exclude incomplete activities
        activity_name AS label,
        month_name,
        month_number
    FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_activity"
    WHERE is_active = TRUE -- Mart level filter, most business users will ignore e.g. 'Follow Up Call' that is set to be inactive
    UNION ALL
    SELECT
        deal_id,
        stage_id,
        NULL AS minor_stage_id,
        NULL AS is_done,
        label,
        month_name,
        month_number
    FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage"
)
SELECT
    nd.deal_id,
    dca.stage_id,
    dca.minor_stage_id,
    dca.is_done,
    dca.label,
    dca.month_name,
    dca.month_number
FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal" nd -- Only deals from the deal_changes model (these have a created_time)
LEFT OUTER JOIN all_deal_changes_and_activity dca -- This will pick up the minor stages/activities where they exist for this set of deals
    ON nd.deal_id = dca.deal_id
  );
  
[0m19:00:51.525557 [debug] [Thread-1 (]: SQL status: SELECT 8895 in 0.042 seconds
[0m19:00:51.530614 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m19:00:51.531114 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */
alter table "postgres"."public_pipedrive_analytics"."mrt_deals_stages" rename to "mrt_deals_stages__dbt_backup"
[0m19:00:51.532767 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:00:51.535730 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m19:00:51.536183 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */
alter table "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_tmp" rename to "mrt_deals_stages"
[0m19:00:51.537740 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:00:51.543483 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: COMMIT
[0m19:00:51.543997 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m19:00:51.544418 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: COMMIT
[0m19:00:51.546997 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m19:00:51.549827 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_backup"
[0m19:00:51.552883 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m19:00:51.553379 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */
drop table if exists "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_backup" cascade
[0m19:00:51.556306 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.002 seconds
[0m19:00:51.557871 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: Close
[0m19:00:51.558469 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f849113-6da9-430d-a8a1-2d98a7ee07ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b36ae0>]}
[0m19:00:51.559190 [info ] [Thread-1 (]: 35 of 36 OK created sql table model public_pipedrive_analytics.mrt_deals_stages  [[32mSELECT 8895[0m in 0.13s]
[0m19:00:51.559976 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.mrt_deals_stages
[0m19:00:51.560862 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m19:00:51.561586 [info ] [Thread-1 (]: 36 of 36 START sql view model public_pipedrive_analytics.rep_sales_funnel_monthly  [RUN]
[0m19:00:51.562119 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.mrt_deals_stages, now model.enpal_assessment_project.rep_sales_funnel_monthly)
[0m19:00:51.562554 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m19:00:51.566049 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m19:00:51.566951 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m19:00:51.570981 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m19:00:51.571844 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m19:00:51.572311 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: BEGIN
[0m19:00:51.572743 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:51.594196 [debug] [Thread-1 (]: SQL status: BEGIN in 0.021 seconds
[0m19:00:51.595036 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m19:00:51.595644 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.rep_sales_funnel_monthly"} */

  create view "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_tmp"
    
    
  as (
    -- ASSUMPTIONS FOR THIS MODEL:
-- Show the number of deals in each stage of the sales funnel, for each month
    -- Although we have models for users, they are not needed/requested in this model
    -- Although we have models for lost deals, we are showing the stage the deal was in at the time of the activity 
        -- whether it was closed or not in the end
    

-- create the funnel steps as requested
WITH funnel_step_from_stages AS (
	SELECT
		deal_id,
		month_number,
		month_name,
		CONCAT(stage_id, 
			CASE
				WHEN minor_stage_id IS NULL THEN ''
				ELSE CONCAT('.', minor_stage_id)
			END
		) AS funnel_step,
		label AS kpi_name
	FROM "postgres"."public_pipedrive_analytics"."mrt_deals_stages" AS funnel
    WHERE COALESCE(is_done, TRUE) -- report level filter: exclude incomplete activities
),
-- aggregate CTE then order, to avoid having to keep the order columns in the view
monthly_agg AS (
	SELECT
		COUNT(deal_id) AS deals_count,
		month_number,
		month_name,
		funnel_step,
		kpi_name
	FROM funnel_step_from_stages
	GROUP BY
		month_number,
		month_name,
		funnel_step,
		kpi_name
)
SELECT
	month_name AS month,
	kpi_name,
	funnel_step,
	deals_count
	FROM monthly_agg
ORDER BY month_number, funnel_step
  );
[0m19:00:51.599522 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:00:51.602787 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m19:00:51.603277 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.rep_sales_funnel_monthly"} */
alter table "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_tmp" rename to "rep_sales_funnel_monthly"
[0m19:00:51.605107 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:00:51.606809 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: COMMIT
[0m19:00:51.607314 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m19:00:51.607732 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: COMMIT
[0m19:00:51.609920 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m19:00:51.612494 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_backup"
[0m19:00:51.613291 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m19:00:51.613730 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.rep_sales_funnel_monthly"} */
drop view if exists "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_backup" cascade
[0m19:00:51.615579 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:00:51.617266 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: Close
[0m19:00:51.617849 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f849113-6da9-430d-a8a1-2d98a7ee07ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104479430>]}
[0m19:00:51.618601 [info ] [Thread-1 (]: 36 of 36 OK created sql view model public_pipedrive_analytics.rep_sales_funnel_monthly  [[32mCREATE VIEW[0m in 0.06s]
[0m19:00:51.619324 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m19:00:51.620685 [debug] [MainThread]: Using postgres connection "master"
[0m19:00:51.621110 [debug] [MainThread]: On master: BEGIN
[0m19:00:51.621458 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:00:51.636723 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m19:00:51.637377 [debug] [MainThread]: On master: COMMIT
[0m19:00:51.637797 [debug] [MainThread]: Using postgres connection "master"
[0m19:00:51.638161 [debug] [MainThread]: On master: COMMIT
[0m19:00:51.639533 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m19:00:51.640105 [debug] [MainThread]: On master: Close
[0m19:00:51.640704 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:00:51.641202 [debug] [MainThread]: Connection 'model.enpal_assessment_project.rep_sales_funnel_monthly' was properly closed.
[0m19:00:51.641686 [info ] [MainThread]: 
[0m19:00:51.642300 [info ] [MainThread]: Finished running 13 view models, 1 seed, 21 data tests, 1 table model in 0 hours 0 minutes and 2.56 seconds (2.56s).
[0m19:00:51.649700 [debug] [MainThread]: Command end result
[0m19:00:51.690069 [info ] [MainThread]: 
[0m19:00:51.690580 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:00:51.691167 [info ] [MainThread]: 
[0m19:00:51.691735 [info ] [MainThread]: Done. PASS=36 WARN=0 ERROR=0 SKIP=0 TOTAL=36
[0m19:00:51.694219 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 3.9571388, "process_in_blocks": "0", "process_kernel_time": 0.619218, "process_mem_max_rss": "115945472", "process_out_blocks": "0", "process_user_time": 4.452786}
[0m19:00:51.695253 [debug] [MainThread]: Command `dbt build` succeeded at 19:00:51.695057 after 3.96 seconds
[0m19:00:51.695774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102e94200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b4a6f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b4b740>]}
[0m19:00:51.696280 [debug] [MainThread]: Flushing usage events
[0m19:02:14.067786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083a0710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083d7200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083d6d50>]}


============================== 19:02:14.072952 | 4ce3d9f7-8e57-414a-bcf5-3b0df839a0cd ==============================
[0m19:02:14.072952 [info ] [MainThread]: Running with dbt=1.8.9
[0m19:02:14.073795 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/julian/Documents/hatvalues_repo/dbt_enpal_assessment/logs', 'profiles_dir': '/Users/julian/Documents/hatvalues_repo/dbt_enpal_assessment', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:02:14.317938 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4ce3d9f7-8e57-414a-bcf5-3b0df839a0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084e9fd0>]}
[0m19:02:14.388339 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4ce3d9f7-8e57-414a-bcf5-3b0df839a0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a4e300>]}
[0m19:02:14.389367 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m19:02:14.522862 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m19:02:14.695873 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:02:14.696375 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:02:14.766759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4ce3d9f7-8e57-414a-bcf5-3b0df839a0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089c9010>]}
[0m19:02:14.933185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4ce3d9f7-8e57-414a-bcf5-3b0df839a0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10904ae70>]}
[0m19:02:14.933910 [info ] [MainThread]: Found 16 models, 21 data tests, 1 seed, 6 sources, 429 macros
[0m19:02:14.939091 [info ] [MainThread]: 
[0m19:02:14.939876 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:02:14.946555 [debug] [ThreadPool]: Acquiring new postgres connection 'list_postgres'
[0m19:02:15.013997 [debug] [ThreadPool]: Using postgres connection "list_postgres"
[0m19:02:15.014566 [debug] [ThreadPool]: On list_postgres: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
[0m19:02:15.014962 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:02:15.045457 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.030 seconds
[0m19:02:15.047122 [debug] [ThreadPool]: On list_postgres: Close
[0m19:02:15.050190 [debug] [ThreadPool]: Using postgres connection "list_postgres"
[0m19:02:15.050745 [debug] [ThreadPool]: On list_postgres: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
[0m19:02:15.051157 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:02:15.067126 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.016 seconds
[0m19:02:15.068685 [debug] [ThreadPool]: On list_postgres: Close
[0m19:02:15.071753 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_postgres, now list_postgres_public_pipedrive_analytics)
[0m19:02:15.078269 [debug] [ThreadPool]: Using postgres connection "list_postgres_public_pipedrive_analytics"
[0m19:02:15.078727 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: BEGIN
[0m19:02:15.079066 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:02:15.095156 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m19:02:15.095822 [debug] [ThreadPool]: Using postgres connection "list_postgres_public_pipedrive_analytics"
[0m19:02:15.096265 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres_public_pipedrive_analytics"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_pipedrive_analytics'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_pipedrive_analytics'
    union all
    select
      'postgres' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_pipedrive_analytics'
  
[0m19:02:15.100617 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.004 seconds
[0m19:02:15.102384 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: ROLLBACK
[0m19:02:15.103713 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: Close
[0m19:02:15.104452 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_postgres_public_pipedrive_analytics, now list_postgres_public)
[0m19:02:15.109138 [debug] [ThreadPool]: Using postgres connection "list_postgres_public"
[0m19:02:15.109583 [debug] [ThreadPool]: On list_postgres_public: BEGIN
[0m19:02:15.109929 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:02:15.126332 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m19:02:15.126931 [debug] [ThreadPool]: Using postgres connection "list_postgres_public"
[0m19:02:15.127368 [debug] [ThreadPool]: On list_postgres_public: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m19:02:15.131467 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.004 seconds
[0m19:02:15.133304 [debug] [ThreadPool]: On list_postgres_public: ROLLBACK
[0m19:02:15.134893 [debug] [ThreadPool]: On list_postgres_public: Close
[0m19:02:15.144122 [debug] [MainThread]: Using postgres connection "master"
[0m19:02:15.144669 [debug] [MainThread]: On master: BEGIN
[0m19:02:15.145025 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:02:15.160516 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m19:02:15.161104 [debug] [MainThread]: Using postgres connection "master"
[0m19:02:15.161605 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m19:02:15.166752 [debug] [MainThread]: SQL status: SELECT 17 in 0.005 seconds
[0m19:02:15.172236 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4ce3d9f7-8e57-414a-bcf5-3b0df839a0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084a5910>]}
[0m19:02:15.172770 [debug] [MainThread]: On master: ROLLBACK
[0m19:02:15.174986 [debug] [MainThread]: Using postgres connection "master"
[0m19:02:15.175458 [debug] [MainThread]: On master: BEGIN
[0m19:02:15.177547 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m19:02:15.178158 [debug] [MainThread]: On master: COMMIT
[0m19:02:15.178607 [debug] [MainThread]: Using postgres connection "master"
[0m19:02:15.178971 [debug] [MainThread]: On master: COMMIT
[0m19:02:15.180477 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m19:02:15.180976 [debug] [MainThread]: On master: Close
[0m19:02:15.181528 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:02:15.181978 [info ] [MainThread]: 
[0m19:02:15.184606 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.base_pipedrive__fields
[0m19:02:15.185276 [info ] [Thread-1 (]: 1 of 36 START sql view model public_pipedrive_analytics.base_pipedrive__fields . [RUN]
[0m19:02:15.185839 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_postgres_public, now model.enpal_assessment_project.base_pipedrive__fields)
[0m19:02:15.186462 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.base_pipedrive__fields
[0m19:02:15.196665 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.base_pipedrive__fields"
[0m19:02:15.197630 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.base_pipedrive__fields
[0m19:02:15.241214 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.base_pipedrive__fields"
[0m19:02:15.242138 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m19:02:15.242569 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: BEGIN
[0m19:02:15.242964 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:15.258858 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m19:02:15.259588 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m19:02:15.260057 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */

  create view "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_tmp"
    
    
  as (
    SELECT *
FROM "postgres"."public"."fields"
  );
[0m19:02:15.262621 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m19:02:15.269799 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m19:02:15.270312 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */
alter table "postgres"."public_pipedrive_analytics"."base_pipedrive__fields" rename to "base_pipedrive__fields__dbt_backup"
[0m19:02:15.273149 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:02:15.276463 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m19:02:15.277019 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */
alter table "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_tmp" rename to "base_pipedrive__fields"
[0m19:02:15.278812 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:02:15.297518 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: COMMIT
[0m19:02:15.298080 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m19:02:15.298490 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: COMMIT
[0m19:02:15.302056 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m19:02:15.309063 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_backup"
[0m19:02:15.314662 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m19:02:15.315175 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */
drop view if exists "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_backup" cascade
[0m19:02:15.319206 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m19:02:15.322449 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: Close
[0m19:02:15.324583 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ce3d9f7-8e57-414a-bcf5-3b0df839a0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c7d850>]}
[0m19:02:15.325572 [info ] [Thread-1 (]: 1 of 36 OK created sql view model public_pipedrive_analytics.base_pipedrive__fields  [[32mCREATE VIEW[0m in 0.14s]
[0m19:02:15.326639 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.base_pipedrive__fields
[0m19:02:15.327385 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__activity
[0m19:02:15.328179 [info ] [Thread-1 (]: 2 of 36 START sql view model public_pipedrive_analytics.stg_pipedrive__activity  [RUN]
[0m19:02:15.328954 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.base_pipedrive__fields, now model.enpal_assessment_project.stg_pipedrive__activity)
[0m19:02:15.329495 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__activity
[0m19:02:15.335288 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__activity"
[0m19:02:15.336272 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__activity
[0m19:02:15.341069 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__activity"
[0m19:02:15.342201 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m19:02:15.342722 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: BEGIN
[0m19:02:15.343423 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:15.361775 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:02:15.362582 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m19:02:15.363258 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_tmp"
    
    
  as (
    -- This model is a staging table for the activity table in the Pipedrive database.
-- Renaming a couple of columns to avoid using reserved keywords
-- Rename others for consistency with other models: model.id, model.reference_model_id
WITH base_activity AS (
    SELECT
        activity_id AS id,
        type AS activity_type,
        assigned_to_user AS user_id,
        deal_id,
        done AS is_done,
        due_to::TIMESTAMP AS due_time
    FROM "postgres"."public"."activity"
)
SELECT 
    id,
    activity_type,
    user_id,
    deal_id,
    is_done,
    due_time,
    
    EXTRACT(MONTH FROM due_time) AS month_number,
    TO_CHAR(due_time, 'Month') AS month_name

FROM base_activity
  );
[0m19:02:15.368302 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:02:15.373315 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m19:02:15.374035 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity" rename to "stg_pipedrive__activity__dbt_backup"
[0m19:02:15.376713 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:02:15.380204 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m19:02:15.380729 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_tmp" rename to "stg_pipedrive__activity"
[0m19:02:15.382416 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:02:15.384206 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: COMMIT
[0m19:02:15.384747 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m19:02:15.385167 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: COMMIT
[0m19:02:15.387052 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m19:02:15.389960 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_backup"
[0m19:02:15.391069 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m19:02:15.391526 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_backup" cascade
[0m19:02:15.394439 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m19:02:15.396135 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: Close
[0m19:02:15.396772 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ce3d9f7-8e57-414a-bcf5-3b0df839a0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098cda00>]}
[0m19:02:15.397732 [info ] [Thread-1 (]: 2 of 36 OK created sql view model public_pipedrive_analytics.stg_pipedrive__activity  [[32mCREATE VIEW[0m in 0.07s]
[0m19:02:15.398629 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__activity
[0m19:02:15.399312 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m19:02:15.400265 [info ] [Thread-1 (]: 3 of 36 START sql view model public_pipedrive_analytics.stg_pipedrive__activity_types  [RUN]
[0m19:02:15.400969 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__activity, now model.enpal_assessment_project.stg_pipedrive__activity_types)
[0m19:02:15.401431 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m19:02:15.404274 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m19:02:15.405125 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m19:02:15.408550 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m19:02:15.409348 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m19:02:15.409781 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: BEGIN
[0m19:02:15.410181 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:15.428014 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:02:15.428628 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m19:02:15.429101 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_tmp"
    
    
  as (
    -- This model is generated from the `activity_types` table in the `pipedrive` schema.
-- Renaming a couple of columns to avoid using reserved keywords
-- The `active` column is a string with just two possible value. It makes more sense as a bool
SELECT
    id,
    name AS activity_name,
    CASE
        WHEN active = 'Yes' THEN TRUE
        ELSE FALSE
    END AS is_active,
    type AS activity_type
FROM "postgres"."public"."activity_types"
  );
[0m19:02:15.432427 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:02:15.437363 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m19:02:15.437864 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types" rename to "stg_pipedrive__activity_types__dbt_backup"
[0m19:02:15.439842 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:02:15.444093 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m19:02:15.444567 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_tmp" rename to "stg_pipedrive__activity_types"
[0m19:02:15.446478 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:02:15.448263 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: COMMIT
[0m19:02:15.448720 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m19:02:15.449131 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: COMMIT
[0m19:02:15.451138 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m19:02:15.453719 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_backup"
[0m19:02:15.454370 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m19:02:15.454879 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_backup" cascade
[0m19:02:15.457584 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m19:02:15.459192 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: Close
[0m19:02:15.459776 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ce3d9f7-8e57-414a-bcf5-3b0df839a0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109292e10>]}
[0m19:02:15.460446 [info ] [Thread-1 (]: 3 of 36 OK created sql view model public_pipedrive_analytics.stg_pipedrive__activity_types  [[32mCREATE VIEW[0m in 0.06s]
[0m19:02:15.461162 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m19:02:15.461669 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m19:02:15.462377 [info ] [Thread-1 (]: 4 of 36 START sql view model public_pipedrive_analytics.stg_pipedrive__deal_changes  [RUN]
[0m19:02:15.463019 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__activity_types, now model.enpal_assessment_project.stg_pipedrive__deal_changes)
[0m19:02:15.463479 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m19:02:15.466721 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m19:02:15.467579 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m19:02:15.471186 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m19:02:15.472083 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m19:02:15.472529 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: BEGIN
[0m19:02:15.472933 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:15.489815 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m19:02:15.490587 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m19:02:15.491087 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_tmp"
    
    
  as (
    -- This model is generated from the `deal_changes` table in the `pipedrive` schema.
-- This is not a source deals table, and deal_id is not a PK (UNIQUE), so leave deal_id named as is
WITH base_deal_changes AS (
    SELECT
        deal_id,
        change_time::TIMESTAMP AS change_time,
        changed_field_key,
        new_value
    FROM "postgres"."public"."deal_changes"
)
SELECT
    deal_id,
    changed_field_key,
    new_value,
    change_time,
    
    EXTRACT(MONTH FROM change_time) AS month_number,
    TO_CHAR(change_time, 'Month') AS month_name

FROM base_deal_changes
  );
[0m19:02:15.494556 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:02:15.498083 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m19:02:15.498551 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes" rename to "stg_pipedrive__deal_changes__dbt_backup"
[0m19:02:15.500262 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:02:15.505553 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m19:02:15.506051 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_tmp" rename to "stg_pipedrive__deal_changes"
[0m19:02:15.507683 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:02:15.509343 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: COMMIT
[0m19:02:15.509814 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m19:02:15.510236 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: COMMIT
[0m19:02:15.512130 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m19:02:15.514741 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_backup"
[0m19:02:15.515427 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m19:02:15.515863 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_backup" cascade
[0m19:02:15.518656 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m19:02:15.520260 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: Close
[0m19:02:15.520850 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ce3d9f7-8e57-414a-bcf5-3b0df839a0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109919c40>]}
[0m19:02:15.521776 [info ] [Thread-1 (]: 4 of 36 OK created sql view model public_pipedrive_analytics.stg_pipedrive__deal_changes  [[32mCREATE VIEW[0m in 0.06s]
[0m19:02:15.522739 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m19:02:15.523407 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__stages
[0m19:02:15.524133 [info ] [Thread-1 (]: 5 of 36 START sql view model public_pipedrive_analytics.stg_pipedrive__stages .. [RUN]
[0m19:02:15.524821 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__deal_changes, now model.enpal_assessment_project.stg_pipedrive__stages)
[0m19:02:15.525262 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__stages
[0m19:02:15.528121 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__stages"
[0m19:02:15.528909 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__stages
[0m19:02:15.532425 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__stages"
[0m19:02:15.533331 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m19:02:15.533795 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: BEGIN
[0m19:02:15.534257 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:15.550258 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m19:02:15.550892 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m19:02:15.551372 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_tmp"
    
    
  as (
    /* NOT USED. 
    The source table has it's origins in the fields table, which is not used in the final model.
    I would rather keep stages and lost_reasons standardised in the final model.
    My assumption is that the fields table is used to store custom fields,
    and if this were to be updated by a sysadmin, the static stages table would not reflect the changes.
NOT USED. */

-- This model is generated from the `stages` table in the `pipedrive` schema.
-- Renaming a couple of columns to avoid using reserved keywords and standardise
SELECT
    stage_id AS id,
    stage_name
FROM "postgres"."public"."stages"
  );
[0m19:02:15.554879 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:02:15.558721 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m19:02:15.559231 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages" rename to "stg_pipedrive__stages__dbt_backup"
[0m19:02:15.560835 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:02:15.564003 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m19:02:15.564491 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_tmp" rename to "stg_pipedrive__stages"
[0m19:02:15.566281 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:02:15.567924 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: COMMIT
[0m19:02:15.568438 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m19:02:15.569048 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: COMMIT
[0m19:02:15.571258 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m19:02:15.573927 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_backup"
[0m19:02:15.574630 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m19:02:15.575072 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_backup" cascade
[0m19:02:15.577821 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m19:02:15.579675 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: Close
[0m19:02:15.580522 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ce3d9f7-8e57-414a-bcf5-3b0df839a0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098ac260>]}
[0m19:02:15.581809 [info ] [Thread-1 (]: 5 of 36 OK created sql view model public_pipedrive_analytics.stg_pipedrive__stages  [[32mCREATE VIEW[0m in 0.06s]
[0m19:02:15.583040 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__stages
[0m19:02:15.583799 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__users
[0m19:02:15.584641 [info ] [Thread-1 (]: 6 of 36 START sql view model public_pipedrive_analytics.stg_pipedrive__users ... [RUN]
[0m19:02:15.585246 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__stages, now model.enpal_assessment_project.stg_pipedrive__users)
[0m19:02:15.585817 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__users
[0m19:02:15.589732 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__users"
[0m19:02:15.590798 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__users
[0m19:02:15.594811 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__users"
[0m19:02:15.595692 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m19:02:15.596313 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: BEGIN
[0m19:02:15.596773 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:15.614602 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:02:15.615287 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m19:02:15.615852 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_tmp"
    
    
  as (
    -- This model is generated from the `users` table in the `pipedrive` schema.
-- Renaming a couple of columns to avoid using reserved keywords and standardise
WITH base_users AS (
    SELECT
        id,
        name AS user_name,
        email AS user_email,
        modified::TIMESTAMP AS modified_time
    FROM "postgres"."public"."users"
)
SELECT
    id,
    user_name,
    user_email,
    modified_time,
    
    EXTRACT(MONTH FROM modified_time) AS month_number,
    TO_CHAR(modified_time, 'Month') AS month_name

FROM base_users
  );
[0m19:02:15.618618 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m19:02:15.622213 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m19:02:15.622809 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__users" rename to "stg_pipedrive__users__dbt_backup"
[0m19:02:15.624422 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:02:15.627639 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m19:02:15.628089 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_tmp" rename to "stg_pipedrive__users"
[0m19:02:15.629950 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:02:15.631672 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: COMMIT
[0m19:02:15.632125 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m19:02:15.632905 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: COMMIT
[0m19:02:15.634945 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m19:02:15.639140 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_backup"
[0m19:02:15.639819 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m19:02:15.640256 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_backup" cascade
[0m19:02:15.642517 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m19:02:15.644083 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: Close
[0m19:02:15.644662 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ce3d9f7-8e57-414a-bcf5-3b0df839a0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109939100>]}
[0m19:02:15.645376 [info ] [Thread-1 (]: 6 of 36 OK created sql view model public_pipedrive_analytics.stg_pipedrive__users  [[32mCREATE VIEW[0m in 0.06s]
[0m19:02:15.646105 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__users
[0m19:02:15.646625 [debug] [Thread-1 (]: Began running node seed.enpal_assessment_project.minor_stages
[0m19:02:15.647335 [info ] [Thread-1 (]: 7 of 36 START seed file public.minor_stages .................................... [RUN]
[0m19:02:15.648099 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__users, now seed.enpal_assessment_project.minor_stages)
[0m19:02:15.648532 [debug] [Thread-1 (]: Began compiling node seed.enpal_assessment_project.minor_stages
[0m19:02:15.648953 [debug] [Thread-1 (]: Began executing node seed.enpal_assessment_project.minor_stages
[0m19:02:15.677586 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m19:02:15.678085 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: BEGIN
[0m19:02:15.678493 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:15.694630 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m19:02:15.695332 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m19:02:15.695817 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "seed.enpal_assessment_project.minor_stages"} */
truncate table "postgres"."public"."minor_stages"
[0m19:02:15.698668 [debug] [Thread-1 (]: SQL status: TRUNCATE TABLE in 0.002 seconds
[0m19:02:15.716766 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m19:02:15.717276 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: 
          insert into "postgres"."public"."minor_stages" ("id", "activity_type", "stage_id", "minor_stage_id") values
          (%s,%s,%s,%s),(%s,%s,%s,%s)
      ...
[0m19:02:15.719058 [debug] [Thread-1 (]: SQL status: INSERT 0 2 in 0.001 seconds
[0m19:02:15.725532 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.enpal_assessment_project.minor_stages"
[0m19:02:15.727493 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: COMMIT
[0m19:02:15.727962 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m19:02:15.728367 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: COMMIT
[0m19:02:15.730732 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m19:02:15.731665 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: Close
[0m19:02:15.732276 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ce3d9f7-8e57-414a-bcf5-3b0df839a0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109938650>]}
[0m19:02:15.732958 [info ] [Thread-1 (]: 7 of 36 OK loaded seed file public.minor_stages ................................ [[32mINSERT 2[0m in 0.08s]
[0m19:02:15.733757 [debug] [Thread-1 (]: Finished running node seed.enpal_assessment_project.minor_stages
[0m19:02:15.734324 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m19:02:15.734910 [info ] [Thread-1 (]: 8 of 36 START test assert_timestamp_equal_add_time_new_value ................... [RUN]
[0m19:02:15.735525 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.enpal_assessment_project.minor_stages, now test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value)
[0m19:02:15.735964 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m19:02:15.738500 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m19:02:15.739504 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m19:02:15.760397 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m19:02:15.761550 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m19:02:15.762224 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: BEGIN
[0m19:02:15.762703 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:15.785408 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m19:02:15.786202 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m19:02:15.786993 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- Assert that the change_time is equal to the new_value when the changed_field_key is 'add_time'
-- With this test, it's OK to ignore the new_value field for add_time changes
SELECT * FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
	WHERE changed_field_key = 'add_time'
	AND change_time != new_value::TIMESTAMP
      
    ) dbt_internal_test
[0m19:02:15.797182 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.009 seconds
[0m19:02:15.802017 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: ROLLBACK
[0m19:02:15.804044 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: Close
[0m19:02:15.805168 [info ] [Thread-1 (]: 8 of 36 PASS assert_timestamp_equal_add_time_new_value ......................... [[32mPASS[0m in 0.07s]
[0m19:02:15.806466 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m19:02:15.807091 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m19:02:15.807922 [info ] [Thread-1 (]: 9 of 36 START sql view model public_pipedrive_analytics.stg_pipedrive__fields_lost_reasons  [RUN]
[0m19:02:15.808681 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value, now model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons)
[0m19:02:15.809189 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m19:02:15.812653 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m19:02:15.813528 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m19:02:15.817339 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m19:02:15.818195 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m19:02:15.818644 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: BEGIN
[0m19:02:15.819048 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:15.842080 [debug] [Thread-1 (]: SQL status: BEGIN in 0.023 seconds
[0m19:02:15.843178 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m19:02:15.844020 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_tmp"
    
    
  as (
    -- This model is generated from the `base_pipedrive__fields` model, which has the values buried in a JSON array.
-- ids should be INTEGER as a rule, even though one DBT test is comparing this to a STRING, I still prefer to cast to INTEGER here and in the test.
-- because in the real world, collaborators would be confused to see numeric-looking values as STRINGs.
WITH expand_array AS (
	SELECT 
		jsonb_array_elements(field_value_options) AS field_value_options
	FROM "postgres"."public_pipedrive_analytics"."base_pipedrive__fields"
	WHERE field_key = 'lost_reason'
)
SELECT
	CAST(field_value_options ->> 'id' AS INTEGER) AS id,
	field_value_options ->> 'label' AS label
FROM expand_array
  );
[0m19:02:15.848679 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:02:15.853373 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m19:02:15.854139 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_tmp" rename to "stg_pipedrive__fields_lost_reasons"
[0m19:02:15.857529 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:02:15.859821 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: COMMIT
[0m19:02:15.860655 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m19:02:15.861286 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: COMMIT
[0m19:02:15.864073 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m19:02:15.867802 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_backup"
[0m19:02:15.868858 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m19:02:15.869642 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_backup" cascade
[0m19:02:15.871548 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:02:15.874001 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: Close
[0m19:02:15.874986 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ce3d9f7-8e57-414a-bcf5-3b0df839a0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10949e990>]}
[0m19:02:15.875942 [info ] [Thread-1 (]: 9 of 36 OK created sql view model public_pipedrive_analytics.stg_pipedrive__fields_lost_reasons  [[32mCREATE VIEW[0m in 0.07s]
[0m19:02:15.876876 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m19:02:15.877481 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m19:02:15.878381 [info ] [Thread-1 (]: 10 of 36 START sql view model public_pipedrive_analytics.stg_pipedrive__fields_stages  [RUN]
[0m19:02:15.879384 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons, now model.enpal_assessment_project.stg_pipedrive__fields_stages)
[0m19:02:15.880097 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m19:02:15.884780 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m19:02:15.885838 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m19:02:15.894733 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m19:02:15.895990 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m19:02:15.896686 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: BEGIN
[0m19:02:15.897284 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:15.918344 [debug] [Thread-1 (]: SQL status: BEGIN in 0.021 seconds
[0m19:02:15.919295 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m19:02:15.920060 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_stages"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_tmp"
    
    
  as (
    -- This model is generated from the `base_pipedrive__fields` model, which has the values buried in a JSON array.
-- ids should be INTEGER as a rule, even though one DBT test is comparing this to a STRING, I still prefer to cast to INTEGER here and in the test.
-- because in the real world, collaborators would be confused to see numeric-looking values as STRINGs.
WITH expand_array AS (
	SELECT 
		jsonb_array_elements(field_value_options) AS field_value_options
	FROM "postgres"."public_pipedrive_analytics"."base_pipedrive__fields"
	WHERE field_key = 'stage_id'
)
SELECT
	CAST(field_value_options ->> 'id' AS INTEGER) AS id,
	field_value_options ->> 'label' AS label
FROM expand_array
  );
[0m19:02:15.923818 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:02:15.927551 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m19:02:15.928051 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_stages"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_tmp" rename to "stg_pipedrive__fields_stages"
[0m19:02:15.929737 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:02:15.931460 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: COMMIT
[0m19:02:15.932051 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m19:02:15.932494 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: COMMIT
[0m19:02:15.934847 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m19:02:15.937428 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_backup"
[0m19:02:15.938382 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m19:02:15.938877 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_stages"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_backup" cascade
[0m19:02:15.940389 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:02:15.941991 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: Close
[0m19:02:15.942648 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ce3d9f7-8e57-414a-bcf5-3b0df839a0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099114f0>]}
[0m19:02:15.943448 [info ] [Thread-1 (]: 10 of 36 OK created sql view model public_pipedrive_analytics.stg_pipedrive__fields_stages  [[32mCREATE VIEW[0m in 0.06s]
[0m19:02:15.944197 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m19:02:15.944842 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m19:02:15.945509 [info ] [Thread-1 (]: 11 of 36 START test not_null_stg_pipedrive__activity_deal_id ................... [RUN]
[0m19:02:15.946277 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__fields_stages, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e)
[0m19:02:15.946785 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m19:02:15.958761 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m19:02:15.959605 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m19:02:15.962148 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m19:02:15.963111 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m19:02:15.963678 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: BEGIN
[0m19:02:15.964093 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:15.980557 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m19:02:15.981232 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m19:02:15.981709 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select deal_id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where deal_id is null



      
    ) dbt_internal_test
[0m19:02:15.984475 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m19:02:15.986219 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: ROLLBACK
[0m19:02:15.987552 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: Close
[0m19:02:15.988287 [info ] [Thread-1 (]: 11 of 36 PASS not_null_stg_pipedrive__activity_deal_id ......................... [[32mPASS[0m in 0.04s]
[0m19:02:15.989056 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m19:02:15.989742 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m19:02:15.990334 [info ] [Thread-1 (]: 12 of 36 START test not_null_stg_pipedrive__activity_due_time .................. [RUN]
[0m19:02:15.991085 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191)
[0m19:02:15.991550 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m19:02:15.996297 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m19:02:15.997344 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m19:02:16.001032 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m19:02:16.001919 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m19:02:16.002390 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: BEGIN
[0m19:02:16.002792 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:16.019730 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m19:02:16.020495 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m19:02:16.020988 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select due_time
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where due_time is null



      
    ) dbt_internal_test
[0m19:02:16.024265 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m19:02:16.026186 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: ROLLBACK
[0m19:02:16.027674 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: Close
[0m19:02:16.028401 [info ] [Thread-1 (]: 12 of 36 PASS not_null_stg_pipedrive__activity_due_time ........................ [[32mPASS[0m in 0.04s]
[0m19:02:16.029843 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m19:02:16.030511 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m19:02:16.031099 [info ] [Thread-1 (]: 13 of 36 START test not_null_stg_pipedrive__activity_id ........................ [RUN]
[0m19:02:16.031891 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb)
[0m19:02:16.032522 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m19:02:16.036710 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m19:02:16.037583 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m19:02:16.040016 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m19:02:16.040787 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m19:02:16.041337 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: BEGIN
[0m19:02:16.041790 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:16.057736 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m19:02:16.058390 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m19:02:16.058842 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where id is null



      
    ) dbt_internal_test
[0m19:02:16.061285 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m19:02:16.063022 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: ROLLBACK
[0m19:02:16.064350 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: Close
[0m19:02:16.065125 [info ] [Thread-1 (]: 13 of 36 PASS not_null_stg_pipedrive__activity_id .............................. [[32mPASS[0m in 0.03s]
[0m19:02:16.066595 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m19:02:16.067223 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m19:02:16.067812 [info ] [Thread-1 (]: 14 of 36 START test not_null_stg_pipedrive__activity_is_done ................... [RUN]
[0m19:02:16.068412 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543)
[0m19:02:16.068855 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m19:02:16.073087 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m19:02:16.073900 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m19:02:16.076316 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m19:02:16.077139 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m19:02:16.077570 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: BEGIN
[0m19:02:16.078009 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:16.094245 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m19:02:16.094916 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m19:02:16.095378 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select is_done
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where is_done is null



      
    ) dbt_internal_test
[0m19:02:16.099126 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m19:02:16.100975 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: ROLLBACK
[0m19:02:16.102272 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: Close
[0m19:02:16.102990 [info ] [Thread-1 (]: 14 of 36 PASS not_null_stg_pipedrive__activity_is_done ......................... [[32mPASS[0m in 0.03s]
[0m19:02:16.103720 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m19:02:16.104236 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m19:02:16.104734 [info ] [Thread-1 (]: 15 of 36 START test relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_  [RUN]
[0m19:02:16.105493 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543, now test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8)
[0m19:02:16.105969 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m19:02:16.116628 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m19:02:16.117490 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m19:02:16.119783 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m19:02:16.120687 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m19:02:16.121362 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: BEGIN
[0m19:02:16.121830 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:16.139017 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m19:02:16.139828 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m19:02:16.140556 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select activity_type as from_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
    where activity_type is not null
),

parent as (
    select activity_type as to_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m19:02:16.145238 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.004 seconds
[0m19:02:16.146965 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: ROLLBACK
[0m19:02:16.148314 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: Close
[0m19:02:16.149288 [info ] [Thread-1 (]: 15 of 36 PASS relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_  [[32mPASS[0m in 0.04s]
[0m19:02:16.150144 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m19:02:16.150686 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m19:02:16.151137 [info ] [Thread-1 (]: 16 of 36 START test accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time  [RUN]
[0m19:02:16.151817 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8, now test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0)
[0m19:02:16.152381 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m19:02:16.163443 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m19:02:16.164306 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m19:02:16.167175 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m19:02:16.168097 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m19:02:16.168557 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: BEGIN
[0m19:02:16.168965 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:16.185545 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m19:02:16.186316 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m19:02:16.186901 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        changed_field_key as value_field,
        count(*) as n_records

    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
    group by changed_field_key

)

select *
from all_values
where value_field not in (
    'user_id','stage_id','lost_reason','add_time'
)



      
    ) dbt_internal_test
[0m19:02:16.191885 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.004 seconds
[0m19:02:16.193671 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: ROLLBACK
[0m19:02:16.195066 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: Close
[0m19:02:16.195837 [info ] [Thread-1 (]: 16 of 36 PASS accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time  [[32mPASS[0m in 0.04s]
[0m19:02:16.196671 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m19:02:16.197270 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m19:02:16.198024 [info ] [Thread-1 (]: 17 of 36 START test not_null_stg_pipedrive__deal_changes_change_time ........... [RUN]
[0m19:02:16.198718 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0, now test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d)
[0m19:02:16.199357 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m19:02:16.204304 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m19:02:16.205221 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m19:02:16.207666 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m19:02:16.208515 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m19:02:16.209034 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: BEGIN
[0m19:02:16.209441 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:16.225863 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m19:02:16.226665 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m19:02:16.227133 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select change_time
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
where change_time is null



      
    ) dbt_internal_test
[0m19:02:16.230516 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m19:02:16.232586 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: ROLLBACK
[0m19:02:16.234565 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: Close
[0m19:02:16.235573 [info ] [Thread-1 (]: 17 of 36 PASS not_null_stg_pipedrive__deal_changes_change_time ................. [[32mPASS[0m in 0.04s]
[0m19:02:16.236579 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m19:02:16.237102 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m19:02:16.237699 [info ] [Thread-1 (]: 18 of 36 START test not_null_stg_pipedrive__deal_changes_deal_id ............... [RUN]
[0m19:02:16.238374 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d, now test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d)
[0m19:02:16.238853 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m19:02:16.243151 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m19:02:16.243976 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m19:02:16.246361 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m19:02:16.247163 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m19:02:16.247596 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: BEGIN
[0m19:02:16.248007 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:16.264707 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m19:02:16.265361 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m19:02:16.265876 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select deal_id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
where deal_id is null



      
    ) dbt_internal_test
[0m19:02:16.269259 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m19:02:16.271013 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: ROLLBACK
[0m19:02:16.272341 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: Close
[0m19:02:16.273240 [info ] [Thread-1 (]: 18 of 36 PASS not_null_stg_pipedrive__deal_changes_deal_id ..................... [[32mPASS[0m in 0.03s]
[0m19:02:16.274112 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m19:02:16.274703 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m19:02:16.275219 [info ] [Thread-1 (]: 19 of 36 START test not_null_stg_pipedrive__deal_changes_new_value ............. [RUN]
[0m19:02:16.275844 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d, now test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96)
[0m19:02:16.276296 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m19:02:16.280459 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m19:02:16.281282 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m19:02:16.283835 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m19:02:16.284671 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m19:02:16.285159 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: BEGIN
[0m19:02:16.285597 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:16.303183 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m19:02:16.303986 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m19:02:16.304511 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select new_value
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
where new_value is null



      
    ) dbt_internal_test
[0m19:02:16.307965 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m19:02:16.309815 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: ROLLBACK
[0m19:02:16.311214 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: Close
[0m19:02:16.312081 [info ] [Thread-1 (]: 19 of 36 PASS not_null_stg_pipedrive__deal_changes_new_value ................... [[32mPASS[0m in 0.04s]
[0m19:02:16.312840 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m19:02:16.313357 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_change_user_references_user_id
[0m19:02:16.313885 [info ] [Thread-1 (]: 20 of 36 START test assert_change_user_references_user_id ...................... [RUN]
[0m19:02:16.314601 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96, now test.enpal_assessment_project.assert_change_user_references_user_id)
[0m19:02:16.315058 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_change_user_references_user_id
[0m19:02:16.318109 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m19:02:16.318939 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_change_user_references_user_id
[0m19:02:16.321368 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m19:02:16.322572 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m19:02:16.323223 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: BEGIN
[0m19:02:16.323695 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:16.340262 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m19:02:16.341022 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m19:02:16.341530 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_change_user_references_user_id"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- CTE to pre-filter deal_changes for stage_id changes
-- to safely cast new_value to an integer when we're sure all the values can be implicitly casted
WITH deal_change_user AS (
	SELECT changed_field_key, new_value FROM deal_changes
	WHERE changed_field_key = 'user_id'
)
SELECT *
FROM deal_change_user d
LEFT OUTER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__users" u
ON CAST(d.new_value AS INTEGER) = u.id
WHERE u.id IS NULL -- Any non referential values in d will return a NULL s.id
      
    ) dbt_internal_test
[0m19:02:16.347123 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m19:02:16.349378 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: ROLLBACK
[0m19:02:16.350948 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: Close
[0m19:02:16.351910 [info ] [Thread-1 (]: 20 of 36 PASS assert_change_user_references_user_id ............................ [[32mPASS[0m in 0.04s]
[0m19:02:16.352858 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_change_user_references_user_id
[0m19:02:16.353505 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m19:02:16.354378 [info ] [Thread-1 (]: 21 of 36 START test not_null_stg_pipedrive__users_id ........................... [RUN]
[0m19:02:16.355460 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_change_user_references_user_id, now test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817)
[0m19:02:16.356258 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m19:02:16.364398 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m19:02:16.365315 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m19:02:16.424062 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m19:02:16.433024 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m19:02:16.433700 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: BEGIN
[0m19:02:16.434275 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:16.452971 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m19:02:16.453724 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m19:02:16.454227 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where id is null



      
    ) dbt_internal_test
[0m19:02:16.456582 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m19:02:16.458405 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: ROLLBACK
[0m19:02:16.459690 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: Close
[0m19:02:16.460425 [info ] [Thread-1 (]: 21 of 36 PASS not_null_stg_pipedrive__users_id ................................. [[32mPASS[0m in 0.11s]
[0m19:02:16.461351 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m19:02:16.461931 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m19:02:16.462509 [info ] [Thread-1 (]: 22 of 36 START test not_null_stg_pipedrive__users_modified_time ................ [RUN]
[0m19:02:16.463322 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817, now test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5)
[0m19:02:16.463799 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m19:02:16.468447 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m19:02:16.469404 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m19:02:16.471928 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m19:02:16.472761 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m19:02:16.473246 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: BEGIN
[0m19:02:16.473660 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:16.489533 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m19:02:16.490267 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m19:02:16.490765 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select modified_time
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where modified_time is null



      
    ) dbt_internal_test
[0m19:02:16.493412 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m19:02:16.495168 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: ROLLBACK
[0m19:02:16.496652 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: Close
[0m19:02:16.497559 [info ] [Thread-1 (]: 22 of 36 PASS not_null_stg_pipedrive__users_modified_time ...................... [[32mPASS[0m in 0.03s]
[0m19:02:16.498394 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m19:02:16.498925 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m19:02:16.499950 [info ] [Thread-1 (]: 23 of 36 START test not_null_stg_pipedrive__users_user_email ................... [RUN]
[0m19:02:16.500779 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5, now test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157)
[0m19:02:16.501454 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m19:02:16.505754 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m19:02:16.506745 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m19:02:16.509666 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m19:02:16.510547 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m19:02:16.511015 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: BEGIN
[0m19:02:16.511419 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:16.528755 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m19:02:16.529596 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m19:02:16.530221 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select user_email
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where user_email is null



      
    ) dbt_internal_test
[0m19:02:16.533440 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m19:02:16.535419 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: ROLLBACK
[0m19:02:16.537004 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: Close
[0m19:02:16.537966 [info ] [Thread-1 (]: 23 of 36 PASS not_null_stg_pipedrive__users_user_email ......................... [[32mPASS[0m in 0.04s]
[0m19:02:16.539205 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m19:02:16.539912 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m19:02:16.540989 [info ] [Thread-1 (]: 24 of 36 START test not_null_stg_pipedrive__users_user_name .................... [RUN]
[0m19:02:16.541724 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157, now test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5)
[0m19:02:16.542301 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m19:02:16.546824 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m19:02:16.547741 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m19:02:16.550373 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m19:02:16.551256 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m19:02:16.551697 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: BEGIN
[0m19:02:16.552110 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:16.569943 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:02:16.570759 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m19:02:16.571233 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select user_name
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where user_name is null



      
    ) dbt_internal_test
[0m19:02:16.574357 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m19:02:16.576101 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: ROLLBACK
[0m19:02:16.577463 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: Close
[0m19:02:16.578204 [info ] [Thread-1 (]: 24 of 36 PASS not_null_stg_pipedrive__users_user_name .......................... [[32mPASS[0m in 0.04s]
[0m19:02:16.578951 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m19:02:16.579473 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m19:02:16.579978 [info ] [Thread-1 (]: 25 of 36 START test relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_  [RUN]
[0m19:02:16.580789 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5, now test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d)
[0m19:02:16.581537 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m19:02:16.587563 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m19:02:16.588486 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m19:02:16.590733 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m19:02:16.591580 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m19:02:16.592022 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: BEGIN
[0m19:02:16.592537 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:16.610287 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:02:16.610885 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m19:02:16.611516 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select user_id as from_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
    where user_id is not null
),

parent as (
    select id as to_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m19:02:16.617959 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.006 seconds
[0m19:02:16.619691 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: ROLLBACK
[0m19:02:16.621308 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: Close
[0m19:02:16.622317 [info ] [Thread-1 (]: 25 of 36 PASS relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_  [[32mPASS[0m in 0.04s]
[0m19:02:16.623391 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m19:02:16.624026 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m19:02:16.624653 [info ] [Thread-1 (]: 26 of 36 START test assert_change_stage_references_lost_reason_id .............. [RUN]
[0m19:02:16.625242 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d, now test.enpal_assessment_project.assert_change_stage_references_lost_reason_id)
[0m19:02:16.625694 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m19:02:16.628420 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m19:02:16.629372 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m19:02:16.631728 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m19:02:16.632623 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m19:02:16.633129 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: BEGIN
[0m19:02:16.633554 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:16.650615 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m19:02:16.651344 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m19:02:16.651923 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- CTE to pre-filter deal_changes for stage_id changes
-- to safely cast new_value to an integer when we're sure all the values can be implicitly casted
WITH deal_change_stage AS (
	SELECT changed_field_key, new_value FROM deal_changes
	WHERE changed_field_key = 'lost_reason'
)
SELECT *
FROM deal_change_stage d
LEFT OUTER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons" s
ON CAST(d.new_value AS INTEGER) = s.id
WHERE s.id IS NULL -- Any non referential values in d will return a NULL s.id
      
    ) dbt_internal_test
[0m19:02:16.656906 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.004 seconds
[0m19:02:16.658591 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: ROLLBACK
[0m19:02:16.660006 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: Close
[0m19:02:16.660885 [info ] [Thread-1 (]: 26 of 36 PASS assert_change_stage_references_lost_reason_id .................... [[32mPASS[0m in 0.04s]
[0m19:02:16.661742 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m19:02:16.662280 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m19:02:16.662811 [info ] [Thread-1 (]: 27 of 36 START test assert_change_stage_references_stage_id .................... [RUN]
[0m19:02:16.663752 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_change_stage_references_lost_reason_id, now test.enpal_assessment_project.assert_change_stage_references_stage_id)
[0m19:02:16.664230 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m19:02:16.667368 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m19:02:16.668202 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m19:02:16.673472 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m19:02:16.674337 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m19:02:16.674770 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: BEGIN
[0m19:02:16.675184 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:16.693957 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m19:02:16.694919 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m19:02:16.695459 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_change_stage_references_stage_id"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- CTE to pre-filter deal_changes for stage_id changes
-- to safely cast new_value to an integer when we're sure all the values can be implicitly casted
WITH deal_change_stage AS (
	SELECT changed_field_key, new_value FROM deal_changes
	WHERE changed_field_key = 'stage_id'
)
SELECT *
FROM deal_change_stage d
LEFT OUTER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages" s
ON CAST(d.new_value AS INTEGER) = s.id
WHERE s.id IS NULL -- Any non referential values in d will return a NULL s.id
      
    ) dbt_internal_test
[0m19:02:16.702951 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.007 seconds
[0m19:02:16.704943 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: ROLLBACK
[0m19:02:16.706521 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: Close
[0m19:02:16.707266 [info ] [Thread-1 (]: 27 of 36 PASS assert_change_stage_references_stage_id .......................... [[32mPASS[0m in 0.04s]
[0m19:02:16.708026 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m19:02:16.708816 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_activity_join_activity_type
[0m19:02:16.709453 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_change_stage_references_stage_id, now model.enpal_assessment_project.int_activity_join_activity_type)
[0m19:02:16.710039 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_activity_join_activity_type
[0m19:02:16.713779 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_activity_join_activity_type"
[0m19:02:16.714939 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_activity_join_activity_type
[0m19:02:16.715435 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m19:02:16.715967 [info ] [Thread-1 (]: 28 of 36 START sql view model public_pipedrive_analytics.int_deal_changes_dedupe_new_deal  [RUN]
[0m19:02:16.716717 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_activity_join_activity_type, now model.enpal_assessment_project.int_deal_changes_dedupe_new_deal)
[0m19:02:16.717195 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m19:02:16.719964 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m19:02:16.720717 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m19:02:16.724502 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m19:02:16.725744 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m19:02:16.726277 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: BEGIN
[0m19:02:16.726745 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:16.744523 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:02:16.745231 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m19:02:16.745737 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"} */

  create view "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_tmp"
    
    
  as (
    -- Separate new deals model from the deal_changes model
-- There are a handful of dupe deals in the deal_changes model (assumption - deals should not have more than one added date)
-- Materialize as a view so it can be tested for deduplication
SELECT
	deal_id, 
	MAX(change_time) AS created_time
FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
WHERE changed_field_key = 'add_time'
GROUP BY
	deal_id
  );
[0m19:02:16.749906 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:02:16.753158 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m19:02:16.753632 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"} */
alter table "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_tmp" rename to "int_deal_changes_dedupe_new_deal"
[0m19:02:16.755573 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:02:16.757448 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: COMMIT
[0m19:02:16.757954 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m19:02:16.758365 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: COMMIT
[0m19:02:16.760485 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m19:02:16.762953 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_backup"
[0m19:02:16.763718 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m19:02:16.764232 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"} */
drop view if exists "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_backup" cascade
[0m19:02:16.765940 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:02:16.767690 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: Close
[0m19:02:16.768391 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ce3d9f7-8e57-414a-bcf5-3b0df839a0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10949ecf0>]}
[0m19:02:16.769202 [info ] [Thread-1 (]: 28 of 36 OK created sql view model public_pipedrive_analytics.int_deal_changes_dedupe_new_deal  [[32mCREATE VIEW[0m in 0.05s]
[0m19:02:16.770001 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m19:02:16.770527 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_user
[0m19:02:16.771201 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_dedupe_new_deal, now model.enpal_assessment_project.int_deal_changes_user)
[0m19:02:16.771892 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_user
[0m19:02:16.775499 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_user"
[0m19:02:16.776806 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_user
[0m19:02:16.777324 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m19:02:16.777904 [info ] [Thread-1 (]: 29 of 36 START sql view model public_pipedrive_analytics.int_deal_changes_dedupe_lost_reason  [RUN]
[0m19:02:16.778430 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_user, now model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason)
[0m19:02:16.778857 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m19:02:16.782106 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m19:02:16.782907 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m19:02:16.786642 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m19:02:16.787537 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m19:02:16.788091 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: BEGIN
[0m19:02:16.788834 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:16.807818 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m19:02:16.808511 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m19:02:16.809000 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"} */

  create view "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_tmp"
    
    
  as (
    WITH deal_changes_lost_reason AS (
	SELECT
		ROW_NUMBER() OVER(PARTITION BY deal_id ORDER BY change_time DESC) AS reverse_order,
		deal_id,
		new_value AS lost_reason_id,
		change_time,
		month_name,
		month_number
	FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
	WHERE changed_field_key = 'lost_reason'
),
deal_changes_lost_reason_cast_id AS (
	SELECT
		deal_id,
		CAST(lost_reason_id AS INTEGER) AS lost_reason_id, -- do it here once rather than twice in the final select & join clauses
		change_time,
		month_name,
		month_number
	FROM deal_changes_lost_reason
	WHERE reverse_order = 1
)
SELECT
dcr.deal_id,
dcr.lost_reason_id,
lost_reasons.label,
dcr.change_time,
dcr.month_name,
dcr.month_number
FROM deal_changes_lost_reason_cast_id dcr
INNER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons" lost_reasons
ON dcr.lost_reason_id = lost_reasons.id
  );
[0m19:02:16.813215 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:02:16.816389 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m19:02:16.816898 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"} */
alter table "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_tmp" rename to "int_deal_changes_dedupe_lost_reason"
[0m19:02:16.818898 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:02:16.820730 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: COMMIT
[0m19:02:16.821201 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m19:02:16.821696 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: COMMIT
[0m19:02:16.824019 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m19:02:16.826627 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_backup"
[0m19:02:16.827309 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m19:02:16.827749 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"} */
drop view if exists "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_backup" cascade
[0m19:02:16.829473 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:02:16.831065 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: Close
[0m19:02:16.831688 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ce3d9f7-8e57-414a-bcf5-3b0df839a0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098f7260>]}
[0m19:02:16.832550 [info ] [Thread-1 (]: 29 of 36 OK created sql view model public_pipedrive_analytics.int_deal_changes_dedupe_lost_reason  [[32mCREATE VIEW[0m in 0.05s]
[0m19:02:16.833582 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m19:02:16.834386 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m19:02:16.835256 [info ] [Thread-1 (]: 30 of 36 START sql view model public_pipedrive_analytics.int_deal_changes_dedupe_stage  [RUN]
[0m19:02:16.835926 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason, now model.enpal_assessment_project.int_deal_changes_dedupe_stage)
[0m19:02:16.836557 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m19:02:16.842103 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m19:02:16.843005 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m19:02:16.846928 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m19:02:16.847737 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m19:02:16.848185 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: BEGIN
[0m19:02:16.848597 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:16.868286 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m19:02:16.869029 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m19:02:16.869562 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_stage"} */

  create view "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_tmp"
    
    
  as (
    -- Separate new deals model from the deal_changes model
-- There are a handful of dupe deals in the deal_changes model (assumption - deals should not have more of each stage id)
-- Materialize as a view so it can be tested for deduplication
-- Method: row_number in reverse order and then pick the first row. 
-- This pattern is better because we don't know how many duplicate rows there could be, but the latest will always be row number 1.
-- Can't just take MAX(new_value) as was done for new_deals, because there are multiple stage_ids and all that appear need to be presented to the model.
WITH deal_changes_stage AS (
	SELECT
		ROW_NUMBER() OVER(PARTITION BY deal_id, new_value ORDER BY new_value, change_time DESC) AS reverse_order,
		deal_id,
		new_value AS stage_id,
		change_time,
		month_name,
		month_number
	FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
	WHERE changed_field_key = 'stage_id'
),
deal_changes_stage_cast_id AS (
	SELECT
		deal_id,
		CAST(stage_id AS INTEGER) AS stage_id, -- do it here once rather than twice in the final select & join clauses
		change_time,
		month_name,
		month_number
	FROM deal_changes_stage
	WHERE reverse_order = 1
)
SELECT
dcs.deal_id,
dcs.stage_id,
stages.label,
dcs.change_time,
dcs.month_name,
dcs.month_number
FROM deal_changes_stage_cast_id dcs
INNER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages" stages
ON dcs.stage_id = stages.id
  );
[0m19:02:16.874255 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:02:16.878230 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m19:02:16.878730 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_stage"} */
alter table "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_tmp" rename to "int_deal_changes_dedupe_stage"
[0m19:02:16.880458 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:02:16.881966 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: COMMIT
[0m19:02:16.882408 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m19:02:16.882824 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: COMMIT
[0m19:02:16.885070 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m19:02:16.887795 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_backup"
[0m19:02:16.888527 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m19:02:16.889043 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_stage"} */
drop view if exists "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_backup" cascade
[0m19:02:16.890929 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:02:16.892612 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: Close
[0m19:02:16.893247 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ce3d9f7-8e57-414a-bcf5-3b0df839a0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083d49b0>]}
[0m19:02:16.893936 [info ] [Thread-1 (]: 30 of 36 OK created sql view model public_pipedrive_analytics.int_deal_changes_dedupe_stage  [[32mCREATE VIEW[0m in 0.06s]
[0m19:02:16.894688 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m19:02:16.895227 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m19:02:16.895847 [info ] [Thread-1 (]: 31 of 36 START test unique_int_deal_changes_dedupe_new_deal_deal_id ............ [RUN]
[0m19:02:16.896599 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_dedupe_stage, now test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc)
[0m19:02:16.897049 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m19:02:16.904965 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m19:02:16.905841 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m19:02:16.908272 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m19:02:16.909156 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m19:02:16.909617 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: BEGIN
[0m19:02:16.910033 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:16.929853 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m19:02:16.930670 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m19:02:16.931169 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    deal_id as unique_field,
    count(*) as n_records

from "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal"
where deal_id is not null
group by deal_id
having count(*) > 1



      
    ) dbt_internal_test
[0m19:02:16.937084 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m19:02:16.938979 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: ROLLBACK
[0m19:02:16.940571 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: Close
[0m19:02:16.941392 [info ] [Thread-1 (]: 31 of 36 PASS unique_int_deal_changes_dedupe_new_deal_deal_id .................. [[32mPASS[0m in 0.04s]
[0m19:02:16.942144 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m19:02:16.942691 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m19:02:16.943138 [info ] [Thread-1 (]: 32 of 36 START test unique_int_deal_changes_dedupe_lost_reason_deal_id ......... [RUN]
[0m19:02:16.943835 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc, now test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907)
[0m19:02:16.944463 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m19:02:16.948831 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m19:02:16.949655 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m19:02:16.952035 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m19:02:16.952844 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m19:02:16.953298 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: BEGIN
[0m19:02:16.953713 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:16.971781 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:02:16.972643 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m19:02:16.973679 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    deal_id as unique_field,
    count(*) as n_records

from "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason"
where deal_id is not null
group by deal_id
having count(*) > 1



      
    ) dbt_internal_test
[0m19:02:16.983364 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.009 seconds
[0m19:02:16.985172 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: ROLLBACK
[0m19:02:16.986690 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: Close
[0m19:02:16.987461 [info ] [Thread-1 (]: 32 of 36 PASS unique_int_deal_changes_dedupe_lost_reason_deal_id ............... [[32mPASS[0m in 0.04s]
[0m19:02:16.988628 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m19:02:16.989346 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_unique_deal_stage
[0m19:02:16.990320 [info ] [Thread-1 (]: 33 of 36 START test assert_unique_deal_stage ................................... [RUN]
[0m19:02:16.991121 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907, now test.enpal_assessment_project.assert_unique_deal_stage)
[0m19:02:16.991660 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_unique_deal_stage
[0m19:02:16.994958 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_unique_deal_stage"
[0m19:02:16.995977 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_unique_deal_stage
[0m19:02:16.998427 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_unique_deal_stage"
[0m19:02:16.999311 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_unique_deal_stage"
[0m19:02:16.999867 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: BEGIN
[0m19:02:17.000276 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:17.018032 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:02:17.018785 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_unique_deal_stage"
[0m19:02:17.019344 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_unique_deal_stage"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT
    COUNT(*),
    deal_id,
    stage_id
FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage"
GROUP BY
    deal_id,
    stage_id
HAVING COUNT(*) > 1
      
    ) dbt_internal_test
[0m19:02:17.043301 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.023 seconds
[0m19:02:17.045105 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: ROLLBACK
[0m19:02:17.046563 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: Close
[0m19:02:17.047300 [info ] [Thread-1 (]: 33 of 36 PASS assert_unique_deal_stage ......................................... [[32mPASS[0m in 0.06s]
[0m19:02:17.048071 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_unique_deal_stage
[0m19:02:17.048595 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_activity
[0m19:02:17.049218 [info ] [Thread-1 (]: 34 of 36 START sql view model public_pipedrive_analytics.int_deal_changes_activity  [RUN]
[0m19:02:17.050091 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_unique_deal_stage, now model.enpal_assessment_project.int_deal_changes_activity)
[0m19:02:17.050561 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_activity
[0m19:02:17.057191 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_activity"
[0m19:02:17.058042 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.int_deal_changes_activity
[0m19:02:17.062674 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.int_deal_changes_activity"
[0m19:02:17.063478 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_activity"
[0m19:02:17.063950 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_activity: BEGIN
[0m19:02:17.064378 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:17.084340 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m19:02:17.085051 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_activity"
[0m19:02:17.085575 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_activity"} */

  create view "postgres"."public_pipedrive_analytics"."int_deal_changes_activity__dbt_tmp"
    
    
  as (
    with __dbt__cte__int_activity_join_activity_type as (
-- Simple Intermediate Model to join activity and activity_types
-- thus providing the friendly name of the activity type
-- Filter out inactive activity types, they are not used in the final report


SELECT
	a.user_id,
	a.deal_id,
	t.activity_name,
	ms.stage_id,
	ms.minor_stage_id,
	t.is_active, -- this would be a mart level filter: business logic determines when to include deactivated activity types
	a.is_done, -- this would be a report level filter: analyst determines when to exclude incomplete activities
	a.due_time,
	a.month_name,
	a.month_number
FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity" a
INNER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types" t
	ON a.activity_type = t.activity_type
INNER JOIN "postgres"."public"."minor_stages" ms
	ON t.activity_type = ms.activity_type
) -- brings in the activity data for each deal in the deal_changes table
-- Note that there are very few rows compared to the total number of deals
-- These will just be the ones with call activities against them
SELECT
    nd.deal_id,
    act.activity_name,
    act.stage_id,
    act.minor_stage_id,
    act.is_active, -- this would be a mart level filter: business logic determines when to include deactivated activity types
    act.is_done, -- this would be a report level filter: analyst determines when to exclude incomplete activities
    act.month_number,
    act.month_name
FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal" nd
INNER JOIN __dbt__cte__int_activity_join_activity_type act
ON nd.deal_id = act.deal_id
  );
[0m19:02:17.089675 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:02:17.094873 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_activity"
[0m19:02:17.095372 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_activity"} */
alter table "postgres"."public_pipedrive_analytics"."int_deal_changes_activity__dbt_tmp" rename to "int_deal_changes_activity"
[0m19:02:17.097147 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:02:17.098698 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_activity: COMMIT
[0m19:02:17.099160 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_activity"
[0m19:02:17.099955 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_activity: COMMIT
[0m19:02:17.102278 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m19:02:17.104746 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."int_deal_changes_activity__dbt_backup"
[0m19:02:17.105430 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_activity"
[0m19:02:17.105862 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_activity"} */
drop view if exists "postgres"."public_pipedrive_analytics"."int_deal_changes_activity__dbt_backup" cascade
[0m19:02:17.107407 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:02:17.109086 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_activity: Close
[0m19:02:17.109698 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ce3d9f7-8e57-414a-bcf5-3b0df839a0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10985cb30>]}
[0m19:02:17.110461 [info ] [Thread-1 (]: 34 of 36 OK created sql view model public_pipedrive_analytics.int_deal_changes_activity  [[32mCREATE VIEW[0m in 0.06s]
[0m19:02:17.111197 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_activity
[0m19:02:17.112409 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.mrt_deals_stages
[0m19:02:17.113044 [info ] [Thread-1 (]: 35 of 36 START sql table model public_pipedrive_analytics.mrt_deals_stages ..... [RUN]
[0m19:02:17.113604 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_activity, now model.enpal_assessment_project.mrt_deals_stages)
[0m19:02:17.114050 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.mrt_deals_stages
[0m19:02:17.118386 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.mrt_deals_stages"
[0m19:02:17.119263 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.mrt_deals_stages
[0m19:02:17.146258 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.mrt_deals_stages"
[0m19:02:17.147163 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m19:02:17.147614 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: BEGIN
[0m19:02:17.148014 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:17.167528 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m19:02:17.168250 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m19:02:17.168777 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */

  
    

  create  table "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_tmp"
  
  
    as
  
  (
    WITH all_deal_changes_and_activity AS (
    SELECT
        deal_id,
        stage_id,
        minor_stage_id,
        is_done, -- this would be a report level filter: analyst determines when to exclude incomplete activities
        activity_name AS label,
        month_name,
        month_number
    FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_activity"
    WHERE is_active = TRUE -- Mart level filter, most business users will ignore e.g. 'Follow Up Call' that is set to be inactive
    UNION ALL
    SELECT
        deal_id,
        stage_id,
        NULL AS minor_stage_id,
        NULL AS is_done,
        label,
        month_name,
        month_number
    FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage"
)
SELECT
    nd.deal_id,
    dca.stage_id,
    dca.minor_stage_id,
    dca.is_done,
    dca.label,
    dca.month_name,
    dca.month_number
FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal" nd -- Only deals from the deal_changes model (these have a created_time)
LEFT OUTER JOIN all_deal_changes_and_activity dca -- This will pick up the minor stages/activities where they exist for this set of deals
    ON nd.deal_id = dca.deal_id
  );
  
[0m19:02:17.213160 [debug] [Thread-1 (]: SQL status: SELECT 8895 in 0.044 seconds
[0m19:02:17.216581 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m19:02:17.217121 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */
alter table "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_tmp" rename to "mrt_deals_stages"
[0m19:02:17.218839 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:02:17.224261 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: COMMIT
[0m19:02:17.224753 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m19:02:17.225168 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: COMMIT
[0m19:02:17.228403 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m19:02:17.231017 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_backup"
[0m19:02:17.234466 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m19:02:17.235008 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */
drop table if exists "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_backup" cascade
[0m19:02:17.236684 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.001 seconds
[0m19:02:17.238335 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: Close
[0m19:02:17.238986 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ce3d9f7-8e57-414a-bcf5-3b0df839a0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097ac7a0>]}
[0m19:02:17.239738 [info ] [Thread-1 (]: 35 of 36 OK created sql table model public_pipedrive_analytics.mrt_deals_stages  [[32mSELECT 8895[0m in 0.13s]
[0m19:02:17.240513 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.mrt_deals_stages
[0m19:02:17.241484 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m19:02:17.242258 [info ] [Thread-1 (]: 36 of 36 START sql view model public_pipedrive_analytics.rep_sales_funnel_monthly  [RUN]
[0m19:02:17.242847 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.mrt_deals_stages, now model.enpal_assessment_project.rep_sales_funnel_monthly)
[0m19:02:17.243316 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m19:02:17.246713 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m19:02:17.247588 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m19:02:17.251243 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m19:02:17.252068 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m19:02:17.252496 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: BEGIN
[0m19:02:17.252893 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:17.270380 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m19:02:17.270951 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m19:02:17.271587 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.rep_sales_funnel_monthly"} */

  create view "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_tmp"
    
    
  as (
    -- ASSUMPTIONS FOR THIS MODEL:
-- Show the number of deals in each stage of the sales funnel, for each month
    -- Although we have models for users, they are not needed/requested in this model
    -- Although we have models for lost deals, we are showing the stage the deal was in at the time of the activity 
        -- whether it was closed or not in the end
    

-- create the funnel steps as requested
WITH funnel_step_from_stages AS (
	SELECT
		deal_id,
		month_number,
		month_name,
		CONCAT(stage_id, 
			CASE
				WHEN minor_stage_id IS NULL THEN ''
				ELSE CONCAT('.', minor_stage_id)
			END
		) AS funnel_step,
		label AS kpi_name
	FROM "postgres"."public_pipedrive_analytics"."mrt_deals_stages" AS funnel
    WHERE COALESCE(is_done, TRUE) -- report level filter: exclude incomplete activities
),
-- aggregate CTE then order, to avoid having to keep the order columns in the view
monthly_agg AS (
	SELECT
		COUNT(deal_id) AS deals_count,
		month_number,
		month_name,
		funnel_step,
		kpi_name
	FROM funnel_step_from_stages
	GROUP BY
		month_number,
		month_name,
		funnel_step,
		kpi_name
)
SELECT
	month_name AS month,
	kpi_name,
	funnel_step,
	deals_count
	FROM monthly_agg
ORDER BY month_number, funnel_step
  );
[0m19:02:17.275308 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:02:17.278554 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m19:02:17.279030 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.rep_sales_funnel_monthly"} */
alter table "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_tmp" rename to "rep_sales_funnel_monthly"
[0m19:02:17.280692 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:02:17.282431 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: COMMIT
[0m19:02:17.282909 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m19:02:17.283349 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: COMMIT
[0m19:02:17.285099 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m19:02:17.287497 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_backup"
[0m19:02:17.288414 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m19:02:17.288979 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.rep_sales_funnel_monthly"} */
drop view if exists "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_backup" cascade
[0m19:02:17.290786 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:02:17.292387 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: Close
[0m19:02:17.292961 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ce3d9f7-8e57-414a-bcf5-3b0df839a0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078ce540>]}
[0m19:02:17.293676 [info ] [Thread-1 (]: 36 of 36 OK created sql view model public_pipedrive_analytics.rep_sales_funnel_monthly  [[32mCREATE VIEW[0m in 0.05s]
[0m19:02:17.294410 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m19:02:17.295694 [debug] [MainThread]: Using postgres connection "master"
[0m19:02:17.296095 [debug] [MainThread]: On master: BEGIN
[0m19:02:17.296558 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:02:17.312550 [debug] [MainThread]: SQL status: BEGIN in 0.016 seconds
[0m19:02:17.313235 [debug] [MainThread]: On master: COMMIT
[0m19:02:17.313696 [debug] [MainThread]: Using postgres connection "master"
[0m19:02:17.314053 [debug] [MainThread]: On master: COMMIT
[0m19:02:17.315416 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m19:02:17.315840 [debug] [MainThread]: On master: Close
[0m19:02:17.316710 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:02:17.317142 [debug] [MainThread]: Connection 'model.enpal_assessment_project.rep_sales_funnel_monthly' was properly closed.
[0m19:02:17.317677 [info ] [MainThread]: 
[0m19:02:17.318086 [info ] [MainThread]: Finished running 13 view models, 1 seed, 21 data tests, 1 table model in 0 hours 0 minutes and 2.38 seconds (2.38s).
[0m19:02:17.325667 [debug] [MainThread]: Command end result
[0m19:02:17.365250 [info ] [MainThread]: 
[0m19:02:17.366005 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:02:17.366862 [info ] [MainThread]: 
[0m19:02:17.367855 [info ] [MainThread]: Done. PASS=36 WARN=0 ERROR=0 SKIP=0 TOTAL=36
[0m19:02:17.370450 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 3.3874319, "process_in_blocks": "0", "process_kernel_time": 0.532877, "process_mem_max_rss": "113131520", "process_out_blocks": "0", "process_user_time": 3.989044}
[0m19:02:17.371311 [debug] [MainThread]: Command `dbt build` succeeded at 19:02:17.371057 after 3.39 seconds
[0m19:02:17.372034 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074c85c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073dc530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089a50d0>]}
[0m19:02:17.372646 [debug] [MainThread]: Flushing usage events
[0m19:18:48.306230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043445f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046e70e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046e6c30>]}


============================== 19:18:48.314072 | dea9d357-5e3a-45ad-8bce-a68828d0f2b3 ==============================
[0m19:18:48.314072 [info ] [MainThread]: Running with dbt=1.8.9
[0m19:18:48.314946 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/julian/Documents/hatvalues_repo/dbt_enpal_assessment/logs', 'profiles_dir': '/Users/julian/Documents/hatvalues_repo/dbt_enpal_assessment', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt build', 'send_anonymous_usage_stats': 'True'}
[0m19:18:48.614529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dea9d357-5e3a-45ad-8bce-a68828d0f2b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10471f1a0>]}
[0m19:18:48.681267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dea9d357-5e3a-45ad-8bce-a68828d0f2b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104bb44a0>]}
[0m19:18:48.683492 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m19:18:48.840247 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m19:18:49.077169 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m19:18:49.078042 [debug] [MainThread]: Partial parsing: updated file: enpal_assessment_project://models/reporting/rep_sales_funnel_monthly.sql
[0m19:18:49.391897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dea9d357-5e3a-45ad-8bce-a68828d0f2b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056b1430>]}
[0m19:18:49.588579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dea9d357-5e3a-45ad-8bce-a68828d0f2b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056a2360>]}
[0m19:18:49.589813 [info ] [MainThread]: Found 16 models, 21 data tests, 1 seed, 6 sources, 429 macros
[0m19:18:49.599035 [info ] [MainThread]: 
[0m19:18:49.600490 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:18:49.608888 [debug] [ThreadPool]: Acquiring new postgres connection 'list_postgres'
[0m19:18:49.690102 [debug] [ThreadPool]: Using postgres connection "list_postgres"
[0m19:18:49.690618 [debug] [ThreadPool]: On list_postgres: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
[0m19:18:49.690984 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:18:49.749159 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.058 seconds
[0m19:18:49.750826 [debug] [ThreadPool]: On list_postgres: Close
[0m19:18:49.753314 [debug] [ThreadPool]: Using postgres connection "list_postgres"
[0m19:18:49.753896 [debug] [ThreadPool]: On list_postgres: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
[0m19:18:49.754303 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:18:49.772238 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.018 seconds
[0m19:18:49.773707 [debug] [ThreadPool]: On list_postgres: Close
[0m19:18:49.776098 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_postgres, now list_postgres_public_pipedrive_analytics)
[0m19:18:49.782516 [debug] [ThreadPool]: Using postgres connection "list_postgres_public_pipedrive_analytics"
[0m19:18:49.783035 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: BEGIN
[0m19:18:49.783393 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:18:49.798871 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m19:18:49.799507 [debug] [ThreadPool]: Using postgres connection "list_postgres_public_pipedrive_analytics"
[0m19:18:49.800036 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres_public_pipedrive_analytics"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_pipedrive_analytics'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_pipedrive_analytics'
    union all
    select
      'postgres' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_pipedrive_analytics'
  
[0m19:18:49.805379 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.005 seconds
[0m19:18:49.807212 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: ROLLBACK
[0m19:18:49.808620 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: Close
[0m19:18:49.809453 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_postgres_public_pipedrive_analytics, now list_postgres_public)
[0m19:18:49.814669 [debug] [ThreadPool]: Using postgres connection "list_postgres_public"
[0m19:18:49.815099 [debug] [ThreadPool]: On list_postgres_public: BEGIN
[0m19:18:49.815436 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:18:49.831168 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m19:18:49.831855 [debug] [ThreadPool]: Using postgres connection "list_postgres_public"
[0m19:18:49.832338 [debug] [ThreadPool]: On list_postgres_public: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m19:18:49.836167 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.003 seconds
[0m19:18:49.837747 [debug] [ThreadPool]: On list_postgres_public: ROLLBACK
[0m19:18:49.838986 [debug] [ThreadPool]: On list_postgres_public: Close
[0m19:18:49.846022 [debug] [MainThread]: Using postgres connection "master"
[0m19:18:49.846478 [debug] [MainThread]: On master: BEGIN
[0m19:18:49.846822 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:18:49.862692 [debug] [MainThread]: SQL status: BEGIN in 0.016 seconds
[0m19:18:49.863313 [debug] [MainThread]: Using postgres connection "master"
[0m19:18:49.863800 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m19:18:49.868671 [debug] [MainThread]: SQL status: SELECT 18 in 0.004 seconds
[0m19:18:49.874292 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dea9d357-5e3a-45ad-8bce-a68828d0f2b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105924620>]}
[0m19:18:49.874804 [debug] [MainThread]: On master: ROLLBACK
[0m19:18:49.876409 [debug] [MainThread]: Using postgres connection "master"
[0m19:18:49.876998 [debug] [MainThread]: On master: BEGIN
[0m19:18:49.879748 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m19:18:49.880760 [debug] [MainThread]: On master: COMMIT
[0m19:18:49.881253 [debug] [MainThread]: Using postgres connection "master"
[0m19:18:49.881627 [debug] [MainThread]: On master: COMMIT
[0m19:18:49.883317 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m19:18:49.883955 [debug] [MainThread]: On master: Close
[0m19:18:49.884587 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:18:49.885129 [info ] [MainThread]: 
[0m19:18:49.889138 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.base_pipedrive__fields
[0m19:18:49.889841 [info ] [Thread-1 (]: 1 of 36 START sql view model public_pipedrive_analytics.base_pipedrive__fields . [RUN]
[0m19:18:49.890423 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_postgres_public, now model.enpal_assessment_project.base_pipedrive__fields)
[0m19:18:49.891218 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.base_pipedrive__fields
[0m19:18:49.901898 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.base_pipedrive__fields"
[0m19:18:49.903567 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.base_pipedrive__fields
[0m19:18:49.948451 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.base_pipedrive__fields"
[0m19:18:49.949488 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m19:18:49.949963 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: BEGIN
[0m19:18:49.950383 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:49.968470 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:18:49.969216 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m19:18:49.969683 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */

  create view "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_tmp"
    
    
  as (
    SELECT *
FROM "postgres"."public"."fields"
  );
[0m19:18:49.972175 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m19:18:49.979199 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m19:18:49.979726 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */
alter table "postgres"."public_pipedrive_analytics"."base_pipedrive__fields" rename to "base_pipedrive__fields__dbt_backup"
[0m19:18:49.981418 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:18:49.984645 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m19:18:49.985095 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */
alter table "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_tmp" rename to "base_pipedrive__fields"
[0m19:18:49.986785 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:18:50.005574 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: COMMIT
[0m19:18:50.006120 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m19:18:50.006534 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: COMMIT
[0m19:18:50.010002 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m19:18:50.017439 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_backup"
[0m19:18:50.022890 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m19:18:50.023380 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */
drop view if exists "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_backup" cascade
[0m19:18:50.027982 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m19:18:50.031170 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: Close
[0m19:18:50.032874 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dea9d357-5e3a-45ad-8bce-a68828d0f2b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103cc1a30>]}
[0m19:18:50.033687 [info ] [Thread-1 (]: 1 of 36 OK created sql view model public_pipedrive_analytics.base_pipedrive__fields  [[32mCREATE VIEW[0m in 0.14s]
[0m19:18:50.034491 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.base_pipedrive__fields
[0m19:18:50.035117 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__activity
[0m19:18:50.035952 [info ] [Thread-1 (]: 2 of 36 START sql view model public_pipedrive_analytics.stg_pipedrive__activity  [RUN]
[0m19:18:50.036540 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.base_pipedrive__fields, now model.enpal_assessment_project.stg_pipedrive__activity)
[0m19:18:50.036983 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__activity
[0m19:18:50.041077 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__activity"
[0m19:18:50.042543 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__activity
[0m19:18:50.047197 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__activity"
[0m19:18:50.048196 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m19:18:50.048695 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: BEGIN
[0m19:18:50.049317 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:50.069454 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m19:18:50.070319 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m19:18:50.070789 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_tmp"
    
    
  as (
    -- This model is a staging table for the activity table in the Pipedrive database.
-- Renaming a couple of columns to avoid using reserved keywords
-- Rename others for consistency with other models: model.id, model.reference_model_id
WITH base_activity AS (
    SELECT
        activity_id AS id,
        type AS activity_type,
        assigned_to_user AS user_id,
        deal_id,
        done AS is_done,
        due_to::TIMESTAMP AS due_time
    FROM "postgres"."public"."activity"
)
SELECT 
    id,
    activity_type,
    user_id,
    deal_id,
    is_done,
    due_time,
    
    EXTRACT(MONTH FROM due_time) AS month_number,
    TO_CHAR(due_time, 'Month') AS month_name

FROM base_activity
  );
[0m19:18:50.073686 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m19:18:50.077107 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m19:18:50.077549 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity" rename to "stg_pipedrive__activity__dbt_backup"
[0m19:18:50.079326 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:18:50.082501 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m19:18:50.082939 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_tmp" rename to "stg_pipedrive__activity"
[0m19:18:50.084462 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:18:50.086082 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: COMMIT
[0m19:18:50.086511 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m19:18:50.086913 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: COMMIT
[0m19:18:50.089130 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m19:18:50.091801 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_backup"
[0m19:18:50.092599 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m19:18:50.093029 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_backup" cascade
[0m19:18:50.097522 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m19:18:50.099230 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: Close
[0m19:18:50.099854 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dea9d357-5e3a-45ad-8bce-a68828d0f2b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c5c0b0>]}
[0m19:18:50.100602 [info ] [Thread-1 (]: 2 of 36 OK created sql view model public_pipedrive_analytics.stg_pipedrive__activity  [[32mCREATE VIEW[0m in 0.06s]
[0m19:18:50.101482 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__activity
[0m19:18:50.102043 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m19:18:50.102877 [info ] [Thread-1 (]: 3 of 36 START sql view model public_pipedrive_analytics.stg_pipedrive__activity_types  [RUN]
[0m19:18:50.103565 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__activity, now model.enpal_assessment_project.stg_pipedrive__activity_types)
[0m19:18:50.104004 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m19:18:50.106744 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m19:18:50.107604 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m19:18:50.112762 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m19:18:50.113645 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m19:18:50.114068 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: BEGIN
[0m19:18:50.114458 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:50.131605 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m19:18:50.132279 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m19:18:50.132738 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_tmp"
    
    
  as (
    -- This model is generated from the `activity_types` table in the `pipedrive` schema.
-- Renaming a couple of columns to avoid using reserved keywords
-- The `active` column is a string with just two possible value. It makes more sense as a bool
SELECT
    id,
    name AS activity_name,
    CASE
        WHEN active = 'Yes' THEN TRUE
        ELSE FALSE
    END AS is_active,
    type AS activity_type
FROM "postgres"."public"."activity_types"
  );
[0m19:18:50.135814 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:18:50.139291 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m19:18:50.139751 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types" rename to "stg_pipedrive__activity_types__dbt_backup"
[0m19:18:50.142680 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:18:50.146716 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m19:18:50.147220 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_tmp" rename to "stg_pipedrive__activity_types"
[0m19:18:50.148871 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:18:50.150572 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: COMMIT
[0m19:18:50.151111 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m19:18:50.151532 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: COMMIT
[0m19:18:50.153988 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m19:18:50.156484 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_backup"
[0m19:18:50.157117 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m19:18:50.157538 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_backup" cascade
[0m19:18:50.160154 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m19:18:50.161765 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: Close
[0m19:18:50.162634 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dea9d357-5e3a-45ad-8bce-a68828d0f2b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d87470>]}
[0m19:18:50.163476 [info ] [Thread-1 (]: 3 of 36 OK created sql view model public_pipedrive_analytics.stg_pipedrive__activity_types  [[32mCREATE VIEW[0m in 0.06s]
[0m19:18:50.164252 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m19:18:50.164773 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m19:18:50.165616 [info ] [Thread-1 (]: 4 of 36 START sql view model public_pipedrive_analytics.stg_pipedrive__deal_changes  [RUN]
[0m19:18:50.166267 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__activity_types, now model.enpal_assessment_project.stg_pipedrive__deal_changes)
[0m19:18:50.166698 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m19:18:50.169841 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m19:18:50.170625 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m19:18:50.173989 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m19:18:50.174767 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m19:18:50.175189 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: BEGIN
[0m19:18:50.175613 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:50.191439 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m19:18:50.192261 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m19:18:50.192778 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_tmp"
    
    
  as (
    -- This model is generated from the `deal_changes` table in the `pipedrive` schema.
-- This is not a source deals table, and deal_id is not a PK (UNIQUE), so leave deal_id named as is
WITH base_deal_changes AS (
    SELECT
        deal_id,
        change_time::TIMESTAMP AS change_time,
        changed_field_key,
        new_value
    FROM "postgres"."public"."deal_changes"
)
SELECT
    deal_id,
    changed_field_key,
    new_value,
    change_time,
    
    EXTRACT(MONTH FROM change_time) AS month_number,
    TO_CHAR(change_time, 'Month') AS month_name

FROM base_deal_changes
  );
[0m19:18:50.197633 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:18:50.201443 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m19:18:50.201962 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes" rename to "stg_pipedrive__deal_changes__dbt_backup"
[0m19:18:50.203674 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:18:50.206780 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m19:18:50.207221 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_tmp" rename to "stg_pipedrive__deal_changes"
[0m19:18:50.208785 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:18:50.210687 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: COMMIT
[0m19:18:50.211957 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m19:18:50.213694 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: COMMIT
[0m19:18:50.216087 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m19:18:50.218700 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_backup"
[0m19:18:50.219333 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m19:18:50.219749 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_backup" cascade
[0m19:18:50.222959 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m19:18:50.224574 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: Close
[0m19:18:50.225145 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dea9d357-5e3a-45ad-8bce-a68828d0f2b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ce0800>]}
[0m19:18:50.225813 [info ] [Thread-1 (]: 4 of 36 OK created sql view model public_pipedrive_analytics.stg_pipedrive__deal_changes  [[32mCREATE VIEW[0m in 0.06s]
[0m19:18:50.226557 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m19:18:50.227081 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__stages
[0m19:18:50.228074 [info ] [Thread-1 (]: 5 of 36 START sql view model public_pipedrive_analytics.stg_pipedrive__stages .. [RUN]
[0m19:18:50.228889 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__deal_changes, now model.enpal_assessment_project.stg_pipedrive__stages)
[0m19:18:50.229338 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__stages
[0m19:18:50.232318 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__stages"
[0m19:18:50.233113 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__stages
[0m19:18:50.236504 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__stages"
[0m19:18:50.237328 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m19:18:50.237750 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: BEGIN
[0m19:18:50.238152 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:50.253787 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m19:18:50.254373 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m19:18:50.254839 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_tmp"
    
    
  as (
    /* NOT USED. 
    The source table has it's origins in the fields table, which is not used in the final model.
    I would rather keep stages and lost_reasons standardised in the final model.
    My assumption is that the fields table is used to store custom fields,
    and if this were to be updated by a sysadmin, the static stages table would not reflect the changes.
NOT USED. */

-- This model is generated from the `stages` table in the `pipedrive` schema.
-- Renaming a couple of columns to avoid using reserved keywords and standardise
SELECT
    stage_id AS id,
    stage_name
FROM "postgres"."public"."stages"
  );
[0m19:18:50.257317 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m19:18:50.261025 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m19:18:50.261529 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages" rename to "stg_pipedrive__stages__dbt_backup"
[0m19:18:50.264896 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m19:18:50.269612 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m19:18:50.270086 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_tmp" rename to "stg_pipedrive__stages"
[0m19:18:50.271851 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:18:50.273494 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: COMMIT
[0m19:18:50.273967 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m19:18:50.274388 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: COMMIT
[0m19:18:50.276274 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m19:18:50.278831 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_backup"
[0m19:18:50.279717 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m19:18:50.280193 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_backup" cascade
[0m19:18:50.283269 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m19:18:50.285551 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: Close
[0m19:18:50.286158 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dea9d357-5e3a-45ad-8bce-a68828d0f2b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105dc0fe0>]}
[0m19:18:50.286861 [info ] [Thread-1 (]: 5 of 36 OK created sql view model public_pipedrive_analytics.stg_pipedrive__stages  [[32mCREATE VIEW[0m in 0.06s]
[0m19:18:50.287784 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__stages
[0m19:18:50.288326 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__users
[0m19:18:50.288902 [info ] [Thread-1 (]: 6 of 36 START sql view model public_pipedrive_analytics.stg_pipedrive__users ... [RUN]
[0m19:18:50.289601 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__stages, now model.enpal_assessment_project.stg_pipedrive__users)
[0m19:18:50.290047 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__users
[0m19:18:50.293134 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__users"
[0m19:18:50.293935 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__users
[0m19:18:50.297577 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__users"
[0m19:18:50.298407 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m19:18:50.298830 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: BEGIN
[0m19:18:50.299223 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:50.316684 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m19:18:50.317338 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m19:18:50.317804 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_tmp"
    
    
  as (
    -- This model is generated from the `users` table in the `pipedrive` schema.
-- Renaming a couple of columns to avoid using reserved keywords and standardise
WITH base_users AS (
    SELECT
        id,
        name AS user_name,
        email AS user_email,
        modified::TIMESTAMP AS modified_time
    FROM "postgres"."public"."users"
)
SELECT
    id,
    user_name,
    user_email,
    modified_time,
    
    EXTRACT(MONTH FROM modified_time) AS month_number,
    TO_CHAR(modified_time, 'Month') AS month_name

FROM base_users
  );
[0m19:18:50.321656 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:18:50.325729 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m19:18:50.326188 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__users" rename to "stg_pipedrive__users__dbt_backup"
[0m19:18:50.327756 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:18:50.331037 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m19:18:50.331509 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_tmp" rename to "stg_pipedrive__users"
[0m19:18:50.333204 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:18:50.334912 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: COMMIT
[0m19:18:50.335493 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m19:18:50.335905 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: COMMIT
[0m19:18:50.337777 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m19:18:50.340300 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_backup"
[0m19:18:50.340929 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m19:18:50.341342 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_backup" cascade
[0m19:18:50.344712 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m19:18:50.346685 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: Close
[0m19:18:50.347516 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dea9d357-5e3a-45ad-8bce-a68828d0f2b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c21340>]}
[0m19:18:50.348418 [info ] [Thread-1 (]: 6 of 36 OK created sql view model public_pipedrive_analytics.stg_pipedrive__users  [[32mCREATE VIEW[0m in 0.06s]
[0m19:18:50.349739 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__users
[0m19:18:50.350634 [debug] [Thread-1 (]: Began running node seed.enpal_assessment_project.minor_stages
[0m19:18:50.351877 [info ] [Thread-1 (]: 7 of 36 START seed file public.minor_stages .................................... [RUN]
[0m19:18:50.353486 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__users, now seed.enpal_assessment_project.minor_stages)
[0m19:18:50.354235 [debug] [Thread-1 (]: Began compiling node seed.enpal_assessment_project.minor_stages
[0m19:18:50.354710 [debug] [Thread-1 (]: Began executing node seed.enpal_assessment_project.minor_stages
[0m19:18:50.389795 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m19:18:50.390310 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: BEGIN
[0m19:18:50.390702 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:50.407281 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m19:18:50.407845 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m19:18:50.408293 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "seed.enpal_assessment_project.minor_stages"} */
truncate table "postgres"."public"."minor_stages"
[0m19:18:50.410498 [debug] [Thread-1 (]: SQL status: TRUNCATE TABLE in 0.002 seconds
[0m19:18:50.428579 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m19:18:50.429307 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: 
          insert into "postgres"."public"."minor_stages" ("id", "activity_type", "stage_id", "minor_stage_id") values
          (%s,%s,%s,%s),(%s,%s,%s,%s)
      ...
[0m19:18:50.431274 [debug] [Thread-1 (]: SQL status: INSERT 0 2 in 0.001 seconds
[0m19:18:50.437637 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.enpal_assessment_project.minor_stages"
[0m19:18:50.439578 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: COMMIT
[0m19:18:50.440011 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m19:18:50.440407 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: COMMIT
[0m19:18:50.442665 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m19:18:50.443581 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: Close
[0m19:18:50.444210 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dea9d357-5e3a-45ad-8bce-a68828d0f2b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105597ad0>]}
[0m19:18:50.445152 [info ] [Thread-1 (]: 7 of 36 OK loaded seed file public.minor_stages ................................ [[32mINSERT 2[0m in 0.09s]
[0m19:18:50.446040 [debug] [Thread-1 (]: Finished running node seed.enpal_assessment_project.minor_stages
[0m19:18:50.446584 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m19:18:50.447210 [info ] [Thread-1 (]: 8 of 36 START test assert_timestamp_equal_add_time_new_value ................... [RUN]
[0m19:18:50.447759 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.enpal_assessment_project.minor_stages, now test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value)
[0m19:18:50.448198 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m19:18:50.450359 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m19:18:50.451152 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m19:18:50.472038 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m19:18:50.472953 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m19:18:50.473495 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: BEGIN
[0m19:18:50.473920 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:50.490744 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m19:18:50.491428 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m19:18:50.491938 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- Assert that the change_time is equal to the new_value when the changed_field_key is 'add_time'
-- With this test, it's OK to ignore the new_value field for add_time changes
SELECT * FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
	WHERE changed_field_key = 'add_time'
	AND change_time != new_value::TIMESTAMP
      
    ) dbt_internal_test
[0m19:18:50.497125 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m19:18:50.500857 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: ROLLBACK
[0m19:18:50.502236 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: Close
[0m19:18:50.503127 [info ] [Thread-1 (]: 8 of 36 PASS assert_timestamp_equal_add_time_new_value ......................... [[32mPASS[0m in 0.06s]
[0m19:18:50.503928 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m19:18:50.504443 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m19:18:50.505086 [info ] [Thread-1 (]: 9 of 36 START sql view model public_pipedrive_analytics.stg_pipedrive__fields_lost_reasons  [RUN]
[0m19:18:50.505714 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value, now model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons)
[0m19:18:50.506154 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m19:18:50.508948 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m19:18:50.509846 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m19:18:50.514039 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m19:18:50.514871 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m19:18:50.515304 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: BEGIN
[0m19:18:50.515698 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:50.531582 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m19:18:50.532282 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m19:18:50.532785 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_tmp"
    
    
  as (
    -- This model is generated from the `base_pipedrive__fields` model, which has the values buried in a JSON array.
-- ids should be INTEGER as a rule, even though one DBT test is comparing this to a STRING, I still prefer to cast to INTEGER here and in the test.
-- because in the real world, collaborators would be confused to see numeric-looking values as STRINGs.
WITH expand_array AS (
	SELECT 
		jsonb_array_elements(field_value_options) AS field_value_options
	FROM "postgres"."public_pipedrive_analytics"."base_pipedrive__fields"
	WHERE field_key = 'lost_reason'
)
SELECT
	CAST(field_value_options ->> 'id' AS INTEGER) AS id,
	field_value_options ->> 'label' AS label
FROM expand_array
  );
[0m19:18:50.536015 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:18:50.539279 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m19:18:50.539745 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_tmp" rename to "stg_pipedrive__fields_lost_reasons"
[0m19:18:50.541329 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:18:50.542853 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: COMMIT
[0m19:18:50.543301 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m19:18:50.543805 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: COMMIT
[0m19:18:50.545813 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m19:18:50.548302 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_backup"
[0m19:18:50.548998 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m19:18:50.549438 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_backup" cascade
[0m19:18:50.550824 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:18:50.552403 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: Close
[0m19:18:50.552974 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dea9d357-5e3a-45ad-8bce-a68828d0f2b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d71e20>]}
[0m19:18:50.553625 [info ] [Thread-1 (]: 9 of 36 OK created sql view model public_pipedrive_analytics.stg_pipedrive__fields_lost_reasons  [[32mCREATE VIEW[0m in 0.05s]
[0m19:18:50.554542 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m19:18:50.555296 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m19:18:50.555994 [info ] [Thread-1 (]: 10 of 36 START sql view model public_pipedrive_analytics.stg_pipedrive__fields_stages  [RUN]
[0m19:18:50.556838 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons, now model.enpal_assessment_project.stg_pipedrive__fields_stages)
[0m19:18:50.557313 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m19:18:50.560853 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m19:18:50.561767 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m19:18:50.565451 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m19:18:50.566240 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m19:18:50.566679 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: BEGIN
[0m19:18:50.567074 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:50.584846 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:18:50.585474 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m19:18:50.585990 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_stages"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_tmp"
    
    
  as (
    -- This model is generated from the `base_pipedrive__fields` model, which has the values buried in a JSON array.
-- ids should be INTEGER as a rule, even though one DBT test is comparing this to a STRING, I still prefer to cast to INTEGER here and in the test.
-- because in the real world, collaborators would be confused to see numeric-looking values as STRINGs.
WITH expand_array AS (
	SELECT 
		jsonb_array_elements(field_value_options) AS field_value_options
	FROM "postgres"."public_pipedrive_analytics"."base_pipedrive__fields"
	WHERE field_key = 'stage_id'
)
SELECT
	CAST(field_value_options ->> 'id' AS INTEGER) AS id,
	field_value_options ->> 'label' AS label
FROM expand_array
  );
[0m19:18:50.589287 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:18:50.592692 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m19:18:50.593165 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_stages"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_tmp" rename to "stg_pipedrive__fields_stages"
[0m19:18:50.594677 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:18:50.596291 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: COMMIT
[0m19:18:50.596733 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m19:18:50.597138 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: COMMIT
[0m19:18:50.599021 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m19:18:50.601493 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_backup"
[0m19:18:50.602163 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m19:18:50.602594 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_stages"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_backup" cascade
[0m19:18:50.604163 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:18:50.605951 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: Close
[0m19:18:50.606668 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dea9d357-5e3a-45ad-8bce-a68828d0f2b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d66e40>]}
[0m19:18:50.607687 [info ] [Thread-1 (]: 10 of 36 OK created sql view model public_pipedrive_analytics.stg_pipedrive__fields_stages  [[32mCREATE VIEW[0m in 0.05s]
[0m19:18:50.609123 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m19:18:50.609738 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m19:18:50.610285 [info ] [Thread-1 (]: 11 of 36 START test not_null_stg_pipedrive__activity_deal_id ................... [RUN]
[0m19:18:50.610847 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__fields_stages, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e)
[0m19:18:50.611352 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m19:18:50.623029 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m19:18:50.624075 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m19:18:50.626816 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m19:18:50.627749 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m19:18:50.628508 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: BEGIN
[0m19:18:50.629141 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:50.647761 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:18:50.648449 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m19:18:50.649006 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select deal_id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where deal_id is null



      
    ) dbt_internal_test
[0m19:18:50.651683 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m19:18:50.653497 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: ROLLBACK
[0m19:18:50.655503 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: Close
[0m19:18:50.656359 [info ] [Thread-1 (]: 11 of 36 PASS not_null_stg_pipedrive__activity_deal_id ......................... [[32mPASS[0m in 0.05s]
[0m19:18:50.657159 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m19:18:50.657675 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m19:18:50.658234 [info ] [Thread-1 (]: 12 of 36 START test not_null_stg_pipedrive__activity_due_time .................. [RUN]
[0m19:18:50.658923 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191)
[0m19:18:50.659384 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m19:18:50.665721 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m19:18:50.667170 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m19:18:50.722132 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m19:18:50.723156 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m19:18:50.723646 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: BEGIN
[0m19:18:50.724144 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:50.741212 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m19:18:50.741850 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m19:18:50.742319 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select due_time
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where due_time is null



      
    ) dbt_internal_test
[0m19:18:50.744865 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m19:18:50.746780 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: ROLLBACK
[0m19:18:50.748132 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: Close
[0m19:18:50.748850 [info ] [Thread-1 (]: 12 of 36 PASS not_null_stg_pipedrive__activity_due_time ........................ [[32mPASS[0m in 0.09s]
[0m19:18:50.749606 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m19:18:50.750167 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m19:18:50.750675 [info ] [Thread-1 (]: 13 of 36 START test not_null_stg_pipedrive__activity_id ........................ [RUN]
[0m19:18:50.751364 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb)
[0m19:18:50.751810 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m19:18:50.756080 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m19:18:50.756908 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m19:18:50.759169 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m19:18:50.759998 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m19:18:50.760439 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: BEGIN
[0m19:18:50.760837 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:50.777760 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m19:18:50.778368 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m19:18:50.779049 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where id is null



      
    ) dbt_internal_test
[0m19:18:50.782646 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m19:18:50.784383 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: ROLLBACK
[0m19:18:50.785634 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: Close
[0m19:18:50.786368 [info ] [Thread-1 (]: 13 of 36 PASS not_null_stg_pipedrive__activity_id .............................. [[32mPASS[0m in 0.03s]
[0m19:18:50.787298 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m19:18:50.787944 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m19:18:50.788491 [info ] [Thread-1 (]: 14 of 36 START test not_null_stg_pipedrive__activity_is_done ................... [RUN]
[0m19:18:50.789205 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543)
[0m19:18:50.789654 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m19:18:50.793831 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m19:18:50.794671 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m19:18:50.797371 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m19:18:50.798311 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m19:18:50.798826 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: BEGIN
[0m19:18:50.799253 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:50.817140 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:18:50.817903 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m19:18:50.818403 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select is_done
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where is_done is null



      
    ) dbt_internal_test
[0m19:18:50.821667 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m19:18:50.823964 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: ROLLBACK
[0m19:18:50.826560 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: Close
[0m19:18:50.827686 [info ] [Thread-1 (]: 14 of 36 PASS not_null_stg_pipedrive__activity_is_done ......................... [[32mPASS[0m in 0.04s]
[0m19:18:50.828846 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m19:18:50.829421 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m19:18:50.829880 [info ] [Thread-1 (]: 15 of 36 START test relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_  [RUN]
[0m19:18:50.830565 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543, now test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8)
[0m19:18:50.831038 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m19:18:50.839957 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m19:18:50.840801 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m19:18:50.843034 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m19:18:50.843762 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m19:18:50.844209 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: BEGIN
[0m19:18:50.844724 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:50.863689 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m19:18:50.864320 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m19:18:50.864804 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select activity_type as from_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
    where activity_type is not null
),

parent as (
    select activity_type as to_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m19:18:50.869150 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.004 seconds
[0m19:18:50.871084 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: ROLLBACK
[0m19:18:50.872493 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: Close
[0m19:18:50.873289 [info ] [Thread-1 (]: 15 of 36 PASS relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_  [[32mPASS[0m in 0.04s]
[0m19:18:50.874286 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m19:18:50.874828 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m19:18:50.875288 [info ] [Thread-1 (]: 16 of 36 START test accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time  [RUN]
[0m19:18:50.876150 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8, now test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0)
[0m19:18:50.876635 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m19:18:50.887363 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m19:18:50.888723 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m19:18:50.891079 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m19:18:50.891960 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m19:18:50.892424 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: BEGIN
[0m19:18:50.892833 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:50.910314 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m19:18:50.910996 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m19:18:50.911492 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        changed_field_key as value_field,
        count(*) as n_records

    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
    group by changed_field_key

)

select *
from all_values
where value_field not in (
    'user_id','stage_id','lost_reason','add_time'
)



      
    ) dbt_internal_test
[0m19:18:50.916394 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.004 seconds
[0m19:18:50.918137 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: ROLLBACK
[0m19:18:50.919500 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: Close
[0m19:18:50.920377 [info ] [Thread-1 (]: 16 of 36 PASS accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time  [[32mPASS[0m in 0.04s]
[0m19:18:50.921369 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m19:18:50.921975 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m19:18:50.922435 [info ] [Thread-1 (]: 17 of 36 START test not_null_stg_pipedrive__deal_changes_change_time ........... [RUN]
[0m19:18:50.923107 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0, now test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d)
[0m19:18:50.923617 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m19:18:50.927989 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m19:18:50.928941 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m19:18:50.931221 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m19:18:50.931965 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m19:18:50.932393 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: BEGIN
[0m19:18:50.932804 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:50.949584 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m19:18:50.950237 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m19:18:50.950720 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select change_time
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
where change_time is null



      
    ) dbt_internal_test
[0m19:18:50.954074 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m19:18:50.955909 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: ROLLBACK
[0m19:18:50.957389 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: Close
[0m19:18:50.958124 [info ] [Thread-1 (]: 17 of 36 PASS not_null_stg_pipedrive__deal_changes_change_time ................. [[32mPASS[0m in 0.04s]
[0m19:18:50.958897 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m19:18:50.959411 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m19:18:50.959944 [info ] [Thread-1 (]: 18 of 36 START test not_null_stg_pipedrive__deal_changes_deal_id ............... [RUN]
[0m19:18:50.960655 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d, now test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d)
[0m19:18:50.961270 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m19:18:50.967207 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m19:18:50.968132 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m19:18:50.970645 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m19:18:50.971454 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m19:18:50.971886 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: BEGIN
[0m19:18:50.972287 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:50.990019 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:18:50.990708 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m19:18:50.991262 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select deal_id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
where deal_id is null



      
    ) dbt_internal_test
[0m19:18:50.994392 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m19:18:50.996391 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: ROLLBACK
[0m19:18:50.997860 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: Close
[0m19:18:50.998627 [info ] [Thread-1 (]: 18 of 36 PASS not_null_stg_pipedrive__deal_changes_deal_id ..................... [[32mPASS[0m in 0.04s]
[0m19:18:50.999435 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m19:18:51.000069 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m19:18:51.000802 [info ] [Thread-1 (]: 19 of 36 START test not_null_stg_pipedrive__deal_changes_new_value ............. [RUN]
[0m19:18:51.001860 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d, now test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96)
[0m19:18:51.002373 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m19:18:51.007270 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m19:18:51.008153 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m19:18:51.010452 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m19:18:51.011309 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m19:18:51.011768 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: BEGIN
[0m19:18:51.012238 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:51.028961 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m19:18:51.029573 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m19:18:51.030056 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select new_value
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
where new_value is null



      
    ) dbt_internal_test
[0m19:18:51.034644 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.004 seconds
[0m19:18:51.036555 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: ROLLBACK
[0m19:18:51.038106 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: Close
[0m19:18:51.038909 [info ] [Thread-1 (]: 19 of 36 PASS not_null_stg_pipedrive__deal_changes_new_value ................... [[32mPASS[0m in 0.04s]
[0m19:18:51.039704 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m19:18:51.040238 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_change_user_references_user_id
[0m19:18:51.040768 [info ] [Thread-1 (]: 20 of 36 START test assert_change_user_references_user_id ...................... [RUN]
[0m19:18:51.041625 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96, now test.enpal_assessment_project.assert_change_user_references_user_id)
[0m19:18:51.042173 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_change_user_references_user_id
[0m19:18:51.045347 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m19:18:51.046804 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_change_user_references_user_id
[0m19:18:51.049537 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m19:18:51.050453 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m19:18:51.050896 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: BEGIN
[0m19:18:51.051305 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:51.069981 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:18:51.070814 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m19:18:51.071371 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_change_user_references_user_id"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- CTE to pre-filter deal_changes for stage_id changes
-- to safely cast new_value to an integer when we're sure all the values can be implicitly casted
WITH deal_change_user AS (
	SELECT changed_field_key, new_value FROM deal_changes
	WHERE changed_field_key = 'user_id'
)
SELECT *
FROM deal_change_user d
LEFT OUTER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__users" u
ON CAST(d.new_value AS INTEGER) = u.id
WHERE u.id IS NULL -- Any non referential values in d will return a NULL s.id
      
    ) dbt_internal_test
[0m19:18:51.077116 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m19:18:51.078892 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: ROLLBACK
[0m19:18:51.080702 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: Close
[0m19:18:51.081478 [info ] [Thread-1 (]: 20 of 36 PASS assert_change_user_references_user_id ............................ [[32mPASS[0m in 0.04s]
[0m19:18:51.082332 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_change_user_references_user_id
[0m19:18:51.082846 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m19:18:51.083287 [info ] [Thread-1 (]: 21 of 36 START test not_null_stg_pipedrive__users_id ........................... [RUN]
[0m19:18:51.084005 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_change_user_references_user_id, now test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817)
[0m19:18:51.084471 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m19:18:51.089357 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m19:18:51.090305 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m19:18:51.093063 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m19:18:51.094306 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m19:18:51.094890 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: BEGIN
[0m19:18:51.095354 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:51.115160 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m19:18:51.115997 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m19:18:51.116691 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where id is null



      
    ) dbt_internal_test
[0m19:18:51.119892 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m19:18:51.122471 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: ROLLBACK
[0m19:18:51.124216 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: Close
[0m19:18:51.125218 [info ] [Thread-1 (]: 21 of 36 PASS not_null_stg_pipedrive__users_id ................................. [[32mPASS[0m in 0.04s]
[0m19:18:51.126411 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m19:18:51.127214 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m19:18:51.128131 [info ] [Thread-1 (]: 22 of 36 START test not_null_stg_pipedrive__users_modified_time ................ [RUN]
[0m19:18:51.129193 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817, now test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5)
[0m19:18:51.129927 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m19:18:51.134721 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m19:18:51.135799 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m19:18:51.138944 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m19:18:51.139999 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m19:18:51.140514 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: BEGIN
[0m19:18:51.140938 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:51.163313 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m19:18:51.164361 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m19:18:51.165082 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select modified_time
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where modified_time is null



      
    ) dbt_internal_test
[0m19:18:51.192588 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.027 seconds
[0m19:18:51.197117 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: ROLLBACK
[0m19:18:51.200533 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: Close
[0m19:18:51.201800 [info ] [Thread-1 (]: 22 of 36 PASS not_null_stg_pipedrive__users_modified_time ...................... [[32mPASS[0m in 0.07s]
[0m19:18:51.203038 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m19:18:51.203933 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m19:18:51.204836 [info ] [Thread-1 (]: 23 of 36 START test not_null_stg_pipedrive__users_user_email ................... [RUN]
[0m19:18:51.205626 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5, now test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157)
[0m19:18:51.206207 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m19:18:51.211162 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m19:18:51.212549 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m19:18:51.216459 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m19:18:51.217833 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m19:18:51.218445 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: BEGIN
[0m19:18:51.219126 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:51.241204 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m19:18:51.242004 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m19:18:51.242515 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select user_email
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where user_email is null



      
    ) dbt_internal_test
[0m19:18:51.245453 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m19:18:51.248016 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: ROLLBACK
[0m19:18:51.249855 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: Close
[0m19:18:51.251040 [info ] [Thread-1 (]: 23 of 36 PASS not_null_stg_pipedrive__users_user_email ......................... [[32mPASS[0m in 0.05s]
[0m19:18:51.252179 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m19:18:51.252839 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m19:18:51.253643 [info ] [Thread-1 (]: 24 of 36 START test not_null_stg_pipedrive__users_user_name .................... [RUN]
[0m19:18:51.254744 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157, now test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5)
[0m19:18:51.255734 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m19:18:51.263532 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m19:18:51.264530 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m19:18:51.267351 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m19:18:51.268395 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m19:18:51.269025 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: BEGIN
[0m19:18:51.269644 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:51.291315 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m19:18:51.292193 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m19:18:51.292742 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select user_name
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where user_name is null



      
    ) dbt_internal_test
[0m19:18:51.296051 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m19:18:51.298127 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: ROLLBACK
[0m19:18:51.299627 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: Close
[0m19:18:51.300593 [info ] [Thread-1 (]: 24 of 36 PASS not_null_stg_pipedrive__users_user_name .......................... [[32mPASS[0m in 0.05s]
[0m19:18:51.301836 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m19:18:51.302654 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m19:18:51.303646 [info ] [Thread-1 (]: 25 of 36 START test relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_  [RUN]
[0m19:18:51.304466 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5, now test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d)
[0m19:18:51.305039 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m19:18:51.311441 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m19:18:51.312424 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m19:18:51.315078 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m19:18:51.315957 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m19:18:51.316421 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: BEGIN
[0m19:18:51.316926 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:51.335473 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:18:51.336299 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m19:18:51.336958 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select user_id as from_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
    where user_id is not null
),

parent as (
    select id as to_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m19:18:51.342947 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m19:18:51.344878 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: ROLLBACK
[0m19:18:51.347612 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: Close
[0m19:18:51.348405 [info ] [Thread-1 (]: 25 of 36 PASS relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_  [[32mPASS[0m in 0.04s]
[0m19:18:51.349180 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m19:18:51.349724 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m19:18:51.350248 [info ] [Thread-1 (]: 26 of 36 START test assert_change_stage_references_lost_reason_id .............. [RUN]
[0m19:18:51.350907 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d, now test.enpal_assessment_project.assert_change_stage_references_lost_reason_id)
[0m19:18:51.351420 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m19:18:51.354901 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m19:18:51.356010 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m19:18:51.358431 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m19:18:51.359207 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m19:18:51.359643 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: BEGIN
[0m19:18:51.360043 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:51.377730 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:18:51.378567 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m19:18:51.379251 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- CTE to pre-filter deal_changes for stage_id changes
-- to safely cast new_value to an integer when we're sure all the values can be implicitly casted
WITH deal_change_stage AS (
	SELECT changed_field_key, new_value FROM deal_changes
	WHERE changed_field_key = 'lost_reason'
)
SELECT *
FROM deal_change_stage d
LEFT OUTER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons" s
ON CAST(d.new_value AS INTEGER) = s.id
WHERE s.id IS NULL -- Any non referential values in d will return a NULL s.id
      
    ) dbt_internal_test
[0m19:18:51.384008 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.004 seconds
[0m19:18:51.385740 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: ROLLBACK
[0m19:18:51.387543 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: Close
[0m19:18:51.388722 [info ] [Thread-1 (]: 26 of 36 PASS assert_change_stage_references_lost_reason_id .................... [[32mPASS[0m in 0.04s]
[0m19:18:51.389687 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m19:18:51.390332 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m19:18:51.391351 [info ] [Thread-1 (]: 27 of 36 START test assert_change_stage_references_stage_id .................... [RUN]
[0m19:18:51.392030 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_change_stage_references_lost_reason_id, now test.enpal_assessment_project.assert_change_stage_references_stage_id)
[0m19:18:51.392486 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m19:18:51.395618 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m19:18:51.396760 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m19:18:51.399513 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m19:18:51.400548 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m19:18:51.401219 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: BEGIN
[0m19:18:51.401740 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:51.421658 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m19:18:51.422621 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m19:18:51.423414 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_change_stage_references_stage_id"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- CTE to pre-filter deal_changes for stage_id changes
-- to safely cast new_value to an integer when we're sure all the values can be implicitly casted
WITH deal_change_stage AS (
	SELECT changed_field_key, new_value FROM deal_changes
	WHERE changed_field_key = 'stage_id'
)
SELECT *
FROM deal_change_stage d
LEFT OUTER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages" s
ON CAST(d.new_value AS INTEGER) = s.id
WHERE s.id IS NULL -- Any non referential values in d will return a NULL s.id
      
    ) dbt_internal_test
[0m19:18:51.430889 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.007 seconds
[0m19:18:51.432983 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: ROLLBACK
[0m19:18:51.434694 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: Close
[0m19:18:51.435920 [info ] [Thread-1 (]: 27 of 36 PASS assert_change_stage_references_stage_id .......................... [[32mPASS[0m in 0.04s]
[0m19:18:51.437281 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m19:18:51.438123 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_activity_join_activity_type
[0m19:18:51.439190 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_change_stage_references_stage_id, now model.enpal_assessment_project.int_activity_join_activity_type)
[0m19:18:51.439918 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_activity_join_activity_type
[0m19:18:51.444255 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_activity_join_activity_type"
[0m19:18:51.445605 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_activity_join_activity_type
[0m19:18:51.446673 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m19:18:51.447445 [info ] [Thread-1 (]: 28 of 36 START sql view model public_pipedrive_analytics.int_deal_changes_dedupe_new_deal  [RUN]
[0m19:18:51.448166 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_activity_join_activity_type, now model.enpal_assessment_project.int_deal_changes_dedupe_new_deal)
[0m19:18:51.448979 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m19:18:51.452220 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m19:18:51.453398 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m19:18:51.459504 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m19:18:51.460750 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m19:18:51.461452 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: BEGIN
[0m19:18:51.462106 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:51.484564 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m19:18:51.485471 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m19:18:51.486063 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"} */

  create view "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_tmp"
    
    
  as (
    -- Separate new deals model from the deal_changes model
-- There are a handful of dupe deals in the deal_changes model (assumption - deals should not have more than one added date)
-- Materialize as a view so it can be tested for deduplication
SELECT
	deal_id, 
	MAX(change_time) AS created_time
FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
WHERE changed_field_key = 'add_time'
GROUP BY
	deal_id
  );
[0m19:18:51.490236 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:18:51.493595 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m19:18:51.494129 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"} */
alter table "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_tmp" rename to "int_deal_changes_dedupe_new_deal"
[0m19:18:51.496957 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m19:18:51.498605 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: COMMIT
[0m19:18:51.499117 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m19:18:51.499530 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: COMMIT
[0m19:18:51.501812 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m19:18:51.506740 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_backup"
[0m19:18:51.507457 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m19:18:51.507956 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"} */
drop view if exists "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_backup" cascade
[0m19:18:51.509712 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:18:51.511358 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: Close
[0m19:18:51.512170 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dea9d357-5e3a-45ad-8bce-a68828d0f2b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d70260>]}
[0m19:18:51.513097 [info ] [Thread-1 (]: 28 of 36 OK created sql view model public_pipedrive_analytics.int_deal_changes_dedupe_new_deal  [[32mCREATE VIEW[0m in 0.06s]
[0m19:18:51.513885 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m19:18:51.514406 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_user
[0m19:18:51.515137 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_dedupe_new_deal, now model.enpal_assessment_project.int_deal_changes_user)
[0m19:18:51.515798 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_user
[0m19:18:51.519239 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_user"
[0m19:18:51.520615 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_user
[0m19:18:51.521454 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m19:18:51.522163 [info ] [Thread-1 (]: 29 of 36 START sql view model public_pipedrive_analytics.int_deal_changes_dedupe_lost_reason  [RUN]
[0m19:18:51.522756 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_user, now model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason)
[0m19:18:51.523223 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m19:18:51.526415 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m19:18:51.527278 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m19:18:51.531096 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m19:18:51.532129 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m19:18:51.532717 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: BEGIN
[0m19:18:51.533527 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:51.552113 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m19:18:51.552882 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m19:18:51.553447 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"} */

  create view "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_tmp"
    
    
  as (
    WITH deal_changes_lost_reason AS (
	SELECT
		ROW_NUMBER() OVER(PARTITION BY deal_id ORDER BY change_time DESC) AS reverse_order,
		deal_id,
		new_value AS lost_reason_id,
		change_time,
		month_name,
		month_number
	FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
	WHERE changed_field_key = 'lost_reason'
),
deal_changes_lost_reason_cast_id AS (
	SELECT
		deal_id,
		CAST(lost_reason_id AS INTEGER) AS lost_reason_id, -- do it here once rather than twice in the final select & join clauses
		change_time,
		month_name,
		month_number
	FROM deal_changes_lost_reason
	WHERE reverse_order = 1
)
SELECT
dcr.deal_id,
dcr.lost_reason_id,
lost_reasons.label,
dcr.change_time,
dcr.month_name,
dcr.month_number
FROM deal_changes_lost_reason_cast_id dcr
INNER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons" lost_reasons
ON dcr.lost_reason_id = lost_reasons.id
  );
[0m19:18:51.557718 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:18:51.560952 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m19:18:51.561524 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"} */
alter table "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_tmp" rename to "int_deal_changes_dedupe_lost_reason"
[0m19:18:51.563522 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:18:51.565107 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: COMMIT
[0m19:18:51.565580 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m19:18:51.566051 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: COMMIT
[0m19:18:51.568263 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m19:18:51.571130 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_backup"
[0m19:18:51.571858 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m19:18:51.572331 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"} */
drop view if exists "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_backup" cascade
[0m19:18:51.573784 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:18:51.575390 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: Close
[0m19:18:51.576025 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dea9d357-5e3a-45ad-8bce-a68828d0f2b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105dcd6d0>]}
[0m19:18:51.576848 [info ] [Thread-1 (]: 29 of 36 OK created sql view model public_pipedrive_analytics.int_deal_changes_dedupe_lost_reason  [[32mCREATE VIEW[0m in 0.05s]
[0m19:18:51.577691 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m19:18:51.578647 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m19:18:51.579611 [info ] [Thread-1 (]: 30 of 36 START sql view model public_pipedrive_analytics.int_deal_changes_dedupe_stage  [RUN]
[0m19:18:51.580414 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason, now model.enpal_assessment_project.int_deal_changes_dedupe_stage)
[0m19:18:51.580907 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m19:18:51.584567 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m19:18:51.585447 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m19:18:51.589690 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m19:18:51.590673 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m19:18:51.591214 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: BEGIN
[0m19:18:51.591678 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:51.613664 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m19:18:51.614361 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m19:18:51.614974 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_stage"} */

  create view "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_tmp"
    
    
  as (
    -- Separate new deals model from the deal_changes model
-- There are a handful of dupe deals in the deal_changes model (assumption - deals should not have more of each stage id)
-- Materialize as a view so it can be tested for deduplication
-- Method: row_number in reverse order and then pick the first row. 
-- This pattern is better because we don't know how many duplicate rows there could be, but the latest will always be row number 1.
-- Can't just take MAX(new_value) as was done for new_deals, because there are multiple stage_ids and all that appear need to be presented to the model.
WITH deal_changes_stage AS (
	SELECT
		ROW_NUMBER() OVER(PARTITION BY deal_id, new_value ORDER BY new_value, change_time DESC) AS reverse_order,
		deal_id,
		new_value AS stage_id,
		change_time,
		month_name,
		month_number
	FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
	WHERE changed_field_key = 'stage_id'
),
deal_changes_stage_cast_id AS (
	SELECT
		deal_id,
		CAST(stage_id AS INTEGER) AS stage_id, -- do it here once rather than twice in the final select & join clauses
		change_time,
		month_name,
		month_number
	FROM deal_changes_stage
	WHERE reverse_order = 1
)
SELECT
dcs.deal_id,
dcs.stage_id,
stages.label,
dcs.change_time,
dcs.month_name,
dcs.month_number
FROM deal_changes_stage_cast_id dcs
INNER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages" stages
ON dcs.stage_id = stages.id
  );
[0m19:18:51.619190 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:18:51.623047 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m19:18:51.623543 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_stage"} */
alter table "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_tmp" rename to "int_deal_changes_dedupe_stage"
[0m19:18:51.625509 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:18:51.627250 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: COMMIT
[0m19:18:51.627733 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m19:18:51.628318 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: COMMIT
[0m19:18:51.630602 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m19:18:51.633256 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_backup"
[0m19:18:51.634128 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m19:18:51.634889 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_stage"} */
drop view if exists "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_backup" cascade
[0m19:18:51.636993 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:18:51.639326 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: Close
[0m19:18:51.640387 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dea9d357-5e3a-45ad-8bce-a68828d0f2b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041727b0>]}
[0m19:18:51.641859 [info ] [Thread-1 (]: 30 of 36 OK created sql view model public_pipedrive_analytics.int_deal_changes_dedupe_stage  [[32mCREATE VIEW[0m in 0.06s]
[0m19:18:51.643237 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m19:18:51.644003 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m19:18:51.644480 [info ] [Thread-1 (]: 31 of 36 START test unique_int_deal_changes_dedupe_new_deal_deal_id ............ [RUN]
[0m19:18:51.645202 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_dedupe_stage, now test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc)
[0m19:18:51.645705 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m19:18:51.652951 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m19:18:51.653790 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m19:18:51.658097 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m19:18:51.658965 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m19:18:51.659429 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: BEGIN
[0m19:18:51.659844 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:51.678232 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:18:51.679046 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m19:18:51.679534 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    deal_id as unique_field,
    count(*) as n_records

from "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal"
where deal_id is not null
group by deal_id
having count(*) > 1



      
    ) dbt_internal_test
[0m19:18:51.685958 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.006 seconds
[0m19:18:51.688797 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: ROLLBACK
[0m19:18:51.690839 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: Close
[0m19:18:51.692010 [info ] [Thread-1 (]: 31 of 36 PASS unique_int_deal_changes_dedupe_new_deal_deal_id .................. [[32mPASS[0m in 0.05s]
[0m19:18:51.692875 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m19:18:51.693410 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m19:18:51.693861 [info ] [Thread-1 (]: 32 of 36 START test unique_int_deal_changes_dedupe_lost_reason_deal_id ......... [RUN]
[0m19:18:51.694691 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc, now test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907)
[0m19:18:51.695483 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m19:18:51.699749 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m19:18:51.700575 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m19:18:51.702668 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m19:18:51.703529 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m19:18:51.704096 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: BEGIN
[0m19:18:51.704514 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:51.723030 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m19:18:51.723880 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m19:18:51.724377 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    deal_id as unique_field,
    count(*) as n_records

from "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason"
where deal_id is not null
group by deal_id
having count(*) > 1



      
    ) dbt_internal_test
[0m19:18:51.733432 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.009 seconds
[0m19:18:51.735354 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: ROLLBACK
[0m19:18:51.736902 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: Close
[0m19:18:51.737691 [info ] [Thread-1 (]: 32 of 36 PASS unique_int_deal_changes_dedupe_lost_reason_deal_id ............... [[32mPASS[0m in 0.04s]
[0m19:18:51.738430 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m19:18:51.738954 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_unique_deal_stage
[0m19:18:51.739391 [info ] [Thread-1 (]: 33 of 36 START test assert_unique_deal_stage ................................... [RUN]
[0m19:18:51.740085 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907, now test.enpal_assessment_project.assert_unique_deal_stage)
[0m19:18:51.740546 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_unique_deal_stage
[0m19:18:51.743231 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_unique_deal_stage"
[0m19:18:51.743993 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_unique_deal_stage
[0m19:18:51.746340 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_unique_deal_stage"
[0m19:18:51.747157 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_unique_deal_stage"
[0m19:18:51.747600 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: BEGIN
[0m19:18:51.748017 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:51.763986 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m19:18:51.764709 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_unique_deal_stage"
[0m19:18:51.765245 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_unique_deal_stage"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT
    COUNT(*),
    deal_id,
    stage_id
FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage"
GROUP BY
    deal_id,
    stage_id
HAVING COUNT(*) > 1
      
    ) dbt_internal_test
[0m19:18:51.787436 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.022 seconds
[0m19:18:51.789382 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: ROLLBACK
[0m19:18:51.790922 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: Close
[0m19:18:51.791660 [info ] [Thread-1 (]: 33 of 36 PASS assert_unique_deal_stage ......................................... [[32mPASS[0m in 0.05s]
[0m19:18:51.792544 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_unique_deal_stage
[0m19:18:51.793115 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_activity
[0m19:18:51.793748 [info ] [Thread-1 (]: 34 of 36 START sql view model public_pipedrive_analytics.int_deal_changes_activity  [RUN]
[0m19:18:51.794396 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_unique_deal_stage, now model.enpal_assessment_project.int_deal_changes_activity)
[0m19:18:51.794895 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_activity
[0m19:18:51.801021 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_activity"
[0m19:18:51.801891 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.int_deal_changes_activity
[0m19:18:51.806252 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.int_deal_changes_activity"
[0m19:18:51.807088 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_activity"
[0m19:18:51.807560 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_activity: BEGIN
[0m19:18:51.807960 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:51.825047 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m19:18:51.825586 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_activity"
[0m19:18:51.826110 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_activity"} */

  create view "postgres"."public_pipedrive_analytics"."int_deal_changes_activity__dbt_tmp"
    
    
  as (
    with __dbt__cte__int_activity_join_activity_type as (
-- Simple Intermediate Model to join activity and activity_types
-- thus providing the friendly name of the activity type
-- Filter out inactive activity types, they are not used in the final report


SELECT
	a.user_id,
	a.deal_id,
	t.activity_name,
	ms.stage_id,
	ms.minor_stage_id,
	t.is_active, -- this would be a mart level filter: business logic determines when to include deactivated activity types
	a.is_done, -- this would be a report level filter: analyst determines when to exclude incomplete activities
	a.due_time,
	a.month_name,
	a.month_number
FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity" a
INNER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types" t
	ON a.activity_type = t.activity_type
INNER JOIN "postgres"."public"."minor_stages" ms
	ON t.activity_type = ms.activity_type
) -- brings in the activity data for each deal in the deal_changes table
-- Note that there are very few rows compared to the total number of deals
-- These will just be the ones with call activities against them
SELECT
    nd.deal_id,
    act.activity_name,
    act.stage_id,
    act.minor_stage_id,
    act.is_active, -- this would be a mart level filter: business logic determines when to include deactivated activity types
    act.is_done, -- this would be a report level filter: analyst determines when to exclude incomplete activities
    act.month_number,
    act.month_name
FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal" nd
INNER JOIN __dbt__cte__int_activity_join_activity_type act
ON nd.deal_id = act.deal_id
  );
[0m19:18:51.830150 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:18:51.833358 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_activity"
[0m19:18:51.833795 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_activity"} */
alter table "postgres"."public_pipedrive_analytics"."int_deal_changes_activity__dbt_tmp" rename to "int_deal_changes_activity"
[0m19:18:51.835682 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:18:51.837356 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_activity: COMMIT
[0m19:18:51.837819 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_activity"
[0m19:18:51.838231 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_activity: COMMIT
[0m19:18:51.840142 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m19:18:51.842588 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."int_deal_changes_activity__dbt_backup"
[0m19:18:51.843223 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_activity"
[0m19:18:51.843725 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_activity"} */
drop view if exists "postgres"."public_pipedrive_analytics"."int_deal_changes_activity__dbt_backup" cascade
[0m19:18:51.845337 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:18:51.846951 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_activity: Close
[0m19:18:51.847593 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dea9d357-5e3a-45ad-8bce-a68828d0f2b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10547fdd0>]}
[0m19:18:51.848373 [info ] [Thread-1 (]: 34 of 36 OK created sql view model public_pipedrive_analytics.int_deal_changes_activity  [[32mCREATE VIEW[0m in 0.05s]
[0m19:18:51.849185 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_activity
[0m19:18:51.850264 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.mrt_deals_stages
[0m19:18:51.850849 [info ] [Thread-1 (]: 35 of 36 START sql table model public_pipedrive_analytics.mrt_deals_stages ..... [RUN]
[0m19:18:51.851378 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_activity, now model.enpal_assessment_project.mrt_deals_stages)
[0m19:18:51.851806 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.mrt_deals_stages
[0m19:18:51.855540 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.mrt_deals_stages"
[0m19:18:51.856413 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.mrt_deals_stages
[0m19:18:51.881806 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.mrt_deals_stages"
[0m19:18:51.882686 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m19:18:51.883112 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: BEGIN
[0m19:18:51.883504 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:51.900274 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m19:18:51.900928 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m19:18:51.901451 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */

  
    

  create  table "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_tmp"
  
  
    as
  
  (
    WITH all_deal_changes_and_activity AS (
    SELECT
        deal_id,
        stage_id,
        minor_stage_id,
        is_done, -- this would be a report level filter: analyst determines when to exclude incomplete activities
        activity_name AS label,
        month_name,
        month_number
    FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_activity"
    WHERE is_active = TRUE -- Mart level filter, most business users will ignore e.g. 'Follow Up Call' that is set to be inactive
    UNION ALL
    SELECT
        deal_id,
        stage_id,
        NULL AS minor_stage_id,
        NULL AS is_done,
        label,
        month_name,
        month_number
    FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage"
)
SELECT
    nd.deal_id,
    dca.stage_id,
    dca.minor_stage_id,
    dca.is_done,
    dca.label,
    dca.month_name,
    dca.month_number
FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal" nd -- Only deals from the deal_changes model (these have a created_time)
LEFT OUTER JOIN all_deal_changes_and_activity dca -- This will pick up the minor stages/activities where they exist for this set of deals
    ON nd.deal_id = dca.deal_id
  );
  
[0m19:18:51.945101 [debug] [Thread-1 (]: SQL status: SELECT 8895 in 0.043 seconds
[0m19:18:51.950087 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m19:18:51.950585 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */
alter table "postgres"."public_pipedrive_analytics"."mrt_deals_stages" rename to "mrt_deals_stages__dbt_backup"
[0m19:18:51.952276 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:18:51.955416 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m19:18:51.955900 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */
alter table "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_tmp" rename to "mrt_deals_stages"
[0m19:18:51.957430 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:18:51.963134 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: COMMIT
[0m19:18:51.963647 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m19:18:51.964057 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: COMMIT
[0m19:18:51.967309 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m19:18:51.970095 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_backup"
[0m19:18:51.973432 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m19:18:51.973923 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */
drop table if exists "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_backup" cascade
[0m19:18:51.979062 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.005 seconds
[0m19:18:51.980762 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: Close
[0m19:18:51.981376 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dea9d357-5e3a-45ad-8bce-a68828d0f2b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d6f0e0>]}
[0m19:18:51.982151 [info ] [Thread-1 (]: 35 of 36 OK created sql table model public_pipedrive_analytics.mrt_deals_stages  [[32mSELECT 8895[0m in 0.13s]
[0m19:18:51.982962 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.mrt_deals_stages
[0m19:18:51.983812 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m19:18:51.984619 [info ] [Thread-1 (]: 36 of 36 START sql view model public_pipedrive_analytics.rep_sales_funnel_monthly  [RUN]
[0m19:18:51.985255 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.mrt_deals_stages, now model.enpal_assessment_project.rep_sales_funnel_monthly)
[0m19:18:51.985718 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m19:18:51.988929 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m19:18:51.989782 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m19:18:51.993680 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m19:18:51.994532 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m19:18:51.995235 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: BEGIN
[0m19:18:51.995820 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:52.013271 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m19:18:52.013883 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m19:18:52.014410 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.rep_sales_funnel_monthly"} */

  create view "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_tmp"
    
    
  as (
    -- ASSUMPTIONS FOR THIS MODEL:
-- Show the number of deals in each stage of the sales funnel, for each month
    -- Although we have models for users, they are not needed/requested in this model
    -- Although we have models for lost deals
        -- we are showing the stage the deal was in at the time of the activity 
        -- whether or not it was closed in the end
        -- If it was not closed in the end, it just doesn't get counted in the Closing or later stages
        -- so it doesn't appear necessary to use the lost reasons model

-- create the funnel steps as requested
WITH funnel_step_from_stages AS (
	SELECT
		deal_id,
		month_number,
		month_name,
		CONCAT(stage_id, 
			CASE
				WHEN minor_stage_id IS NULL THEN ''
				ELSE CONCAT('.', minor_stage_id)
			END
		) AS funnel_step,
		label AS kpi_name
	FROM "postgres"."public_pipedrive_analytics"."mrt_deals_stages" AS funnel
    WHERE COALESCE(is_done, TRUE) -- report level filter: exclude incomplete activities
),
-- aggregate CTE then order, to avoid having to keep the order columns in the view
monthly_agg AS (
	SELECT
		COUNT(deal_id) AS deals_count,
		month_number,
		month_name,
		funnel_step,
		kpi_name
	FROM funnel_step_from_stages
	GROUP BY
		month_number,
		month_name,
		funnel_step,
		kpi_name
)
-- final query with ordering
SELECT
	month_name AS month,
	kpi_name,
	funnel_step,
	deals_count
	FROM monthly_agg
ORDER BY month_number, funnel_step
  );
[0m19:18:52.017806 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:18:52.021333 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m19:18:52.021876 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.rep_sales_funnel_monthly"} */
alter table "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_tmp" rename to "rep_sales_funnel_monthly"
[0m19:18:52.023622 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:18:52.025174 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: COMMIT
[0m19:18:52.025615 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m19:18:52.026026 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: COMMIT
[0m19:18:52.027807 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m19:18:52.030460 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_backup"
[0m19:18:52.031156 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m19:18:52.031654 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.rep_sales_funnel_monthly"} */
drop view if exists "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_backup" cascade
[0m19:18:52.033026 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:18:52.034597 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: Close
[0m19:18:52.035175 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dea9d357-5e3a-45ad-8bce-a68828d0f2b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cec650>]}
[0m19:18:52.035846 [info ] [Thread-1 (]: 36 of 36 OK created sql view model public_pipedrive_analytics.rep_sales_funnel_monthly  [[32mCREATE VIEW[0m in 0.05s]
[0m19:18:52.036651 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m19:18:52.038065 [debug] [MainThread]: Using postgres connection "master"
[0m19:18:52.038653 [debug] [MainThread]: On master: BEGIN
[0m19:18:52.039076 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:18:52.055787 [debug] [MainThread]: SQL status: BEGIN in 0.017 seconds
[0m19:18:52.056561 [debug] [MainThread]: On master: COMMIT
[0m19:18:52.057115 [debug] [MainThread]: Using postgres connection "master"
[0m19:18:52.057499 [debug] [MainThread]: On master: COMMIT
[0m19:18:52.059574 [debug] [MainThread]: SQL status: COMMIT in 0.002 seconds
[0m19:18:52.060001 [debug] [MainThread]: On master: Close
[0m19:18:52.060525 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:18:52.060930 [debug] [MainThread]: Connection 'model.enpal_assessment_project.rep_sales_funnel_monthly' was properly closed.
[0m19:18:52.061418 [info ] [MainThread]: 
[0m19:18:52.061924 [info ] [MainThread]: Finished running 13 view models, 1 seed, 21 data tests, 1 table model in 0 hours 0 minutes and 2.46 seconds (2.46s).
[0m19:18:52.069807 [debug] [MainThread]: Command end result
[0m19:18:52.108474 [info ] [MainThread]: 
[0m19:18:52.109059 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:18:52.109483 [info ] [MainThread]: 
[0m19:18:52.109950 [info ] [MainThread]: Done. PASS=36 WARN=0 ERROR=0 SKIP=0 TOTAL=36
[0m19:18:52.112437 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 3.8990347, "process_in_blocks": "0", "process_kernel_time": 0.655591, "process_mem_max_rss": "116150272", "process_out_blocks": "0", "process_user_time": 4.337865}
[0m19:18:52.113167 [debug] [MainThread]: Command `dbt build` succeeded at 19:18:52.113026 after 3.90 seconds
[0m19:18:52.113636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100a6ad50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10363e180>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d919a0>]}
[0m19:18:52.114053 [debug] [MainThread]: Flushing usage events
[0m12:05:35.107247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1100f7ef0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111c57260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111c56d80>]}


============================== 12:05:35.116115 | 1046ab7e-a40f-4d8a-b2fd-e4eac88fd138 ==============================
[0m12:05:35.116115 [info ] [MainThread]: Running with dbt=1.8.9
[0m12:05:35.116964 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/julian/Documents/hatvalues_repo/dbt_enpal_assessment/logs', 'profiles_dir': '/Users/julian/Documents/hatvalues_repo/dbt_enpal_assessment', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt build', 'send_anonymous_usage_stats': 'True'}
[0m12:05:35.447718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1046ab7e-a40f-4d8a-b2fd-e4eac88fd138', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111b21400>]}
[0m12:05:35.516461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1046ab7e-a40f-4d8a-b2fd-e4eac88fd138', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1110f5730>]}
[0m12:05:35.518121 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m12:05:35.661032 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m12:05:35.802502 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m12:05:35.803135 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '1046ab7e-a40f-4d8a-b2fd-e4eac88fd138', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1129e20c0>]}
[0m12:05:37.278719 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m12:05:37.279304 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '1046ab7e-a40f-4d8a-b2fd-e4eac88fd138', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c1f9e0>]}
[0m12:05:37.614677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1046ab7e-a40f-4d8a-b2fd-e4eac88fd138', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112db43e0>]}
[0m12:05:37.808092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1046ab7e-a40f-4d8a-b2fd-e4eac88fd138', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112de4fb0>]}
[0m12:05:37.808681 [info ] [MainThread]: Found 16 models, 21 data tests, 1 seed, 6 sources, 430 macros
[0m12:05:37.813460 [info ] [MainThread]: 
[0m12:05:37.814172 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:05:37.821279 [debug] [ThreadPool]: Acquiring new postgres connection 'list_postgres'
[0m12:05:37.896781 [debug] [ThreadPool]: Using postgres connection "list_postgres"
[0m12:05:37.897281 [debug] [ThreadPool]: On list_postgres: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
[0m12:05:37.897657 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:05:37.983267 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.085 seconds
[0m12:05:37.985106 [debug] [ThreadPool]: On list_postgres: Close
[0m12:05:37.988065 [debug] [ThreadPool]: Using postgres connection "list_postgres"
[0m12:05:37.988815 [debug] [ThreadPool]: On list_postgres: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
[0m12:05:37.989254 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:05:38.008286 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.019 seconds
[0m12:05:38.009879 [debug] [ThreadPool]: On list_postgres: Close
[0m12:05:38.010740 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_postgres, now create_postgres_public_pipedrive_analytics)
[0m12:05:38.011372 [debug] [ThreadPool]: Creating schema "database: "postgres"
schema: "public_pipedrive_analytics"
"
[0m12:05:38.016965 [debug] [ThreadPool]: Using postgres connection "create_postgres_public_pipedrive_analytics"
[0m12:05:38.017442 [debug] [ThreadPool]: On create_postgres_public_pipedrive_analytics: BEGIN
[0m12:05:38.017795 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:05:38.033514 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m12:05:38.034117 [debug] [ThreadPool]: Using postgres connection "create_postgres_public_pipedrive_analytics"
[0m12:05:38.034656 [debug] [ThreadPool]: On create_postgres_public_pipedrive_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "create_postgres_public_pipedrive_analytics"} */
create schema if not exists "public_pipedrive_analytics"
[0m12:05:38.036334 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.001 seconds
[0m12:05:38.037488 [debug] [ThreadPool]: On create_postgres_public_pipedrive_analytics: COMMIT
[0m12:05:38.037888 [debug] [ThreadPool]: Using postgres connection "create_postgres_public_pipedrive_analytics"
[0m12:05:38.038246 [debug] [ThreadPool]: On create_postgres_public_pipedrive_analytics: COMMIT
[0m12:05:38.040681 [debug] [ThreadPool]: SQL status: COMMIT in 0.002 seconds
[0m12:05:38.041120 [debug] [ThreadPool]: On create_postgres_public_pipedrive_analytics: Close
[0m12:05:38.043610 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_postgres_public_pipedrive_analytics, now list_postgres_public)
[0m12:05:38.049981 [debug] [ThreadPool]: Using postgres connection "list_postgres_public"
[0m12:05:38.050438 [debug] [ThreadPool]: On list_postgres_public: BEGIN
[0m12:05:38.050804 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:05:38.066568 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m12:05:38.067216 [debug] [ThreadPool]: Using postgres connection "list_postgres_public"
[0m12:05:38.067747 [debug] [ThreadPool]: On list_postgres_public: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:05:38.072581 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.004 seconds
[0m12:05:38.074152 [debug] [ThreadPool]: On list_postgres_public: ROLLBACK
[0m12:05:38.075380 [debug] [ThreadPool]: On list_postgres_public: Close
[0m12:05:38.076033 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_postgres_public, now list_postgres_public_pipedrive_analytics)
[0m12:05:38.079390 [debug] [ThreadPool]: Using postgres connection "list_postgres_public_pipedrive_analytics"
[0m12:05:38.079831 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: BEGIN
[0m12:05:38.080166 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:05:38.095274 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m12:05:38.095939 [debug] [ThreadPool]: Using postgres connection "list_postgres_public_pipedrive_analytics"
[0m12:05:38.096385 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres_public_pipedrive_analytics"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_pipedrive_analytics'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_pipedrive_analytics'
    union all
    select
      'postgres' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_pipedrive_analytics'
  
[0m12:05:38.100168 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.003 seconds
[0m12:05:38.101594 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: ROLLBACK
[0m12:05:38.102758 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: Close
[0m12:05:38.108415 [debug] [MainThread]: Using postgres connection "master"
[0m12:05:38.108848 [debug] [MainThread]: On master: BEGIN
[0m12:05:38.109182 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:05:38.124633 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m12:05:38.125308 [debug] [MainThread]: Using postgres connection "master"
[0m12:05:38.125884 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:05:38.131157 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m12:05:38.132610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1046ab7e-a40f-4d8a-b2fd-e4eac88fd138', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1111c9010>]}
[0m12:05:38.133130 [debug] [MainThread]: On master: ROLLBACK
[0m12:05:38.134922 [debug] [MainThread]: Using postgres connection "master"
[0m12:05:38.135514 [debug] [MainThread]: On master: BEGIN
[0m12:05:38.137509 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m12:05:38.138008 [debug] [MainThread]: On master: COMMIT
[0m12:05:38.138392 [debug] [MainThread]: Using postgres connection "master"
[0m12:05:38.138746 [debug] [MainThread]: On master: COMMIT
[0m12:05:38.139978 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m12:05:38.140421 [debug] [MainThread]: On master: Close
[0m12:05:38.140993 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:05:38.141446 [info ] [MainThread]: 
[0m12:05:38.144578 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.base_pipedrive__fields
[0m12:05:38.145258 [info ] [Thread-1 (]: 1 of 35 START sql view model public_pipedrive_analytics.base_pipedrive__fields . [RUN]
[0m12:05:38.146074 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_postgres_public_pipedrive_analytics, now model.enpal_assessment_project.base_pipedrive__fields)
[0m12:05:38.146545 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.base_pipedrive__fields
[0m12:05:38.156009 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.base_pipedrive__fields"
[0m12:05:38.157440 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.base_pipedrive__fields
[0m12:05:38.201864 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.base_pipedrive__fields"
[0m12:05:38.202794 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m12:05:38.203228 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: BEGIN
[0m12:05:38.203623 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:38.219205 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m12:05:38.220022 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m12:05:38.220500 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */

  create view "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_tmp"
    
    
  as (
    -- Simple base model to connect to the source table
-- This table has JSON array values that need to be unpacked
-- Those unpacked values will be set up as reference nodes in the staging layer
SELECT *
FROM "postgres"."public"."fields"
  );
[0m12:05:38.223635 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m12:05:38.230389 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m12:05:38.230881 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */
alter table "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_tmp" rename to "base_pipedrive__fields"
[0m12:05:38.232472 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:05:38.249160 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: COMMIT
[0m12:05:38.249707 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m12:05:38.250115 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: COMMIT
[0m12:05:38.252561 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:05:38.261503 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_backup"
[0m12:05:38.267465 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m12:05:38.267995 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */
drop view if exists "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_backup" cascade
[0m12:05:38.269872 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m12:05:38.272748 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: Close
[0m12:05:38.274489 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1046ab7e-a40f-4d8a-b2fd-e4eac88fd138', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111205bb0>]}
[0m12:05:38.275288 [info ] [Thread-1 (]: 1 of 35 OK created sql view model public_pipedrive_analytics.base_pipedrive__fields  [[32mCREATE VIEW[0m in 0.13s]
[0m12:05:38.276220 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.base_pipedrive__fields
[0m12:05:38.276871 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__activity
[0m12:05:38.277458 [info ] [Thread-1 (]: 2 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__activity  [RUN]
[0m12:05:38.278019 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.base_pipedrive__fields, now model.enpal_assessment_project.stg_pipedrive__activity)
[0m12:05:38.278585 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__activity
[0m12:05:38.282238 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__activity"
[0m12:05:38.283810 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__activity
[0m12:05:38.288774 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__activity"
[0m12:05:38.289701 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m12:05:38.290165 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: BEGIN
[0m12:05:38.291686 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:38.309536 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m12:05:38.310317 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m12:05:38.310961 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_tmp"
    
    
  as (
    -- Type is a reserved keyword. Renaming.
-- Rename others for consistency with other models
    -- model.id, model.reference_model_id
    -- bools are prefixed with is_ or has_
    -- convert date strings to timestamps and rename
-- add calculated month fields that will be used downstream
WITH base_activity AS (
    SELECT
        activity_id AS id,
        type AS activity_type,
        assigned_to_user AS user_id,
        deal_id,
        done AS is_done,
        due_to::TIMESTAMP AS due_time
    FROM "postgres"."public"."activity"
)
SELECT 
    id,
    activity_type,
    user_id,
    deal_id,
    is_done,
    due_time,
    
    EXTRACT(MONTH FROM due_time) AS month_number,
    TO_CHAR(due_time, 'Month') AS month_name

FROM base_activity
  );
[0m12:05:38.314262 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m12:05:38.317640 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m12:05:38.318140 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_tmp" rename to "stg_pipedrive__activity"
[0m12:05:38.319822 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:05:38.321359 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: COMMIT
[0m12:05:38.321804 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m12:05:38.322215 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: COMMIT
[0m12:05:38.324012 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m12:05:38.326522 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_backup"
[0m12:05:38.327215 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m12:05:38.327638 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_backup" cascade
[0m12:05:38.330436 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m12:05:38.332216 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: Close
[0m12:05:38.332916 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1046ab7e-a40f-4d8a-b2fd-e4eac88fd138', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113352a50>]}
[0m12:05:38.333736 [info ] [Thread-1 (]: 2 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__activity  [[32mCREATE VIEW[0m in 0.05s]
[0m12:05:38.334527 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__activity
[0m12:05:38.335062 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m12:05:38.335806 [info ] [Thread-1 (]: 3 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__activity_types  [RUN]
[0m12:05:38.336554 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__activity, now model.enpal_assessment_project.stg_pipedrive__activity_types)
[0m12:05:38.337023 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m12:05:38.339869 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m12:05:38.340651 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m12:05:38.343855 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m12:05:38.344644 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m12:05:38.345109 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: BEGIN
[0m12:05:38.345569 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:38.362298 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m12:05:38.363080 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m12:05:38.363719 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_tmp"
    
    
  as (
    -- Type and Name are reserved keywords. Renaming.
-- The `active` column is a string with just two possible value. It makes more sense as a bool
SELECT
    id,
    name AS activity_name,
    CASE
        WHEN active = 'Yes' THEN TRUE
        ELSE FALSE
    END AS is_active,
    type AS activity_type
FROM "postgres"."public"."activity_types"
  );
[0m12:05:38.367694 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m12:05:38.370992 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m12:05:38.371495 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_tmp" rename to "stg_pipedrive__activity_types"
[0m12:05:38.373087 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:05:38.374650 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: COMMIT
[0m12:05:38.375095 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m12:05:38.375505 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: COMMIT
[0m12:05:38.377355 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m12:05:38.379836 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_backup"
[0m12:05:38.380570 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m12:05:38.381110 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_backup" cascade
[0m12:05:38.382597 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m12:05:38.384270 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: Close
[0m12:05:38.384865 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1046ab7e-a40f-4d8a-b2fd-e4eac88fd138', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11334ffe0>]}
[0m12:05:38.385547 [info ] [Thread-1 (]: 3 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__activity_types  [[32mCREATE VIEW[0m in 0.05s]
[0m12:05:38.386281 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m12:05:38.386854 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m12:05:38.387487 [info ] [Thread-1 (]: 4 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__deal_changes  [RUN]
[0m12:05:38.388466 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__activity_types, now model.enpal_assessment_project.stg_pipedrive__deal_changes)
[0m12:05:38.389114 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m12:05:38.392548 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m12:05:38.393378 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m12:05:38.398443 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m12:05:38.399294 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m12:05:38.399730 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: BEGIN
[0m12:05:38.400134 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:38.416640 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m12:05:38.417286 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m12:05:38.417972 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_tmp"
    
    
  as (
    -- This is not a source deals table, and deal_id is not a PK (UNIQUE)
    -- leave deal_id named as is to be consistent with naming convention model.reference_model_id
    -- convert date strings to timestamps and rename
-- add calculated month fields that will be used downstream
WITH base_deal_changes AS (
    SELECT
        deal_id,
        change_time::TIMESTAMP AS change_time,
        changed_field_key,
        new_value
    FROM "postgres"."public"."deal_changes"
)
SELECT
    deal_id,
    changed_field_key,
    new_value,
    change_time,
    
    EXTRACT(MONTH FROM change_time) AS month_number,
    TO_CHAR(change_time, 'Month') AS month_name

FROM base_deal_changes
  );
[0m12:05:38.421996 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m12:05:38.425243 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m12:05:38.425716 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_tmp" rename to "stg_pipedrive__deal_changes"
[0m12:05:38.427521 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:05:38.429070 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: COMMIT
[0m12:05:38.429548 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m12:05:38.429958 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: COMMIT
[0m12:05:38.432030 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:05:38.435189 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_backup"
[0m12:05:38.435930 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m12:05:38.436365 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_backup" cascade
[0m12:05:38.437840 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m12:05:38.439418 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: Close
[0m12:05:38.440001 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1046ab7e-a40f-4d8a-b2fd-e4eac88fd138', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1133efe30>]}
[0m12:05:38.440750 [info ] [Thread-1 (]: 4 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__deal_changes  [[32mCREATE VIEW[0m in 0.05s]
[0m12:05:38.441528 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m12:05:38.442050 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__stages
[0m12:05:38.442957 [info ] [Thread-1 (]: 5 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__stages .. [RUN]
[0m12:05:38.443682 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__deal_changes, now model.enpal_assessment_project.stg_pipedrive__stages)
[0m12:05:38.444130 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__stages
[0m12:05:38.447000 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__stages"
[0m12:05:38.447774 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__stages
[0m12:05:38.451218 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__stages"
[0m12:05:38.452422 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m12:05:38.452906 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: BEGIN
[0m12:05:38.453315 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:38.471709 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m12:05:38.472354 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m12:05:38.472873 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_tmp"
    
    
  as (
    /* NOT USED UPSTREAM. 
    The values in this table also found in the JSON array of base_pipedrive__fields.
    I would rather standardise the way stages and lost_reasons are handled.
    My assumption is that base_pipedrive__fields holds the current values configured in the Pipedrive application,
    and if this were to be updated by a sysadmin, the static version of the stages table would not reflect the changes.
NOT USED UPSTREAM. */

-- Rename stage_id to id for consistency: model.id, model.reference_model_id
SELECT
    stage_id AS id,
    stage_name
FROM "postgres"."public"."stages"
  );
[0m12:05:38.475219 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m12:05:38.478346 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m12:05:38.478795 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_tmp" rename to "stg_pipedrive__stages"
[0m12:05:38.480236 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:05:38.481802 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: COMMIT
[0m12:05:38.482269 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m12:05:38.482683 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: COMMIT
[0m12:05:38.484793 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:05:38.487373 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_backup"
[0m12:05:38.488020 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m12:05:38.488438 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_backup" cascade
[0m12:05:38.490088 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m12:05:38.491676 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: Close
[0m12:05:38.492256 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1046ab7e-a40f-4d8a-b2fd-e4eac88fd138', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1132e1bb0>]}
[0m12:05:38.493013 [info ] [Thread-1 (]: 5 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__stages  [[32mCREATE VIEW[0m in 0.05s]
[0m12:05:38.493836 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__stages
[0m12:05:38.494366 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__users
[0m12:05:38.495120 [info ] [Thread-1 (]: 6 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__users ... [RUN]
[0m12:05:38.495691 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__stages, now model.enpal_assessment_project.stg_pipedrive__users)
[0m12:05:38.496123 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__users
[0m12:05:38.499466 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__users"
[0m12:05:38.501978 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__users
[0m12:05:38.505906 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__users"
[0m12:05:38.506781 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m12:05:38.507200 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: BEGIN
[0m12:05:38.507675 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:38.524927 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m12:05:38.525655 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m12:05:38.526148 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_tmp"
    
    
  as (
    -- Name is a reserved keyword. Renaming.
-- Convert date strings to timestamps and rename
-- Add calculated month fields that will be used downstream
WITH base_users AS (
    SELECT
        id,
        name AS user_name,
        email AS user_email,
        modified::TIMESTAMP AS modified_time
    FROM "postgres"."public"."users"
)
SELECT
    id,
    user_name,
    user_email,
    modified_time,
    
    EXTRACT(MONTH FROM modified_time) AS month_number,
    TO_CHAR(modified_time, 'Month') AS month_name

FROM base_users
  );
[0m12:05:38.529414 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m12:05:38.532644 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m12:05:38.533110 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_tmp" rename to "stg_pipedrive__users"
[0m12:05:38.534762 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:05:38.536640 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: COMMIT
[0m12:05:38.537286 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m12:05:38.537857 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: COMMIT
[0m12:05:38.540010 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:05:38.543562 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_backup"
[0m12:05:38.544503 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m12:05:38.544995 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_backup" cascade
[0m12:05:38.547248 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m12:05:38.548928 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: Close
[0m12:05:38.549555 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1046ab7e-a40f-4d8a-b2fd-e4eac88fd138', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1133ceab0>]}
[0m12:05:38.550282 [info ] [Thread-1 (]: 6 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__users  [[32mCREATE VIEW[0m in 0.05s]
[0m12:05:38.551051 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__users
[0m12:05:38.551664 [debug] [Thread-1 (]: Began running node seed.enpal_assessment_project.minor_stages
[0m12:05:38.552577 [info ] [Thread-1 (]: 7 of 35 START seed file public.minor_stages .................................... [RUN]
[0m12:05:38.553366 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__users, now seed.enpal_assessment_project.minor_stages)
[0m12:05:38.553828 [debug] [Thread-1 (]: Began compiling node seed.enpal_assessment_project.minor_stages
[0m12:05:38.554270 [debug] [Thread-1 (]: Began executing node seed.enpal_assessment_project.minor_stages
[0m12:05:38.584280 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m12:05:38.584783 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: BEGIN
[0m12:05:38.585175 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:38.604600 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m12:05:38.605332 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m12:05:38.605838 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "seed.enpal_assessment_project.minor_stages"} */

    create table "postgres"."public"."minor_stages" ("id" integer,"activity_type" text,"stage_id" integer,"minor_stage_id" integer)
  
[0m12:05:38.609810 [debug] [Thread-1 (]: SQL status: CREATE TABLE in 0.003 seconds
[0m12:05:38.627390 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m12:05:38.627946 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: 
          insert into "postgres"."public"."minor_stages" ("id", "activity_type", "stage_id", "minor_stage_id") values
          (%s,%s,%s,%s),(%s,%s,%s,%s)
      ...
[0m12:05:38.630552 [debug] [Thread-1 (]: SQL status: INSERT 0 2 in 0.002 seconds
[0m12:05:38.636802 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.enpal_assessment_project.minor_stages"
[0m12:05:38.642433 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: COMMIT
[0m12:05:38.642936 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m12:05:38.643343 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: COMMIT
[0m12:05:38.646146 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:05:38.647215 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: Close
[0m12:05:38.647950 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1046ab7e-a40f-4d8a-b2fd-e4eac88fd138', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113403bf0>]}
[0m12:05:38.648666 [info ] [Thread-1 (]: 7 of 35 OK loaded seed file public.minor_stages ................................ [[32mINSERT 2[0m in 0.09s]
[0m12:05:38.649509 [debug] [Thread-1 (]: Finished running node seed.enpal_assessment_project.minor_stages
[0m12:05:38.650094 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m12:05:38.650871 [info ] [Thread-1 (]: 8 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__fields_lost_reasons  [RUN]
[0m12:05:38.651513 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.enpal_assessment_project.minor_stages, now model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons)
[0m12:05:38.651971 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m12:05:38.654943 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m12:05:38.656647 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m12:05:38.660479 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m12:05:38.661440 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m12:05:38.662122 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: BEGIN
[0m12:05:38.662671 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:38.681314 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m12:05:38.681964 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m12:05:38.682444 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_tmp"
    
    
  as (
    -- `base_pipedrive__fields` model has the values buried in a JSON array.
-- Make sure ids are INTEGER and not numeric-looking STRING 
	-- it is better to convert here even though CASTING is also required in the referential test.
	-- because in the real world, collaborators would be confused to see numeric-looking values as STRINGs.
WITH expand_array AS (
	SELECT 
		jsonb_array_elements(field_value_options) AS field_value_options
	FROM "postgres"."public_pipedrive_analytics"."base_pipedrive__fields"
	WHERE field_key = 'lost_reason'
)
SELECT
	CAST(field_value_options ->> 'id' AS INTEGER) AS id,
	field_value_options ->> 'label' AS label
FROM expand_array
  );
[0m12:05:38.685428 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m12:05:38.688748 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m12:05:38.689214 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_tmp" rename to "stg_pipedrive__fields_lost_reasons"
[0m12:05:38.690857 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:05:38.692481 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: COMMIT
[0m12:05:38.693048 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m12:05:38.693520 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: COMMIT
[0m12:05:38.695478 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m12:05:38.697969 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_backup"
[0m12:05:38.698634 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m12:05:38.699121 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_backup" cascade
[0m12:05:38.700799 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m12:05:38.702371 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: Close
[0m12:05:38.702942 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1046ab7e-a40f-4d8a-b2fd-e4eac88fd138', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113400fb0>]}
[0m12:05:38.703605 [info ] [Thread-1 (]: 8 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__fields_lost_reasons  [[32mCREATE VIEW[0m in 0.05s]
[0m12:05:38.704333 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m12:05:38.704847 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m12:05:38.705553 [info ] [Thread-1 (]: 9 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__fields_stages  [RUN]
[0m12:05:38.706330 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons, now model.enpal_assessment_project.stg_pipedrive__fields_stages)
[0m12:05:38.706771 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m12:05:38.709826 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m12:05:38.710745 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m12:05:38.715628 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m12:05:38.716533 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m12:05:38.716963 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: BEGIN
[0m12:05:38.717355 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:38.734604 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m12:05:38.735248 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m12:05:38.735804 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_stages"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_tmp"
    
    
  as (
    -- `base_pipedrive__fields` model has the values buried in a JSON array.
-- Make sure ids are INTEGER and not numeric-looking STRING 
	-- it is better to convert here even though CASTING is also required in the referential test.
	-- because in the real world, collaborators would be confused to see numeric-looking values as STRINGs.
WITH expand_array AS (
	SELECT 
		jsonb_array_elements(field_value_options) AS field_value_options
	FROM "postgres"."public_pipedrive_analytics"."base_pipedrive__fields"
	WHERE field_key = 'stage_id'
)
SELECT
	CAST(field_value_options ->> 'id' AS INTEGER) AS id,
	field_value_options ->> 'label' AS label
FROM expand_array
  );
[0m12:05:38.738952 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m12:05:38.742224 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m12:05:38.742696 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_stages"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_tmp" rename to "stg_pipedrive__fields_stages"
[0m12:05:38.744715 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:05:38.746528 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: COMMIT
[0m12:05:38.747153 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m12:05:38.747587 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: COMMIT
[0m12:05:38.749379 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m12:05:38.751849 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_backup"
[0m12:05:38.752490 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m12:05:38.753028 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_stages"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_backup" cascade
[0m12:05:38.754529 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m12:05:38.756118 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: Close
[0m12:05:38.756746 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1046ab7e-a40f-4d8a-b2fd-e4eac88fd138', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1133c8d40>]}
[0m12:05:38.757477 [info ] [Thread-1 (]: 9 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__fields_stages  [[32mCREATE VIEW[0m in 0.05s]
[0m12:05:38.758210 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m12:05:38.758739 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m12:05:38.759421 [info ] [Thread-1 (]: 10 of 35 START test not_null_stg_pipedrive__activity_deal_id ................... [RUN]
[0m12:05:38.760053 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__fields_stages, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e)
[0m12:05:38.760534 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m12:05:38.772046 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m12:05:38.773344 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m12:05:38.791009 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m12:05:38.792467 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m12:05:38.792952 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: BEGIN
[0m12:05:38.793387 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:38.809591 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m12:05:38.810290 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m12:05:38.810829 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select deal_id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where deal_id is null



      
    ) dbt_internal_test
[0m12:05:38.814429 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m12:05:38.818076 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: ROLLBACK
[0m12:05:38.819452 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: Close
[0m12:05:38.820245 [info ] [Thread-1 (]: 10 of 35 PASS not_null_stg_pipedrive__activity_deal_id ......................... [[32mPASS[0m in 0.06s]
[0m12:05:38.821037 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m12:05:38.821547 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m12:05:38.822061 [info ] [Thread-1 (]: 11 of 35 START test not_null_stg_pipedrive__activity_due_time .................. [RUN]
[0m12:05:38.822666 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191)
[0m12:05:38.823123 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m12:05:38.827192 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m12:05:38.828171 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m12:05:38.830631 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m12:05:38.831436 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m12:05:38.831867 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: BEGIN
[0m12:05:38.832269 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:38.849708 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m12:05:38.850366 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m12:05:38.850964 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select due_time
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where due_time is null



      
    ) dbt_internal_test
[0m12:05:38.854250 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m12:05:38.856109 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: ROLLBACK
[0m12:05:38.857513 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: Close
[0m12:05:38.858228 [info ] [Thread-1 (]: 11 of 35 PASS not_null_stg_pipedrive__activity_due_time ........................ [[32mPASS[0m in 0.04s]
[0m12:05:38.859087 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m12:05:38.859595 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m12:05:38.860033 [info ] [Thread-1 (]: 12 of 35 START test not_null_stg_pipedrive__activity_id ........................ [RUN]
[0m12:05:38.860788 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb)
[0m12:05:38.861485 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m12:05:38.865692 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m12:05:38.866487 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m12:05:38.868979 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m12:05:38.869934 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m12:05:38.870433 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: BEGIN
[0m12:05:38.870858 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:38.888014 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m12:05:38.888757 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m12:05:38.889256 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where id is null



      
    ) dbt_internal_test
[0m12:05:38.891891 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m12:05:38.893659 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: ROLLBACK
[0m12:05:38.895150 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: Close
[0m12:05:38.896164 [info ] [Thread-1 (]: 12 of 35 PASS not_null_stg_pipedrive__activity_id .............................. [[32mPASS[0m in 0.04s]
[0m12:05:38.897126 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m12:05:38.897655 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m12:05:38.898102 [info ] [Thread-1 (]: 13 of 35 START test not_null_stg_pipedrive__activity_is_done ................... [RUN]
[0m12:05:38.898913 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543)
[0m12:05:38.899427 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m12:05:38.904100 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m12:05:38.905037 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m12:05:38.907799 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m12:05:38.908656 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m12:05:38.909092 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: BEGIN
[0m12:05:38.909491 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:38.928433 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m12:05:38.929016 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m12:05:38.929481 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select is_done
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where is_done is null



      
    ) dbt_internal_test
[0m12:05:38.932198 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m12:05:38.934103 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: ROLLBACK
[0m12:05:38.935721 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: Close
[0m12:05:38.936560 [info ] [Thread-1 (]: 13 of 35 PASS not_null_stg_pipedrive__activity_is_done ......................... [[32mPASS[0m in 0.04s]
[0m12:05:38.937405 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m12:05:38.937959 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m12:05:38.938417 [info ] [Thread-1 (]: 14 of 35 START test relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_  [RUN]
[0m12:05:38.939029 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543, now test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8)
[0m12:05:38.939719 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m12:05:38.945102 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m12:05:38.946098 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m12:05:38.948585 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m12:05:38.949413 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m12:05:38.949860 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: BEGIN
[0m12:05:38.950263 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:38.966906 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m12:05:38.967606 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m12:05:38.968100 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select activity_type as from_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
    where activity_type is not null
),

parent as (
    select activity_type as to_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m12:05:38.972542 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.004 seconds
[0m12:05:38.974258 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: ROLLBACK
[0m12:05:38.976117 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: Close
[0m12:05:38.976856 [info ] [Thread-1 (]: 14 of 35 PASS relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_  [[32mPASS[0m in 0.04s]
[0m12:05:38.977696 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m12:05:38.978235 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m12:05:38.978847 [info ] [Thread-1 (]: 15 of 35 START test accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time  [RUN]
[0m12:05:38.979947 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8, now test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0)
[0m12:05:38.980482 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m12:05:38.984875 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m12:05:38.986077 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m12:05:38.988359 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m12:05:38.989147 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m12:05:38.989595 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: BEGIN
[0m12:05:38.990004 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:39.006344 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m12:05:39.007084 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m12:05:39.007624 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        changed_field_key as value_field,
        count(*) as n_records

    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
    group by changed_field_key

)

select *
from all_values
where value_field not in (
    'user_id','stage_id','lost_reason','add_time'
)



      
    ) dbt_internal_test
[0m12:05:39.012460 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.004 seconds
[0m12:05:39.014230 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: ROLLBACK
[0m12:05:39.015733 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: Close
[0m12:05:39.016479 [info ] [Thread-1 (]: 15 of 35 PASS accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time  [[32mPASS[0m in 0.04s]
[0m12:05:39.017211 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m12:05:39.017730 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m12:05:39.018227 [info ] [Thread-1 (]: 16 of 35 START test assert_timestamp_equal_add_time_new_value .................. [RUN]
[0m12:05:39.018791 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0, now test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value)
[0m12:05:39.019246 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m12:05:39.023849 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m12:05:39.024652 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m12:05:39.026906 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m12:05:39.027787 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m12:05:39.028252 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: BEGIN
[0m12:05:39.028668 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:39.045511 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m12:05:39.046400 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m12:05:39.046926 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- Proving that the new_value field for add_time changes is redundant. We can just use the change_time.
WITH deal_change_add_time AS (
	
SELECT
    changed_field_key,
    new_value
FROM
    "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
WHERE
    changed_field_key = 'add_time'

)
SELECT * FROM deal_change_add_time
WHERE change_time != new_value::TIMESTAMP
      
    ) dbt_internal_test
[0m12:05:39.052344 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "change_time" does not exist
LINE 20: WHERE change_time != new_value::TIMESTAMP
               ^

[0m12:05:39.053093 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: ROLLBACK
[0m12:05:39.054879 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: Close
[0m12:05:39.067304 [debug] [Thread-1 (]: Database Error in test assert_timestamp_equal_add_time_new_value (tests/assert_timestamp_equal_add_time_new_value.sql)
  column "change_time" does not exist
  LINE 20: WHERE change_time != new_value::TIMESTAMP
                 ^
  compiled code at target/run/enpal_assessment_project/tests/assert_timestamp_equal_add_time_new_value.sql
[0m12:05:39.067978 [error] [Thread-1 (]: 16 of 35 ERROR assert_timestamp_equal_add_time_new_value ....................... [[31mERROR[0m in 0.05s]
[0m12:05:39.068720 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m12:05:39.069295 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m12:05:39.070123 [info ] [Thread-1 (]: 17 of 35 START test not_null_stg_pipedrive__deal_changes_change_time ........... [RUN]
[0m12:05:39.070662 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value, now test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d)
[0m12:05:39.071089 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m12:05:39.075227 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m12:05:39.075991 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m12:05:39.078377 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m12:05:39.079245 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m12:05:39.079761 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: BEGIN
[0m12:05:39.080205 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:39.097710 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m12:05:39.098454 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m12:05:39.099040 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select change_time
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
where change_time is null



      
    ) dbt_internal_test
[0m12:05:39.102091 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m12:05:39.103797 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: ROLLBACK
[0m12:05:39.105225 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: Close
[0m12:05:39.105931 [info ] [Thread-1 (]: 17 of 35 PASS not_null_stg_pipedrive__deal_changes_change_time ................. [[32mPASS[0m in 0.04s]
[0m12:05:39.106819 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m12:05:39.107347 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m12:05:39.107856 [info ] [Thread-1 (]: 18 of 35 START test not_null_stg_pipedrive__deal_changes_deal_id ............... [RUN]
[0m12:05:39.108429 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d, now test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d)
[0m12:05:39.108898 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m12:05:39.113318 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m12:05:39.114179 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m12:05:39.116556 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m12:05:39.117364 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m12:05:39.117804 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: BEGIN
[0m12:05:39.118201 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:39.134622 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m12:05:39.135280 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m12:05:39.135807 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select deal_id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
where deal_id is null



      
    ) dbt_internal_test
[0m12:05:39.140267 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.004 seconds
[0m12:05:39.142036 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: ROLLBACK
[0m12:05:39.143382 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: Close
[0m12:05:39.144104 [info ] [Thread-1 (]: 18 of 35 PASS not_null_stg_pipedrive__deal_changes_deal_id ..................... [[32mPASS[0m in 0.04s]
[0m12:05:39.144892 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m12:05:39.145444 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m12:05:39.146037 [info ] [Thread-1 (]: 19 of 35 START test not_null_stg_pipedrive__deal_changes_new_value ............. [RUN]
[0m12:05:39.146678 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d, now test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96)
[0m12:05:39.147133 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m12:05:39.151462 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m12:05:39.152368 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m12:05:39.154713 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m12:05:39.155637 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m12:05:39.156097 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: BEGIN
[0m12:05:39.156558 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:39.174347 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m12:05:39.175086 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m12:05:39.175549 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select new_value
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
where new_value is null



      
    ) dbt_internal_test
[0m12:05:39.178900 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m12:05:39.180726 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: ROLLBACK
[0m12:05:39.182130 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: Close
[0m12:05:39.182866 [info ] [Thread-1 (]: 19 of 35 PASS not_null_stg_pipedrive__deal_changes_new_value ................... [[32mPASS[0m in 0.04s]
[0m12:05:39.183590 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m12:05:39.184180 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_change_user_references_user_id
[0m12:05:39.184750 [info ] [Thread-1 (]: 20 of 35 START test assert_change_user_references_user_id ...................... [RUN]
[0m12:05:39.185598 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96, now test.enpal_assessment_project.assert_change_user_references_user_id)
[0m12:05:39.186097 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_change_user_references_user_id
[0m12:05:39.189832 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m12:05:39.191391 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_change_user_references_user_id
[0m12:05:39.193927 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m12:05:39.194818 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m12:05:39.195281 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: BEGIN
[0m12:05:39.195898 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:39.213879 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m12:05:39.214609 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m12:05:39.215091 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_change_user_references_user_id"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- CTE to pre-filter deal_changes for stage_id changes
-- to safely cast new_value to an integer when we're sure all the values can be implicitly casted
WITH deal_change_user AS (
	
SELECT
    changed_field_key,
    new_value
FROM
    "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
WHERE
    changed_field_key = 'user_id'

)
SELECT *
FROM deal_change_user d
LEFT OUTER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__users" u
ON CAST(d.new_value AS INTEGER) = u.id
WHERE u.id IS NULL -- Any non referential values in d will return a NULL s.id
      
    ) dbt_internal_test
[0m12:05:39.221022 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m12:05:39.222743 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: ROLLBACK
[0m12:05:39.224163 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: Close
[0m12:05:39.224858 [info ] [Thread-1 (]: 20 of 35 PASS assert_change_user_references_user_id ............................ [[32mPASS[0m in 0.04s]
[0m12:05:39.225614 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_change_user_references_user_id
[0m12:05:39.226127 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m12:05:39.226563 [info ] [Thread-1 (]: 21 of 35 START test not_null_stg_pipedrive__users_id ........................... [RUN]
[0m12:05:39.227154 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_change_user_references_user_id, now test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817)
[0m12:05:39.227795 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m12:05:39.232057 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m12:05:39.232863 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m12:05:39.235323 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m12:05:39.236202 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m12:05:39.236777 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: BEGIN
[0m12:05:39.237331 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:39.253675 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m12:05:39.254316 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m12:05:39.254822 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where id is null



      
    ) dbt_internal_test
[0m12:05:39.257888 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m12:05:39.259557 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: ROLLBACK
[0m12:05:39.260817 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: Close
[0m12:05:39.261596 [info ] [Thread-1 (]: 21 of 35 PASS not_null_stg_pipedrive__users_id ................................. [[32mPASS[0m in 0.03s]
[0m12:05:39.262327 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m12:05:39.262834 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m12:05:39.263329 [info ] [Thread-1 (]: 22 of 35 START test not_null_stg_pipedrive__users_modified_time ................ [RUN]
[0m12:05:39.264001 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817, now test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5)
[0m12:05:39.264457 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m12:05:39.271206 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m12:05:39.272089 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m12:05:39.274479 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m12:05:39.275284 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m12:05:39.275715 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: BEGIN
[0m12:05:39.276167 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:39.292296 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m12:05:39.292962 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m12:05:39.293444 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select modified_time
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where modified_time is null



      
    ) dbt_internal_test
[0m12:05:39.295967 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m12:05:39.297658 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: ROLLBACK
[0m12:05:39.298902 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: Close
[0m12:05:39.299631 [info ] [Thread-1 (]: 22 of 35 PASS not_null_stg_pipedrive__users_modified_time ...................... [[32mPASS[0m in 0.04s]
[0m12:05:39.300348 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m12:05:39.300849 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m12:05:39.301324 [info ] [Thread-1 (]: 23 of 35 START test not_null_stg_pipedrive__users_user_email ................... [RUN]
[0m12:05:39.301967 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5, now test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157)
[0m12:05:39.302413 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m12:05:39.306600 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m12:05:39.307462 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m12:05:39.309855 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m12:05:39.310824 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m12:05:39.311318 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: BEGIN
[0m12:05:39.311736 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:39.330566 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m12:05:39.331458 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m12:05:39.331964 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select user_email
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where user_email is null



      
    ) dbt_internal_test
[0m12:05:39.334407 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m12:05:39.336130 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: ROLLBACK
[0m12:05:39.337551 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: Close
[0m12:05:39.338395 [info ] [Thread-1 (]: 23 of 35 PASS not_null_stg_pipedrive__users_user_email ......................... [[32mPASS[0m in 0.04s]
[0m12:05:39.339297 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m12:05:39.339821 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m12:05:39.340257 [info ] [Thread-1 (]: 24 of 35 START test not_null_stg_pipedrive__users_user_name .................... [RUN]
[0m12:05:39.341258 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157, now test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5)
[0m12:05:39.341768 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m12:05:39.346106 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m12:05:39.346941 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m12:05:39.349242 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m12:05:39.350023 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m12:05:39.350458 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: BEGIN
[0m12:05:39.350856 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:39.367037 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m12:05:39.367807 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m12:05:39.368304 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select user_name
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where user_name is null



      
    ) dbt_internal_test
[0m12:05:39.370774 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m12:05:39.372484 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: ROLLBACK
[0m12:05:39.373758 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: Close
[0m12:05:39.374576 [info ] [Thread-1 (]: 24 of 35 PASS not_null_stg_pipedrive__users_user_name .......................... [[32mPASS[0m in 0.03s]
[0m12:05:39.375448 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m12:05:39.375982 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m12:05:39.376433 [info ] [Thread-1 (]: 25 of 35 START test relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_  [RUN]
[0m12:05:39.377171 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5, now test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d)
[0m12:05:39.377655 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m12:05:39.383212 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m12:05:39.384065 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m12:05:39.386366 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m12:05:39.387156 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m12:05:39.387604 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: BEGIN
[0m12:05:39.388009 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:39.405080 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m12:05:39.405770 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m12:05:39.406261 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select user_id as from_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
    where user_id is not null
),

parent as (
    select id as to_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m12:05:39.410734 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.004 seconds
[0m12:05:39.412608 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: ROLLBACK
[0m12:05:39.414064 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: Close
[0m12:05:39.414894 [info ] [Thread-1 (]: 25 of 35 PASS relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_  [[32mPASS[0m in 0.04s]
[0m12:05:39.415668 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m12:05:39.416191 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m12:05:39.416683 [info ] [Thread-1 (]: 26 of 35 START test assert_change_stage_references_lost_reason_id .............. [RUN]
[0m12:05:39.417260 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d, now test.enpal_assessment_project.assert_change_stage_references_lost_reason_id)
[0m12:05:39.417786 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m12:05:39.420981 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m12:05:39.421767 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m12:05:39.424085 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m12:05:39.424947 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m12:05:39.425408 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: BEGIN
[0m12:05:39.425809 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:39.444191 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m12:05:39.445022 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m12:05:39.445781 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- new_value field is a STRING type but contains mixed values for other tables/models
-- The CTE will pre-filter the deal_changes to safely cast new_value to an integer for this test
WITH deal_change_reasons AS (
	
SELECT
    changed_field_key,
    new_value
FROM
    "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
WHERE
    changed_field_key = 'lost_reason'

)
SELECT *
FROM deal_change_reasons dcr
LEFT OUTER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons" reasons
ON CAST(dcr.new_value AS INTEGER) = reasons.id
WHERE reasons.id IS NULL -- Any non referential values in dcr will return a NULL reasons.id
      
    ) dbt_internal_test
[0m12:05:39.450958 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.004 seconds
[0m12:05:39.453009 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: ROLLBACK
[0m12:05:39.454586 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: Close
[0m12:05:39.455327 [info ] [Thread-1 (]: 26 of 35 PASS assert_change_stage_references_lost_reason_id .................... [[32mPASS[0m in 0.04s]
[0m12:05:39.456109 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m12:05:39.456617 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m12:05:39.457058 [info ] [Thread-1 (]: 27 of 35 START test assert_change_stage_references_stage_id .................... [RUN]
[0m12:05:39.457858 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_change_stage_references_lost_reason_id, now test.enpal_assessment_project.assert_change_stage_references_stage_id)
[0m12:05:39.458342 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m12:05:39.461544 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m12:05:39.462839 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m12:05:39.465228 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m12:05:39.466636 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m12:05:39.467118 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: BEGIN
[0m12:05:39.467526 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:05:39.485121 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m12:05:39.485895 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m12:05:39.486384 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_change_stage_references_stage_id"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- new_value field is a STRING type but contains mixed values for other tables/models
-- The CTE will pre-filter the deal_changes to safely cast new_value to an integer for this test
WITH deal_change_stage AS (
	
SELECT
    changed_field_key,
    new_value
FROM
    "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
WHERE
    changed_field_key = 'stage_id'

)
SELECT *
FROM deal_change_stage dcs
LEFT OUTER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages" stages
ON CAST(dcs.new_value AS INTEGER) = stages.id
WHERE stages.id IS NULL -- Any non referential values in d will return a NULL s.id
      
    ) dbt_internal_test
[0m12:05:39.493559 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.007 seconds
[0m12:05:39.495366 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: ROLLBACK
[0m12:05:39.497031 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: Close
[0m12:05:39.497883 [info ] [Thread-1 (]: 27 of 35 PASS assert_change_stage_references_stage_id .......................... [[32mPASS[0m in 0.04s]
[0m12:05:39.498863 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m12:05:39.499520 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_activity_join_activity_type
[0m12:05:39.500310 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_change_stage_references_stage_id, now model.enpal_assessment_project.int_activity_join_activity_type)
[0m12:05:39.501073 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_activity_join_activity_type
[0m12:05:39.504690 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_activity_join_activity_type"
[0m12:05:39.505953 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_activity_join_activity_type
[0m12:05:39.506456 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m12:05:39.506928 [info ] [Thread-1 (]: 28 of 35 SKIP relation public_pipedrive_analytics.int_deal_changes_dedupe_new_deal  [[33mSKIP[0m]
[0m12:05:39.507431 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m12:05:39.507902 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_user
[0m12:05:39.508354 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_user
[0m12:05:39.509096 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m12:05:39.509824 [info ] [Thread-1 (]: 29 of 35 SKIP relation public_pipedrive_analytics.int_deal_changes_dedupe_lost_reason  [[33mSKIP[0m]
[0m12:05:39.510430 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m12:05:39.511029 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m12:05:39.511691 [info ] [Thread-1 (]: 30 of 35 SKIP relation public_pipedrive_analytics.int_deal_changes_dedupe_stage  [[33mSKIP[0m]
[0m12:05:39.512573 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m12:05:39.513264 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m12:05:39.513977 [info ] [Thread-1 (]: 31 of 35 SKIP test unique_int_deal_changes_dedupe_new_deal_deal_id ............. [[33mSKIP[0m]
[0m12:05:39.514670 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m12:05:39.515224 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m12:05:39.515936 [info ] [Thread-1 (]: 32 of 35 SKIP test unique_int_deal_changes_dedupe_lost_reason_deal_id .......... [[33mSKIP[0m]
[0m12:05:39.516949 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m12:05:39.517772 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_unique_deal_stage
[0m12:05:39.518361 [info ] [Thread-1 (]: 33 of 35 SKIP test assert_unique_deal_stage .................................... [[33mSKIP[0m]
[0m12:05:39.518908 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_unique_deal_stage
[0m12:05:39.519462 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_activity
[0m12:05:39.520023 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_activity
[0m12:05:39.520911 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.mrt_deals_stages
[0m12:05:39.521310 [error] [Thread-1 (]: 34 of 35 SKIP relation public_pipedrive_analytics.mrt_deals_stages due to ephemeral model error  [[31mERROR SKIP[0m]
[0m12:05:39.521842 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.mrt_deals_stages
[0m12:05:39.522561 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m12:05:39.523126 [info ] [Thread-1 (]: 35 of 35 SKIP relation public_pipedrive_analytics.rep_sales_funnel_monthly ..... [[33mSKIP[0m]
[0m12:05:39.523875 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m12:05:39.525420 [debug] [MainThread]: Using postgres connection "master"
[0m12:05:39.525962 [debug] [MainThread]: On master: BEGIN
[0m12:05:39.526349 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:05:39.544447 [debug] [MainThread]: SQL status: BEGIN in 0.018 seconds
[0m12:05:39.545141 [debug] [MainThread]: On master: COMMIT
[0m12:05:39.545632 [debug] [MainThread]: Using postgres connection "master"
[0m12:05:39.546092 [debug] [MainThread]: On master: COMMIT
[0m12:05:39.547598 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m12:05:39.548324 [debug] [MainThread]: On master: Close
[0m12:05:39.549050 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:05:39.549473 [debug] [MainThread]: Connection 'model.enpal_assessment_project.int_activity_join_activity_type' was properly closed.
[0m12:05:39.549960 [info ] [MainThread]: 
[0m12:05:39.550435 [info ] [MainThread]: Finished running 12 view models, 1 seed, 21 data tests, 1 table model in 0 hours 0 minutes and 1.74 seconds (1.74s).
[0m12:05:39.558056 [debug] [MainThread]: Command end result
[0m12:05:39.597028 [info ] [MainThread]: 
[0m12:05:39.597550 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m12:05:39.597935 [info ] [MainThread]: 
[0m12:05:39.598407 [error] [MainThread]:   Database Error in test assert_timestamp_equal_add_time_new_value (tests/assert_timestamp_equal_add_time_new_value.sql)
  column "change_time" does not exist
  LINE 20: WHERE change_time != new_value::TIMESTAMP
                 ^
  compiled code at target/run/enpal_assessment_project/tests/assert_timestamp_equal_add_time_new_value.sql
[0m12:05:39.598982 [info ] [MainThread]: 
[0m12:05:39.599507 [error] [MainThread]:   Compilation Error in model.enpal_assessment_project.mrt_deals_stages, caused by compilation error in referenced ephemeral model model.enpal_assessment_project.int_deal_changes_activity
[0m12:05:39.599944 [info ] [MainThread]: 
[0m12:05:39.600474 [info ] [MainThread]: Done. PASS=26 WARN=0 ERROR=1 SKIP=8 TOTAL=35
[0m12:05:39.603131 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 4.6057343, "process_in_blocks": "0", "process_kernel_time": 0.674023, "process_mem_max_rss": "119918592", "process_out_blocks": "0", "process_user_time": 5.341391}
[0m12:05:39.603854 [debug] [MainThread]: Command `dbt build` failed at 12:05:39.603717 after 4.61 seconds
[0m12:05:39.604335 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110af6030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111c56d80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b95850>]}
[0m12:05:39.604777 [debug] [MainThread]: Flushing usage events
[0m12:10:27.043516 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ee2480>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ff72f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ff6cf0>]}


============================== 12:10:27.050878 | 9aab4967-282e-4793-92ca-58373499bec0 ==============================
[0m12:10:27.050878 [info ] [MainThread]: Running with dbt=1.8.9
[0m12:10:27.051972 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/julian/Documents/hatvalues_repo/dbt_enpal_assessment', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/julian/Documents/hatvalues_repo/dbt_enpal_assessment/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:10:27.340218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9aab4967-282e-4793-92ca-58373499bec0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095a5160>]}
[0m12:10:27.406254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9aab4967-282e-4793-92ca-58373499bec0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b42ff0>]}
[0m12:10:27.408460 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m12:10:27.557898 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m12:10:27.789864 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:10:27.790746 [debug] [MainThread]: Partial parsing: updated file: enpal_assessment_project://tests/assert_timestamp_equal_add_time_new_value.sql
[0m12:10:28.023685 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9aab4967-282e-4793-92ca-58373499bec0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ac6e9c0>]}
[0m12:10:28.212458 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9aab4967-282e-4793-92ca-58373499bec0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aed9100>]}
[0m12:10:28.213180 [info ] [MainThread]: Found 16 models, 21 data tests, 1 seed, 6 sources, 430 macros
[0m12:10:28.218134 [info ] [MainThread]: 
[0m12:10:28.218889 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:10:28.224301 [debug] [ThreadPool]: Acquiring new postgres connection 'list_postgres'
[0m12:10:28.302680 [debug] [ThreadPool]: Using postgres connection "list_postgres"
[0m12:10:28.303193 [debug] [ThreadPool]: On list_postgres: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
[0m12:10:28.303730 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:10:28.364085 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.060 seconds
[0m12:10:28.365723 [debug] [ThreadPool]: On list_postgres: Close
[0m12:10:28.368273 [debug] [ThreadPool]: Using postgres connection "list_postgres"
[0m12:10:28.368818 [debug] [ThreadPool]: On list_postgres: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
[0m12:10:28.369209 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:10:28.385725 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.016 seconds
[0m12:10:28.387310 [debug] [ThreadPool]: On list_postgres: Close
[0m12:10:28.389747 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_postgres, now list_postgres_public_pipedrive_analytics)
[0m12:10:28.396166 [debug] [ThreadPool]: Using postgres connection "list_postgres_public_pipedrive_analytics"
[0m12:10:28.396635 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: BEGIN
[0m12:10:28.396991 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:10:28.413172 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m12:10:28.413757 [debug] [ThreadPool]: Using postgres connection "list_postgres_public_pipedrive_analytics"
[0m12:10:28.414202 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres_public_pipedrive_analytics"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_pipedrive_analytics'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_pipedrive_analytics'
    union all
    select
      'postgres' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_pipedrive_analytics'
  
[0m12:10:28.418255 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.004 seconds
[0m12:10:28.419946 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: ROLLBACK
[0m12:10:28.421199 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: Close
[0m12:10:28.421875 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_postgres_public_pipedrive_analytics, now list_postgres_public)
[0m12:10:28.425802 [debug] [ThreadPool]: Using postgres connection "list_postgres_public"
[0m12:10:28.426258 [debug] [ThreadPool]: On list_postgres_public: BEGIN
[0m12:10:28.426597 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:10:28.443756 [debug] [ThreadPool]: SQL status: BEGIN in 0.017 seconds
[0m12:10:28.444406 [debug] [ThreadPool]: Using postgres connection "list_postgres_public"
[0m12:10:28.444834 [debug] [ThreadPool]: On list_postgres_public: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:10:28.449697 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.004 seconds
[0m12:10:28.451342 [debug] [ThreadPool]: On list_postgres_public: ROLLBACK
[0m12:10:28.452658 [debug] [ThreadPool]: On list_postgres_public: Close
[0m12:10:28.462680 [debug] [MainThread]: Using postgres connection "master"
[0m12:10:28.463212 [debug] [MainThread]: On master: BEGIN
[0m12:10:28.463595 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:10:28.479925 [debug] [MainThread]: SQL status: BEGIN in 0.016 seconds
[0m12:10:28.480579 [debug] [MainThread]: Using postgres connection "master"
[0m12:10:28.481069 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:10:28.486498 [debug] [MainThread]: SQL status: SELECT 8 in 0.005 seconds
[0m12:10:28.489860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9aab4967-282e-4793-92ca-58373499bec0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b478530>]}
[0m12:10:28.490366 [debug] [MainThread]: On master: ROLLBACK
[0m12:10:28.491679 [debug] [MainThread]: Using postgres connection "master"
[0m12:10:28.492094 [debug] [MainThread]: On master: BEGIN
[0m12:10:28.493903 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m12:10:28.494467 [debug] [MainThread]: On master: COMMIT
[0m12:10:28.494855 [debug] [MainThread]: Using postgres connection "master"
[0m12:10:28.495204 [debug] [MainThread]: On master: COMMIT
[0m12:10:28.496378 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m12:10:28.496826 [debug] [MainThread]: On master: Close
[0m12:10:28.497416 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:10:28.497962 [info ] [MainThread]: 
[0m12:10:28.501057 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.base_pipedrive__fields
[0m12:10:28.501865 [info ] [Thread-1 (]: 1 of 35 START sql view model public_pipedrive_analytics.base_pipedrive__fields . [RUN]
[0m12:10:28.502428 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_postgres_public, now model.enpal_assessment_project.base_pipedrive__fields)
[0m12:10:28.502867 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.base_pipedrive__fields
[0m12:10:28.513092 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.base_pipedrive__fields"
[0m12:10:28.514092 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.base_pipedrive__fields
[0m12:10:28.554982 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.base_pipedrive__fields"
[0m12:10:28.555993 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m12:10:28.556433 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: BEGIN
[0m12:10:28.556829 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:28.573475 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m12:10:28.574063 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m12:10:28.574526 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */

  create view "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_tmp"
    
    
  as (
    -- Simple base model to connect to the source table
-- This table has JSON array values that need to be unpacked
-- Those unpacked values will be set up as reference nodes in the staging layer
SELECT *
FROM "postgres"."public"."fields"
  );
[0m12:10:28.577086 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m12:10:28.584214 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m12:10:28.584785 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */
alter table "postgres"."public_pipedrive_analytics"."base_pipedrive__fields" rename to "base_pipedrive__fields__dbt_backup"
[0m12:10:28.588459 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m12:10:28.592151 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m12:10:28.592653 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */
alter table "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_tmp" rename to "base_pipedrive__fields"
[0m12:10:28.594442 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:10:28.613166 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: COMMIT
[0m12:10:28.613717 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m12:10:28.614132 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: COMMIT
[0m12:10:28.617099 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:10:28.625630 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_backup"
[0m12:10:28.631147 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m12:10:28.631750 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */
drop view if exists "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_backup" cascade
[0m12:10:28.635709 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m12:10:28.638490 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: Close
[0m12:10:28.640140 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9aab4967-282e-4793-92ca-58373499bec0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095a5880>]}
[0m12:10:28.640916 [info ] [Thread-1 (]: 1 of 35 OK created sql view model public_pipedrive_analytics.base_pipedrive__fields  [[32mCREATE VIEW[0m in 0.14s]
[0m12:10:28.641857 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.base_pipedrive__fields
[0m12:10:28.642419 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__activity
[0m12:10:28.642976 [info ] [Thread-1 (]: 2 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__activity  [RUN]
[0m12:10:28.643710 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.base_pipedrive__fields, now model.enpal_assessment_project.stg_pipedrive__activity)
[0m12:10:28.644149 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__activity
[0m12:10:28.648229 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__activity"
[0m12:10:28.649166 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__activity
[0m12:10:28.655080 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__activity"
[0m12:10:28.656017 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m12:10:28.656449 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: BEGIN
[0m12:10:28.656848 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:28.673944 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m12:10:28.674607 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m12:10:28.675087 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_tmp"
    
    
  as (
    -- Type is a reserved keyword. Renaming.
-- Rename others for consistency with other models
    -- model.id, model.reference_model_id
    -- bools are prefixed with is_ or has_
    -- convert date strings to timestamps and rename
-- add calculated month fields that will be used downstream
WITH base_activity AS (
    SELECT
        activity_id AS id,
        type AS activity_type,
        assigned_to_user AS user_id,
        deal_id,
        done AS is_done,
        due_to::TIMESTAMP AS due_time
    FROM "postgres"."public"."activity"
)
SELECT 
    id,
    activity_type,
    user_id,
    deal_id,
    is_done,
    due_time,
    
    EXTRACT(MONTH FROM due_time) AS month_number,
    TO_CHAR(due_time, 'Month') AS month_name

FROM base_activity
  );
[0m12:10:28.677955 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m12:10:28.681487 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m12:10:28.681954 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity" rename to "stg_pipedrive__activity__dbt_backup"
[0m12:10:28.683719 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:10:28.687019 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m12:10:28.687498 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_tmp" rename to "stg_pipedrive__activity"
[0m12:10:28.690248 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m12:10:28.692135 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: COMMIT
[0m12:10:28.692678 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m12:10:28.693119 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: COMMIT
[0m12:10:28.695339 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:10:28.698123 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_backup"
[0m12:10:28.698908 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m12:10:28.699388 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_backup" cascade
[0m12:10:28.702618 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m12:10:28.704230 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: Close
[0m12:10:28.704831 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9aab4967-282e-4793-92ca-58373499bec0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f041d0>]}
[0m12:10:28.705601 [info ] [Thread-1 (]: 2 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__activity  [[32mCREATE VIEW[0m in 0.06s]
[0m12:10:28.706418 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__activity
[0m12:10:28.706966 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m12:10:28.707890 [info ] [Thread-1 (]: 3 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__activity_types  [RUN]
[0m12:10:28.708511 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__activity, now model.enpal_assessment_project.stg_pipedrive__activity_types)
[0m12:10:28.708954 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m12:10:28.711750 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m12:10:28.712642 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m12:10:28.717981 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m12:10:28.718877 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m12:10:28.719312 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: BEGIN
[0m12:10:28.719710 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:28.736295 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m12:10:28.737487 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m12:10:28.737991 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_tmp"
    
    
  as (
    -- Type and Name are reserved keywords. Renaming.
-- The `active` column is a string with just two possible value. It makes more sense as a bool
SELECT
    id,
    name AS activity_name,
    CASE
        WHEN active = 'Yes' THEN TRUE
        ELSE FALSE
    END AS is_active,
    type AS activity_type
FROM "postgres"."public"."activity_types"
  );
[0m12:10:28.741034 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m12:10:28.744532 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m12:10:28.745016 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types" rename to "stg_pipedrive__activity_types__dbt_backup"
[0m12:10:28.746831 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:10:28.750303 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m12:10:28.750821 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_tmp" rename to "stg_pipedrive__activity_types"
[0m12:10:28.752434 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:10:28.754094 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: COMMIT
[0m12:10:28.754555 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m12:10:28.755044 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: COMMIT
[0m12:10:28.757203 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:10:28.759900 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_backup"
[0m12:10:28.760576 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m12:10:28.761006 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_backup" cascade
[0m12:10:28.763792 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m12:10:28.765566 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: Close
[0m12:10:28.766270 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9aab4967-282e-4793-92ca-58373499bec0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b491100>]}
[0m12:10:28.767186 [info ] [Thread-1 (]: 3 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__activity_types  [[32mCREATE VIEW[0m in 0.06s]
[0m12:10:28.768617 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m12:10:28.769349 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m12:10:28.770090 [info ] [Thread-1 (]: 4 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__deal_changes  [RUN]
[0m12:10:28.770717 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__activity_types, now model.enpal_assessment_project.stg_pipedrive__deal_changes)
[0m12:10:28.771158 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m12:10:28.776528 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m12:10:28.777510 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m12:10:28.782681 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m12:10:28.783607 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m12:10:28.784138 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: BEGIN
[0m12:10:28.785410 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:28.803843 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m12:10:28.804495 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m12:10:28.804996 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_tmp"
    
    
  as (
    -- This is not a source deals table, and deal_id is not a PK (UNIQUE)
    -- leave deal_id named as is to be consistent with naming convention model.reference_model_id
    -- convert date strings to timestamps and rename
-- add calculated month fields that will be used downstream
WITH base_deal_changes AS (
    SELECT
        deal_id,
        change_time::TIMESTAMP AS change_time,
        changed_field_key,
        new_value
    FROM "postgres"."public"."deal_changes"
)
SELECT
    deal_id,
    changed_field_key,
    new_value,
    change_time,
    
    EXTRACT(MONTH FROM change_time) AS month_number,
    TO_CHAR(change_time, 'Month') AS month_name

FROM base_deal_changes
  );
[0m12:10:28.807711 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m12:10:28.811235 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m12:10:28.811726 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes" rename to "stg_pipedrive__deal_changes__dbt_backup"
[0m12:10:28.813420 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:10:28.816666 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m12:10:28.817159 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_tmp" rename to "stg_pipedrive__deal_changes"
[0m12:10:28.818841 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:10:28.820478 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: COMMIT
[0m12:10:28.820966 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m12:10:28.821463 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: COMMIT
[0m12:10:28.823661 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:10:28.826229 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_backup"
[0m12:10:28.826927 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m12:10:28.827375 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_backup" cascade
[0m12:10:28.829893 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m12:10:28.831478 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: Close
[0m12:10:28.832086 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9aab4967-282e-4793-92ca-58373499bec0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b48ce60>]}
[0m12:10:28.832878 [info ] [Thread-1 (]: 4 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__deal_changes  [[32mCREATE VIEW[0m in 0.06s]
[0m12:10:28.833772 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m12:10:28.834556 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__stages
[0m12:10:28.835437 [info ] [Thread-1 (]: 5 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__stages .. [RUN]
[0m12:10:28.836191 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__deal_changes, now model.enpal_assessment_project.stg_pipedrive__stages)
[0m12:10:28.836721 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__stages
[0m12:10:28.839584 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__stages"
[0m12:10:28.840512 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__stages
[0m12:10:28.843942 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__stages"
[0m12:10:28.844748 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m12:10:28.845211 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: BEGIN
[0m12:10:28.845623 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:28.863152 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m12:10:28.863939 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m12:10:28.864421 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_tmp"
    
    
  as (
    /* NOT USED UPSTREAM. 
    The values in this table also found in the JSON array of base_pipedrive__fields.
    I would rather standardise the way stages and lost_reasons are handled.
    My assumption is that base_pipedrive__fields holds the current values configured in the Pipedrive application,
    and if this were to be updated by a sysadmin, the static version of the stages table would not reflect the changes.
NOT USED UPSTREAM. */

-- Rename stage_id to id for consistency: model.id, model.reference_model_id
SELECT
    stage_id AS id,
    stage_name
FROM "postgres"."public"."stages"
  );
[0m12:10:28.866882 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m12:10:28.870550 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m12:10:28.871032 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages" rename to "stg_pipedrive__stages__dbt_backup"
[0m12:10:28.872763 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:10:28.875932 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m12:10:28.876407 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_tmp" rename to "stg_pipedrive__stages"
[0m12:10:28.878121 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:10:28.879776 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: COMMIT
[0m12:10:28.880241 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m12:10:28.880667 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: COMMIT
[0m12:10:28.882810 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:10:28.885393 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_backup"
[0m12:10:28.886049 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m12:10:28.886482 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_backup" cascade
[0m12:10:28.889085 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m12:10:28.890728 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: Close
[0m12:10:28.891349 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9aab4967-282e-4793-92ca-58373499bec0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b52e7e0>]}
[0m12:10:28.892078 [info ] [Thread-1 (]: 5 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__stages  [[32mCREATE VIEW[0m in 0.06s]
[0m12:10:28.892887 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__stages
[0m12:10:28.893404 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__users
[0m12:10:28.894139 [info ] [Thread-1 (]: 6 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__users ... [RUN]
[0m12:10:28.894791 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__stages, now model.enpal_assessment_project.stg_pipedrive__users)
[0m12:10:28.895251 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__users
[0m12:10:28.898563 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__users"
[0m12:10:28.899499 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__users
[0m12:10:28.903293 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__users"
[0m12:10:28.904283 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m12:10:28.904739 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: BEGIN
[0m12:10:28.905133 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:28.922963 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m12:10:28.923653 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m12:10:28.924142 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_tmp"
    
    
  as (
    -- Name is a reserved keyword. Renaming.
-- Convert date strings to timestamps and rename
-- Add calculated month fields that will be used downstream
WITH base_users AS (
    SELECT
        id,
        name AS user_name,
        email AS user_email,
        modified::TIMESTAMP AS modified_time
    FROM "postgres"."public"."users"
)
SELECT
    id,
    user_name,
    user_email,
    modified_time,
    
    EXTRACT(MONTH FROM modified_time) AS month_number,
    TO_CHAR(modified_time, 'Month') AS month_name

FROM base_users
  );
[0m12:10:28.926914 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m12:10:28.932986 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m12:10:28.933745 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__users" rename to "stg_pipedrive__users__dbt_backup"
[0m12:10:28.954717 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m12:10:28.975060 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m12:10:28.991486 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_tmp" rename to "stg_pipedrive__users"
[0m12:10:28.994214 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m12:10:29.014010 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: COMMIT
[0m12:10:29.014681 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m12:10:29.015265 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: COMMIT
[0m12:10:29.018365 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:10:29.021485 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_backup"
[0m12:10:29.022243 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m12:10:29.022750 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_backup" cascade
[0m12:10:29.025881 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m12:10:29.027726 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: Close
[0m12:10:29.028445 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9aab4967-282e-4793-92ca-58373499bec0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b608a40>]}
[0m12:10:29.029238 [info ] [Thread-1 (]: 6 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__users  [[32mCREATE VIEW[0m in 0.13s]
[0m12:10:29.030095 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__users
[0m12:10:29.030694 [debug] [Thread-1 (]: Began running node seed.enpal_assessment_project.minor_stages
[0m12:10:29.031584 [info ] [Thread-1 (]: 7 of 35 START seed file public.minor_stages .................................... [RUN]
[0m12:10:29.032435 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__users, now seed.enpal_assessment_project.minor_stages)
[0m12:10:29.032989 [debug] [Thread-1 (]: Began compiling node seed.enpal_assessment_project.minor_stages
[0m12:10:29.033553 [debug] [Thread-1 (]: Began executing node seed.enpal_assessment_project.minor_stages
[0m12:10:29.062765 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m12:10:29.063255 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: BEGIN
[0m12:10:29.063657 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:29.079150 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m12:10:29.079911 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m12:10:29.080394 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "seed.enpal_assessment_project.minor_stages"} */
truncate table "postgres"."public"."minor_stages"
[0m12:10:29.082530 [debug] [Thread-1 (]: SQL status: TRUNCATE TABLE in 0.002 seconds
[0m12:10:29.100552 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m12:10:29.101070 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: 
          insert into "postgres"."public"."minor_stages" ("id", "activity_type", "stage_id", "minor_stage_id") values
          (%s,%s,%s,%s),(%s,%s,%s,%s)
      ...
[0m12:10:29.102856 [debug] [Thread-1 (]: SQL status: INSERT 0 2 in 0.001 seconds
[0m12:10:29.108981 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.enpal_assessment_project.minor_stages"
[0m12:10:29.110917 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: COMMIT
[0m12:10:29.111369 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m12:10:29.111771 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: COMMIT
[0m12:10:29.114162 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:10:29.115109 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: Close
[0m12:10:29.115675 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9aab4967-282e-4793-92ca-58373499bec0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b5ab3b0>]}
[0m12:10:29.116361 [info ] [Thread-1 (]: 7 of 35 OK loaded seed file public.minor_stages ................................ [[32mINSERT 2[0m in 0.08s]
[0m12:10:29.117110 [debug] [Thread-1 (]: Finished running node seed.enpal_assessment_project.minor_stages
[0m12:10:29.117633 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m12:10:29.118189 [info ] [Thread-1 (]: 8 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__fields_lost_reasons  [RUN]
[0m12:10:29.118773 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.enpal_assessment_project.minor_stages, now model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons)
[0m12:10:29.119232 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m12:10:29.122190 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m12:10:29.123077 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m12:10:29.126728 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m12:10:29.127572 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m12:10:29.128016 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: BEGIN
[0m12:10:29.128424 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:29.146384 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m12:10:29.146912 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m12:10:29.147400 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_tmp"
    
    
  as (
    -- `base_pipedrive__fields` model has the values buried in a JSON array.
-- Make sure ids are INTEGER and not numeric-looking STRING 
	-- it is better to convert here even though CASTING is also required in the referential test.
	-- because in the real world, collaborators would be confused to see numeric-looking values as STRINGs.
WITH expand_array AS (
	SELECT 
		jsonb_array_elements(field_value_options) AS field_value_options
	FROM "postgres"."public_pipedrive_analytics"."base_pipedrive__fields"
	WHERE field_key = 'lost_reason'
)
SELECT
	CAST(field_value_options ->> 'id' AS INTEGER) AS id,
	field_value_options ->> 'label' AS label
FROM expand_array
  );
[0m12:10:29.151382 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m12:10:29.154811 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m12:10:29.155296 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_tmp" rename to "stg_pipedrive__fields_lost_reasons"
[0m12:10:29.156795 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:10:29.158340 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: COMMIT
[0m12:10:29.158791 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m12:10:29.159202 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: COMMIT
[0m12:10:29.161046 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m12:10:29.163500 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_backup"
[0m12:10:29.164148 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m12:10:29.164702 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_backup" cascade
[0m12:10:29.166084 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m12:10:29.167850 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: Close
[0m12:10:29.168543 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9aab4967-282e-4793-92ca-58373499bec0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b624410>]}
[0m12:10:29.169299 [info ] [Thread-1 (]: 8 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__fields_lost_reasons  [[32mCREATE VIEW[0m in 0.05s]
[0m12:10:29.170027 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m12:10:29.170633 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m12:10:29.172112 [info ] [Thread-1 (]: 9 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__fields_stages  [RUN]
[0m12:10:29.173098 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons, now model.enpal_assessment_project.stg_pipedrive__fields_stages)
[0m12:10:29.173563 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m12:10:29.176284 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m12:10:29.177040 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m12:10:29.182177 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m12:10:29.183199 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m12:10:29.183733 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: BEGIN
[0m12:10:29.184328 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:29.202390 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m12:10:29.202967 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m12:10:29.203617 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_stages"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_tmp"
    
    
  as (
    -- `base_pipedrive__fields` model has the values buried in a JSON array.
-- Make sure ids are INTEGER and not numeric-looking STRING 
	-- it is better to convert here even though CASTING is also required in the referential test.
	-- because in the real world, collaborators would be confused to see numeric-looking values as STRINGs.
WITH expand_array AS (
	SELECT 
		jsonb_array_elements(field_value_options) AS field_value_options
	FROM "postgres"."public_pipedrive_analytics"."base_pipedrive__fields"
	WHERE field_key = 'stage_id'
)
SELECT
	CAST(field_value_options ->> 'id' AS INTEGER) AS id,
	field_value_options ->> 'label' AS label
FROM expand_array
  );
[0m12:10:29.207006 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m12:10:29.210268 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m12:10:29.210724 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_stages"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_tmp" rename to "stg_pipedrive__fields_stages"
[0m12:10:29.212530 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:10:29.214055 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: COMMIT
[0m12:10:29.214498 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m12:10:29.214911 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: COMMIT
[0m12:10:29.217050 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:10:29.219547 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_backup"
[0m12:10:29.220341 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m12:10:29.221064 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_stages"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_backup" cascade
[0m12:10:29.222682 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m12:10:29.224275 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: Close
[0m12:10:29.224855 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9aab4967-282e-4793-92ca-58373499bec0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b5e6870>]}
[0m12:10:29.225618 [info ] [Thread-1 (]: 9 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__fields_stages  [[32mCREATE VIEW[0m in 0.05s]
[0m12:10:29.226346 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m12:10:29.226855 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m12:10:29.227632 [info ] [Thread-1 (]: 10 of 35 START test not_null_stg_pipedrive__activity_deal_id ................... [RUN]
[0m12:10:29.228413 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__fields_stages, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e)
[0m12:10:29.228897 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m12:10:29.242193 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m12:10:29.243053 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m12:10:29.259120 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m12:10:29.260006 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m12:10:29.260471 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: BEGIN
[0m12:10:29.260878 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:29.279107 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m12:10:29.279826 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m12:10:29.280394 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select deal_id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where deal_id is null



      
    ) dbt_internal_test
[0m12:10:29.283146 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m12:10:29.286845 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: ROLLBACK
[0m12:10:29.288395 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: Close
[0m12:10:29.289131 [info ] [Thread-1 (]: 10 of 35 PASS not_null_stg_pipedrive__activity_deal_id ......................... [[32mPASS[0m in 0.06s]
[0m12:10:29.290077 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m12:10:29.290607 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m12:10:29.291050 [info ] [Thread-1 (]: 11 of 35 START test not_null_stg_pipedrive__activity_due_time .................. [RUN]
[0m12:10:29.291900 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191)
[0m12:10:29.292366 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m12:10:29.296459 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m12:10:29.297366 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m12:10:29.299664 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m12:10:29.300424 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m12:10:29.300915 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: BEGIN
[0m12:10:29.301420 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:29.319139 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m12:10:29.320014 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m12:10:29.320500 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select due_time
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where due_time is null



      
    ) dbt_internal_test
[0m12:10:29.323219 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m12:10:29.325077 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: ROLLBACK
[0m12:10:29.326796 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: Close
[0m12:10:29.327704 [info ] [Thread-1 (]: 11 of 35 PASS not_null_stg_pipedrive__activity_due_time ........................ [[32mPASS[0m in 0.04s]
[0m12:10:29.328593 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m12:10:29.329460 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m12:10:29.330383 [info ] [Thread-1 (]: 12 of 35 START test not_null_stg_pipedrive__activity_id ........................ [RUN]
[0m12:10:29.331472 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb)
[0m12:10:29.331982 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m12:10:29.336741 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m12:10:29.337663 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m12:10:29.340028 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m12:10:29.340960 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m12:10:29.341434 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: BEGIN
[0m12:10:29.341838 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:29.360138 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m12:10:29.360869 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m12:10:29.361385 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where id is null



      
    ) dbt_internal_test
[0m12:10:29.363983 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m12:10:29.365765 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: ROLLBACK
[0m12:10:29.367310 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: Close
[0m12:10:29.368073 [info ] [Thread-1 (]: 12 of 35 PASS not_null_stg_pipedrive__activity_id .............................. [[32mPASS[0m in 0.04s]
[0m12:10:29.368818 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m12:10:29.369373 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m12:10:29.369883 [info ] [Thread-1 (]: 13 of 35 START test not_null_stg_pipedrive__activity_is_done ................... [RUN]
[0m12:10:29.370583 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543)
[0m12:10:29.371065 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m12:10:29.375345 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m12:10:29.376186 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m12:10:29.380094 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m12:10:29.380914 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m12:10:29.381368 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: BEGIN
[0m12:10:29.381773 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:29.399030 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m12:10:29.399783 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m12:10:29.400296 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select is_done
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where is_done is null



      
    ) dbt_internal_test
[0m12:10:29.403115 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m12:10:29.404819 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: ROLLBACK
[0m12:10:29.406219 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: Close
[0m12:10:29.406945 [info ] [Thread-1 (]: 13 of 35 PASS not_null_stg_pipedrive__activity_is_done ......................... [[32mPASS[0m in 0.04s]
[0m12:10:29.407816 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m12:10:29.408407 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m12:10:29.408969 [info ] [Thread-1 (]: 14 of 35 START test relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_  [RUN]
[0m12:10:29.409809 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543, now test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8)
[0m12:10:29.410296 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m12:10:29.471710 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m12:10:29.472787 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m12:10:29.475249 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m12:10:29.476077 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m12:10:29.476539 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: BEGIN
[0m12:10:29.476958 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:29.494446 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m12:10:29.495286 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m12:10:29.495863 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select activity_type as from_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
    where activity_type is not null
),

parent as (
    select activity_type as to_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m12:10:29.500587 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.004 seconds
[0m12:10:29.502449 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: ROLLBACK
[0m12:10:29.504023 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: Close
[0m12:10:29.504838 [info ] [Thread-1 (]: 14 of 35 PASS relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_  [[32mPASS[0m in 0.10s]
[0m12:10:29.505755 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m12:10:29.506320 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m12:10:29.506933 [info ] [Thread-1 (]: 15 of 35 START test accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time  [RUN]
[0m12:10:29.507721 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8, now test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0)
[0m12:10:29.508203 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m12:10:29.520165 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m12:10:29.521007 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m12:10:29.523667 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m12:10:29.524898 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m12:10:29.525411 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: BEGIN
[0m12:10:29.525898 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:29.543930 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m12:10:29.544526 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m12:10:29.545068 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        changed_field_key as value_field,
        count(*) as n_records

    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
    group by changed_field_key

)

select *
from all_values
where value_field not in (
    'user_id','stage_id','lost_reason','add_time'
)



      
    ) dbt_internal_test
[0m12:10:29.550838 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m12:10:29.552560 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: ROLLBACK
[0m12:10:29.554032 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: Close
[0m12:10:29.554819 [info ] [Thread-1 (]: 15 of 35 PASS accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time  [[32mPASS[0m in 0.05s]
[0m12:10:29.555695 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m12:10:29.556233 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m12:10:29.556692 [info ] [Thread-1 (]: 16 of 35 START test assert_timestamp_equal_add_time_new_value .................. [RUN]
[0m12:10:29.557547 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0, now test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value)
[0m12:10:29.558138 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m12:10:29.561162 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m12:10:29.561984 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m12:10:29.564285 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m12:10:29.565165 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m12:10:29.565626 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: BEGIN
[0m12:10:29.566025 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:29.586530 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m12:10:29.587388 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m12:10:29.587967 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- Proving that the new_value field for add_time changes is redundant. We can just use the change_time.
SELECT * FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
	WHERE changed_field_key = 'add_time'
	AND change_time != new_value::TIMESTAMP
      
    ) dbt_internal_test
[0m12:10:29.593539 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m12:10:29.595414 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: ROLLBACK
[0m12:10:29.597052 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: Close
[0m12:10:29.597788 [info ] [Thread-1 (]: 16 of 35 PASS assert_timestamp_equal_add_time_new_value ........................ [[32mPASS[0m in 0.04s]
[0m12:10:29.598600 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m12:10:29.599137 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m12:10:29.599741 [info ] [Thread-1 (]: 17 of 35 START test not_null_stg_pipedrive__deal_changes_change_time ........... [RUN]
[0m12:10:29.600489 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value, now test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d)
[0m12:10:29.601293 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m12:10:29.606008 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m12:10:29.606919 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m12:10:29.609814 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m12:10:29.610820 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m12:10:29.611273 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: BEGIN
[0m12:10:29.611675 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:29.629331 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m12:10:29.630058 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m12:10:29.630707 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select change_time
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
where change_time is null



      
    ) dbt_internal_test
[0m12:10:29.634406 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m12:10:29.636448 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: ROLLBACK
[0m12:10:29.639152 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: Close
[0m12:10:29.639947 [info ] [Thread-1 (]: 17 of 35 PASS not_null_stg_pipedrive__deal_changes_change_time ................. [[32mPASS[0m in 0.04s]
[0m12:10:29.640727 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m12:10:29.641331 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m12:10:29.641851 [info ] [Thread-1 (]: 18 of 35 START test not_null_stg_pipedrive__deal_changes_deal_id ............... [RUN]
[0m12:10:29.642533 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d, now test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d)
[0m12:10:29.643031 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m12:10:29.647105 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m12:10:29.648059 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m12:10:29.650480 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m12:10:29.651410 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m12:10:29.652249 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: BEGIN
[0m12:10:29.652746 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:29.671270 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m12:10:29.672097 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m12:10:29.672680 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select deal_id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
where deal_id is null



      
    ) dbt_internal_test
[0m12:10:29.675716 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m12:10:29.677458 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: ROLLBACK
[0m12:10:29.678918 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: Close
[0m12:10:29.679629 [info ] [Thread-1 (]: 18 of 35 PASS not_null_stg_pipedrive__deal_changes_deal_id ..................... [[32mPASS[0m in 0.04s]
[0m12:10:29.680386 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m12:10:29.680904 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m12:10:29.681350 [info ] [Thread-1 (]: 19 of 35 START test not_null_stg_pipedrive__deal_changes_new_value ............. [RUN]
[0m12:10:29.681957 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d, now test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96)
[0m12:10:29.682444 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m12:10:29.686736 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m12:10:29.687602 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m12:10:29.690018 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m12:10:29.690835 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m12:10:29.691288 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: BEGIN
[0m12:10:29.691695 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:29.708956 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m12:10:29.709727 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m12:10:29.710234 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select new_value
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
where new_value is null



      
    ) dbt_internal_test
[0m12:10:29.713321 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m12:10:29.715036 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: ROLLBACK
[0m12:10:29.716522 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: Close
[0m12:10:29.717248 [info ] [Thread-1 (]: 19 of 35 PASS not_null_stg_pipedrive__deal_changes_new_value ................... [[32mPASS[0m in 0.04s]
[0m12:10:29.717990 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m12:10:29.718515 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_change_user_references_user_id
[0m12:10:29.719045 [info ] [Thread-1 (]: 20 of 35 START test assert_change_user_references_user_id ...................... [RUN]
[0m12:10:29.719845 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96, now test.enpal_assessment_project.assert_change_user_references_user_id)
[0m12:10:29.720428 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_change_user_references_user_id
[0m12:10:29.727091 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m12:10:29.727934 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_change_user_references_user_id
[0m12:10:29.730230 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m12:10:29.731004 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m12:10:29.731437 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: BEGIN
[0m12:10:29.731833 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:29.750139 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m12:10:29.751192 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m12:10:29.751862 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_change_user_references_user_id"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- CTE to pre-filter deal_changes for stage_id changes
-- to safely cast new_value to an integer when we're sure all the values can be implicitly casted
WITH deal_change_user AS (
	
SELECT
    changed_field_key,
    new_value
FROM
    "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
WHERE
    changed_field_key = 'user_id'

)
SELECT *
FROM deal_change_user d
LEFT OUTER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__users" u
ON CAST(d.new_value AS INTEGER) = u.id
WHERE u.id IS NULL -- Any non referential values in d will return a NULL s.id
      
    ) dbt_internal_test
[0m12:10:29.758433 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.006 seconds
[0m12:10:29.760254 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: ROLLBACK
[0m12:10:29.761626 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: Close
[0m12:10:29.762327 [info ] [Thread-1 (]: 20 of 35 PASS assert_change_user_references_user_id ............................ [[32mPASS[0m in 0.04s]
[0m12:10:29.763053 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_change_user_references_user_id
[0m12:10:29.763560 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m12:10:29.763991 [info ] [Thread-1 (]: 21 of 35 START test not_null_stg_pipedrive__users_id ........................... [RUN]
[0m12:10:29.764618 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_change_user_references_user_id, now test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817)
[0m12:10:29.765101 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m12:10:29.769718 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m12:10:29.770628 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m12:10:29.773279 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m12:10:29.775126 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m12:10:29.775595 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: BEGIN
[0m12:10:29.776004 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:29.793259 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m12:10:29.793901 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m12:10:29.794374 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where id is null



      
    ) dbt_internal_test
[0m12:10:29.796513 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m12:10:29.798222 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: ROLLBACK
[0m12:10:29.799548 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: Close
[0m12:10:29.800490 [info ] [Thread-1 (]: 21 of 35 PASS not_null_stg_pipedrive__users_id ................................. [[32mPASS[0m in 0.04s]
[0m12:10:29.801413 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m12:10:29.801948 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m12:10:29.802500 [info ] [Thread-1 (]: 22 of 35 START test not_null_stg_pipedrive__users_modified_time ................ [RUN]
[0m12:10:29.803162 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817, now test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5)
[0m12:10:29.803658 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m12:10:29.807808 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m12:10:29.808642 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m12:10:29.810889 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m12:10:29.811761 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m12:10:29.812216 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: BEGIN
[0m12:10:29.812627 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:29.829407 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m12:10:29.830069 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m12:10:29.830571 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select modified_time
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where modified_time is null



      
    ) dbt_internal_test
[0m12:10:29.833363 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m12:10:29.835349 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: ROLLBACK
[0m12:10:29.838136 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: Close
[0m12:10:29.838912 [info ] [Thread-1 (]: 22 of 35 PASS not_null_stg_pipedrive__users_modified_time ...................... [[32mPASS[0m in 0.04s]
[0m12:10:29.839756 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m12:10:29.840282 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m12:10:29.840745 [info ] [Thread-1 (]: 23 of 35 START test not_null_stg_pipedrive__users_user_email ................... [RUN]
[0m12:10:29.841417 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5, now test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157)
[0m12:10:29.841910 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m12:10:29.846064 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m12:10:29.846994 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m12:10:29.849264 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m12:10:29.850171 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m12:10:29.850614 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: BEGIN
[0m12:10:29.851041 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:29.868179 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m12:10:29.868984 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m12:10:29.869578 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select user_email
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where user_email is null



      
    ) dbt_internal_test
[0m12:10:29.872437 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m12:10:29.874229 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: ROLLBACK
[0m12:10:29.875728 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: Close
[0m12:10:29.876467 [info ] [Thread-1 (]: 23 of 35 PASS not_null_stg_pipedrive__users_user_email ......................... [[32mPASS[0m in 0.04s]
[0m12:10:29.877227 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m12:10:29.877849 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m12:10:29.878993 [info ] [Thread-1 (]: 24 of 35 START test not_null_stg_pipedrive__users_user_name .................... [RUN]
[0m12:10:29.879721 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157, now test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5)
[0m12:10:29.880177 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m12:10:29.884581 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m12:10:29.885419 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m12:10:29.887857 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m12:10:29.888865 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m12:10:29.889403 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: BEGIN
[0m12:10:29.889831 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:29.913018 [debug] [Thread-1 (]: SQL status: BEGIN in 0.023 seconds
[0m12:10:29.913816 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m12:10:29.914282 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select user_name
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where user_name is null



      
    ) dbt_internal_test
[0m12:10:29.919086 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.004 seconds
[0m12:10:29.922410 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: ROLLBACK
[0m12:10:29.924467 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: Close
[0m12:10:29.925409 [info ] [Thread-1 (]: 24 of 35 PASS not_null_stg_pipedrive__users_user_name .......................... [[32mPASS[0m in 0.05s]
[0m12:10:29.926189 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m12:10:29.926715 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m12:10:29.927361 [info ] [Thread-1 (]: 25 of 35 START test relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_  [RUN]
[0m12:10:29.928119 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5, now test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d)
[0m12:10:29.928646 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m12:10:29.935418 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m12:10:29.937358 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m12:10:29.941306 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m12:10:29.942381 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m12:10:29.942918 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: BEGIN
[0m12:10:29.943369 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:29.962172 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m12:10:29.962926 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m12:10:29.963409 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select user_id as from_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
    where user_id is not null
),

parent as (
    select id as to_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m12:10:29.968235 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.004 seconds
[0m12:10:29.970027 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: ROLLBACK
[0m12:10:29.971457 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: Close
[0m12:10:29.972188 [info ] [Thread-1 (]: 25 of 35 PASS relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_  [[32mPASS[0m in 0.04s]
[0m12:10:29.973035 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m12:10:29.973577 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m12:10:29.974084 [info ] [Thread-1 (]: 26 of 35 START test assert_change_stage_references_lost_reason_id .............. [RUN]
[0m12:10:29.974810 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d, now test.enpal_assessment_project.assert_change_stage_references_lost_reason_id)
[0m12:10:29.975286 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m12:10:29.980538 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m12:10:29.981444 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m12:10:29.983758 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m12:10:29.984594 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m12:10:29.985042 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: BEGIN
[0m12:10:29.985448 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:30.002564 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m12:10:30.003341 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m12:10:30.003893 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- new_value field is a STRING type but contains mixed values for other tables/models
-- The CTE will pre-filter the deal_changes to safely cast new_value to an integer for this test
WITH deal_change_reasons AS (
	
SELECT
    changed_field_key,
    new_value
FROM
    "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
WHERE
    changed_field_key = 'lost_reason'

)
SELECT *
FROM deal_change_reasons dcr
LEFT OUTER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons" reasons
ON CAST(dcr.new_value AS INTEGER) = reasons.id
WHERE reasons.id IS NULL -- Any non referential values in dcr will return a NULL reasons.id
      
    ) dbt_internal_test
[0m12:10:30.009262 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m12:10:30.010989 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: ROLLBACK
[0m12:10:30.012521 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: Close
[0m12:10:30.013270 [info ] [Thread-1 (]: 26 of 35 PASS assert_change_stage_references_lost_reason_id .................... [[32mPASS[0m in 0.04s]
[0m12:10:30.014160 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m12:10:30.014751 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m12:10:30.015192 [info ] [Thread-1 (]: 27 of 35 START test assert_change_stage_references_stage_id .................... [RUN]
[0m12:10:30.015869 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_change_stage_references_lost_reason_id, now test.enpal_assessment_project.assert_change_stage_references_stage_id)
[0m12:10:30.016568 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m12:10:30.019760 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m12:10:30.020551 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m12:10:30.022905 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m12:10:30.023828 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m12:10:30.024280 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: BEGIN
[0m12:10:30.024823 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:30.042804 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m12:10:30.043541 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m12:10:30.044048 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_change_stage_references_stage_id"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- new_value field is a STRING type but contains mixed values for other tables/models
-- The CTE will pre-filter the deal_changes to safely cast new_value to an integer for this test
WITH deal_change_stage AS (
	
SELECT
    changed_field_key,
    new_value
FROM
    "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
WHERE
    changed_field_key = 'stage_id'

)
SELECT *
FROM deal_change_stage dcs
LEFT OUTER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages" stages
ON CAST(dcs.new_value AS INTEGER) = stages.id
WHERE stages.id IS NULL -- Any non referential values in d will return a NULL s.id
      
    ) dbt_internal_test
[0m12:10:30.051294 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.007 seconds
[0m12:10:30.053023 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: ROLLBACK
[0m12:10:30.054359 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: Close
[0m12:10:30.055183 [info ] [Thread-1 (]: 27 of 35 PASS assert_change_stage_references_stage_id .......................... [[32mPASS[0m in 0.04s]
[0m12:10:30.056040 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m12:10:30.056570 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_activity_join_activity_type
[0m12:10:30.057058 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_change_stage_references_stage_id, now model.enpal_assessment_project.int_activity_join_activity_type)
[0m12:10:30.057691 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_activity_join_activity_type
[0m12:10:30.061223 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_activity_join_activity_type"
[0m12:10:30.062333 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_activity_join_activity_type
[0m12:10:30.062819 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m12:10:30.063334 [info ] [Thread-1 (]: 28 of 35 START sql view model public_pipedrive_analytics.int_deal_changes_dedupe_new_deal  [RUN]
[0m12:10:30.063842 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_activity_join_activity_type, now model.enpal_assessment_project.int_deal_changes_dedupe_new_deal)
[0m12:10:30.064271 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m12:10:30.067834 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m12:10:30.068760 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m12:10:30.072188 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m12:10:30.073056 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m12:10:30.073519 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: BEGIN
[0m12:10:30.073966 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:30.093404 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m12:10:30.093977 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m12:10:30.094542 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"} */

  create view "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_tmp"
    
    
  as (
    -- This intermediate model does the following:
	-- Separates new deals from the deal_changes model
	-- Deduplicates a handful of dupe deals in the deal_changes model
	  -- Assumption: deals should not have more than one added date
	  -- Assumption: the latest added date is the one that should be presented to the model
	  -- Method: simple MAX

-- materialized view to apply built-in test unique values after dedupe


SELECT
	deal_id, 
	MAX(change_time) AS created_time
FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
WHERE changed_field_key = 'add_time'
GROUP BY
	deal_id
  );
[0m12:10:30.097468 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m12:10:30.100779 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m12:10:30.101346 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"} */
alter table "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_tmp" rename to "int_deal_changes_dedupe_new_deal"
[0m12:10:30.102981 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:10:30.104535 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: COMMIT
[0m12:10:30.104988 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m12:10:30.105408 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: COMMIT
[0m12:10:30.107165 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m12:10:30.109656 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_backup"
[0m12:10:30.110309 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m12:10:30.110770 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"} */
drop view if exists "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_backup" cascade
[0m12:10:30.112227 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m12:10:30.113815 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: Close
[0m12:10:30.114418 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9aab4967-282e-4793-92ca-58373499bec0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b634c50>]}
[0m12:10:30.115162 [info ] [Thread-1 (]: 28 of 35 OK created sql view model public_pipedrive_analytics.int_deal_changes_dedupe_new_deal  [[32mCREATE VIEW[0m in 0.05s]
[0m12:10:30.115920 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m12:10:30.116661 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_user
[0m12:10:30.117305 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_dedupe_new_deal, now model.enpal_assessment_project.int_deal_changes_user)
[0m12:10:30.117763 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_user
[0m12:10:30.120676 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_user"
[0m12:10:30.121761 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_user
[0m12:10:30.122248 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m12:10:30.122879 [info ] [Thread-1 (]: 29 of 35 START sql view model public_pipedrive_analytics.int_deal_changes_dedupe_lost_reason  [RUN]
[0m12:10:30.123423 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_user, now model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason)
[0m12:10:30.123842 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m12:10:30.127284 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m12:10:30.128085 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m12:10:30.131499 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m12:10:30.132357 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m12:10:30.132943 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: BEGIN
[0m12:10:30.133705 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:30.152221 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m12:10:30.152845 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m12:10:30.153445 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"} */

  create view "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_tmp"
    
    
  as (
    -- This intermediate model does the following:
	-- Separates the lost reason from the deal_changes model
	-- Adds the friendly lost reason label to the deal_changes data.
	-- Deduplicates a handful of dupe deals in the deal_changes model
		-- Assumption: deals should not have more than one lost reason
		-- Assumption: the latest lost reason is the one that should be presented to the model
		-- Method: row_number in reverse order and then pick the first row. 
		-- This pattern is better when we don't know how many duplicate rows there could be, but the latest will always be row number 1.
		-- Can't just take MAX(new_value) as was done for new_deals, because that would pick the largest given lost reason id, which would be incorrect.

-- materialized view to apply built-in test unique values after dedupe


WITH deal_changes_lost_reason AS (
	SELECT
		ROW_NUMBER() OVER(PARTITION BY deal_id ORDER BY change_time DESC) AS reverse_order,
		deal_id,
		new_value AS lost_reason_id,
		change_time,
		month_name,
		month_number
	FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
	WHERE changed_field_key = 'lost_reason'
),
deal_changes_lost_reason_cast_id AS (
	SELECT
		deal_id,
		CAST(lost_reason_id AS INTEGER) AS lost_reason_id, -- do it here once rather than twice in the final select & join clauses
		change_time,
		month_name,
		month_number
	FROM deal_changes_lost_reason
	WHERE reverse_order = 1
)
SELECT
dcr.deal_id,
dcr.lost_reason_id,
lost_reasons.label,
dcr.change_time,
dcr.month_name,
dcr.month_number
FROM deal_changes_lost_reason_cast_id dcr
INNER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons" lost_reasons
ON dcr.lost_reason_id = lost_reasons.id
  );
[0m12:10:30.157424 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m12:10:30.162534 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m12:10:30.163031 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"} */
alter table "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_tmp" rename to "int_deal_changes_dedupe_lost_reason"
[0m12:10:30.164914 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:10:30.166641 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: COMMIT
[0m12:10:30.167123 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m12:10:30.167678 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: COMMIT
[0m12:10:30.169857 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:10:30.172459 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_backup"
[0m12:10:30.173122 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m12:10:30.173555 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"} */
drop view if exists "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_backup" cascade
[0m12:10:30.175147 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m12:10:30.176704 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: Close
[0m12:10:30.177353 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9aab4967-282e-4793-92ca-58373499bec0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b66cf80>]}
[0m12:10:30.178076 [info ] [Thread-1 (]: 29 of 35 OK created sql view model public_pipedrive_analytics.int_deal_changes_dedupe_lost_reason  [[32mCREATE VIEW[0m in 0.05s]
[0m12:10:30.178887 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m12:10:30.179464 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m12:10:30.180216 [info ] [Thread-1 (]: 30 of 35 START sql view model public_pipedrive_analytics.int_deal_changes_dedupe_stage  [RUN]
[0m12:10:30.180868 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason, now model.enpal_assessment_project.int_deal_changes_dedupe_stage)
[0m12:10:30.181305 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m12:10:30.184900 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m12:10:30.185693 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m12:10:30.189244 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m12:10:30.190053 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m12:10:30.190487 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: BEGIN
[0m12:10:30.190892 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:30.208844 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m12:10:30.209607 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m12:10:30.210163 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_stage"} */

  create view "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_tmp"
    
    
  as (
    -- This intermediate model does the following:
	-- Separates the stages from the deal_changes model
	-- Adds the friendly stages label to the deal_changes data.
	-- Deduplicates a handful of dupe deals in the deal_changes model
		-- Assumption: deals should not arrive at the same stage more than once
			-- Note: it might be possible in the real world, but this rule was checked by looking at the deals that also had more than one add date, which definitely seems incorrect.
		-- Assumption: the latest lost reason is the one that should be presented to the model
		-- Method: row_number in reverse order and then pick the first row. 
		-- This pattern is better when we don't know how many duplicate rows there could be, but the latest will always be row number 1.
		-- Can't just take MAX(new_value) as was done for new_deals, because that would pick the largest given lost reason id, which would be incorrect.

-- materialized view to apply built-in test unique values after dedupe


WITH deal_changes_stage AS (
	SELECT
		ROW_NUMBER() OVER(PARTITION BY deal_id, new_value ORDER BY new_value, change_time DESC) AS reverse_order,
		deal_id,
		new_value AS stage_id,
		change_time,
		month_name,
		month_number
	FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
	WHERE changed_field_key = 'stage_id'
),
deal_changes_stage_cast_id AS (
	SELECT
		deal_id,
		CAST(stage_id AS INTEGER) AS stage_id, -- do it here once rather than twice in the final select & join clauses
		change_time,
		month_name,
		month_number
	FROM deal_changes_stage
	WHERE reverse_order = 1
)
SELECT
dcs.deal_id,
dcs.stage_id,
stages.label,
dcs.change_time,
dcs.month_name,
dcs.month_number
FROM deal_changes_stage_cast_id dcs
INNER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages" stages
ON dcs.stage_id = stages.id
  );
[0m12:10:30.214089 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m12:10:30.217349 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m12:10:30.217927 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_stage"} */
alter table "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_tmp" rename to "int_deal_changes_dedupe_stage"
[0m12:10:30.219698 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:10:30.221480 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: COMMIT
[0m12:10:30.221930 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m12:10:30.222344 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: COMMIT
[0m12:10:30.224279 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m12:10:30.226871 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_backup"
[0m12:10:30.227643 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m12:10:30.228098 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_stage"} */
drop view if exists "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_backup" cascade
[0m12:10:30.229513 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m12:10:30.231085 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: Close
[0m12:10:30.231703 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9aab4967-282e-4793-92ca-58373499bec0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b47bfe0>]}
[0m12:10:30.232393 [info ] [Thread-1 (]: 30 of 35 OK created sql view model public_pipedrive_analytics.int_deal_changes_dedupe_stage  [[32mCREATE VIEW[0m in 0.05s]
[0m12:10:30.233230 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m12:10:30.233763 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m12:10:30.234558 [info ] [Thread-1 (]: 31 of 35 START test unique_int_deal_changes_dedupe_new_deal_deal_id ............ [RUN]
[0m12:10:30.235417 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_dedupe_stage, now test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc)
[0m12:10:30.235899 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m12:10:30.242423 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m12:10:30.243234 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m12:10:30.245584 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m12:10:30.246445 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m12:10:30.246918 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: BEGIN
[0m12:10:30.247400 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:30.264515 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m12:10:30.265216 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m12:10:30.265771 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    deal_id as unique_field,
    count(*) as n_records

from "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal"
where deal_id is not null
group by deal_id
having count(*) > 1



      
    ) dbt_internal_test
[0m12:10:30.271727 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m12:10:30.273490 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: ROLLBACK
[0m12:10:30.274999 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: Close
[0m12:10:30.275729 [info ] [Thread-1 (]: 31 of 35 PASS unique_int_deal_changes_dedupe_new_deal_deal_id .................. [[32mPASS[0m in 0.04s]
[0m12:10:30.276515 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m12:10:30.277031 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m12:10:30.277604 [info ] [Thread-1 (]: 32 of 35 START test unique_int_deal_changes_dedupe_lost_reason_deal_id ......... [RUN]
[0m12:10:30.278368 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc, now test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907)
[0m12:10:30.278844 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m12:10:30.283050 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m12:10:30.283915 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m12:10:30.286229 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m12:10:30.286996 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m12:10:30.287434 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: BEGIN
[0m12:10:30.287839 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:30.305434 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m12:10:30.306026 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m12:10:30.306633 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    deal_id as unique_field,
    count(*) as n_records

from "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason"
where deal_id is not null
group by deal_id
having count(*) > 1



      
    ) dbt_internal_test
[0m12:10:30.315562 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.008 seconds
[0m12:10:30.317646 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: ROLLBACK
[0m12:10:30.319162 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: Close
[0m12:10:30.319882 [info ] [Thread-1 (]: 32 of 35 PASS unique_int_deal_changes_dedupe_lost_reason_deal_id ............... [[32mPASS[0m in 0.04s]
[0m12:10:30.320744 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m12:10:30.321280 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_unique_deal_stage
[0m12:10:30.321720 [info ] [Thread-1 (]: 33 of 35 START test assert_unique_deal_stage ................................... [RUN]
[0m12:10:30.322434 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907, now test.enpal_assessment_project.assert_unique_deal_stage)
[0m12:10:30.322917 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_unique_deal_stage
[0m12:10:30.326106 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_unique_deal_stage"
[0m12:10:30.326914 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_unique_deal_stage
[0m12:10:30.329669 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_unique_deal_stage"
[0m12:10:30.330510 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_unique_deal_stage"
[0m12:10:30.330941 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: BEGIN
[0m12:10:30.331336 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:30.349880 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m12:10:30.350511 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_unique_deal_stage"
[0m12:10:30.350979 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_unique_deal_stage"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- Assert that there are no duplicate deal-stage pairs in the deal changes table
SELECT
    COUNT(*),
    deal_id,
    stage_id
FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage"
GROUP BY
    deal_id,
    stage_id
HAVING COUNT(*) > 1
      
    ) dbt_internal_test
[0m12:10:30.373191 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.022 seconds
[0m12:10:30.374909 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: ROLLBACK
[0m12:10:30.376424 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: Close
[0m12:10:30.377236 [info ] [Thread-1 (]: 33 of 35 PASS assert_unique_deal_stage ......................................... [[32mPASS[0m in 0.05s]
[0m12:10:30.378204 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_unique_deal_stage
[0m12:10:30.378786 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_activity
[0m12:10:30.379366 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_unique_deal_stage, now model.enpal_assessment_project.int_deal_changes_activity)
[0m12:10:30.379947 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_activity
[0m12:10:30.388387 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_activity"
[0m12:10:30.389803 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_activity
[0m12:10:30.390761 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.mrt_deals_stages
[0m12:10:30.391776 [info ] [Thread-1 (]: 34 of 35 START sql table model public_pipedrive_analytics.mrt_deals_stages ..... [RUN]
[0m12:10:30.392816 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_activity, now model.enpal_assessment_project.mrt_deals_stages)
[0m12:10:30.393323 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.mrt_deals_stages
[0m12:10:30.403371 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.mrt_deals_stages"
[0m12:10:30.404216 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.mrt_deals_stages
[0m12:10:30.430234 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.mrt_deals_stages"
[0m12:10:30.431118 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m12:10:30.431551 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: BEGIN
[0m12:10:30.431942 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:30.452666 [debug] [Thread-1 (]: SQL status: BEGIN in 0.021 seconds
[0m12:10:30.453380 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m12:10:30.453970 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */

  
    

  create  table "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_tmp"
  
  
    as
  
  (
    -- This mart model provides a breakdown by month of all deals and their stages, minor stages, and activities.
WITH  __dbt__cte__int_activity_join_activity_type as (
-- Simple intermediate model to join activity and activity_types
-- thus providing the friendly name of the activity type for downstream models
SELECT
	a.user_id,
	a.deal_id,
	t.activity_name,
	ms.stage_id,
	ms.minor_stage_id,
	t.is_active, -- this would be a mart level filter: business logic determines when to include deactivated activity types
	a.is_done, -- this would be a report level filter: analyst determines when to exclude incomplete activities
	a.due_time,
	a.month_name,
	a.month_number
FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity" a
INNER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types" t
	ON a.activity_type = t.activity_type
INNER JOIN "postgres"."public"."minor_stages" ms
	ON t.activity_type = ms.activity_type
),  __dbt__cte__int_deal_changes_activity as (
-- brings in the activity data for deals in the deal_changes table with the same deal_id
-- These will just be the ones with call activities against them

-- Note that there are very few rows compared to the total number of deals
-- Potential problem? Why are there so many rows in the activity table with deal ids that don't exist in the deal_changes table?

SELECT
    nd.deal_id,
    act.activity_name,
    act.stage_id,
    act.minor_stage_id,
    act.is_active, -- this would be a mart level filter: business logic determines when to include deactivated activity types
    act.is_done, -- this would be a report level filter: analyst determines when to exclude incomplete activities
    act.month_number,
    act.month_name
FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal" nd
INNER JOIN __dbt__cte__int_activity_join_activity_type act -- result of INNER JOIN is very few rows. Is it a problem?
ON nd.deal_id = act.deal_id
), all_deal_changes_and_activity AS (
    SELECT
        deal_id,
        stage_id,
        minor_stage_id,
        is_done, -- this would be a report level filter: analyst determines when to exclude incomplete activities
        activity_name AS label,
        month_name,
        month_number
    FROM __dbt__cte__int_deal_changes_activity
    WHERE is_active = TRUE -- Mart level filter, most business users will ignore e.g. 'Follow Up Call' that is set to be inactive
    UNION ALL
    SELECT
        deal_id,
        stage_id,
        NULL AS minor_stage_id,
        NULL AS is_done,
        label,
        month_name,
        month_number
    FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage"
)
SELECT
    nd.deal_id,
    dca.stage_id,
    dca.minor_stage_id,
    dca.is_done,
    dca.label,
    dca.month_name,
    dca.month_number
FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal" nd -- Only deals from the deal_changes model (these have a created_time)
LEFT OUTER JOIN all_deal_changes_and_activity dca -- This will pick up the minor stages/activities where they exist for this set of deals
    ON nd.deal_id = dca.deal_id
  );
  
[0m12:10:30.498515 [debug] [Thread-1 (]: SQL status: SELECT 8895 in 0.044 seconds
[0m12:10:30.502112 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m12:10:30.502613 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */
alter table "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_tmp" rename to "mrt_deals_stages"
[0m12:10:30.504193 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:10:30.509525 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: COMMIT
[0m12:10:30.510012 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m12:10:30.510426 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: COMMIT
[0m12:10:30.512412 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:10:30.514850 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_backup"
[0m12:10:30.517984 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m12:10:30.518455 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */
drop table if exists "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_backup" cascade
[0m12:10:30.521100 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.002 seconds
[0m12:10:30.522793 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: Close
[0m12:10:30.523452 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9aab4967-282e-4793-92ca-58373499bec0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089ce2d0>]}
[0m12:10:30.524534 [info ] [Thread-1 (]: 34 of 35 OK created sql table model public_pipedrive_analytics.mrt_deals_stages  [[32mSELECT 8895[0m in 0.13s]
[0m12:10:30.525379 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.mrt_deals_stages
[0m12:10:30.526202 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m12:10:30.527036 [info ] [Thread-1 (]: 35 of 35 START sql view model public_pipedrive_analytics.rep_sales_funnel_monthly  [RUN]
[0m12:10:30.527625 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.mrt_deals_stages, now model.enpal_assessment_project.rep_sales_funnel_monthly)
[0m12:10:30.528137 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m12:10:30.531219 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m12:10:30.532050 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m12:10:30.535899 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m12:10:30.536940 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m12:10:30.537524 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: BEGIN
[0m12:10:30.538096 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:30.554718 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m12:10:30.555686 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m12:10:30.556260 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.rep_sales_funnel_monthly"} */

  create view "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_tmp"
    
    
  as (
    -- ASSUMPTIONS FOR THIS MODEL:
-- Show the number of deals in each stage of the sales funnel, for each month
    -- Although we have models for users, they are not needed/requested in this model
    -- Although we have models for lost deals
        -- we are showing the stage the deal was in at the time of the activity 
        -- whether or not it was closed in the end
        -- If it was not closed in the end, it just doesn't get counted in the Closing or later stages
        -- so it doesn't appear necessary to use the lost reasons model

-- create the funnel steps as requested
WITH funnel_step_from_stages AS (
	SELECT
		deal_id,
		month_number,
		month_name,
		CONCAT(stage_id, 
			CASE
				WHEN minor_stage_id IS NULL THEN ''
				ELSE CONCAT('.', minor_stage_id)
			END
		) AS funnel_step,
		label AS kpi_name
	FROM "postgres"."public_pipedrive_analytics"."mrt_deals_stages" AS funnel
    WHERE COALESCE(is_done, TRUE) -- report level filter: exclude incomplete activities
),
-- aggregate CTE then order, to avoid having to keep the order columns in the view
monthly_agg AS (
	SELECT
		COUNT(deal_id) AS deals_count,
		month_number,
		month_name,
		funnel_step,
		kpi_name
	FROM funnel_step_from_stages
	GROUP BY
		month_number,
		month_name,
		funnel_step,
		kpi_name
)
-- final query with ordering
SELECT
	month_name AS month,
	kpi_name,
	funnel_step,
	deals_count
	FROM monthly_agg
ORDER BY month_number, funnel_step
  );
[0m12:10:30.559716 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m12:10:30.562983 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m12:10:30.563429 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.rep_sales_funnel_monthly"} */
alter table "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_tmp" rename to "rep_sales_funnel_monthly"
[0m12:10:30.565130 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:10:30.566721 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: COMMIT
[0m12:10:30.567175 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m12:10:30.567606 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: COMMIT
[0m12:10:30.569739 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:10:30.572241 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_backup"
[0m12:10:30.572896 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m12:10:30.573545 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.rep_sales_funnel_monthly"} */
drop view if exists "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_backup" cascade
[0m12:10:30.575178 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m12:10:30.576755 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: Close
[0m12:10:30.577345 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9aab4967-282e-4793-92ca-58373499bec0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b5a0c80>]}
[0m12:10:30.578019 [info ] [Thread-1 (]: 35 of 35 OK created sql view model public_pipedrive_analytics.rep_sales_funnel_monthly  [[32mCREATE VIEW[0m in 0.05s]
[0m12:10:30.578736 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m12:10:30.579977 [debug] [MainThread]: Using postgres connection "master"
[0m12:10:30.580403 [debug] [MainThread]: On master: BEGIN
[0m12:10:30.580752 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:10:30.597316 [debug] [MainThread]: SQL status: BEGIN in 0.016 seconds
[0m12:10:30.597931 [debug] [MainThread]: On master: COMMIT
[0m12:10:30.598355 [debug] [MainThread]: Using postgres connection "master"
[0m12:10:30.598790 [debug] [MainThread]: On master: COMMIT
[0m12:10:30.600285 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m12:10:30.600843 [debug] [MainThread]: On master: Close
[0m12:10:30.601507 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:10:30.601956 [debug] [MainThread]: Connection 'model.enpal_assessment_project.rep_sales_funnel_monthly' was properly closed.
[0m12:10:30.602414 [info ] [MainThread]: 
[0m12:10:30.602827 [info ] [MainThread]: Finished running 12 view models, 1 seed, 21 data tests, 1 table model in 0 hours 0 minutes and 2.38 seconds (2.38s).
[0m12:10:30.609907 [debug] [MainThread]: Command end result
[0m12:10:30.649057 [info ] [MainThread]: 
[0m12:10:30.649682 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:10:30.650113 [info ] [MainThread]: 
[0m12:10:30.650518 [info ] [MainThread]: Done. PASS=35 WARN=0 ERROR=0 SKIP=0 TOTAL=35
[0m12:10:30.653005 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 3.7013044, "process_in_blocks": "0", "process_kernel_time": 0.641374, "process_mem_max_rss": "114794496", "process_out_blocks": "0", "process_user_time": 4.285724}
[0m12:10:30.653750 [debug] [MainThread]: Command `dbt build` succeeded at 12:10:30.653598 after 3.70 seconds
[0m12:10:30.654229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ce4b00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ae67890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b626d80>]}
[0m12:10:30.654656 [debug] [MainThread]: Flushing usage events
[0m16:34:03.494948 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b39e570>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b53f110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b53ec30>]}


============================== 16:34:03.502753 | 934e2743-b6ee-47f6-82bd-41aad67eb993 ==============================
[0m16:34:03.502753 [info ] [MainThread]: Running with dbt=1.8.9
[0m16:34:03.503568 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/julian/Documents/hatvalues_repo/dbt_enpal_assessment', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/julian/Documents/hatvalues_repo/dbt_enpal_assessment/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:34:03.798145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '934e2743-b6ee-47f6-82bd-41aad67eb993', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3e48f0>]}
[0m16:34:03.865254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '934e2743-b6ee-47f6-82bd-41aad67eb993', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3e5be0>]}
[0m16:34:03.867179 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m16:34:04.013492 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m16:34:04.245030 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 5 files changed.
[0m16:34:04.245935 [debug] [MainThread]: Partial parsing: updated file: enpal_assessment_project://models/intermediate/int_deal_changes_user.sql
[0m16:34:04.246484 [debug] [MainThread]: Partial parsing: updated file: enpal_assessment_project://models/intermediate/int_deal_changes_activity.sql
[0m16:34:04.247049 [debug] [MainThread]: Partial parsing: updated file: enpal_assessment_project://models/staging/stg_pipedrive__users.sql
[0m16:34:04.247617 [debug] [MainThread]: Partial parsing: updated file: enpal_assessment_project://models/staging/stg_pipedrive__activity.sql
[0m16:34:04.248118 [debug] [MainThread]: Partial parsing: updated file: enpal_assessment_project://models/reporting/rep_sales_funnel_monthly.sql
[0m16:34:04.536495 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m16:34:04.537111 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '934e2743-b6ee-47f6-82bd-41aad67eb993', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c269e20>]}
[0m16:34:04.786230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '934e2743-b6ee-47f6-82bd-41aad67eb993', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c4948f0>]}
[0m16:34:04.955731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '934e2743-b6ee-47f6-82bd-41aad67eb993', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c44a060>]}
[0m16:34:04.956402 [info ] [MainThread]: Found 16 models, 21 data tests, 1 seed, 6 sources, 430 macros
[0m16:34:04.956898 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '934e2743-b6ee-47f6-82bd-41aad67eb993', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c4f1760>]}
[0m16:34:04.960237 [info ] [MainThread]: 
[0m16:34:04.960978 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:34:04.966443 [debug] [ThreadPool]: Acquiring new postgres connection 'list_postgres'
[0m16:34:05.046946 [debug] [ThreadPool]: Using postgres connection "list_postgres"
[0m16:34:05.047485 [debug] [ThreadPool]: On list_postgres: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
[0m16:34:05.047874 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:34:05.112585 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.065 seconds
[0m16:34:05.114352 [debug] [ThreadPool]: On list_postgres: Close
[0m16:34:05.116908 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_postgres, now list_postgres_public_pipedrive_analytics)
[0m16:34:05.124221 [debug] [ThreadPool]: Using postgres connection "list_postgres_public_pipedrive_analytics"
[0m16:34:05.124697 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: BEGIN
[0m16:34:05.125041 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:34:05.141622 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m16:34:05.142217 [debug] [ThreadPool]: Using postgres connection "list_postgres_public_pipedrive_analytics"
[0m16:34:05.142702 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres_public_pipedrive_analytics"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_pipedrive_analytics'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_pipedrive_analytics'
    union all
    select
      'postgres' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_pipedrive_analytics'
  
[0m16:34:05.147114 [debug] [ThreadPool]: SQL status: SELECT 13 in 0.004 seconds
[0m16:34:05.149153 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: ROLLBACK
[0m16:34:05.150873 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: Close
[0m16:34:05.151684 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_postgres_public_pipedrive_analytics, now list_postgres_public)
[0m16:34:05.156490 [debug] [ThreadPool]: Using postgres connection "list_postgres_public"
[0m16:34:05.156906 [debug] [ThreadPool]: On list_postgres_public: BEGIN
[0m16:34:05.157248 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:34:05.174845 [debug] [ThreadPool]: SQL status: BEGIN in 0.017 seconds
[0m16:34:05.175471 [debug] [ThreadPool]: Using postgres connection "list_postgres_public"
[0m16:34:05.175968 [debug] [ThreadPool]: On list_postgres_public: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m16:34:05.180956 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.005 seconds
[0m16:34:05.182605 [debug] [ThreadPool]: On list_postgres_public: ROLLBACK
[0m16:34:05.183917 [debug] [ThreadPool]: On list_postgres_public: Close
[0m16:34:05.192024 [debug] [MainThread]: Using postgres connection "master"
[0m16:34:05.192544 [debug] [MainThread]: On master: BEGIN
[0m16:34:05.193041 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:34:05.215535 [debug] [MainThread]: SQL status: BEGIN in 0.022 seconds
[0m16:34:05.216398 [debug] [MainThread]: Using postgres connection "master"
[0m16:34:05.216915 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:34:05.221953 [debug] [MainThread]: SQL status: SELECT 14 in 0.005 seconds
[0m16:34:05.226606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '934e2743-b6ee-47f6-82bd-41aad67eb993', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c1f3c80>]}
[0m16:34:05.227142 [debug] [MainThread]: On master: ROLLBACK
[0m16:34:05.228717 [debug] [MainThread]: Using postgres connection "master"
[0m16:34:05.229193 [debug] [MainThread]: On master: BEGIN
[0m16:34:05.231422 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m16:34:05.232095 [debug] [MainThread]: On master: COMMIT
[0m16:34:05.232486 [debug] [MainThread]: Using postgres connection "master"
[0m16:34:05.232841 [debug] [MainThread]: On master: COMMIT
[0m16:34:05.234444 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:34:05.234945 [debug] [MainThread]: On master: Close
[0m16:34:05.235533 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:34:05.236040 [info ] [MainThread]: 
[0m16:34:05.239201 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.base_pipedrive__fields
[0m16:34:05.240083 [info ] [Thread-1 (]: 1 of 13 START sql view model public_pipedrive_analytics.base_pipedrive__fields . [RUN]
[0m16:34:05.240648 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_postgres_public, now model.enpal_assessment_project.base_pipedrive__fields)
[0m16:34:05.241076 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.base_pipedrive__fields
[0m16:34:05.249445 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.base_pipedrive__fields"
[0m16:34:05.250528 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.base_pipedrive__fields
[0m16:34:05.292000 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.base_pipedrive__fields"
[0m16:34:05.292985 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m16:34:05.293417 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: BEGIN
[0m16:34:05.293885 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:05.310723 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:05.311439 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m16:34:05.311965 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */

  create view "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_tmp"
    
    
  as (
    -- Simple base model to connect to the source table
-- This table has JSON array values that need to be unpacked
-- Those unpacked values will be set up as reference nodes in the staging layer
SELECT *
FROM "postgres"."public"."fields"
  );
[0m16:34:05.314675 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m16:34:05.321603 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m16:34:05.322086 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */
alter table "postgres"."public_pipedrive_analytics"."base_pipedrive__fields" rename to "base_pipedrive__fields__dbt_backup"
[0m16:34:05.323735 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:05.327146 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m16:34:05.327628 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */
alter table "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_tmp" rename to "base_pipedrive__fields"
[0m16:34:05.329699 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:34:05.347998 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: COMMIT
[0m16:34:05.348537 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m16:34:05.348950 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: COMMIT
[0m16:34:05.351929 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:34:05.360914 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_backup"
[0m16:34:05.366539 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m16:34:05.367036 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */
drop view if exists "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_backup" cascade
[0m16:34:05.371255 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m16:34:05.374232 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: Close
[0m16:34:05.375951 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '934e2743-b6ee-47f6-82bd-41aad67eb993', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109deda60>]}
[0m16:34:05.376792 [info ] [Thread-1 (]: 1 of 13 OK created sql view model public_pipedrive_analytics.base_pipedrive__fields  [[32mCREATE VIEW[0m in 0.13s]
[0m16:34:05.377626 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.base_pipedrive__fields
[0m16:34:05.378244 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__activity
[0m16:34:05.378855 [info ] [Thread-1 (]: 2 of 13 START sql view model public_pipedrive_analytics.stg_pipedrive__activity  [RUN]
[0m16:34:05.379399 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.base_pipedrive__fields, now model.enpal_assessment_project.stg_pipedrive__activity)
[0m16:34:05.379829 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__activity
[0m16:34:05.383059 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__activity"
[0m16:34:05.384467 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__activity
[0m16:34:05.388128 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__activity"
[0m16:34:05.389180 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m16:34:05.389757 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: BEGIN
[0m16:34:05.390198 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:05.410143 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m16:34:05.411083 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m16:34:05.411591 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_tmp"
    
    
  as (
    -- Type is a reserved keyword. Renaming.
-- Rename others for consistency with other models
    -- model.id, model.reference_model_id
    -- bools are prefixed with is_ or has_
    -- convert date strings to timestamps and rename
-- add calculated month fields that will be used downstream

-- Potential problem? Activity ids are not unique on their own.
    -- Combinations repeating activity id with all other columns
    -- Not useful to create a composite unique check
    -- Does not seem to affect the overall task because the relationship to deal_id is more important

WITH base_activity AS (
    SELECT
        activity_id AS id,
        type AS activity_type,
        assigned_to_user AS user_id,
        deal_id,
        done AS is_done,
        due_to::TIMESTAMP AS due_time
    FROM "postgres"."public"."activity"
)
SELECT 
    id,
    activity_type,
    user_id,
    deal_id,
    is_done,
    due_time,
    
    EXTRACT(MONTH FROM due_time) AS month_number,
    TO_CHAR(due_time, 'Month') AS month_name

FROM base_activity
  );
[0m16:34:05.414456 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m16:34:05.417966 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m16:34:05.418426 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity" rename to "stg_pipedrive__activity__dbt_backup"
[0m16:34:05.420211 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:05.423382 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m16:34:05.423839 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_tmp" rename to "stg_pipedrive__activity"
[0m16:34:05.425445 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:05.427212 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: COMMIT
[0m16:34:05.427671 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m16:34:05.428091 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: COMMIT
[0m16:34:05.430083 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m16:34:05.432698 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_backup"
[0m16:34:05.433356 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m16:34:05.433778 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_backup" cascade
[0m16:34:05.436711 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m16:34:05.438335 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: Close
[0m16:34:05.438957 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '934e2743-b6ee-47f6-82bd-41aad67eb993', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c62aed0>]}
[0m16:34:05.439699 [info ] [Thread-1 (]: 2 of 13 OK created sql view model public_pipedrive_analytics.stg_pipedrive__activity  [[32mCREATE VIEW[0m in 0.06s]
[0m16:34:05.440455 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__activity
[0m16:34:05.440983 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m16:34:05.441722 [info ] [Thread-1 (]: 3 of 13 START sql view model public_pipedrive_analytics.stg_pipedrive__activity_types  [RUN]
[0m16:34:05.442308 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__activity, now model.enpal_assessment_project.stg_pipedrive__activity_types)
[0m16:34:05.442753 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m16:34:05.445587 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m16:34:05.446359 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m16:34:05.451437 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m16:34:05.452418 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m16:34:05.452960 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: BEGIN
[0m16:34:05.453383 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:05.471096 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m16:34:05.471804 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m16:34:05.472281 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_tmp"
    
    
  as (
    -- Type and Name are reserved keywords. Renaming.
-- The `active` column is a string with just two possible value. It makes more sense as a bool
SELECT
    id,
    name AS activity_name,
    CASE
        WHEN active = 'Yes' THEN TRUE
        ELSE FALSE
    END AS is_active,
    type AS activity_type
FROM "postgres"."public"."activity_types"
  );
[0m16:34:05.475120 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m16:34:05.478659 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m16:34:05.479124 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types" rename to "stg_pipedrive__activity_types__dbt_backup"
[0m16:34:05.480712 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:05.483873 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m16:34:05.484342 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_tmp" rename to "stg_pipedrive__activity_types"
[0m16:34:05.485946 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:05.487553 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: COMMIT
[0m16:34:05.488015 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m16:34:05.488424 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: COMMIT
[0m16:34:05.490368 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m16:34:05.492940 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_backup"
[0m16:34:05.493668 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m16:34:05.494092 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_backup" cascade
[0m16:34:05.496551 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m16:34:05.498280 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: Close
[0m16:34:05.498905 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '934e2743-b6ee-47f6-82bd-41aad67eb993', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cb38770>]}
[0m16:34:05.499608 [info ] [Thread-1 (]: 3 of 13 OK created sql view model public_pipedrive_analytics.stg_pipedrive__activity_types  [[32mCREATE VIEW[0m in 0.06s]
[0m16:34:05.500345 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m16:34:05.500857 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m16:34:05.501522 [info ] [Thread-1 (]: 4 of 13 START sql view model public_pipedrive_analytics.stg_pipedrive__deal_changes  [RUN]
[0m16:34:05.502180 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__activity_types, now model.enpal_assessment_project.stg_pipedrive__deal_changes)
[0m16:34:05.502617 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m16:34:05.505558 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m16:34:05.506309 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m16:34:05.509761 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m16:34:05.510622 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m16:34:05.511100 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: BEGIN
[0m16:34:05.511484 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:05.531852 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m16:34:05.532411 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m16:34:05.532932 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_tmp"
    
    
  as (
    -- This is not a source deals table, and deal_id is not a PK (UNIQUE)
    -- leave deal_id named as is to be consistent with naming convention model.reference_model_id
    -- convert date strings to timestamps and rename
-- add calculated month fields that will be used downstream
WITH base_deal_changes AS (
    SELECT
        deal_id,
        change_time::TIMESTAMP AS change_time,
        changed_field_key,
        new_value
    FROM "postgres"."public"."deal_changes"
)
SELECT
    deal_id,
    changed_field_key,
    new_value,
    change_time,
    
    EXTRACT(MONTH FROM change_time) AS month_number,
    TO_CHAR(change_time, 'Month') AS month_name

FROM base_deal_changes
  );
[0m16:34:05.535831 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m16:34:05.539243 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m16:34:05.539683 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes" rename to "stg_pipedrive__deal_changes__dbt_backup"
[0m16:34:05.541364 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:05.544438 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m16:34:05.544880 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_tmp" rename to "stg_pipedrive__deal_changes"
[0m16:34:05.546465 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:05.548084 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: COMMIT
[0m16:34:05.548517 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m16:34:05.548918 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: COMMIT
[0m16:34:05.551030 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:34:05.553607 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_backup"
[0m16:34:05.554239 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m16:34:05.554659 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_backup" cascade
[0m16:34:05.557373 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m16:34:05.558981 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: Close
[0m16:34:05.559565 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '934e2743-b6ee-47f6-82bd-41aad67eb993', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cb35820>]}
[0m16:34:05.560367 [info ] [Thread-1 (]: 4 of 13 OK created sql view model public_pipedrive_analytics.stg_pipedrive__deal_changes  [[32mCREATE VIEW[0m in 0.06s]
[0m16:34:05.561359 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m16:34:05.561997 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__stages
[0m16:34:05.563008 [info ] [Thread-1 (]: 5 of 13 START sql view model public_pipedrive_analytics.stg_pipedrive__stages .. [RUN]
[0m16:34:05.563633 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__deal_changes, now model.enpal_assessment_project.stg_pipedrive__stages)
[0m16:34:05.564481 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__stages
[0m16:34:05.569011 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__stages"
[0m16:34:05.569935 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__stages
[0m16:34:05.573332 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__stages"
[0m16:34:05.574097 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m16:34:05.574508 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: BEGIN
[0m16:34:05.574899 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:05.591587 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:05.592158 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m16:34:05.592639 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_tmp"
    
    
  as (
    /* NOT USED UPSTREAM. 
    The values in this table also found in the JSON array of base_pipedrive__fields.
    I would rather standardise the way stages and lost_reasons are handled.
    My assumption is that base_pipedrive__fields holds the current values configured in the Pipedrive application,
    and if this were to be updated by a sysadmin, the static version of the stages table would not reflect the changes.
NOT USED UPSTREAM. */

-- Rename stage_id to id for consistency: model.id, model.reference_model_id
SELECT
    stage_id AS id,
    stage_name
FROM "postgres"."public"."stages"
  );
[0m16:34:05.595160 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m16:34:05.602431 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m16:34:05.603109 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages" rename to "stg_pipedrive__stages__dbt_backup"
[0m16:34:05.604906 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:05.608086 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m16:34:05.608536 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_tmp" rename to "stg_pipedrive__stages"
[0m16:34:05.610147 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:05.611759 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: COMMIT
[0m16:34:05.612189 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m16:34:05.612589 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: COMMIT
[0m16:34:05.614622 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:34:05.617373 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_backup"
[0m16:34:05.618273 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m16:34:05.618702 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_backup" cascade
[0m16:34:05.621145 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m16:34:05.622760 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: Close
[0m16:34:05.623341 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '934e2743-b6ee-47f6-82bd-41aad67eb993', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cb4dd30>]}
[0m16:34:05.624027 [info ] [Thread-1 (]: 5 of 13 OK created sql view model public_pipedrive_analytics.stg_pipedrive__stages  [[32mCREATE VIEW[0m in 0.06s]
[0m16:34:05.624811 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__stages
[0m16:34:05.625334 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__users
[0m16:34:05.626012 [info ] [Thread-1 (]: 6 of 13 START sql view model public_pipedrive_analytics.stg_pipedrive__users ... [RUN]
[0m16:34:05.626586 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__stages, now model.enpal_assessment_project.stg_pipedrive__users)
[0m16:34:05.627015 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__users
[0m16:34:05.630114 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__users"
[0m16:34:05.630905 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__users
[0m16:34:05.635179 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__users"
[0m16:34:05.636102 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m16:34:05.636525 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: BEGIN
[0m16:34:05.637110 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:05.655779 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m16:34:05.656398 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m16:34:05.656935 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_tmp"
    
    
  as (
    /* NOT USED UPSTREAM. 
    The requested report does not call for user information, so this model is not used anywhere upstream.
	This model is created for completeness of the investigative aspects of the task.
NOT USED UPSTREAM. */

-- Name is a reserved keyword. Renaming.
-- Convert date strings to timestamps and rename
-- Add calculated month fields that will be used downstream
WITH base_users AS (
    SELECT
        id,
        name AS user_name,
        email AS user_email,
        modified::TIMESTAMP AS modified_time
    FROM "postgres"."public"."users"
)
SELECT
    id,
    user_name,
    user_email,
    modified_time,
    
    EXTRACT(MONTH FROM modified_time) AS month_number,
    TO_CHAR(modified_time, 'Month') AS month_name

FROM base_users
  );
[0m16:34:05.659639 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m16:34:05.663250 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m16:34:05.663729 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__users" rename to "stg_pipedrive__users__dbt_backup"
[0m16:34:05.665443 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:05.669125 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m16:34:05.669607 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_tmp" rename to "stg_pipedrive__users"
[0m16:34:05.671272 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:05.672936 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: COMMIT
[0m16:34:05.673403 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m16:34:05.673842 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: COMMIT
[0m16:34:05.675861 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m16:34:05.678610 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_backup"
[0m16:34:05.679264 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m16:34:05.679683 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_backup" cascade
[0m16:34:05.682175 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m16:34:05.683772 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: Close
[0m16:34:05.684362 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '934e2743-b6ee-47f6-82bd-41aad67eb993', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9fa4b0>]}
[0m16:34:05.685132 [info ] [Thread-1 (]: 6 of 13 OK created sql view model public_pipedrive_analytics.stg_pipedrive__users  [[32mCREATE VIEW[0m in 0.06s]
[0m16:34:05.685998 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__users
[0m16:34:05.686545 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m16:34:05.687217 [info ] [Thread-1 (]: 7 of 13 START sql view model public_pipedrive_analytics.stg_pipedrive__fields_lost_reasons  [RUN]
[0m16:34:05.687784 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__users, now model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons)
[0m16:34:05.688214 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m16:34:05.691046 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m16:34:05.691852 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m16:34:05.695161 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m16:34:05.695934 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m16:34:05.696356 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: BEGIN
[0m16:34:05.696749 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:05.714039 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:05.714696 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m16:34:05.715248 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_tmp"
    
    
  as (
    -- `base_pipedrive__fields` model has the values buried in a JSON array.
-- Make sure ids are INTEGER and not numeric-looking STRING 
	-- it is better to convert here even though CASTING is also required in the referential test.
	-- because in the real world, collaborators would be confused to see numeric-looking values as STRINGs.
WITH expand_array AS (
	SELECT 
		jsonb_array_elements(field_value_options) AS field_value_options
	FROM "postgres"."public_pipedrive_analytics"."base_pipedrive__fields"
	WHERE field_key = 'lost_reason'
)
SELECT
	CAST(field_value_options ->> 'id' AS INTEGER) AS id,
	field_value_options ->> 'label' AS label
FROM expand_array
  );
[0m16:34:05.719856 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m16:34:05.723140 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m16:34:05.723689 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_tmp" rename to "stg_pipedrive__fields_lost_reasons"
[0m16:34:05.725678 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:05.727250 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: COMMIT
[0m16:34:05.727692 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m16:34:05.728096 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: COMMIT
[0m16:34:05.729924 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m16:34:05.732605 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_backup"
[0m16:34:05.733645 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m16:34:05.734323 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_backup" cascade
[0m16:34:05.736012 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m16:34:05.737698 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: Close
[0m16:34:05.738306 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '934e2743-b6ee-47f6-82bd-41aad67eb993', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cb84080>]}
[0m16:34:05.739063 [info ] [Thread-1 (]: 7 of 13 OK created sql view model public_pipedrive_analytics.stg_pipedrive__fields_lost_reasons  [[32mCREATE VIEW[0m in 0.05s]
[0m16:34:05.739816 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m16:34:05.740339 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m16:34:05.741013 [info ] [Thread-1 (]: 8 of 13 START sql view model public_pipedrive_analytics.stg_pipedrive__fields_stages  [RUN]
[0m16:34:05.741709 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons, now model.enpal_assessment_project.stg_pipedrive__fields_stages)
[0m16:34:05.742157 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m16:34:05.746494 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m16:34:05.747331 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m16:34:05.806124 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m16:34:05.807262 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m16:34:05.807841 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: BEGIN
[0m16:34:05.808374 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:05.827180 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m16:34:05.827951 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m16:34:05.828460 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_stages"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_tmp"
    
    
  as (
    -- `base_pipedrive__fields` model has the values buried in a JSON array.
-- Make sure ids are INTEGER and not numeric-looking STRING 
	-- it is better to convert here even though CASTING is also required in the referential test.
	-- because in the real world, collaborators would be confused to see numeric-looking values as STRINGs.
WITH expand_array AS (
	SELECT 
		jsonb_array_elements(field_value_options) AS field_value_options
	FROM "postgres"."public_pipedrive_analytics"."base_pipedrive__fields"
	WHERE field_key = 'stage_id'
)
SELECT
	CAST(field_value_options ->> 'id' AS INTEGER) AS id,
	field_value_options ->> 'label' AS label
FROM expand_array
  );
[0m16:34:05.831744 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m16:34:05.835056 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m16:34:05.835546 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_stages"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_tmp" rename to "stg_pipedrive__fields_stages"
[0m16:34:05.837172 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:05.838779 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: COMMIT
[0m16:34:05.839268 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m16:34:05.839688 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: COMMIT
[0m16:34:05.841897 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:34:05.844459 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_backup"
[0m16:34:05.845252 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m16:34:05.845823 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_stages"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_backup" cascade
[0m16:34:05.847409 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m16:34:05.849222 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: Close
[0m16:34:05.849863 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '934e2743-b6ee-47f6-82bd-41aad67eb993', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cb86450>]}
[0m16:34:05.850721 [info ] [Thread-1 (]: 8 of 13 OK created sql view model public_pipedrive_analytics.stg_pipedrive__fields_stages  [[32mCREATE VIEW[0m in 0.11s]
[0m16:34:05.851592 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m16:34:05.852237 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_activity_join_activity_type
[0m16:34:05.853136 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__fields_stages, now model.enpal_assessment_project.int_activity_join_activity_type)
[0m16:34:05.853703 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_activity_join_activity_type
[0m16:34:05.857222 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_activity_join_activity_type"
[0m16:34:05.858418 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_activity_join_activity_type
[0m16:34:05.858934 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m16:34:05.859481 [info ] [Thread-1 (]: 9 of 13 START sql view model public_pipedrive_analytics.int_deal_changes_dedupe_new_deal  [RUN]
[0m16:34:05.860146 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_activity_join_activity_type, now model.enpal_assessment_project.int_deal_changes_dedupe_new_deal)
[0m16:34:05.860611 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m16:34:05.864202 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m16:34:05.865202 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m16:34:05.869392 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m16:34:05.870507 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m16:34:05.871129 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: BEGIN
[0m16:34:05.871726 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:05.890822 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m16:34:05.891647 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m16:34:05.892248 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"} */

  create view "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_tmp"
    
    
  as (
    -- This intermediate model does the following:
	-- Separates new deals from the deal_changes model
	-- Deduplicates a handful of dupe deals in the deal_changes model
	  -- Assumption: deals should not have more than one added date
	  -- Assumption: the latest added date is the one that should be presented to the model
	  -- Method: simple MAX

-- materialized view to apply built-in test unique values after dedupe


SELECT
	deal_id, 
	MAX(change_time) AS created_time
FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
WHERE changed_field_key = 'add_time'
GROUP BY
	deal_id
  );
[0m16:34:05.896685 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m16:34:05.900513 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m16:34:05.901010 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"} */
alter table "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_tmp" rename to "int_deal_changes_dedupe_new_deal"
[0m16:34:05.902973 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:05.904695 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: COMMIT
[0m16:34:05.905169 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m16:34:05.905586 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: COMMIT
[0m16:34:05.907787 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:34:05.910530 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_backup"
[0m16:34:05.911257 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m16:34:05.911736 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"} */
drop view if exists "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_backup" cascade
[0m16:34:05.914574 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m16:34:05.916312 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: Close
[0m16:34:05.917035 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '934e2743-b6ee-47f6-82bd-41aad67eb993', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c324680>]}
[0m16:34:05.917920 [info ] [Thread-1 (]: 9 of 13 OK created sql view model public_pipedrive_analytics.int_deal_changes_dedupe_new_deal  [[32mCREATE VIEW[0m in 0.06s]
[0m16:34:05.918743 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m16:34:05.919264 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_user
[0m16:34:05.920045 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_dedupe_new_deal, now model.enpal_assessment_project.int_deal_changes_user)
[0m16:34:05.920509 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_user
[0m16:34:05.923327 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_user"
[0m16:34:05.924401 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_user
[0m16:34:05.924887 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m16:34:05.925407 [info ] [Thread-1 (]: 10 of 13 START sql view model public_pipedrive_analytics.int_deal_changes_dedupe_lost_reason  [RUN]
[0m16:34:05.925905 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_user, now model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason)
[0m16:34:05.926330 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m16:34:05.929682 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m16:34:05.930524 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m16:34:05.936180 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m16:34:05.937092 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m16:34:05.937556 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: BEGIN
[0m16:34:05.938090 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:05.955153 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:05.955798 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m16:34:05.956324 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"} */

  create view "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_tmp"
    
    
  as (
    -- This intermediate model does the following:
	-- Separates the lost reason from the deal_changes model
	-- Adds the friendly lost reason label to the deal_changes data.
	-- Deduplicates a handful of dupe deals in the deal_changes model
		-- Assumption: deals should not have more than one lost reason
		-- Assumption: the latest lost reason is the one that should be presented to the model
		-- Method: row_number in reverse order and then pick the first row. 
		-- This pattern is better when we don't know how many duplicate rows there could be, but the latest will always be row number 1.
		-- Can't just take MAX(new_value) as was done for new_deals, because that would pick the largest given lost reason id, which would be incorrect.

-- materialized view to apply built-in test unique values after dedupe


WITH deal_changes_lost_reason AS (
	SELECT
		ROW_NUMBER() OVER(PARTITION BY deal_id ORDER BY change_time DESC) AS reverse_order,
		deal_id,
		new_value AS lost_reason_id,
		change_time,
		month_name,
		month_number
	FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
	WHERE changed_field_key = 'lost_reason'
),
deal_changes_lost_reason_cast_id AS (
	SELECT
		deal_id,
		CAST(lost_reason_id AS INTEGER) AS lost_reason_id, -- do it here once rather than twice in the final select & join clauses
		change_time,
		month_name,
		month_number
	FROM deal_changes_lost_reason
	WHERE reverse_order = 1
)
SELECT
dcr.deal_id,
dcr.lost_reason_id,
lost_reasons.label,
dcr.change_time,
dcr.month_name,
dcr.month_number
FROM deal_changes_lost_reason_cast_id dcr
INNER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons" lost_reasons
ON dcr.lost_reason_id = lost_reasons.id
  );
[0m16:34:05.960173 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m16:34:05.963341 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m16:34:05.963874 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"} */
alter table "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_tmp" rename to "int_deal_changes_dedupe_lost_reason"
[0m16:34:05.965829 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:05.968280 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: COMMIT
[0m16:34:05.968793 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m16:34:05.969279 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: COMMIT
[0m16:34:05.971346 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m16:34:05.974110 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_backup"
[0m16:34:05.974827 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m16:34:05.975262 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"} */
drop view if exists "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_backup" cascade
[0m16:34:05.976807 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m16:34:05.978358 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: Close
[0m16:34:05.978938 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '934e2743-b6ee-47f6-82bd-41aad67eb993', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cb38320>]}
[0m16:34:05.979641 [info ] [Thread-1 (]: 10 of 13 OK created sql view model public_pipedrive_analytics.int_deal_changes_dedupe_lost_reason  [[32mCREATE VIEW[0m in 0.05s]
[0m16:34:05.980360 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m16:34:05.980857 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m16:34:05.981543 [info ] [Thread-1 (]: 11 of 13 START sql view model public_pipedrive_analytics.int_deal_changes_dedupe_stage  [RUN]
[0m16:34:05.982186 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason, now model.enpal_assessment_project.int_deal_changes_dedupe_stage)
[0m16:34:05.982645 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m16:34:05.986014 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m16:34:05.986791 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m16:34:05.990424 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m16:34:05.991207 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m16:34:05.991653 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: BEGIN
[0m16:34:05.992052 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:06.009946 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m16:34:06.010637 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m16:34:06.011169 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_stage"} */

  create view "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_tmp"
    
    
  as (
    -- This intermediate model does the following:
	-- Separates the stages from the deal_changes model
	-- Adds the friendly stages label to the deal_changes data.
	-- Deduplicates a handful of dupe deals in the deal_changes model
		-- Assumption: deals should not arrive at the same stage more than once
			-- Note: it might be possible in the real world, but this rule was checked by looking at the deals that also had more than one add date, which definitely seems incorrect.
		-- Assumption: the latest lost reason is the one that should be presented to the model
		-- Method: row_number in reverse order and then pick the first row. 
		-- This pattern is better when we don't know how many duplicate rows there could be, but the latest will always be row number 1.
		-- Can't just take MAX(new_value) as was done for new_deals, because that would pick the largest given lost reason id, which would be incorrect.

-- materialized view to apply built-in test unique values after dedupe


WITH deal_changes_stage AS (
	SELECT
		ROW_NUMBER() OVER(PARTITION BY deal_id, new_value ORDER BY new_value, change_time DESC) AS reverse_order,
		deal_id,
		new_value AS stage_id,
		change_time,
		month_name,
		month_number
	FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
	WHERE changed_field_key = 'stage_id'
),
deal_changes_stage_cast_id AS (
	SELECT
		deal_id,
		CAST(stage_id AS INTEGER) AS stage_id, -- do it here once rather than twice in the final select & join clauses
		change_time,
		month_name,
		month_number
	FROM deal_changes_stage
	WHERE reverse_order = 1
)
SELECT
dcs.deal_id,
dcs.stage_id,
stages.label,
dcs.change_time,
dcs.month_name,
dcs.month_number
FROM deal_changes_stage_cast_id dcs
INNER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages" stages
ON dcs.stage_id = stages.id
  );
[0m16:34:06.015234 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m16:34:06.018618 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m16:34:06.019190 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_stage"} */
alter table "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_tmp" rename to "int_deal_changes_dedupe_stage"
[0m16:34:06.021050 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:06.022676 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: COMMIT
[0m16:34:06.023133 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m16:34:06.023552 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: COMMIT
[0m16:34:06.025389 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m16:34:06.027851 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_backup"
[0m16:34:06.028570 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m16:34:06.029041 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_stage"} */
drop view if exists "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_backup" cascade
[0m16:34:06.030480 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m16:34:06.032141 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: Close
[0m16:34:06.032790 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '934e2743-b6ee-47f6-82bd-41aad67eb993', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cb2d400>]}
[0m16:34:06.033709 [info ] [Thread-1 (]: 11 of 13 OK created sql view model public_pipedrive_analytics.int_deal_changes_dedupe_stage  [[32mCREATE VIEW[0m in 0.05s]
[0m16:34:06.034501 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m16:34:06.035077 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_activity
[0m16:34:06.035734 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_dedupe_stage, now model.enpal_assessment_project.int_deal_changes_activity)
[0m16:34:06.036200 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_activity
[0m16:34:06.042381 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_activity"
[0m16:34:06.043522 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_activity
[0m16:34:06.044365 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.mrt_deals_stages
[0m16:34:06.045033 [info ] [Thread-1 (]: 12 of 13 START sql table model public_pipedrive_analytics.mrt_deals_stages ..... [RUN]
[0m16:34:06.045695 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_activity, now model.enpal_assessment_project.mrt_deals_stages)
[0m16:34:06.046223 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.mrt_deals_stages
[0m16:34:06.056580 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.mrt_deals_stages"
[0m16:34:06.057392 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.mrt_deals_stages
[0m16:34:06.083767 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.mrt_deals_stages"
[0m16:34:06.084638 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m16:34:06.085055 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: BEGIN
[0m16:34:06.085526 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:06.101650 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:34:06.102259 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m16:34:06.102837 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */

  
    

  create  table "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_tmp"
  
  
    as
  
  (
    -- This mart model provides a breakdown by month of all deals and their stages, minor stages, and activities.
WITH  __dbt__cte__int_activity_join_activity_type as (
-- Simple intermediate model to join activity and activity_types
-- thus providing the friendly name of the activity type for downstream models
SELECT
	a.user_id,
	a.deal_id,
	t.activity_name,
	ms.stage_id,
	ms.minor_stage_id,
	t.is_active, -- this would be a mart level filter: business logic determines when to include deactivated activity types
	a.is_done, -- this would be a report level filter: analyst determines when to exclude incomplete activities
	a.due_time,
	a.month_name,
	a.month_number
FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity" a
INNER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types" t
	ON a.activity_type = t.activity_type
INNER JOIN "postgres"."public"."minor_stages" ms
	ON t.activity_type = ms.activity_type
),  __dbt__cte__int_deal_changes_activity as (
-- brings in the activity data for deals in the deal_changes table with the same deal_id
-- These will just be the ones with call activities against them

-- Note that there are very few rows compared to the total number of deals
    -- This is because there are very few matching deal ids in deal_changes and activity tables
    -- I have looked at whether this can be an out by N error on the ids but didn't find a fix
-- Potential problem? Why are there so many rows in the activity table with deal ids that don't exist in the deal_changes table?

SELECT
    nd.deal_id,
    act.activity_name,
    act.stage_id,
    act.minor_stage_id,
    act.is_active, -- this would be a mart level filter: business logic determines when to include deactivated activity types
    act.is_done, -- this would be a report level filter: analyst determines when to exclude incomplete activities
    act.month_number,
    act.month_name
FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal" nd
INNER JOIN __dbt__cte__int_activity_join_activity_type act -- result of INNER JOIN is very few rows. Is it a problem?
ON nd.deal_id = act.deal_id
), all_deal_changes_and_activity AS (
    SELECT
        deal_id,
        stage_id,
        minor_stage_id,
        is_done, -- this would be a report level filter: analyst determines when to exclude incomplete activities
        activity_name AS label,
        month_name,
        month_number
    FROM __dbt__cte__int_deal_changes_activity
    WHERE is_active = TRUE -- Mart level filter, most business users will ignore e.g. 'Follow Up Call' that is set to be inactive
    UNION ALL
    SELECT
        deal_id,
        stage_id,
        NULL AS minor_stage_id,
        NULL AS is_done,
        label,
        month_name,
        month_number
    FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage"
)
SELECT
    nd.deal_id,
    dca.stage_id,
    dca.minor_stage_id,
    dca.is_done,
    dca.label,
    dca.month_name,
    dca.month_number
FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal" nd -- Only deals from the deal_changes model (these have a created_time)
LEFT OUTER JOIN all_deal_changes_and_activity dca -- This will pick up the minor stages/activities where they exist for this set of deals
    ON nd.deal_id = dca.deal_id
  );
  
[0m16:34:06.146428 [debug] [Thread-1 (]: SQL status: SELECT 8895 in 0.043 seconds
[0m16:34:06.149711 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m16:34:06.150193 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */
alter table "postgres"."public_pipedrive_analytics"."mrt_deals_stages" rename to "mrt_deals_stages__dbt_backup"
[0m16:34:06.151787 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:06.156312 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m16:34:06.156806 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */
alter table "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_tmp" rename to "mrt_deals_stages"
[0m16:34:06.158323 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:06.163955 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: COMMIT
[0m16:34:06.164443 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m16:34:06.164852 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: COMMIT
[0m16:34:06.167769 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:34:06.170439 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_backup"
[0m16:34:06.173522 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m16:34:06.173976 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */
drop table if exists "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_backup" cascade
[0m16:34:06.177395 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.003 seconds
[0m16:34:06.179000 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: Close
[0m16:34:06.179586 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '934e2743-b6ee-47f6-82bd-41aad67eb993', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c4e33e0>]}
[0m16:34:06.180247 [info ] [Thread-1 (]: 12 of 13 OK created sql table model public_pipedrive_analytics.mrt_deals_stages  [[32mSELECT 8895[0m in 0.13s]
[0m16:34:06.181003 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.mrt_deals_stages
[0m16:34:06.181822 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m16:34:06.182613 [info ] [Thread-1 (]: 13 of 13 START sql view model public_pipedrive_analytics.rep_sales_funnel_monthly  [RUN]
[0m16:34:06.183204 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.mrt_deals_stages, now model.enpal_assessment_project.rep_sales_funnel_monthly)
[0m16:34:06.183646 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m16:34:06.186862 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m16:34:06.188290 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m16:34:06.192193 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m16:34:06.193033 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m16:34:06.193473 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: BEGIN
[0m16:34:06.193873 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:06.211176 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:06.211839 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m16:34:06.212367 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.rep_sales_funnel_monthly"} */

  create view "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_tmp"
    
    
  as (
    -- ASSUMPTIONS FOR THIS MODEL:
-- Show the number of deals in each stage of the sales funnel, for each month
	-- I am presenting a historical view, each deal stage at the time it happened
	-- (alternative would have been snapshot of final stages of each deal, that's not what I'm doing here)
    -- Although we have models for users, they are not needed/requested in this model
    -- Although we have models for lost deals
        -- we are showing the stage the deal was in at the time of the activity 
        -- whether or not it was closed in the end
        -- If it was not closed in the end, it just doesn't get counted in the Closing or later stages
        -- so it doesn't appear necessary to use the lost reasons model
	-- As noted in the intermediate model, we are excluding inactive activities
	-- As noted in the intermediate model, there are hardly any activities with deal_ids also in the deal_changes table
		-- this results in very entries for steps 2.1 and 3.1 (only two, in fact)

-- create the funnel steps as requested
WITH funnel_step_from_stages AS (
	SELECT
		deal_id,
		month_number,
		month_name,
		CONCAT(stage_id, 
			CASE
				WHEN minor_stage_id IS NULL THEN ''
				ELSE CONCAT('.', minor_stage_id)
			END
		) AS funnel_step,
		label AS kpi_name
	FROM "postgres"."public_pipedrive_analytics"."mrt_deals_stages" AS funnel
    WHERE COALESCE(is_done, TRUE) -- report level filter: exclude incomplete activities
),
-- aggregate CTE then order, to avoid having to keep the order columns in the view
monthly_agg AS (
	SELECT
		COUNT(deal_id) AS deals_count,
		month_number,
		month_name,
		funnel_step,
		kpi_name
	FROM funnel_step_from_stages
	GROUP BY
		month_number,
		month_name,
		funnel_step,
		kpi_name
)
-- final query with ordering
SELECT
	month_name AS month,
	kpi_name,
	funnel_step,
	deals_count
	FROM monthly_agg
ORDER BY month_number, funnel_step
  );
[0m16:34:06.216088 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m16:34:06.219335 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m16:34:06.219817 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.rep_sales_funnel_monthly"} */
alter table "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_tmp" rename to "rep_sales_funnel_monthly"
[0m16:34:06.222579 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:34:06.224140 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: COMMIT
[0m16:34:06.224608 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m16:34:06.225018 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: COMMIT
[0m16:34:06.227109 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:34:06.231739 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_backup"
[0m16:34:06.232465 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m16:34:06.232971 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.rep_sales_funnel_monthly"} */
drop view if exists "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_backup" cascade
[0m16:34:06.235541 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m16:34:06.237224 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: Close
[0m16:34:06.237843 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '934e2743-b6ee-47f6-82bd-41aad67eb993', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c3b18b0>]}
[0m16:34:06.238671 [info ] [Thread-1 (]: 13 of 13 OK created sql view model public_pipedrive_analytics.rep_sales_funnel_monthly  [[32mCREATE VIEW[0m in 0.05s]
[0m16:34:06.239472 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m16:34:06.240991 [debug] [MainThread]: Using postgres connection "master"
[0m16:34:06.241442 [debug] [MainThread]: On master: BEGIN
[0m16:34:06.241793 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:34:06.259742 [debug] [MainThread]: SQL status: BEGIN in 0.018 seconds
[0m16:34:06.260232 [debug] [MainThread]: On master: COMMIT
[0m16:34:06.260685 [debug] [MainThread]: Using postgres connection "master"
[0m16:34:06.261060 [debug] [MainThread]: On master: COMMIT
[0m16:34:06.263198 [debug] [MainThread]: SQL status: COMMIT in 0.002 seconds
[0m16:34:06.263656 [debug] [MainThread]: On master: Close
[0m16:34:06.264147 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:34:06.264554 [debug] [MainThread]: Connection 'model.enpal_assessment_project.rep_sales_funnel_monthly' was properly closed.
[0m16:34:06.265026 [info ] [MainThread]: 
[0m16:34:06.265435 [info ] [MainThread]: Finished running 12 view models, 1 table model in 0 hours 0 minutes and 1.30 seconds (1.30s).
[0m16:34:06.269189 [debug] [MainThread]: Command end result
[0m16:34:06.307030 [info ] [MainThread]: 
[0m16:34:06.307535 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:34:06.307940 [info ] [MainThread]: 
[0m16:34:06.308348 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 TOTAL=13
[0m16:34:06.310981 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.9082537, "process_in_blocks": "0", "process_kernel_time": 0.643181, "process_mem_max_rss": "115478528", "process_out_blocks": "0", "process_user_time": 3.901824}
[0m16:34:06.311905 [debug] [MainThread]: Command `dbt run` succeeded at 16:34:06.311725 after 2.91 seconds
[0m16:34:06.312424 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10785ad50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cb7cb30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cb7d970>]}
[0m16:34:06.312875 [debug] [MainThread]: Flushing usage events
[0m16:34:12.435610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109faf3b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a11b140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a11ac60>]}


============================== 16:34:12.441004 | 97b815fe-31bb-47b3-b5de-1e2b392ba51f ==============================
[0m16:34:12.441004 [info ] [MainThread]: Running with dbt=1.8.9
[0m16:34:12.441936 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/julian/Documents/hatvalues_repo/dbt_enpal_assessment/logs', 'profiles_dir': '/Users/julian/Documents/hatvalues_repo/dbt_enpal_assessment', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:34:12.676339 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '97b815fe-31bb-47b3-b5de-1e2b392ba51f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2064e0>]}
[0m16:34:12.741368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '97b815fe-31bb-47b3-b5de-1e2b392ba51f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fefb90>]}
[0m16:34:12.742359 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m16:34:12.873435 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m16:34:13.041299 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:34:13.041782 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:34:13.110768 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '97b815fe-31bb-47b3-b5de-1e2b392ba51f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6828a0>]}
[0m16:34:13.276928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '97b815fe-31bb-47b3-b5de-1e2b392ba51f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b1a8110>]}
[0m16:34:13.277696 [info ] [MainThread]: Found 16 models, 21 data tests, 1 seed, 6 sources, 430 macros
[0m16:34:13.278350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '97b815fe-31bb-47b3-b5de-1e2b392ba51f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a705190>]}
[0m16:34:13.282166 [info ] [MainThread]: 
[0m16:34:13.282949 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:34:13.288521 [debug] [ThreadPool]: Acquiring new postgres connection 'list_postgres_public'
[0m16:34:13.398448 [debug] [ThreadPool]: Using postgres connection "list_postgres_public"
[0m16:34:13.399032 [debug] [ThreadPool]: On list_postgres_public: BEGIN
[0m16:34:13.399390 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:34:13.432571 [debug] [ThreadPool]: SQL status: BEGIN in 0.033 seconds
[0m16:34:13.433362 [debug] [ThreadPool]: Using postgres connection "list_postgres_public"
[0m16:34:13.433912 [debug] [ThreadPool]: On list_postgres_public: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m16:34:13.439095 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.005 seconds
[0m16:34:13.440899 [debug] [ThreadPool]: On list_postgres_public: ROLLBACK
[0m16:34:13.442237 [debug] [ThreadPool]: On list_postgres_public: Close
[0m16:34:13.443135 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_postgres_public, now list_postgres_public_pipedrive_analytics)
[0m16:34:13.447108 [debug] [ThreadPool]: Using postgres connection "list_postgres_public_pipedrive_analytics"
[0m16:34:13.447542 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: BEGIN
[0m16:34:13.447893 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:34:13.463933 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m16:34:13.464775 [debug] [ThreadPool]: Using postgres connection "list_postgres_public_pipedrive_analytics"
[0m16:34:13.465188 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres_public_pipedrive_analytics"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_pipedrive_analytics'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_pipedrive_analytics'
    union all
    select
      'postgres' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_pipedrive_analytics'
  
[0m16:34:13.469179 [debug] [ThreadPool]: SQL status: SELECT 13 in 0.004 seconds
[0m16:34:13.471069 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: ROLLBACK
[0m16:34:13.472352 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: Close
[0m16:34:13.480580 [debug] [MainThread]: Using postgres connection "master"
[0m16:34:13.481048 [debug] [MainThread]: On master: BEGIN
[0m16:34:13.481396 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:34:13.497225 [debug] [MainThread]: SQL status: BEGIN in 0.016 seconds
[0m16:34:13.497897 [debug] [MainThread]: Using postgres connection "master"
[0m16:34:13.498385 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:34:13.503794 [debug] [MainThread]: SQL status: SELECT 14 in 0.005 seconds
[0m16:34:13.508529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '97b815fe-31bb-47b3-b5de-1e2b392ba51f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a680bc0>]}
[0m16:34:13.509078 [debug] [MainThread]: On master: ROLLBACK
[0m16:34:13.510678 [debug] [MainThread]: Using postgres connection "master"
[0m16:34:13.511122 [debug] [MainThread]: On master: BEGIN
[0m16:34:13.513173 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m16:34:13.513778 [debug] [MainThread]: On master: COMMIT
[0m16:34:13.514181 [debug] [MainThread]: Using postgres connection "master"
[0m16:34:13.514531 [debug] [MainThread]: On master: COMMIT
[0m16:34:13.515795 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:34:13.516246 [debug] [MainThread]: On master: Close
[0m16:34:13.516844 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:34:13.517508 [info ] [MainThread]: 
[0m16:34:13.521519 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m16:34:13.522236 [info ] [Thread-1 (]: 1 of 21 START test accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time  [RUN]
[0m16:34:13.523056 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_postgres_public_pipedrive_analytics, now test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0)
[0m16:34:13.523666 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m16:34:13.548360 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m16:34:13.550309 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m16:34:13.570817 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m16:34:13.571928 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m16:34:13.572387 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: BEGIN
[0m16:34:13.572837 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:13.588566 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:34:13.589319 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m16:34:13.589886 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        changed_field_key as value_field,
        count(*) as n_records

    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
    group by changed_field_key

)

select *
from all_values
where value_field not in (
    'user_id','stage_id','lost_reason','add_time'
)



      
    ) dbt_internal_test
[0m16:34:13.595759 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m16:34:13.600566 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: ROLLBACK
[0m16:34:13.602053 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: Close
[0m16:34:13.602953 [info ] [Thread-1 (]: 1 of 21 PASS accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time  [[32mPASS[0m in 0.08s]
[0m16:34:13.603868 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m16:34:13.604431 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m16:34:13.604965 [info ] [Thread-1 (]: 2 of 21 START test assert_change_stage_references_lost_reason_id ............... [RUN]
[0m16:34:13.605647 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0, now test.enpal_assessment_project.assert_change_stage_references_lost_reason_id)
[0m16:34:13.606115 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m16:34:13.610700 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m16:34:13.612310 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m16:34:13.614660 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m16:34:13.615857 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m16:34:13.616402 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: BEGIN
[0m16:34:13.616875 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:13.634238 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:13.634936 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m16:34:13.635402 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- new_value field is a STRING type but contains mixed values for other tables/models
-- The CTE will pre-filter the deal_changes to safely cast new_value to an integer for this test
WITH deal_change_reasons AS (
	
SELECT
    changed_field_key,
    new_value
FROM
    "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
WHERE
    changed_field_key = 'lost_reason'

)
SELECT *
FROM deal_change_reasons dcr
LEFT OUTER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons" reasons
ON CAST(dcr.new_value AS INTEGER) = reasons.id
WHERE reasons.id IS NULL -- Any non referential values in dcr will return a NULL reasons.id
      
    ) dbt_internal_test
[0m16:34:13.640586 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m16:34:13.642409 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: ROLLBACK
[0m16:34:13.643827 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: Close
[0m16:34:13.644584 [info ] [Thread-1 (]: 2 of 21 PASS assert_change_stage_references_lost_reason_id ..................... [[32mPASS[0m in 0.04s]
[0m16:34:13.645359 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m16:34:13.645897 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m16:34:13.646402 [info ] [Thread-1 (]: 3 of 21 START test assert_change_stage_references_stage_id ..................... [RUN]
[0m16:34:13.647032 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_change_stage_references_lost_reason_id, now test.enpal_assessment_project.assert_change_stage_references_stage_id)
[0m16:34:13.647525 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m16:34:13.651125 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m16:34:13.653448 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m16:34:13.655948 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m16:34:13.656773 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m16:34:13.657219 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: BEGIN
[0m16:34:13.657648 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:13.676858 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m16:34:13.677610 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m16:34:13.678562 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_change_stage_references_stage_id"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- new_value field is a STRING type but contains mixed values for other tables/models
-- The CTE will pre-filter the deal_changes to safely cast new_value to an integer for this test
WITH deal_change_stage AS (
	
SELECT
    changed_field_key,
    new_value
FROM
    "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
WHERE
    changed_field_key = 'stage_id'

)
SELECT *
FROM deal_change_stage dcs
LEFT OUTER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages" stages
ON CAST(dcs.new_value AS INTEGER) = stages.id
WHERE stages.id IS NULL -- Any non referential values in d will return a NULL s.id
      
    ) dbt_internal_test
[0m16:34:13.686086 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.007 seconds
[0m16:34:13.687812 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: ROLLBACK
[0m16:34:13.689281 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: Close
[0m16:34:13.690035 [info ] [Thread-1 (]: 3 of 21 PASS assert_change_stage_references_stage_id ........................... [[32mPASS[0m in 0.04s]
[0m16:34:13.690840 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m16:34:13.691384 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_change_user_references_user_id
[0m16:34:13.691879 [info ] [Thread-1 (]: 4 of 21 START test assert_change_user_references_user_id ....................... [RUN]
[0m16:34:13.692614 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_change_stage_references_stage_id, now test.enpal_assessment_project.assert_change_user_references_user_id)
[0m16:34:13.693163 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_change_user_references_user_id
[0m16:34:13.696515 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m16:34:13.697448 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_change_user_references_user_id
[0m16:34:13.701101 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m16:34:13.702065 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m16:34:13.702506 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: BEGIN
[0m16:34:13.702900 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:13.718578 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:34:13.719157 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m16:34:13.719645 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_change_user_references_user_id"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- CTE to pre-filter deal_changes for stage_id changes
-- to safely cast new_value to an integer when we're sure all the values can be implicitly casted
WITH deal_change_user AS (
	
SELECT
    changed_field_key,
    new_value
FROM
    "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
WHERE
    changed_field_key = 'user_id'

)
SELECT *
FROM deal_change_user d
LEFT OUTER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__users" u
ON CAST(d.new_value AS INTEGER) = u.id
WHERE u.id IS NULL -- Any non referential values in d will return a NULL s.id
      
    ) dbt_internal_test
[0m16:34:13.724936 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m16:34:13.726770 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: ROLLBACK
[0m16:34:13.729544 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: Close
[0m16:34:13.730372 [info ] [Thread-1 (]: 4 of 21 PASS assert_change_user_references_user_id ............................. [[32mPASS[0m in 0.04s]
[0m16:34:13.731226 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_change_user_references_user_id
[0m16:34:13.731802 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m16:34:13.732349 [info ] [Thread-1 (]: 5 of 21 START test assert_timestamp_equal_add_time_new_value ................... [RUN]
[0m16:34:13.733092 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_change_user_references_user_id, now test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value)
[0m16:34:13.733582 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m16:34:13.736585 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m16:34:13.737382 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m16:34:13.739563 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m16:34:13.740715 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m16:34:13.741153 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: BEGIN
[0m16:34:13.741591 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:13.757931 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:34:13.758845 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m16:34:13.759505 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- Proving that the new_value field for add_time changes is redundant. We can just use the change_time.
SELECT * FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
	WHERE changed_field_key = 'add_time'
	AND change_time != new_value::TIMESTAMP
      
    ) dbt_internal_test
[0m16:34:13.766766 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.007 seconds
[0m16:34:13.768708 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: ROLLBACK
[0m16:34:13.770144 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: Close
[0m16:34:13.770961 [info ] [Thread-1 (]: 5 of 21 PASS assert_timestamp_equal_add_time_new_value ......................... [[32mPASS[0m in 0.04s]
[0m16:34:13.771882 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m16:34:13.772426 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_unique_deal_stage
[0m16:34:13.772875 [info ] [Thread-1 (]: 6 of 21 START test assert_unique_deal_stage .................................... [RUN]
[0m16:34:13.773581 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value, now test.enpal_assessment_project.assert_unique_deal_stage)
[0m16:34:13.774059 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_unique_deal_stage
[0m16:34:13.779262 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_unique_deal_stage"
[0m16:34:13.780580 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_unique_deal_stage
[0m16:34:13.782833 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_unique_deal_stage"
[0m16:34:13.783580 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_unique_deal_stage"
[0m16:34:13.784007 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: BEGIN
[0m16:34:13.784401 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:13.800738 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:34:13.801354 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_unique_deal_stage"
[0m16:34:13.801887 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_unique_deal_stage"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- Assert that there are no duplicate deal-stage pairs in the deal changes table
SELECT
    COUNT(*),
    deal_id,
    stage_id
FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage"
GROUP BY
    deal_id,
    stage_id
HAVING COUNT(*) > 1
      
    ) dbt_internal_test
[0m16:34:13.824178 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.022 seconds
[0m16:34:13.826104 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: ROLLBACK
[0m16:34:13.827867 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: Close
[0m16:34:13.828717 [info ] [Thread-1 (]: 6 of 21 PASS assert_unique_deal_stage .......................................... [[32mPASS[0m in 0.06s]
[0m16:34:13.829530 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_unique_deal_stage
[0m16:34:13.830100 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m16:34:13.830623 [info ] [Thread-1 (]: 7 of 21 START test not_null_stg_pipedrive__activity_deal_id .................... [RUN]
[0m16:34:13.831360 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_unique_deal_stage, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e)
[0m16:34:13.831945 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m16:34:13.839175 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m16:34:13.840027 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m16:34:13.842353 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m16:34:13.843135 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m16:34:13.843595 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: BEGIN
[0m16:34:13.844008 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:13.862461 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m16:34:13.863245 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m16:34:13.863774 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select deal_id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where deal_id is null



      
    ) dbt_internal_test
[0m16:34:13.867502 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m16:34:13.869289 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: ROLLBACK
[0m16:34:13.870751 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: Close
[0m16:34:13.871589 [info ] [Thread-1 (]: 7 of 21 PASS not_null_stg_pipedrive__activity_deal_id .......................... [[32mPASS[0m in 0.04s]
[0m16:34:13.872581 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m16:34:13.873206 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m16:34:13.874187 [info ] [Thread-1 (]: 8 of 21 START test not_null_stg_pipedrive__activity_due_time ................... [RUN]
[0m16:34:13.875131 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191)
[0m16:34:13.875632 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m16:34:13.883040 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m16:34:13.883956 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m16:34:13.886292 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m16:34:13.887090 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m16:34:13.887522 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: BEGIN
[0m16:34:13.887993 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:13.906467 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m16:34:13.907265 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m16:34:13.907803 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select due_time
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where due_time is null



      
    ) dbt_internal_test
[0m16:34:13.910459 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m16:34:13.912660 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: ROLLBACK
[0m16:34:13.914641 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: Close
[0m16:34:13.915511 [info ] [Thread-1 (]: 8 of 21 PASS not_null_stg_pipedrive__activity_due_time ......................... [[32mPASS[0m in 0.04s]
[0m16:34:13.916277 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m16:34:13.916831 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m16:34:13.917325 [info ] [Thread-1 (]: 9 of 21 START test not_null_stg_pipedrive__activity_id ......................... [RUN]
[0m16:34:13.917968 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb)
[0m16:34:13.918442 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m16:34:13.922644 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m16:34:13.923548 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m16:34:13.926539 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m16:34:13.927991 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m16:34:13.928467 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: BEGIN
[0m16:34:13.928867 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:13.946500 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:13.947290 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m16:34:13.947868 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where id is null



      
    ) dbt_internal_test
[0m16:34:13.950596 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m16:34:13.952317 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: ROLLBACK
[0m16:34:13.953788 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: Close
[0m16:34:13.954534 [info ] [Thread-1 (]: 9 of 21 PASS not_null_stg_pipedrive__activity_id ............................... [[32mPASS[0m in 0.04s]
[0m16:34:13.955339 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m16:34:13.955874 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m16:34:13.956325 [info ] [Thread-1 (]: 10 of 21 START test not_null_stg_pipedrive__activity_is_done ................... [RUN]
[0m16:34:13.957026 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543)
[0m16:34:13.957490 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m16:34:13.961653 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m16:34:13.962485 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m16:34:13.964866 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m16:34:13.965680 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m16:34:13.966120 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: BEGIN
[0m16:34:13.966517 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:13.983886 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:13.984730 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m16:34:13.985224 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select is_done
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where is_done is null



      
    ) dbt_internal_test
[0m16:34:13.987944 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m16:34:13.989720 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: ROLLBACK
[0m16:34:13.991080 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: Close
[0m16:34:13.991804 [info ] [Thread-1 (]: 10 of 21 PASS not_null_stg_pipedrive__activity_is_done ......................... [[32mPASS[0m in 0.03s]
[0m16:34:13.992619 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m16:34:13.993251 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m16:34:13.993794 [info ] [Thread-1 (]: 11 of 21 START test not_null_stg_pipedrive__deal_changes_change_time ........... [RUN]
[0m16:34:13.994370 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543, now test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d)
[0m16:34:13.994840 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m16:34:13.998876 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m16:34:14.000325 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m16:34:14.003867 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m16:34:14.004985 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m16:34:14.005493 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: BEGIN
[0m16:34:14.006112 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:14.023944 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m16:34:14.024687 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m16:34:14.025202 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select change_time
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
where change_time is null



      
    ) dbt_internal_test
[0m16:34:14.028630 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m16:34:14.030391 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: ROLLBACK
[0m16:34:14.032016 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: Close
[0m16:34:14.032802 [info ] [Thread-1 (]: 11 of 21 PASS not_null_stg_pipedrive__deal_changes_change_time ................. [[32mPASS[0m in 0.04s]
[0m16:34:14.033639 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m16:34:14.034163 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m16:34:14.034664 [info ] [Thread-1 (]: 12 of 21 START test not_null_stg_pipedrive__deal_changes_deal_id ............... [RUN]
[0m16:34:14.035316 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d, now test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d)
[0m16:34:14.035856 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m16:34:14.041697 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m16:34:14.043017 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m16:34:14.045509 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m16:34:14.046363 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m16:34:14.046805 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: BEGIN
[0m16:34:14.047205 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:14.063823 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:14.064684 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m16:34:14.065178 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select deal_id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
where deal_id is null



      
    ) dbt_internal_test
[0m16:34:14.068248 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m16:34:14.070063 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: ROLLBACK
[0m16:34:14.071427 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: Close
[0m16:34:14.072155 [info ] [Thread-1 (]: 12 of 21 PASS not_null_stg_pipedrive__deal_changes_deal_id ..................... [[32mPASS[0m in 0.04s]
[0m16:34:14.072890 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m16:34:14.073412 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m16:34:14.073913 [info ] [Thread-1 (]: 13 of 21 START test not_null_stg_pipedrive__deal_changes_new_value ............. [RUN]
[0m16:34:14.074570 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d, now test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96)
[0m16:34:14.075065 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m16:34:14.079581 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m16:34:14.080409 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m16:34:14.082692 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m16:34:14.083457 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m16:34:14.083894 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: BEGIN
[0m16:34:14.084296 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:14.100992 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:14.101663 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m16:34:14.102136 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select new_value
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
where new_value is null



      
    ) dbt_internal_test
[0m16:34:14.105678 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m16:34:14.107401 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: ROLLBACK
[0m16:34:14.108788 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: Close
[0m16:34:14.109546 [info ] [Thread-1 (]: 13 of 21 PASS not_null_stg_pipedrive__deal_changes_new_value ................... [[32mPASS[0m in 0.03s]
[0m16:34:14.110506 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m16:34:14.111148 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m16:34:14.111737 [info ] [Thread-1 (]: 14 of 21 START test not_null_stg_pipedrive__users_id ........................... [RUN]
[0m16:34:14.112356 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96, now test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817)
[0m16:34:14.112806 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m16:34:14.116937 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m16:34:14.118208 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m16:34:14.120511 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m16:34:14.121386 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m16:34:14.121842 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: BEGIN
[0m16:34:14.122247 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:14.139706 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:14.140348 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m16:34:14.140893 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where id is null



      
    ) dbt_internal_test
[0m16:34:14.143429 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m16:34:14.145307 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: ROLLBACK
[0m16:34:14.146767 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: Close
[0m16:34:14.147528 [info ] [Thread-1 (]: 14 of 21 PASS not_null_stg_pipedrive__users_id ................................. [[32mPASS[0m in 0.04s]
[0m16:34:14.148274 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m16:34:14.148792 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m16:34:14.149282 [info ] [Thread-1 (]: 15 of 21 START test not_null_stg_pipedrive__users_modified_time ................ [RUN]
[0m16:34:14.149912 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817, now test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5)
[0m16:34:14.150370 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m16:34:14.154636 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m16:34:14.155655 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m16:34:14.158345 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m16:34:14.159268 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m16:34:14.159797 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: BEGIN
[0m16:34:14.160208 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:14.177562 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:14.178278 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m16:34:14.178826 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select modified_time
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where modified_time is null



      
    ) dbt_internal_test
[0m16:34:14.181499 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m16:34:14.183251 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: ROLLBACK
[0m16:34:14.184730 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: Close
[0m16:34:14.185462 [info ] [Thread-1 (]: 15 of 21 PASS not_null_stg_pipedrive__users_modified_time ...................... [[32mPASS[0m in 0.04s]
[0m16:34:14.186198 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m16:34:14.186719 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m16:34:14.187325 [info ] [Thread-1 (]: 16 of 21 START test not_null_stg_pipedrive__users_user_email ................... [RUN]
[0m16:34:14.188009 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5, now test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157)
[0m16:34:14.188515 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m16:34:14.193021 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m16:34:14.194318 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m16:34:14.196669 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m16:34:14.198178 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m16:34:14.198728 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: BEGIN
[0m16:34:14.199223 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:14.216365 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:14.217099 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m16:34:14.217598 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select user_email
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where user_email is null



      
    ) dbt_internal_test
[0m16:34:14.220154 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m16:34:14.221849 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: ROLLBACK
[0m16:34:14.223222 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: Close
[0m16:34:14.223963 [info ] [Thread-1 (]: 16 of 21 PASS not_null_stg_pipedrive__users_user_email ......................... [[32mPASS[0m in 0.04s]
[0m16:34:14.224849 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m16:34:14.225370 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m16:34:14.225904 [info ] [Thread-1 (]: 17 of 21 START test not_null_stg_pipedrive__users_user_name .................... [RUN]
[0m16:34:14.226837 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157, now test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5)
[0m16:34:14.227314 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m16:34:14.231805 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m16:34:14.232638 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m16:34:14.235439 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m16:34:14.236298 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m16:34:14.236756 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: BEGIN
[0m16:34:14.237169 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:14.253768 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:14.254528 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m16:34:14.255033 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select user_name
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where user_name is null



      
    ) dbt_internal_test
[0m16:34:14.257670 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m16:34:14.259605 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: ROLLBACK
[0m16:34:14.261156 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: Close
[0m16:34:14.261891 [info ] [Thread-1 (]: 17 of 21 PASS not_null_stg_pipedrive__users_user_name .......................... [[32mPASS[0m in 0.04s]
[0m16:34:14.262720 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m16:34:14.263259 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m16:34:14.263772 [info ] [Thread-1 (]: 18 of 21 START test relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_  [RUN]
[0m16:34:14.264439 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5, now test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8)
[0m16:34:14.264942 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m16:34:14.275694 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m16:34:14.276547 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m16:34:14.279012 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m16:34:14.280366 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m16:34:14.280843 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: BEGIN
[0m16:34:14.281256 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:14.307809 [debug] [Thread-1 (]: SQL status: BEGIN in 0.026 seconds
[0m16:34:14.308595 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m16:34:14.309131 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select activity_type as from_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
    where activity_type is not null
),

parent as (
    select activity_type as to_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m16:34:14.314238 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m16:34:14.316107 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: ROLLBACK
[0m16:34:14.317766 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: Close
[0m16:34:14.318811 [info ] [Thread-1 (]: 18 of 21 PASS relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_  [[32mPASS[0m in 0.05s]
[0m16:34:14.319916 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m16:34:14.320493 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m16:34:14.321123 [info ] [Thread-1 (]: 19 of 21 START test relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_  [RUN]
[0m16:34:14.321774 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8, now test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d)
[0m16:34:14.322247 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m16:34:14.328524 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m16:34:14.329541 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m16:34:14.331840 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m16:34:14.332669 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m16:34:14.333112 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: BEGIN
[0m16:34:14.333517 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:14.351945 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m16:34:14.352791 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m16:34:14.353313 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select user_id as from_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
    where user_id is not null
),

parent as (
    select id as to_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m16:34:14.357874 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.004 seconds
[0m16:34:14.359783 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: ROLLBACK
[0m16:34:14.361247 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: Close
[0m16:34:14.361991 [info ] [Thread-1 (]: 19 of 21 PASS relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_  [[32mPASS[0m in 0.04s]
[0m16:34:14.362821 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m16:34:14.363339 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m16:34:14.363786 [info ] [Thread-1 (]: 20 of 21 START test unique_int_deal_changes_dedupe_lost_reason_deal_id ......... [RUN]
[0m16:34:14.364483 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d, now test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907)
[0m16:34:14.365001 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m16:34:14.372306 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m16:34:14.373668 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m16:34:14.376007 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m16:34:14.376788 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m16:34:14.377234 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: BEGIN
[0m16:34:14.377836 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:14.394278 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:34:14.394921 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m16:34:14.395474 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    deal_id as unique_field,
    count(*) as n_records

from "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason"
where deal_id is not null
group by deal_id
having count(*) > 1



      
    ) dbt_internal_test
[0m16:34:14.403683 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.008 seconds
[0m16:34:14.405399 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: ROLLBACK
[0m16:34:14.406804 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: Close
[0m16:34:14.407546 [info ] [Thread-1 (]: 20 of 21 PASS unique_int_deal_changes_dedupe_lost_reason_deal_id ............... [[32mPASS[0m in 0.04s]
[0m16:34:14.408292 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m16:34:14.408806 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m16:34:14.409309 [info ] [Thread-1 (]: 21 of 21 START test unique_int_deal_changes_dedupe_new_deal_deal_id ............ [RUN]
[0m16:34:14.409954 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907, now test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc)
[0m16:34:14.410471 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m16:34:14.414684 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m16:34:14.415526 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m16:34:14.417770 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m16:34:14.418555 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m16:34:14.418988 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: BEGIN
[0m16:34:14.419388 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:14.436038 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:14.436730 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m16:34:14.437213 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    deal_id as unique_field,
    count(*) as n_records

from "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal"
where deal_id is not null
group by deal_id
having count(*) > 1



      
    ) dbt_internal_test
[0m16:34:14.443019 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m16:34:14.444865 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: ROLLBACK
[0m16:34:14.446734 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: Close
[0m16:34:14.447510 [info ] [Thread-1 (]: 21 of 21 PASS unique_int_deal_changes_dedupe_new_deal_deal_id .................. [[32mPASS[0m in 0.04s]
[0m16:34:14.448248 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m16:34:14.449504 [debug] [MainThread]: Using postgres connection "master"
[0m16:34:14.449987 [debug] [MainThread]: On master: BEGIN
[0m16:34:14.450346 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:34:14.466430 [debug] [MainThread]: SQL status: BEGIN in 0.016 seconds
[0m16:34:14.467089 [debug] [MainThread]: On master: COMMIT
[0m16:34:14.467526 [debug] [MainThread]: Using postgres connection "master"
[0m16:34:14.467893 [debug] [MainThread]: On master: COMMIT
[0m16:34:14.469187 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:34:14.469612 [debug] [MainThread]: On master: Close
[0m16:34:14.470120 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:34:14.470510 [debug] [MainThread]: Connection 'test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc' was properly closed.
[0m16:34:14.470968 [info ] [MainThread]: 
[0m16:34:14.471412 [info ] [MainThread]: Finished running 21 data tests in 0 hours 0 minutes and 1.19 seconds (1.19s).
[0m16:34:14.476718 [debug] [MainThread]: Command end result
[0m16:34:14.516881 [info ] [MainThread]: 
[0m16:34:14.517399 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:34:14.517859 [info ] [MainThread]: 
[0m16:34:14.518405 [info ] [MainThread]: Done. PASS=21 WARN=0 ERROR=0 SKIP=0 TOTAL=21
[0m16:34:14.520522 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 2.1693761, "process_in_blocks": "0", "process_kernel_time": 0.346541, "process_mem_max_rss": "111505408", "process_out_blocks": "0", "process_user_time": 2.926892}
[0m16:34:14.521378 [debug] [MainThread]: Command `dbt test` succeeded at 16:34:14.521166 after 2.17 seconds
[0m16:34:14.521994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10641ed20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109173ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a11b140>]}
[0m16:34:14.522608 [debug] [MainThread]: Flushing usage events
[0m16:34:25.769339 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f8b1490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fa17350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fa16e40>]}


============================== 16:34:25.774352 | 1196f713-62b3-4d92-8f04-1f1103e51542 ==============================
[0m16:34:25.774352 [info ] [MainThread]: Running with dbt=1.8.9
[0m16:34:25.775102 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/julian/Documents/hatvalues_repo/dbt_enpal_assessment/logs', 'profiles_dir': '/Users/julian/Documents/hatvalues_repo/dbt_enpal_assessment', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt build', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:34:26.006431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1196f713-62b3-4d92-8f04-1f1103e51542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8b9a90>]}
[0m16:34:26.075725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1196f713-62b3-4d92-8f04-1f1103e51542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f39f8c0>]}
[0m16:34:26.076817 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m16:34:26.208898 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m16:34:26.377298 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:34:26.377786 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:34:26.448796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1196f713-62b3-4d92-8f04-1f1103e51542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110010830>]}
[0m16:34:26.617245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1196f713-62b3-4d92-8f04-1f1103e51542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ff91ca0>]}
[0m16:34:26.617859 [info ] [MainThread]: Found 16 models, 21 data tests, 1 seed, 6 sources, 430 macros
[0m16:34:26.622714 [info ] [MainThread]: 
[0m16:34:26.623453 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:34:26.628698 [debug] [ThreadPool]: Acquiring new postgres connection 'list_postgres'
[0m16:34:26.686721 [debug] [ThreadPool]: Using postgres connection "list_postgres"
[0m16:34:26.687196 [debug] [ThreadPool]: On list_postgres: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
[0m16:34:26.687568 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:34:26.717645 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.030 seconds
[0m16:34:26.719331 [debug] [ThreadPool]: On list_postgres: Close
[0m16:34:26.722029 [debug] [ThreadPool]: Using postgres connection "list_postgres"
[0m16:34:26.722674 [debug] [ThreadPool]: On list_postgres: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
[0m16:34:26.723096 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:34:26.739371 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.016 seconds
[0m16:34:26.740941 [debug] [ThreadPool]: On list_postgres: Close
[0m16:34:26.743610 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_postgres, now list_postgres_public)
[0m16:34:26.750207 [debug] [ThreadPool]: Using postgres connection "list_postgres_public"
[0m16:34:26.750706 [debug] [ThreadPool]: On list_postgres_public: BEGIN
[0m16:34:26.751047 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:34:26.770564 [debug] [ThreadPool]: SQL status: BEGIN in 0.019 seconds
[0m16:34:26.785850 [debug] [ThreadPool]: Using postgres connection "list_postgres_public"
[0m16:34:26.788598 [debug] [ThreadPool]: On list_postgres_public: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m16:34:26.816362 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.009 seconds
[0m16:34:26.831200 [debug] [ThreadPool]: On list_postgres_public: ROLLBACK
[0m16:34:26.850278 [debug] [ThreadPool]: On list_postgres_public: Close
[0m16:34:26.851672 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_postgres_public, now list_postgres_public_pipedrive_analytics)
[0m16:34:26.858371 [debug] [ThreadPool]: Using postgres connection "list_postgres_public_pipedrive_analytics"
[0m16:34:26.858997 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: BEGIN
[0m16:34:26.859491 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:34:26.878807 [debug] [ThreadPool]: SQL status: BEGIN in 0.019 seconds
[0m16:34:26.879528 [debug] [ThreadPool]: Using postgres connection "list_postgres_public_pipedrive_analytics"
[0m16:34:26.880030 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres_public_pipedrive_analytics"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_pipedrive_analytics'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_pipedrive_analytics'
    union all
    select
      'postgres' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_pipedrive_analytics'
  
[0m16:34:26.884416 [debug] [ThreadPool]: SQL status: SELECT 13 in 0.004 seconds
[0m16:34:26.886291 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: ROLLBACK
[0m16:34:26.887807 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: Close
[0m16:34:26.898113 [debug] [MainThread]: Using postgres connection "master"
[0m16:34:26.898700 [debug] [MainThread]: On master: BEGIN
[0m16:34:26.899051 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:34:26.915194 [debug] [MainThread]: SQL status: BEGIN in 0.016 seconds
[0m16:34:26.915955 [debug] [MainThread]: Using postgres connection "master"
[0m16:34:26.916485 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:34:26.921389 [debug] [MainThread]: SQL status: SELECT 14 in 0.004 seconds
[0m16:34:26.926091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1196f713-62b3-4d92-8f04-1f1103e51542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ebc1a0>]}
[0m16:34:26.926634 [debug] [MainThread]: On master: ROLLBACK
[0m16:34:26.929134 [debug] [MainThread]: Using postgres connection "master"
[0m16:34:26.929641 [debug] [MainThread]: On master: BEGIN
[0m16:34:26.932156 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m16:34:26.932819 [debug] [MainThread]: On master: COMMIT
[0m16:34:26.933247 [debug] [MainThread]: Using postgres connection "master"
[0m16:34:26.933628 [debug] [MainThread]: On master: COMMIT
[0m16:34:26.934933 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:34:26.935404 [debug] [MainThread]: On master: Close
[0m16:34:26.935996 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:34:26.936480 [info ] [MainThread]: 
[0m16:34:26.938962 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.base_pipedrive__fields
[0m16:34:26.939642 [info ] [Thread-1 (]: 1 of 35 START sql view model public_pipedrive_analytics.base_pipedrive__fields . [RUN]
[0m16:34:26.940189 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_postgres_public_pipedrive_analytics, now model.enpal_assessment_project.base_pipedrive__fields)
[0m16:34:26.940626 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.base_pipedrive__fields
[0m16:34:26.950761 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.base_pipedrive__fields"
[0m16:34:26.952243 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.base_pipedrive__fields
[0m16:34:26.992812 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.base_pipedrive__fields"
[0m16:34:26.993829 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m16:34:26.994278 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: BEGIN
[0m16:34:26.994686 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:27.011121 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:34:27.011889 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m16:34:27.012388 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */

  create view "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_tmp"
    
    
  as (
    -- Simple base model to connect to the source table
-- This table has JSON array values that need to be unpacked
-- Those unpacked values will be set up as reference nodes in the staging layer
SELECT *
FROM "postgres"."public"."fields"
  );
[0m16:34:27.014687 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m16:34:27.021675 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m16:34:27.022160 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */
alter table "postgres"."public_pipedrive_analytics"."base_pipedrive__fields" rename to "base_pipedrive__fields__dbt_backup"
[0m16:34:27.023930 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:27.027148 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m16:34:27.027602 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */
alter table "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_tmp" rename to "base_pipedrive__fields"
[0m16:34:27.029432 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:27.047683 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: COMMIT
[0m16:34:27.048217 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m16:34:27.048634 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: COMMIT
[0m16:34:27.051295 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:34:27.058506 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_backup"
[0m16:34:27.064059 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m16:34:27.064563 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */
drop view if exists "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_backup" cascade
[0m16:34:27.068661 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m16:34:27.071712 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: Close
[0m16:34:27.073607 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1196f713-62b3-4d92-8f04-1f1103e51542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e2c1a00>]}
[0m16:34:27.074458 [info ] [Thread-1 (]: 1 of 35 OK created sql view model public_pipedrive_analytics.base_pipedrive__fields  [[32mCREATE VIEW[0m in 0.13s]
[0m16:34:27.075500 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.base_pipedrive__fields
[0m16:34:27.076270 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__activity
[0m16:34:27.077166 [info ] [Thread-1 (]: 2 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__activity  [RUN]
[0m16:34:27.078051 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.base_pipedrive__fields, now model.enpal_assessment_project.stg_pipedrive__activity)
[0m16:34:27.078566 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__activity
[0m16:34:27.084645 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__activity"
[0m16:34:27.085728 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__activity
[0m16:34:27.089673 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__activity"
[0m16:34:27.092139 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m16:34:27.092915 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: BEGIN
[0m16:34:27.093364 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:27.111070 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m16:34:27.111727 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m16:34:27.112246 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_tmp"
    
    
  as (
    -- Type is a reserved keyword. Renaming.
-- Rename others for consistency with other models
    -- model.id, model.reference_model_id
    -- bools are prefixed with is_ or has_
    -- convert date strings to timestamps and rename
-- add calculated month fields that will be used downstream

-- Potential problem? Activity ids are not unique on their own.
    -- Combinations repeating activity id with all other columns
    -- Not useful to create a composite unique check
    -- Does not seem to affect the overall task because the relationship to deal_id is more important

WITH base_activity AS (
    SELECT
        activity_id AS id,
        type AS activity_type,
        assigned_to_user AS user_id,
        deal_id,
        done AS is_done,
        due_to::TIMESTAMP AS due_time
    FROM "postgres"."public"."activity"
)
SELECT 
    id,
    activity_type,
    user_id,
    deal_id,
    is_done,
    due_time,
    
    EXTRACT(MONTH FROM due_time) AS month_number,
    TO_CHAR(due_time, 'Month') AS month_name

FROM base_activity
  );
[0m16:34:27.115099 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m16:34:27.120219 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m16:34:27.120815 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity" rename to "stg_pipedrive__activity__dbt_backup"
[0m16:34:27.122715 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:27.125942 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m16:34:27.126404 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_tmp" rename to "stg_pipedrive__activity"
[0m16:34:27.128067 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:27.129903 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: COMMIT
[0m16:34:27.130425 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m16:34:27.130849 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: COMMIT
[0m16:34:27.132815 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m16:34:27.135389 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_backup"
[0m16:34:27.136050 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m16:34:27.136479 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_backup" cascade
[0m16:34:27.139232 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m16:34:27.140896 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: Close
[0m16:34:27.141514 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1196f713-62b3-4d92-8f04-1f1103e51542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f41130>]}
[0m16:34:27.142216 [info ] [Thread-1 (]: 2 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__activity  [[32mCREATE VIEW[0m in 0.06s]
[0m16:34:27.142957 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__activity
[0m16:34:27.143487 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m16:34:27.144349 [info ] [Thread-1 (]: 3 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__activity_types  [RUN]
[0m16:34:27.144951 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__activity, now model.enpal_assessment_project.stg_pipedrive__activity_types)
[0m16:34:27.145396 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m16:34:27.148323 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m16:34:27.149739 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m16:34:27.155179 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m16:34:27.156078 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m16:34:27.156517 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: BEGIN
[0m16:34:27.156917 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:27.175001 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m16:34:27.175733 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m16:34:27.176203 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_tmp"
    
    
  as (
    -- Type and Name are reserved keywords. Renaming.
-- The `active` column is a string with just two possible value. It makes more sense as a bool
SELECT
    id,
    name AS activity_name,
    CASE
        WHEN active = 'Yes' THEN TRUE
        ELSE FALSE
    END AS is_active,
    type AS activity_type
FROM "postgres"."public"."activity_types"
  );
[0m16:34:27.179565 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m16:34:27.183082 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m16:34:27.183542 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types" rename to "stg_pipedrive__activity_types__dbt_backup"
[0m16:34:27.185219 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:27.188367 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m16:34:27.188814 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_tmp" rename to "stg_pipedrive__activity_types"
[0m16:34:27.190439 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:27.192159 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: COMMIT
[0m16:34:27.192612 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m16:34:27.193140 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: COMMIT
[0m16:34:27.195223 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:34:27.197798 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_backup"
[0m16:34:27.198435 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m16:34:27.198858 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_backup" cascade
[0m16:34:27.201452 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m16:34:27.203032 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: Close
[0m16:34:27.203615 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1196f713-62b3-4d92-8f04-1f1103e51542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e5da90>]}
[0m16:34:27.204300 [info ] [Thread-1 (]: 3 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__activity_types  [[32mCREATE VIEW[0m in 0.06s]
[0m16:34:27.205036 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m16:34:27.205558 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m16:34:27.206263 [info ] [Thread-1 (]: 4 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__deal_changes  [RUN]
[0m16:34:27.206968 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__activity_types, now model.enpal_assessment_project.stg_pipedrive__deal_changes)
[0m16:34:27.207429 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m16:34:27.210659 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m16:34:27.211910 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m16:34:27.217142 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m16:34:27.218566 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m16:34:27.219021 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: BEGIN
[0m16:34:27.219416 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:27.236420 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:27.237005 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m16:34:27.237485 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_tmp"
    
    
  as (
    -- This is not a source deals table, and deal_id is not a PK (UNIQUE)
    -- leave deal_id named as is to be consistent with naming convention model.reference_model_id
    -- convert date strings to timestamps and rename
-- add calculated month fields that will be used downstream
WITH base_deal_changes AS (
    SELECT
        deal_id,
        change_time::TIMESTAMP AS change_time,
        changed_field_key,
        new_value
    FROM "postgres"."public"."deal_changes"
)
SELECT
    deal_id,
    changed_field_key,
    new_value,
    change_time,
    
    EXTRACT(MONTH FROM change_time) AS month_number,
    TO_CHAR(change_time, 'Month') AS month_name

FROM base_deal_changes
  );
[0m16:34:27.240563 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m16:34:27.244135 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m16:34:27.244615 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes" rename to "stg_pipedrive__deal_changes__dbt_backup"
[0m16:34:27.246293 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:27.250959 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m16:34:27.251443 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_tmp" rename to "stg_pipedrive__deal_changes"
[0m16:34:27.253027 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:27.254843 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: COMMIT
[0m16:34:27.255439 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m16:34:27.255877 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: COMMIT
[0m16:34:27.257990 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:34:27.260713 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_backup"
[0m16:34:27.261386 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m16:34:27.261816 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_backup" cascade
[0m16:34:27.264734 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m16:34:27.266386 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: Close
[0m16:34:27.267009 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1196f713-62b3-4d92-8f04-1f1103e51542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f76330>]}
[0m16:34:27.267764 [info ] [Thread-1 (]: 4 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__deal_changes  [[32mCREATE VIEW[0m in 0.06s]
[0m16:34:27.268539 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m16:34:27.269097 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__stages
[0m16:34:27.269845 [info ] [Thread-1 (]: 5 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__stages .. [RUN]
[0m16:34:27.270592 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__deal_changes, now model.enpal_assessment_project.stg_pipedrive__stages)
[0m16:34:27.271034 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__stages
[0m16:34:27.274057 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__stages"
[0m16:34:27.275402 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__stages
[0m16:34:27.280569 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__stages"
[0m16:34:27.281465 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m16:34:27.281901 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: BEGIN
[0m16:34:27.282300 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:27.298861 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:34:27.299595 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m16:34:27.300077 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_tmp"
    
    
  as (
    /* NOT USED UPSTREAM. 
    The values in this table also found in the JSON array of base_pipedrive__fields.
    I would rather standardise the way stages and lost_reasons are handled.
    My assumption is that base_pipedrive__fields holds the current values configured in the Pipedrive application,
    and if this were to be updated by a sysadmin, the static version of the stages table would not reflect the changes.
NOT USED UPSTREAM. */

-- Rename stage_id to id for consistency: model.id, model.reference_model_id
SELECT
    stage_id AS id,
    stage_name
FROM "postgres"."public"."stages"
  );
[0m16:34:27.302590 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m16:34:27.306057 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m16:34:27.306502 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages" rename to "stg_pipedrive__stages__dbt_backup"
[0m16:34:27.308090 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:27.311247 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m16:34:27.311700 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_tmp" rename to "stg_pipedrive__stages"
[0m16:34:27.313099 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:27.314726 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: COMMIT
[0m16:34:27.315166 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m16:34:27.315574 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: COMMIT
[0m16:34:27.317527 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m16:34:27.320083 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_backup"
[0m16:34:27.320730 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m16:34:27.321155 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_backup" cascade
[0m16:34:27.323620 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m16:34:27.325257 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: Close
[0m16:34:27.325850 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1196f713-62b3-4d92-8f04-1f1103e51542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ebe090>]}
[0m16:34:27.326606 [info ] [Thread-1 (]: 5 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__stages  [[32mCREATE VIEW[0m in 0.06s]
[0m16:34:27.327517 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__stages
[0m16:34:27.328078 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__users
[0m16:34:27.328922 [info ] [Thread-1 (]: 6 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__users ... [RUN]
[0m16:34:27.329502 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__stages, now model.enpal_assessment_project.stg_pipedrive__users)
[0m16:34:27.329946 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__users
[0m16:34:27.333155 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__users"
[0m16:34:27.333936 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__users
[0m16:34:27.337309 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__users"
[0m16:34:27.338057 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m16:34:27.338476 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: BEGIN
[0m16:34:27.338875 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:27.355249 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:34:27.355992 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m16:34:27.356480 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_tmp"
    
    
  as (
    /* NOT USED UPSTREAM. 
    The requested report does not call for user information, so this model is not used anywhere upstream.
	This model is created for completeness of the investigative aspects of the task.
NOT USED UPSTREAM. */

-- Name is a reserved keyword. Renaming.
-- Convert date strings to timestamps and rename
-- Add calculated month fields that will be used downstream
WITH base_users AS (
    SELECT
        id,
        name AS user_name,
        email AS user_email,
        modified::TIMESTAMP AS modified_time
    FROM "postgres"."public"."users"
)
SELECT
    id,
    user_name,
    user_email,
    modified_time,
    
    EXTRACT(MONTH FROM modified_time) AS month_number,
    TO_CHAR(modified_time, 'Month') AS month_name

FROM base_users
  );
[0m16:34:27.359525 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m16:34:27.364454 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m16:34:27.364949 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__users" rename to "stg_pipedrive__users__dbt_backup"
[0m16:34:27.367294 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:34:27.370445 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m16:34:27.370906 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_tmp" rename to "stg_pipedrive__users"
[0m16:34:27.372414 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:27.374285 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: COMMIT
[0m16:34:27.374792 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m16:34:27.375202 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: COMMIT
[0m16:34:27.377106 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m16:34:27.382529 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_backup"
[0m16:34:27.383233 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m16:34:27.383683 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_backup" cascade
[0m16:34:27.386731 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m16:34:27.388331 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: Close
[0m16:34:27.388917 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1196f713-62b3-4d92-8f04-1f1103e51542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110fb2e70>]}
[0m16:34:27.389643 [info ] [Thread-1 (]: 6 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__users  [[32mCREATE VIEW[0m in 0.06s]
[0m16:34:27.390437 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__users
[0m16:34:27.390991 [debug] [Thread-1 (]: Began running node seed.enpal_assessment_project.minor_stages
[0m16:34:27.391630 [info ] [Thread-1 (]: 7 of 35 START seed file public.minor_stages .................................... [RUN]
[0m16:34:27.392523 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__users, now seed.enpal_assessment_project.minor_stages)
[0m16:34:27.392989 [debug] [Thread-1 (]: Began compiling node seed.enpal_assessment_project.minor_stages
[0m16:34:27.393419 [debug] [Thread-1 (]: Began executing node seed.enpal_assessment_project.minor_stages
[0m16:34:27.423552 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m16:34:27.424063 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: BEGIN
[0m16:34:27.424468 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:27.440377 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:34:27.440951 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m16:34:27.441400 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "seed.enpal_assessment_project.minor_stages"} */
truncate table "postgres"."public"."minor_stages"
[0m16:34:27.443747 [debug] [Thread-1 (]: SQL status: TRUNCATE TABLE in 0.002 seconds
[0m16:34:27.461539 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m16:34:27.462092 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: 
          insert into "postgres"."public"."minor_stages" ("id", "activity_type", "stage_id", "minor_stage_id") values
          (%s,%s,%s,%s),(%s,%s,%s,%s)
      ...
[0m16:34:27.464200 [debug] [Thread-1 (]: SQL status: INSERT 0 2 in 0.002 seconds
[0m16:34:27.470506 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.enpal_assessment_project.minor_stages"
[0m16:34:27.474177 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: COMMIT
[0m16:34:27.474709 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m16:34:27.475134 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: COMMIT
[0m16:34:27.478080 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:34:27.479090 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: Close
[0m16:34:27.479698 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1196f713-62b3-4d92-8f04-1f1103e51542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110fb19a0>]}
[0m16:34:27.480372 [info ] [Thread-1 (]: 7 of 35 OK loaded seed file public.minor_stages ................................ [[32mINSERT 2[0m in 0.09s]
[0m16:34:27.481192 [debug] [Thread-1 (]: Finished running node seed.enpal_assessment_project.minor_stages
[0m16:34:27.481788 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m16:34:27.482807 [info ] [Thread-1 (]: 8 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__fields_lost_reasons  [RUN]
[0m16:34:27.483499 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.enpal_assessment_project.minor_stages, now model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons)
[0m16:34:27.484022 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m16:34:27.487152 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m16:34:27.488021 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m16:34:27.491724 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m16:34:27.492645 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m16:34:27.493096 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: BEGIN
[0m16:34:27.493571 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:27.512566 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m16:34:27.513201 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m16:34:27.513710 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_tmp"
    
    
  as (
    -- `base_pipedrive__fields` model has the values buried in a JSON array.
-- Make sure ids are INTEGER and not numeric-looking STRING 
	-- it is better to convert here even though CASTING is also required in the referential test.
	-- because in the real world, collaborators would be confused to see numeric-looking values as STRINGs.
WITH expand_array AS (
	SELECT 
		jsonb_array_elements(field_value_options) AS field_value_options
	FROM "postgres"."public_pipedrive_analytics"."base_pipedrive__fields"
	WHERE field_key = 'lost_reason'
)
SELECT
	CAST(field_value_options ->> 'id' AS INTEGER) AS id,
	field_value_options ->> 'label' AS label
FROM expand_array
  );
[0m16:34:27.517802 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m16:34:27.520971 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m16:34:27.521416 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_tmp" rename to "stg_pipedrive__fields_lost_reasons"
[0m16:34:27.523060 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:27.524563 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: COMMIT
[0m16:34:27.525000 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m16:34:27.525404 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: COMMIT
[0m16:34:27.527366 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:34:27.530024 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_backup"
[0m16:34:27.530885 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m16:34:27.531360 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_backup" cascade
[0m16:34:27.533094 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m16:34:27.534744 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: Close
[0m16:34:27.535338 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1196f713-62b3-4d92-8f04-1f1103e51542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1109e6e10>]}
[0m16:34:27.536075 [info ] [Thread-1 (]: 8 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__fields_lost_reasons  [[32mCREATE VIEW[0m in 0.05s]
[0m16:34:27.536824 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m16:34:27.537347 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m16:34:27.538072 [info ] [Thread-1 (]: 9 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__fields_stages  [RUN]
[0m16:34:27.538758 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons, now model.enpal_assessment_project.stg_pipedrive__fields_stages)
[0m16:34:27.539204 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m16:34:27.542034 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m16:34:27.542863 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m16:34:27.546443 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m16:34:27.547323 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m16:34:27.547875 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: BEGIN
[0m16:34:27.549265 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:27.568860 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m16:34:27.570148 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m16:34:27.570918 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_stages"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_tmp"
    
    
  as (
    -- `base_pipedrive__fields` model has the values buried in a JSON array.
-- Make sure ids are INTEGER and not numeric-looking STRING 
	-- it is better to convert here even though CASTING is also required in the referential test.
	-- because in the real world, collaborators would be confused to see numeric-looking values as STRINGs.
WITH expand_array AS (
	SELECT 
		jsonb_array_elements(field_value_options) AS field_value_options
	FROM "postgres"."public_pipedrive_analytics"."base_pipedrive__fields"
	WHERE field_key = 'stage_id'
)
SELECT
	CAST(field_value_options ->> 'id' AS INTEGER) AS id,
	field_value_options ->> 'label' AS label
FROM expand_array
  );
[0m16:34:27.574079 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m16:34:27.577398 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m16:34:27.577951 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_stages"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_tmp" rename to "stg_pipedrive__fields_stages"
[0m16:34:27.579940 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:27.581531 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: COMMIT
[0m16:34:27.581966 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m16:34:27.582370 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: COMMIT
[0m16:34:27.584512 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:34:27.589117 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_backup"
[0m16:34:27.589802 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m16:34:27.590229 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_stages"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_backup" cascade
[0m16:34:27.591801 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m16:34:27.593416 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: Close
[0m16:34:27.594024 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1196f713-62b3-4d92-8f04-1f1103e51542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110fcb560>]}
[0m16:34:27.594729 [info ] [Thread-1 (]: 9 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__fields_stages  [[32mCREATE VIEW[0m in 0.06s]
[0m16:34:27.595468 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m16:34:27.596004 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m16:34:27.596690 [info ] [Thread-1 (]: 10 of 35 START test not_null_stg_pipedrive__activity_deal_id ................... [RUN]
[0m16:34:27.597348 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__fields_stages, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e)
[0m16:34:27.597800 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m16:34:27.612365 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m16:34:27.613318 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m16:34:27.633741 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m16:34:27.635278 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m16:34:27.635783 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: BEGIN
[0m16:34:27.636214 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:27.652638 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:34:27.653291 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m16:34:27.653818 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select deal_id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where deal_id is null



      
    ) dbt_internal_test
[0m16:34:27.656412 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m16:34:27.660103 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: ROLLBACK
[0m16:34:27.661486 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: Close
[0m16:34:27.662247 [info ] [Thread-1 (]: 10 of 35 PASS not_null_stg_pipedrive__activity_deal_id ......................... [[32mPASS[0m in 0.06s]
[0m16:34:27.663081 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m16:34:27.663596 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m16:34:27.664042 [info ] [Thread-1 (]: 11 of 35 START test not_null_stg_pipedrive__activity_due_time .................. [RUN]
[0m16:34:27.664755 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191)
[0m16:34:27.665238 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m16:34:27.669630 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m16:34:27.670516 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m16:34:27.673079 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m16:34:27.673907 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m16:34:27.674407 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: BEGIN
[0m16:34:27.674824 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:27.690617 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:34:27.691386 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m16:34:27.691999 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select due_time
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where due_time is null



      
    ) dbt_internal_test
[0m16:34:27.694850 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m16:34:27.696962 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: ROLLBACK
[0m16:34:27.698697 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: Close
[0m16:34:27.699426 [info ] [Thread-1 (]: 11 of 35 PASS not_null_stg_pipedrive__activity_due_time ........................ [[32mPASS[0m in 0.03s]
[0m16:34:27.700205 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m16:34:27.700717 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m16:34:27.701308 [info ] [Thread-1 (]: 12 of 35 START test not_null_stg_pipedrive__activity_id ........................ [RUN]
[0m16:34:27.702095 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb)
[0m16:34:27.702598 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m16:34:27.706768 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m16:34:27.707990 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m16:34:27.710309 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m16:34:27.711090 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m16:34:27.711513 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: BEGIN
[0m16:34:27.711904 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:27.728549 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:34:27.729338 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m16:34:27.729889 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where id is null



      
    ) dbt_internal_test
[0m16:34:27.732483 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m16:34:27.734190 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: ROLLBACK
[0m16:34:27.735728 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: Close
[0m16:34:27.736484 [info ] [Thread-1 (]: 12 of 35 PASS not_null_stg_pipedrive__activity_id .............................. [[32mPASS[0m in 0.03s]
[0m16:34:27.737212 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m16:34:27.737733 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m16:34:27.738333 [info ] [Thread-1 (]: 13 of 35 START test not_null_stg_pipedrive__activity_is_done ................... [RUN]
[0m16:34:27.739191 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543)
[0m16:34:27.739677 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m16:34:27.743689 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m16:34:27.744460 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m16:34:27.746868 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m16:34:27.747735 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m16:34:27.748186 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: BEGIN
[0m16:34:27.748582 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:27.765448 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:27.766129 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m16:34:27.766658 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select is_done
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where is_done is null



      
    ) dbt_internal_test
[0m16:34:27.769345 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m16:34:27.771103 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: ROLLBACK
[0m16:34:27.772664 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: Close
[0m16:34:27.773405 [info ] [Thread-1 (]: 13 of 35 PASS not_null_stg_pipedrive__activity_is_done ......................... [[32mPASS[0m in 0.03s]
[0m16:34:27.774220 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m16:34:27.774806 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m16:34:27.775323 [info ] [Thread-1 (]: 14 of 35 START test relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_  [RUN]
[0m16:34:27.775940 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543, now test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8)
[0m16:34:27.776407 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m16:34:27.785435 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m16:34:27.786770 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m16:34:27.789265 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m16:34:27.790528 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m16:34:27.791007 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: BEGIN
[0m16:34:27.791495 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:27.808479 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:27.809181 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m16:34:27.809692 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select activity_type as from_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
    where activity_type is not null
),

parent as (
    select activity_type as to_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m16:34:27.815073 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m16:34:27.816946 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: ROLLBACK
[0m16:34:27.818498 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: Close
[0m16:34:27.819332 [info ] [Thread-1 (]: 14 of 35 PASS relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_  [[32mPASS[0m in 0.04s]
[0m16:34:27.820076 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m16:34:27.820592 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m16:34:27.821174 [info ] [Thread-1 (]: 15 of 35 START test accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time  [RUN]
[0m16:34:27.821868 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8, now test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0)
[0m16:34:27.822335 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m16:34:27.834738 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m16:34:27.836003 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m16:34:27.838552 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m16:34:27.839854 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m16:34:27.840500 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: BEGIN
[0m16:34:27.841049 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:27.858520 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:27.859261 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m16:34:27.859982 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        changed_field_key as value_field,
        count(*) as n_records

    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
    group by changed_field_key

)

select *
from all_values
where value_field not in (
    'user_id','stage_id','lost_reason','add_time'
)



      
    ) dbt_internal_test
[0m16:34:27.865399 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m16:34:27.867120 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: ROLLBACK
[0m16:34:27.868595 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: Close
[0m16:34:27.869499 [info ] [Thread-1 (]: 15 of 35 PASS accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time  [[32mPASS[0m in 0.05s]
[0m16:34:27.870375 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m16:34:27.870906 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m16:34:27.871416 [info ] [Thread-1 (]: 16 of 35 START test assert_timestamp_equal_add_time_new_value .................. [RUN]
[0m16:34:27.872184 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0, now test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value)
[0m16:34:27.872685 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m16:34:27.875592 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m16:34:27.876770 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m16:34:27.879130 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m16:34:27.880069 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m16:34:27.880522 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: BEGIN
[0m16:34:27.880930 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:27.898128 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:27.898756 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m16:34:27.899230 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- Proving that the new_value field for add_time changes is redundant. We can just use the change_time.
SELECT * FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
	WHERE changed_field_key = 'add_time'
	AND change_time != new_value::TIMESTAMP
      
    ) dbt_internal_test
[0m16:34:27.904661 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m16:34:27.906475 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: ROLLBACK
[0m16:34:27.907863 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: Close
[0m16:34:27.908624 [info ] [Thread-1 (]: 16 of 35 PASS assert_timestamp_equal_add_time_new_value ........................ [[32mPASS[0m in 0.04s]
[0m16:34:27.909409 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m16:34:27.909938 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m16:34:27.910384 [info ] [Thread-1 (]: 17 of 35 START test not_null_stg_pipedrive__deal_changes_change_time ........... [RUN]
[0m16:34:27.911014 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value, now test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d)
[0m16:34:27.911498 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m16:34:27.915625 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m16:34:27.916818 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m16:34:27.919223 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m16:34:27.920475 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m16:34:27.920950 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: BEGIN
[0m16:34:27.921374 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:27.940231 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m16:34:27.941325 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m16:34:27.941984 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select change_time
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
where change_time is null



      
    ) dbt_internal_test
[0m16:34:27.945094 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m16:34:27.946824 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: ROLLBACK
[0m16:34:27.948202 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: Close
[0m16:34:27.948905 [info ] [Thread-1 (]: 17 of 35 PASS not_null_stg_pipedrive__deal_changes_change_time ................. [[32mPASS[0m in 0.04s]
[0m16:34:27.949678 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m16:34:27.950190 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m16:34:27.950635 [info ] [Thread-1 (]: 18 of 35 START test not_null_stg_pipedrive__deal_changes_deal_id ............... [RUN]
[0m16:34:27.951437 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d, now test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d)
[0m16:34:27.951917 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m16:34:27.955988 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m16:34:27.956782 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m16:34:27.959212 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m16:34:27.960479 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m16:34:27.961041 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: BEGIN
[0m16:34:27.961621 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:27.978525 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:27.979153 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m16:34:27.979664 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select deal_id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
where deal_id is null



      
    ) dbt_internal_test
[0m16:34:27.983565 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m16:34:27.985377 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: ROLLBACK
[0m16:34:27.986601 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: Close
[0m16:34:27.987414 [info ] [Thread-1 (]: 18 of 35 PASS not_null_stg_pipedrive__deal_changes_deal_id ..................... [[32mPASS[0m in 0.04s]
[0m16:34:27.988191 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m16:34:27.988883 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m16:34:27.989612 [info ] [Thread-1 (]: 19 of 35 START test not_null_stg_pipedrive__deal_changes_new_value ............. [RUN]
[0m16:34:27.990270 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d, now test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96)
[0m16:34:27.990731 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m16:34:27.995222 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m16:34:27.996088 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m16:34:27.998484 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m16:34:27.999243 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m16:34:27.999666 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: BEGIN
[0m16:34:28.000055 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:28.016935 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:28.017786 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m16:34:28.018305 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select new_value
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
where new_value is null



      
    ) dbt_internal_test
[0m16:34:28.021921 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m16:34:28.023738 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: ROLLBACK
[0m16:34:28.025129 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: Close
[0m16:34:28.025891 [info ] [Thread-1 (]: 19 of 35 PASS not_null_stg_pipedrive__deal_changes_new_value ................... [[32mPASS[0m in 0.04s]
[0m16:34:28.026671 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m16:34:28.027190 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_change_user_references_user_id
[0m16:34:28.027628 [info ] [Thread-1 (]: 20 of 35 START test assert_change_user_references_user_id ...................... [RUN]
[0m16:34:28.028360 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96, now test.enpal_assessment_project.assert_change_user_references_user_id)
[0m16:34:28.028847 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_change_user_references_user_id
[0m16:34:28.033166 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m16:34:28.034240 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_change_user_references_user_id
[0m16:34:28.037848 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m16:34:28.039211 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m16:34:28.039824 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: BEGIN
[0m16:34:28.040372 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:28.057506 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:28.058109 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m16:34:28.058664 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_change_user_references_user_id"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- CTE to pre-filter deal_changes for stage_id changes
-- to safely cast new_value to an integer when we're sure all the values can be implicitly casted
WITH deal_change_user AS (
	
SELECT
    changed_field_key,
    new_value
FROM
    "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
WHERE
    changed_field_key = 'user_id'

)
SELECT *
FROM deal_change_user d
LEFT OUTER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__users" u
ON CAST(d.new_value AS INTEGER) = u.id
WHERE u.id IS NULL -- Any non referential values in d will return a NULL s.id
      
    ) dbt_internal_test
[0m16:34:28.064159 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m16:34:28.066072 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: ROLLBACK
[0m16:34:28.067591 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: Close
[0m16:34:28.068535 [info ] [Thread-1 (]: 20 of 35 PASS assert_change_user_references_user_id ............................ [[32mPASS[0m in 0.04s]
[0m16:34:28.069668 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_change_user_references_user_id
[0m16:34:28.070216 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m16:34:28.070809 [info ] [Thread-1 (]: 21 of 35 START test not_null_stg_pipedrive__users_id ........................... [RUN]
[0m16:34:28.071431 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_change_user_references_user_id, now test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817)
[0m16:34:28.071875 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m16:34:28.077727 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m16:34:28.078694 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m16:34:28.133199 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m16:34:28.135036 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m16:34:28.135936 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: BEGIN
[0m16:34:28.136533 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:28.155361 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m16:34:28.155891 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m16:34:28.156470 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where id is null



      
    ) dbt_internal_test
[0m16:34:28.158871 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m16:34:28.160653 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: ROLLBACK
[0m16:34:28.161910 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: Close
[0m16:34:28.162642 [info ] [Thread-1 (]: 21 of 35 PASS not_null_stg_pipedrive__users_id ................................. [[32mPASS[0m in 0.09s]
[0m16:34:28.163452 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m16:34:28.163964 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m16:34:28.164455 [info ] [Thread-1 (]: 22 of 35 START test not_null_stg_pipedrive__users_modified_time ................ [RUN]
[0m16:34:28.165077 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817, now test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5)
[0m16:34:28.165534 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m16:34:28.169643 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m16:34:28.170445 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m16:34:28.172727 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m16:34:28.173908 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m16:34:28.174405 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: BEGIN
[0m16:34:28.174811 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:28.190672 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:34:28.191391 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m16:34:28.191871 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select modified_time
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where modified_time is null



      
    ) dbt_internal_test
[0m16:34:28.194715 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m16:34:28.196760 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: ROLLBACK
[0m16:34:28.198171 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: Close
[0m16:34:28.198889 [info ] [Thread-1 (]: 22 of 35 PASS not_null_stg_pipedrive__users_modified_time ...................... [[32mPASS[0m in 0.03s]
[0m16:34:28.199709 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m16:34:28.200216 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m16:34:28.200694 [info ] [Thread-1 (]: 23 of 35 START test not_null_stg_pipedrive__users_user_email ................... [RUN]
[0m16:34:28.201287 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5, now test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157)
[0m16:34:28.201827 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m16:34:28.205932 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m16:34:28.206753 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m16:34:28.209224 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m16:34:28.210451 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m16:34:28.210897 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: BEGIN
[0m16:34:28.211301 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:28.228622 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:28.229526 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m16:34:28.230276 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select user_email
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where user_email is null



      
    ) dbt_internal_test
[0m16:34:28.232942 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m16:34:28.234836 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: ROLLBACK
[0m16:34:28.236369 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: Close
[0m16:34:28.237104 [info ] [Thread-1 (]: 23 of 35 PASS not_null_stg_pipedrive__users_user_email ......................... [[32mPASS[0m in 0.04s]
[0m16:34:28.237841 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m16:34:28.238456 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m16:34:28.238913 [info ] [Thread-1 (]: 24 of 35 START test not_null_stg_pipedrive__users_user_name .................... [RUN]
[0m16:34:28.239600 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157, now test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5)
[0m16:34:28.240071 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m16:34:28.244360 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m16:34:28.245191 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m16:34:28.247509 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m16:34:28.248367 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m16:34:28.248833 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: BEGIN
[0m16:34:28.249239 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:28.265334 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:34:28.265976 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m16:34:28.266514 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select user_name
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where user_name is null



      
    ) dbt_internal_test
[0m16:34:28.269262 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m16:34:28.270966 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: ROLLBACK
[0m16:34:28.272275 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: Close
[0m16:34:28.273011 [info ] [Thread-1 (]: 24 of 35 PASS not_null_stg_pipedrive__users_user_name .......................... [[32mPASS[0m in 0.03s]
[0m16:34:28.273817 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m16:34:28.274424 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m16:34:28.274983 [info ] [Thread-1 (]: 25 of 35 START test relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_  [RUN]
[0m16:34:28.275852 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5, now test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d)
[0m16:34:28.276441 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m16:34:28.282163 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m16:34:28.283439 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m16:34:28.285977 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m16:34:28.286800 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m16:34:28.287242 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: BEGIN
[0m16:34:28.287643 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:28.304653 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:28.305391 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m16:34:28.305887 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select user_id as from_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
    where user_id is not null
),

parent as (
    select id as to_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m16:34:28.310555 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.004 seconds
[0m16:34:28.312291 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: ROLLBACK
[0m16:34:28.313725 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: Close
[0m16:34:28.314458 [info ] [Thread-1 (]: 25 of 35 PASS relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_  [[32mPASS[0m in 0.04s]
[0m16:34:28.315330 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m16:34:28.315866 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m16:34:28.316394 [info ] [Thread-1 (]: 26 of 35 START test assert_change_stage_references_lost_reason_id .............. [RUN]
[0m16:34:28.317297 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d, now test.enpal_assessment_project.assert_change_stage_references_lost_reason_id)
[0m16:34:28.317888 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m16:34:28.321116 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m16:34:28.321906 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m16:34:28.324199 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m16:34:28.324957 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m16:34:28.325391 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: BEGIN
[0m16:34:28.325786 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:28.342516 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:28.343151 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m16:34:28.343683 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- new_value field is a STRING type but contains mixed values for other tables/models
-- The CTE will pre-filter the deal_changes to safely cast new_value to an integer for this test
WITH deal_change_reasons AS (
	
SELECT
    changed_field_key,
    new_value
FROM
    "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
WHERE
    changed_field_key = 'lost_reason'

)
SELECT *
FROM deal_change_reasons dcr
LEFT OUTER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons" reasons
ON CAST(dcr.new_value AS INTEGER) = reasons.id
WHERE reasons.id IS NULL -- Any non referential values in dcr will return a NULL reasons.id
      
    ) dbt_internal_test
[0m16:34:28.348546 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.004 seconds
[0m16:34:28.350284 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: ROLLBACK
[0m16:34:28.351735 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: Close
[0m16:34:28.352665 [info ] [Thread-1 (]: 26 of 35 PASS assert_change_stage_references_lost_reason_id .................... [[32mPASS[0m in 0.04s]
[0m16:34:28.353508 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m16:34:28.354033 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m16:34:28.354589 [info ] [Thread-1 (]: 27 of 35 START test assert_change_stage_references_stage_id .................... [RUN]
[0m16:34:28.355400 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_change_stage_references_lost_reason_id, now test.enpal_assessment_project.assert_change_stage_references_stage_id)
[0m16:34:28.355873 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m16:34:28.360745 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m16:34:28.362128 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m16:34:28.364489 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m16:34:28.365306 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m16:34:28.365744 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: BEGIN
[0m16:34:28.366359 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:28.383204 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:28.383918 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m16:34:28.384560 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_change_stage_references_stage_id"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- new_value field is a STRING type but contains mixed values for other tables/models
-- The CTE will pre-filter the deal_changes to safely cast new_value to an integer for this test
WITH deal_change_stage AS (
	
SELECT
    changed_field_key,
    new_value
FROM
    "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
WHERE
    changed_field_key = 'stage_id'

)
SELECT *
FROM deal_change_stage dcs
LEFT OUTER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages" stages
ON CAST(dcs.new_value AS INTEGER) = stages.id
WHERE stages.id IS NULL -- Any non referential values in d will return a NULL s.id
      
    ) dbt_internal_test
[0m16:34:28.391981 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.007 seconds
[0m16:34:28.393815 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: ROLLBACK
[0m16:34:28.395339 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: Close
[0m16:34:28.396085 [info ] [Thread-1 (]: 27 of 35 PASS assert_change_stage_references_stage_id .......................... [[32mPASS[0m in 0.04s]
[0m16:34:28.396915 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m16:34:28.397495 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_activity_join_activity_type
[0m16:34:28.397984 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_change_stage_references_stage_id, now model.enpal_assessment_project.int_activity_join_activity_type)
[0m16:34:28.398564 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_activity_join_activity_type
[0m16:34:28.402073 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_activity_join_activity_type"
[0m16:34:28.403451 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_activity_join_activity_type
[0m16:34:28.403969 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m16:34:28.404540 [info ] [Thread-1 (]: 28 of 35 START sql view model public_pipedrive_analytics.int_deal_changes_dedupe_new_deal  [RUN]
[0m16:34:28.405127 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_activity_join_activity_type, now model.enpal_assessment_project.int_deal_changes_dedupe_new_deal)
[0m16:34:28.405566 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m16:34:28.408697 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m16:34:28.409882 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m16:34:28.413927 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m16:34:28.414995 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m16:34:28.415624 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: BEGIN
[0m16:34:28.416110 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:28.433827 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m16:34:28.434597 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m16:34:28.435102 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"} */

  create view "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_tmp"
    
    
  as (
    -- This intermediate model does the following:
	-- Separates new deals from the deal_changes model
	-- Deduplicates a handful of dupe deals in the deal_changes model
	  -- Assumption: deals should not have more than one added date
	  -- Assumption: the latest added date is the one that should be presented to the model
	  -- Method: simple MAX

-- materialized view to apply built-in test unique values after dedupe


SELECT
	deal_id, 
	MAX(change_time) AS created_time
FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
WHERE changed_field_key = 'add_time'
GROUP BY
	deal_id
  );
[0m16:34:28.438528 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m16:34:28.441788 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m16:34:28.442262 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"} */
alter table "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_tmp" rename to "int_deal_changes_dedupe_new_deal"
[0m16:34:28.443870 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:28.445422 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: COMMIT
[0m16:34:28.445869 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m16:34:28.446277 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: COMMIT
[0m16:34:28.448126 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m16:34:28.450607 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_backup"
[0m16:34:28.451313 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m16:34:28.451779 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"} */
drop view if exists "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_backup" cascade
[0m16:34:28.453164 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m16:34:28.454756 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: Close
[0m16:34:28.455348 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1196f713-62b3-4d92-8f04-1f1103e51542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1100114f0>]}
[0m16:34:28.456025 [info ] [Thread-1 (]: 28 of 35 OK created sql view model public_pipedrive_analytics.int_deal_changes_dedupe_new_deal  [[32mCREATE VIEW[0m in 0.05s]
[0m16:34:28.456761 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m16:34:28.457275 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_user
[0m16:34:28.457824 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_dedupe_new_deal, now model.enpal_assessment_project.int_deal_changes_user)
[0m16:34:28.458332 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_user
[0m16:34:28.461305 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_user"
[0m16:34:28.462835 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_user
[0m16:34:28.463373 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m16:34:28.464005 [info ] [Thread-1 (]: 29 of 35 START sql view model public_pipedrive_analytics.int_deal_changes_dedupe_lost_reason  [RUN]
[0m16:34:28.464595 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_user, now model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason)
[0m16:34:28.465066 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m16:34:28.468575 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m16:34:28.469448 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m16:34:28.473270 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m16:34:28.474407 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m16:34:28.474928 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: BEGIN
[0m16:34:28.475360 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:28.493150 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m16:34:28.493821 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m16:34:28.494349 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"} */

  create view "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_tmp"
    
    
  as (
    -- This intermediate model does the following:
	-- Separates the lost reason from the deal_changes model
	-- Adds the friendly lost reason label to the deal_changes data.
	-- Deduplicates a handful of dupe deals in the deal_changes model
		-- Assumption: deals should not have more than one lost reason
		-- Assumption: the latest lost reason is the one that should be presented to the model
		-- Method: row_number in reverse order and then pick the first row. 
		-- This pattern is better when we don't know how many duplicate rows there could be, but the latest will always be row number 1.
		-- Can't just take MAX(new_value) as was done for new_deals, because that would pick the largest given lost reason id, which would be incorrect.

-- materialized view to apply built-in test unique values after dedupe


WITH deal_changes_lost_reason AS (
	SELECT
		ROW_NUMBER() OVER(PARTITION BY deal_id ORDER BY change_time DESC) AS reverse_order,
		deal_id,
		new_value AS lost_reason_id,
		change_time,
		month_name,
		month_number
	FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
	WHERE changed_field_key = 'lost_reason'
),
deal_changes_lost_reason_cast_id AS (
	SELECT
		deal_id,
		CAST(lost_reason_id AS INTEGER) AS lost_reason_id, -- do it here once rather than twice in the final select & join clauses
		change_time,
		month_name,
		month_number
	FROM deal_changes_lost_reason
	WHERE reverse_order = 1
)
SELECT
dcr.deal_id,
dcr.lost_reason_id,
lost_reasons.label,
dcr.change_time,
dcr.month_name,
dcr.month_number
FROM deal_changes_lost_reason_cast_id dcr
INNER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons" lost_reasons
ON dcr.lost_reason_id = lost_reasons.id
  );
[0m16:34:28.498249 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m16:34:28.501536 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m16:34:28.502009 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"} */
alter table "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_tmp" rename to "int_deal_changes_dedupe_lost_reason"
[0m16:34:28.503775 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:28.505335 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: COMMIT
[0m16:34:28.505794 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m16:34:28.506208 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: COMMIT
[0m16:34:28.507994 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m16:34:28.510538 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_backup"
[0m16:34:28.511189 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m16:34:28.511672 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"} */
drop view if exists "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_backup" cascade
[0m16:34:28.513155 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m16:34:28.514724 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: Close
[0m16:34:28.515304 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1196f713-62b3-4d92-8f04-1f1103e51542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110df9550>]}
[0m16:34:28.515973 [info ] [Thread-1 (]: 29 of 35 OK created sql view model public_pipedrive_analytics.int_deal_changes_dedupe_lost_reason  [[32mCREATE VIEW[0m in 0.05s]
[0m16:34:28.516864 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m16:34:28.517438 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m16:34:28.518133 [info ] [Thread-1 (]: 30 of 35 START sql view model public_pipedrive_analytics.int_deal_changes_dedupe_stage  [RUN]
[0m16:34:28.518893 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason, now model.enpal_assessment_project.int_deal_changes_dedupe_stage)
[0m16:34:28.519372 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m16:34:28.524305 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m16:34:28.525679 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m16:34:28.529383 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m16:34:28.530187 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m16:34:28.530644 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: BEGIN
[0m16:34:28.531049 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:28.548318 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:28.548929 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m16:34:28.549460 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_stage"} */

  create view "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_tmp"
    
    
  as (
    -- This intermediate model does the following:
	-- Separates the stages from the deal_changes model
	-- Adds the friendly stages label to the deal_changes data.
	-- Deduplicates a handful of dupe deals in the deal_changes model
		-- Assumption: deals should not arrive at the same stage more than once
			-- Note: it might be possible in the real world, but this rule was checked by looking at the deals that also had more than one add date, which definitely seems incorrect.
		-- Assumption: the latest lost reason is the one that should be presented to the model
		-- Method: row_number in reverse order and then pick the first row. 
		-- This pattern is better when we don't know how many duplicate rows there could be, but the latest will always be row number 1.
		-- Can't just take MAX(new_value) as was done for new_deals, because that would pick the largest given lost reason id, which would be incorrect.

-- materialized view to apply built-in test unique values after dedupe


WITH deal_changes_stage AS (
	SELECT
		ROW_NUMBER() OVER(PARTITION BY deal_id, new_value ORDER BY new_value, change_time DESC) AS reverse_order,
		deal_id,
		new_value AS stage_id,
		change_time,
		month_name,
		month_number
	FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
	WHERE changed_field_key = 'stage_id'
),
deal_changes_stage_cast_id AS (
	SELECT
		deal_id,
		CAST(stage_id AS INTEGER) AS stage_id, -- do it here once rather than twice in the final select & join clauses
		change_time,
		month_name,
		month_number
	FROM deal_changes_stage
	WHERE reverse_order = 1
)
SELECT
dcs.deal_id,
dcs.stage_id,
stages.label,
dcs.change_time,
dcs.month_name,
dcs.month_number
FROM deal_changes_stage_cast_id dcs
INNER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages" stages
ON dcs.stage_id = stages.id
  );
[0m16:34:28.554656 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m16:34:28.557883 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m16:34:28.558345 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_stage"} */
alter table "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_tmp" rename to "int_deal_changes_dedupe_stage"
[0m16:34:28.560082 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:28.561616 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: COMMIT
[0m16:34:28.562061 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m16:34:28.562471 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: COMMIT
[0m16:34:28.564605 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:34:28.567224 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_backup"
[0m16:34:28.568074 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m16:34:28.568630 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_stage"} */
drop view if exists "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_backup" cascade
[0m16:34:28.570140 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m16:34:28.571734 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: Close
[0m16:34:28.572348 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1196f713-62b3-4d92-8f04-1f1103e51542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fb2c560>]}
[0m16:34:28.573093 [info ] [Thread-1 (]: 30 of 35 OK created sql view model public_pipedrive_analytics.int_deal_changes_dedupe_stage  [[32mCREATE VIEW[0m in 0.05s]
[0m16:34:28.573873 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m16:34:28.574433 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m16:34:28.575230 [info ] [Thread-1 (]: 31 of 35 START test unique_int_deal_changes_dedupe_new_deal_deal_id ............ [RUN]
[0m16:34:28.575845 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_dedupe_stage, now test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc)
[0m16:34:28.576298 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m16:34:28.583074 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m16:34:28.584515 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m16:34:28.587002 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m16:34:28.587823 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m16:34:28.588261 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: BEGIN
[0m16:34:28.588661 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:28.605835 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:28.606440 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m16:34:28.606945 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    deal_id as unique_field,
    count(*) as n_records

from "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal"
where deal_id is not null
group by deal_id
having count(*) > 1



      
    ) dbt_internal_test
[0m16:34:28.613062 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.006 seconds
[0m16:34:28.615053 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: ROLLBACK
[0m16:34:28.616481 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: Close
[0m16:34:28.617213 [info ] [Thread-1 (]: 31 of 35 PASS unique_int_deal_changes_dedupe_new_deal_deal_id .................. [[32mPASS[0m in 0.04s]
[0m16:34:28.618194 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m16:34:28.618717 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m16:34:28.619164 [info ] [Thread-1 (]: 32 of 35 START test unique_int_deal_changes_dedupe_lost_reason_deal_id ......... [RUN]
[0m16:34:28.619949 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc, now test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907)
[0m16:34:28.620455 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m16:34:28.624717 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m16:34:28.625602 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m16:34:28.627892 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m16:34:28.628679 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m16:34:28.629113 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: BEGIN
[0m16:34:28.629513 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:28.646795 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:28.647514 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m16:34:28.647979 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    deal_id as unique_field,
    count(*) as n_records

from "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason"
where deal_id is not null
group by deal_id
having count(*) > 1



      
    ) dbt_internal_test
[0m16:34:28.656118 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.008 seconds
[0m16:34:28.657925 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: ROLLBACK
[0m16:34:28.659420 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: Close
[0m16:34:28.660172 [info ] [Thread-1 (]: 32 of 35 PASS unique_int_deal_changes_dedupe_lost_reason_deal_id ............... [[32mPASS[0m in 0.04s]
[0m16:34:28.660907 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m16:34:28.661424 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_unique_deal_stage
[0m16:34:28.661866 [info ] [Thread-1 (]: 33 of 35 START test assert_unique_deal_stage ................................... [RUN]
[0m16:34:28.662531 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907, now test.enpal_assessment_project.assert_unique_deal_stage)
[0m16:34:28.663015 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_unique_deal_stage
[0m16:34:28.665881 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_unique_deal_stage"
[0m16:34:28.666654 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_unique_deal_stage
[0m16:34:28.669080 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_unique_deal_stage"
[0m16:34:28.670385 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_unique_deal_stage"
[0m16:34:28.670942 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: BEGIN
[0m16:34:28.671353 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:28.689415 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m16:34:28.690170 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_unique_deal_stage"
[0m16:34:28.690738 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_unique_deal_stage"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- Assert that there are no duplicate deal-stage pairs in the deal changes table
SELECT
    COUNT(*),
    deal_id,
    stage_id
FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage"
GROUP BY
    deal_id,
    stage_id
HAVING COUNT(*) > 1
      
    ) dbt_internal_test
[0m16:34:28.712792 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.022 seconds
[0m16:34:28.714535 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: ROLLBACK
[0m16:34:28.715908 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: Close
[0m16:34:28.716616 [info ] [Thread-1 (]: 33 of 35 PASS assert_unique_deal_stage ......................................... [[32mPASS[0m in 0.05s]
[0m16:34:28.717491 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_unique_deal_stage
[0m16:34:28.718095 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_activity
[0m16:34:28.718723 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_unique_deal_stage, now model.enpal_assessment_project.int_deal_changes_activity)
[0m16:34:28.719188 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_activity
[0m16:34:28.725314 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_activity"
[0m16:34:28.726456 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_activity
[0m16:34:28.727290 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.mrt_deals_stages
[0m16:34:28.727851 [info ] [Thread-1 (]: 34 of 35 START sql table model public_pipedrive_analytics.mrt_deals_stages ..... [RUN]
[0m16:34:28.728361 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_activity, now model.enpal_assessment_project.mrt_deals_stages)
[0m16:34:28.728799 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.mrt_deals_stages
[0m16:34:28.741755 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.mrt_deals_stages"
[0m16:34:28.742584 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.mrt_deals_stages
[0m16:34:28.768202 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.mrt_deals_stages"
[0m16:34:28.769503 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m16:34:28.770019 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: BEGIN
[0m16:34:28.770421 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:28.787722 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:34:28.788335 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m16:34:28.788924 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */

  
    

  create  table "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_tmp"
  
  
    as
  
  (
    -- This mart model provides a breakdown by month of all deals and their stages, minor stages, and activities.
WITH  __dbt__cte__int_activity_join_activity_type as (
-- Simple intermediate model to join activity and activity_types
-- thus providing the friendly name of the activity type for downstream models
SELECT
	a.user_id,
	a.deal_id,
	t.activity_name,
	ms.stage_id,
	ms.minor_stage_id,
	t.is_active, -- this would be a mart level filter: business logic determines when to include deactivated activity types
	a.is_done, -- this would be a report level filter: analyst determines when to exclude incomplete activities
	a.due_time,
	a.month_name,
	a.month_number
FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity" a
INNER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types" t
	ON a.activity_type = t.activity_type
INNER JOIN "postgres"."public"."minor_stages" ms
	ON t.activity_type = ms.activity_type
),  __dbt__cte__int_deal_changes_activity as (
-- brings in the activity data for deals in the deal_changes table with the same deal_id
-- These will just be the ones with call activities against them

-- Note that there are very few rows compared to the total number of deals
    -- This is because there are very few matching deal ids in deal_changes and activity tables
    -- I have looked at whether this can be an out by N error on the ids but didn't find a fix
-- Potential problem? Why are there so many rows in the activity table with deal ids that don't exist in the deal_changes table?

SELECT
    nd.deal_id,
    act.activity_name,
    act.stage_id,
    act.minor_stage_id,
    act.is_active, -- this would be a mart level filter: business logic determines when to include deactivated activity types
    act.is_done, -- this would be a report level filter: analyst determines when to exclude incomplete activities
    act.month_number,
    act.month_name
FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal" nd
INNER JOIN __dbt__cte__int_activity_join_activity_type act -- result of INNER JOIN is very few rows. Is it a problem?
ON nd.deal_id = act.deal_id
), all_deal_changes_and_activity AS (
    SELECT
        deal_id,
        stage_id,
        minor_stage_id,
        is_done, -- this would be a report level filter: analyst determines when to exclude incomplete activities
        activity_name AS label,
        month_name,
        month_number
    FROM __dbt__cte__int_deal_changes_activity
    WHERE is_active = TRUE -- Mart level filter, most business users will ignore e.g. 'Follow Up Call' that is set to be inactive
    UNION ALL
    SELECT
        deal_id,
        stage_id,
        NULL AS minor_stage_id,
        NULL AS is_done,
        label,
        month_name,
        month_number
    FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage"
)
SELECT
    nd.deal_id,
    dca.stage_id,
    dca.minor_stage_id,
    dca.is_done,
    dca.label,
    dca.month_name,
    dca.month_number
FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal" nd -- Only deals from the deal_changes model (these have a created_time)
LEFT OUTER JOIN all_deal_changes_and_activity dca -- This will pick up the minor stages/activities where they exist for this set of deals
    ON nd.deal_id = dca.deal_id
  );
  
[0m16:34:28.832351 [debug] [Thread-1 (]: SQL status: SELECT 8895 in 0.043 seconds
[0m16:34:28.835724 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m16:34:28.836251 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */
alter table "postgres"."public_pipedrive_analytics"."mrt_deals_stages" rename to "mrt_deals_stages__dbt_backup"
[0m16:34:28.837931 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:28.841231 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m16:34:28.841703 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */
alter table "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_tmp" rename to "mrt_deals_stages"
[0m16:34:28.843276 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:28.848697 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: COMMIT
[0m16:34:28.849161 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m16:34:28.849566 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: COMMIT
[0m16:34:28.853826 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m16:34:28.856544 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_backup"
[0m16:34:28.859704 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m16:34:28.860178 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */
drop table if exists "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_backup" cascade
[0m16:34:28.863672 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.003 seconds
[0m16:34:28.865273 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: Close
[0m16:34:28.865882 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1196f713-62b3-4d92-8f04-1f1103e51542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110fa2570>]}
[0m16:34:28.866564 [info ] [Thread-1 (]: 34 of 35 OK created sql table model public_pipedrive_analytics.mrt_deals_stages  [[32mSELECT 8895[0m in 0.14s]
[0m16:34:28.867281 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.mrt_deals_stages
[0m16:34:28.868049 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m16:34:28.868802 [info ] [Thread-1 (]: 35 of 35 START sql view model public_pipedrive_analytics.rep_sales_funnel_monthly  [RUN]
[0m16:34:28.869646 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.mrt_deals_stages, now model.enpal_assessment_project.rep_sales_funnel_monthly)
[0m16:34:28.870108 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m16:34:28.873103 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m16:34:28.873874 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m16:34:28.877376 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m16:34:28.878648 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m16:34:28.879097 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: BEGIN
[0m16:34:28.879541 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:28.898117 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m16:34:28.898773 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m16:34:28.899291 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.rep_sales_funnel_monthly"} */

  create view "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_tmp"
    
    
  as (
    -- ASSUMPTIONS FOR THIS MODEL:
-- Show the number of deals in each stage of the sales funnel, for each month
	-- I am presenting a historical view, each deal stage at the time it happened
	-- (alternative would have been snapshot of final stages of each deal, that's not what I'm doing here)
    -- Although we have models for users, they are not needed/requested in this model
    -- Although we have models for lost deals
        -- we are showing the stage the deal was in at the time of the activity 
        -- whether or not it was closed in the end
        -- If it was not closed in the end, it just doesn't get counted in the Closing or later stages
        -- so it doesn't appear necessary to use the lost reasons model
	-- As noted in the intermediate model, we are excluding inactive activities
	-- As noted in the intermediate model, there are hardly any activities with deal_ids also in the deal_changes table
		-- this results in very entries for steps 2.1 and 3.1 (only two, in fact)

-- create the funnel steps as requested
WITH funnel_step_from_stages AS (
	SELECT
		deal_id,
		month_number,
		month_name,
		CONCAT(stage_id, 
			CASE
				WHEN minor_stage_id IS NULL THEN ''
				ELSE CONCAT('.', minor_stage_id)
			END
		) AS funnel_step,
		label AS kpi_name
	FROM "postgres"."public_pipedrive_analytics"."mrt_deals_stages" AS funnel
    WHERE COALESCE(is_done, TRUE) -- report level filter: exclude incomplete activities
),
-- aggregate CTE then order, to avoid having to keep the order columns in the view
monthly_agg AS (
	SELECT
		COUNT(deal_id) AS deals_count,
		month_number,
		month_name,
		funnel_step,
		kpi_name
	FROM funnel_step_from_stages
	GROUP BY
		month_number,
		month_name,
		funnel_step,
		kpi_name
)
-- final query with ordering
SELECT
	month_name AS month,
	kpi_name,
	funnel_step,
	deals_count
	FROM monthly_agg
ORDER BY month_number, funnel_step
  );
[0m16:34:28.903425 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m16:34:28.906716 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m16:34:28.907175 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.rep_sales_funnel_monthly"} */
alter table "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_tmp" rename to "rep_sales_funnel_monthly"
[0m16:34:28.908924 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:34:28.910426 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: COMMIT
[0m16:34:28.910871 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m16:34:28.911389 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: COMMIT
[0m16:34:28.913876 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:34:28.916606 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_backup"
[0m16:34:28.917553 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m16:34:28.918056 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.rep_sales_funnel_monthly"} */
drop view if exists "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_backup" cascade
[0m16:34:28.919582 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m16:34:28.921246 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: Close
[0m16:34:28.921837 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1196f713-62b3-4d92-8f04-1f1103e51542', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f58350>]}
[0m16:34:28.922536 [info ] [Thread-1 (]: 35 of 35 OK created sql view model public_pipedrive_analytics.rep_sales_funnel_monthly  [[32mCREATE VIEW[0m in 0.05s]
[0m16:34:28.923260 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m16:34:28.924606 [debug] [MainThread]: Using postgres connection "master"
[0m16:34:28.925030 [debug] [MainThread]: On master: BEGIN
[0m16:34:28.925381 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:34:28.944019 [debug] [MainThread]: SQL status: BEGIN in 0.019 seconds
[0m16:34:28.944762 [debug] [MainThread]: On master: COMMIT
[0m16:34:28.945280 [debug] [MainThread]: Using postgres connection "master"
[0m16:34:28.945852 [debug] [MainThread]: On master: COMMIT
[0m16:34:28.947690 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:34:28.948149 [debug] [MainThread]: On master: Close
[0m16:34:28.948740 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:34:28.949151 [debug] [MainThread]: Connection 'model.enpal_assessment_project.rep_sales_funnel_monthly' was properly closed.
[0m16:34:28.949681 [info ] [MainThread]: 
[0m16:34:28.950144 [info ] [MainThread]: Finished running 12 view models, 1 seed, 21 data tests, 1 table model in 0 hours 0 minutes and 2.33 seconds (2.33s).
[0m16:34:28.958056 [debug] [MainThread]: Command end result
[0m16:34:28.998635 [info ] [MainThread]: 
[0m16:34:28.999151 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:34:28.999571 [info ] [MainThread]: 
[0m16:34:28.999993 [info ] [MainThread]: Done. PASS=35 WARN=0 ERROR=0 SKIP=0 TOTAL=35
[0m16:34:29.001771 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 3.3186598, "process_in_blocks": "0", "process_kernel_time": 0.382006, "process_mem_max_rss": "113389568", "process_out_blocks": "0", "process_user_time": 3.716776}
[0m16:34:29.002705 [debug] [MainThread]: Command `dbt build` succeeded at 16:34:29.002493 after 3.32 seconds
[0m16:34:29.003279 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bd2ed50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d76b7a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d9ccda0>]}
[0m16:34:29.003736 [debug] [MainThread]: Flushing usage events
[0m16:44:51.577108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064fb9e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106abf4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106abeff0>]}


============================== 16:44:51.583131 | 811d7115-d333-46ff-8e4d-366db989b193 ==============================
[0m16:44:51.583131 [info ] [MainThread]: Running with dbt=1.8.9
[0m16:44:51.583832 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/julian/Documents/hatvalues_repo/dbt_enpal_assessment', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/julian/Documents/hatvalues_repo/dbt_enpal_assessment/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt build', 'send_anonymous_usage_stats': 'True'}
[0m16:44:51.864042 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '811d7115-d333-46ff-8e4d-366db989b193', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b92150>]}
[0m16:44:51.929550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '811d7115-d333-46ff-8e4d-366db989b193', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106aed430>]}
[0m16:44:51.930572 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m16:44:52.058163 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m16:44:52.226550 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 4 files changed.
[0m16:44:52.227419 [debug] [MainThread]: Partial parsing: updated file: enpal_assessment_project://models/intermediate/int_deal_changes_dedupe_lost_reason.sql
[0m16:44:52.227985 [debug] [MainThread]: Partial parsing: updated file: enpal_assessment_project://models/marts/mrt_deals_stages.sql
[0m16:44:52.228464 [debug] [MainThread]: Partial parsing: updated file: enpal_assessment_project://models/intermediate/int_deal_changes_dedupe_new_deal.sql
[0m16:44:52.228988 [debug] [MainThread]: Partial parsing: updated file: enpal_assessment_project://models/intermediate/int_deal_changes_user.sql
[0m16:44:52.491963 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m16:44:52.492600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '811d7115-d333-46ff-8e4d-366db989b193', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107954560>]}
[0m16:44:52.730430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '811d7115-d333-46ff-8e4d-366db989b193', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070322d0>]}
[0m16:44:52.897213 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '811d7115-d333-46ff-8e4d-366db989b193', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106095f40>]}
[0m16:44:52.897806 [info ] [MainThread]: Found 16 models, 21 data tests, 1 seed, 6 sources, 430 macros
[0m16:44:52.902386 [info ] [MainThread]: 
[0m16:44:52.903092 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:44:52.908576 [debug] [ThreadPool]: Acquiring new postgres connection 'list_postgres'
[0m16:44:52.972009 [debug] [ThreadPool]: Using postgres connection "list_postgres"
[0m16:44:52.972499 [debug] [ThreadPool]: On list_postgres: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
[0m16:44:52.972873 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:44:53.004525 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.032 seconds
[0m16:44:53.006186 [debug] [ThreadPool]: On list_postgres: Close
[0m16:44:53.008885 [debug] [ThreadPool]: Using postgres connection "list_postgres"
[0m16:44:53.009464 [debug] [ThreadPool]: On list_postgres: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
[0m16:44:53.009851 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:44:53.026425 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.016 seconds
[0m16:44:53.028005 [debug] [ThreadPool]: On list_postgres: Close
[0m16:44:53.030387 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_postgres, now list_postgres_public)
[0m16:44:53.037412 [debug] [ThreadPool]: Using postgres connection "list_postgres_public"
[0m16:44:53.037858 [debug] [ThreadPool]: On list_postgres_public: BEGIN
[0m16:44:53.038193 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:44:53.053666 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m16:44:53.054248 [debug] [ThreadPool]: Using postgres connection "list_postgres_public"
[0m16:44:53.054692 [debug] [ThreadPool]: On list_postgres_public: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres_public"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'postgres' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m16:44:53.058702 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.004 seconds
[0m16:44:53.060402 [debug] [ThreadPool]: On list_postgres_public: ROLLBACK
[0m16:44:53.061677 [debug] [ThreadPool]: On list_postgres_public: Close
[0m16:44:53.062416 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_postgres_public, now list_postgres_public_pipedrive_analytics)
[0m16:44:53.066171 [debug] [ThreadPool]: Using postgres connection "list_postgres_public_pipedrive_analytics"
[0m16:44:53.066594 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: BEGIN
[0m16:44:53.066934 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:44:53.082128 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m16:44:53.082855 [debug] [ThreadPool]: Using postgres connection "list_postgres_public_pipedrive_analytics"
[0m16:44:53.083346 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "list_postgres_public_pipedrive_analytics"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_pipedrive_analytics'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_pipedrive_analytics'
    union all
    select
      'postgres' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_pipedrive_analytics'
  
[0m16:44:53.088111 [debug] [ThreadPool]: SQL status: SELECT 13 in 0.004 seconds
[0m16:44:53.089909 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: ROLLBACK
[0m16:44:53.091177 [debug] [ThreadPool]: On list_postgres_public_pipedrive_analytics: Close
[0m16:44:53.099170 [debug] [MainThread]: Using postgres connection "master"
[0m16:44:53.099633 [debug] [MainThread]: On master: BEGIN
[0m16:44:53.100053 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:44:53.115899 [debug] [MainThread]: SQL status: BEGIN in 0.016 seconds
[0m16:44:53.116525 [debug] [MainThread]: Using postgres connection "master"
[0m16:44:53.117010 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:44:53.121816 [debug] [MainThread]: SQL status: SELECT 14 in 0.004 seconds
[0m16:44:53.126653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '811d7115-d333-46ff-8e4d-366db989b193', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079894c0>]}
[0m16:44:53.127157 [debug] [MainThread]: On master: ROLLBACK
[0m16:44:53.129357 [debug] [MainThread]: Using postgres connection "master"
[0m16:44:53.129777 [debug] [MainThread]: On master: BEGIN
[0m16:44:53.131789 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m16:44:53.132379 [debug] [MainThread]: On master: COMMIT
[0m16:44:53.132868 [debug] [MainThread]: Using postgres connection "master"
[0m16:44:53.133243 [debug] [MainThread]: On master: COMMIT
[0m16:44:53.134631 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:44:53.135136 [debug] [MainThread]: On master: Close
[0m16:44:53.135749 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:44:53.136233 [info ] [MainThread]: 
[0m16:44:53.138803 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.base_pipedrive__fields
[0m16:44:53.139574 [info ] [Thread-1 (]: 1 of 35 START sql view model public_pipedrive_analytics.base_pipedrive__fields . [RUN]
[0m16:44:53.140173 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_postgres_public_pipedrive_analytics, now model.enpal_assessment_project.base_pipedrive__fields)
[0m16:44:53.140617 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.base_pipedrive__fields
[0m16:44:53.150973 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.base_pipedrive__fields"
[0m16:44:53.151992 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.base_pipedrive__fields
[0m16:44:53.193209 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.base_pipedrive__fields"
[0m16:44:53.194225 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m16:44:53.194657 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: BEGIN
[0m16:44:53.195052 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:53.211130 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:44:53.211839 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m16:44:53.212350 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */

  create view "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_tmp"
    
    
  as (
    -- Simple base model to connect to the source table
-- This table has JSON array values that need to be unpacked
-- Those unpacked values will be set up as reference nodes in the staging layer
SELECT *
FROM "postgres"."public"."fields"
  );
[0m16:44:53.215123 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m16:44:53.222435 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m16:44:53.222952 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */
alter table "postgres"."public_pipedrive_analytics"."base_pipedrive__fields" rename to "base_pipedrive__fields__dbt_backup"
[0m16:44:53.224736 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:44:53.228114 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m16:44:53.228606 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */
alter table "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_tmp" rename to "base_pipedrive__fields"
[0m16:44:53.230465 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:44:53.248907 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: COMMIT
[0m16:44:53.249454 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m16:44:53.249877 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: COMMIT
[0m16:44:53.252861 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:44:53.260180 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_backup"
[0m16:44:53.266015 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.base_pipedrive__fields"
[0m16:44:53.266531 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.base_pipedrive__fields"} */
drop view if exists "postgres"."public_pipedrive_analytics"."base_pipedrive__fields__dbt_backup" cascade
[0m16:44:53.270561 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m16:44:53.273417 [debug] [Thread-1 (]: On model.enpal_assessment_project.base_pipedrive__fields: Close
[0m16:44:53.275183 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '811d7115-d333-46ff-8e4d-366db989b193', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105371400>]}
[0m16:44:53.276119 [info ] [Thread-1 (]: 1 of 35 OK created sql view model public_pipedrive_analytics.base_pipedrive__fields  [[32mCREATE VIEW[0m in 0.13s]
[0m16:44:53.277139 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.base_pipedrive__fields
[0m16:44:53.277798 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__activity
[0m16:44:53.278379 [info ] [Thread-1 (]: 2 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__activity  [RUN]
[0m16:44:53.279129 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.base_pipedrive__fields, now model.enpal_assessment_project.stg_pipedrive__activity)
[0m16:44:53.279606 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__activity
[0m16:44:53.283870 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__activity"
[0m16:44:53.284712 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__activity
[0m16:44:53.288616 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__activity"
[0m16:44:53.289666 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m16:44:53.290115 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: BEGIN
[0m16:44:53.290513 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:53.310327 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m16:44:53.311032 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m16:44:53.311548 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_tmp"
    
    
  as (
    -- Type is a reserved keyword. Renaming.
-- Rename others for consistency with other models
    -- model.id, model.reference_model_id
    -- bools are prefixed with is_ or has_
    -- convert date strings to timestamps and rename
-- add calculated month fields that will be used downstream

-- Potential problem? Activity ids are not unique on their own.
    -- Combinations repeating activity id with all other columns
    -- Not useful to create a composite unique check
    -- Does not seem to affect the overall task because the relationship to deal_id is more important

WITH base_activity AS (
    SELECT
        activity_id AS id,
        type AS activity_type,
        assigned_to_user AS user_id,
        deal_id,
        done AS is_done,
        due_to::TIMESTAMP AS due_time
    FROM "postgres"."public"."activity"
)
SELECT 
    id,
    activity_type,
    user_id,
    deal_id,
    is_done,
    due_time,
    
    EXTRACT(MONTH FROM due_time) AS month_number,
    TO_CHAR(due_time, 'Month') AS month_name

FROM base_activity
  );
[0m16:44:53.315302 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m16:44:53.318895 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m16:44:53.319386 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity" rename to "stg_pipedrive__activity__dbt_backup"
[0m16:44:53.321260 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:44:53.324968 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m16:44:53.325470 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_tmp" rename to "stg_pipedrive__activity"
[0m16:44:53.327310 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:44:53.329028 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: COMMIT
[0m16:44:53.329516 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m16:44:53.329927 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: COMMIT
[0m16:44:53.332002 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:44:53.335982 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_backup"
[0m16:44:53.336787 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity"
[0m16:44:53.337221 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity__dbt_backup" cascade
[0m16:44:53.340237 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m16:44:53.341851 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity: Close
[0m16:44:53.342447 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '811d7115-d333-46ff-8e4d-366db989b193', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10823dd00>]}
[0m16:44:53.343220 [info ] [Thread-1 (]: 2 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__activity  [[32mCREATE VIEW[0m in 0.06s]
[0m16:44:53.344011 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__activity
[0m16:44:53.344553 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m16:44:53.345433 [info ] [Thread-1 (]: 3 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__activity_types  [RUN]
[0m16:44:53.346167 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__activity, now model.enpal_assessment_project.stg_pipedrive__activity_types)
[0m16:44:53.346607 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m16:44:53.349306 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m16:44:53.350563 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m16:44:53.354638 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m16:44:53.355602 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m16:44:53.356078 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: BEGIN
[0m16:44:53.356627 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:53.376743 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m16:44:53.377324 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m16:44:53.377805 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_tmp"
    
    
  as (
    -- Type and Name are reserved keywords. Renaming.
-- The `active` column is a string with just two possible value. It makes more sense as a bool
SELECT
    id,
    name AS activity_name,
    CASE
        WHEN active = 'Yes' THEN TRUE
        ELSE FALSE
    END AS is_active,
    type AS activity_type
FROM "postgres"."public"."activity_types"
  );
[0m16:44:53.380745 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m16:44:53.384196 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m16:44:53.384649 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types" rename to "stg_pipedrive__activity_types__dbt_backup"
[0m16:44:53.386346 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:44:53.389551 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m16:44:53.390000 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_tmp" rename to "stg_pipedrive__activity_types"
[0m16:44:53.391687 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:44:53.393274 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: COMMIT
[0m16:44:53.393710 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m16:44:53.394117 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: COMMIT
[0m16:44:53.396179 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:44:53.398744 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_backup"
[0m16:44:53.399384 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__activity_types"
[0m16:44:53.399813 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__activity_types"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types__dbt_backup" cascade
[0m16:44:53.402620 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m16:44:53.404234 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__activity_types: Close
[0m16:44:53.404842 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '811d7115-d333-46ff-8e4d-366db989b193', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108224e90>]}
[0m16:44:53.405556 [info ] [Thread-1 (]: 3 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__activity_types  [[32mCREATE VIEW[0m in 0.06s]
[0m16:44:53.406326 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__activity_types
[0m16:44:53.406886 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m16:44:53.407623 [info ] [Thread-1 (]: 4 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__deal_changes  [RUN]
[0m16:44:53.408349 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__activity_types, now model.enpal_assessment_project.stg_pipedrive__deal_changes)
[0m16:44:53.408808 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m16:44:53.412018 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m16:44:53.412838 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m16:44:53.416293 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m16:44:53.417714 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m16:44:53.418213 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: BEGIN
[0m16:44:53.418618 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:53.439246 [debug] [Thread-1 (]: SQL status: BEGIN in 0.021 seconds
[0m16:44:53.439992 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m16:44:53.440477 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_tmp"
    
    
  as (
    -- This is not a source deals table, and deal_id is not a PK (UNIQUE)
    -- leave deal_id named as is to be consistent with naming convention model.reference_model_id
    -- convert date strings to timestamps and rename
-- add calculated month fields that will be used downstream
WITH base_deal_changes AS (
    SELECT
        deal_id,
        change_time::TIMESTAMP AS change_time,
        changed_field_key,
        new_value
    FROM "postgres"."public"."deal_changes"
)
SELECT
    deal_id,
    changed_field_key,
    new_value,
    change_time,
    
    EXTRACT(MONTH FROM change_time) AS month_number,
    TO_CHAR(change_time, 'Month') AS month_name

FROM base_deal_changes
  );
[0m16:44:53.443229 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m16:44:53.446822 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m16:44:53.447278 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes" rename to "stg_pipedrive__deal_changes__dbt_backup"
[0m16:44:53.449013 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:44:53.452230 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m16:44:53.452678 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_tmp" rename to "stg_pipedrive__deal_changes"
[0m16:44:53.454366 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:44:53.455964 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: COMMIT
[0m16:44:53.456419 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m16:44:53.456825 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: COMMIT
[0m16:44:53.458918 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:44:53.461597 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_backup"
[0m16:44:53.462235 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__deal_changes"
[0m16:44:53.462654 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__deal_changes"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes__dbt_backup" cascade
[0m16:44:53.466914 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m16:44:53.468593 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__deal_changes: Close
[0m16:44:53.469226 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '811d7115-d333-46ff-8e4d-366db989b193', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a7be00>]}
[0m16:44:53.470002 [info ] [Thread-1 (]: 4 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__deal_changes  [[32mCREATE VIEW[0m in 0.06s]
[0m16:44:53.470824 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__deal_changes
[0m16:44:53.471394 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__stages
[0m16:44:53.472341 [info ] [Thread-1 (]: 5 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__stages .. [RUN]
[0m16:44:53.473054 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__deal_changes, now model.enpal_assessment_project.stg_pipedrive__stages)
[0m16:44:53.473490 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__stages
[0m16:44:53.477937 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__stages"
[0m16:44:53.478811 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__stages
[0m16:44:53.484839 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__stages"
[0m16:44:53.486142 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m16:44:53.486666 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: BEGIN
[0m16:44:53.487191 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:53.503969 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:44:53.504682 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m16:44:53.505161 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_tmp"
    
    
  as (
    /* NOT USED UPSTREAM. 
    The values in this table also found in the JSON array of base_pipedrive__fields.
    I would rather standardise the way stages and lost_reasons are handled.
    My assumption is that base_pipedrive__fields holds the current values configured in the Pipedrive application,
    and if this were to be updated by a sysadmin, the static version of the stages table would not reflect the changes.
NOT USED UPSTREAM. */

-- Rename stage_id to id for consistency: model.id, model.reference_model_id
SELECT
    stage_id AS id,
    stage_name
FROM "postgres"."public"."stages"
  );
[0m16:44:53.507573 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m16:44:53.511219 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m16:44:53.511718 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages" rename to "stg_pipedrive__stages__dbt_backup"
[0m16:44:53.513302 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:44:53.516507 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m16:44:53.516972 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_tmp" rename to "stg_pipedrive__stages"
[0m16:44:53.518543 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:44:53.520132 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: COMMIT
[0m16:44:53.520566 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m16:44:53.520964 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: COMMIT
[0m16:44:53.522897 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m16:44:53.525489 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_backup"
[0m16:44:53.526146 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__stages"
[0m16:44:53.526581 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__stages"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__stages__dbt_backup" cascade
[0m16:44:53.529093 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m16:44:53.530703 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__stages: Close
[0m16:44:53.531298 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '811d7115-d333-46ff-8e4d-366db989b193', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108283530>]}
[0m16:44:53.532080 [info ] [Thread-1 (]: 5 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__stages  [[32mCREATE VIEW[0m in 0.06s]
[0m16:44:53.532850 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__stages
[0m16:44:53.533375 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__users
[0m16:44:53.534143 [info ] [Thread-1 (]: 6 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__users ... [RUN]
[0m16:44:53.534720 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__stages, now model.enpal_assessment_project.stg_pipedrive__users)
[0m16:44:53.535159 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__users
[0m16:44:53.538366 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__users"
[0m16:44:53.539617 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__users
[0m16:44:53.543400 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__users"
[0m16:44:53.544428 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m16:44:53.544949 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: BEGIN
[0m16:44:53.545457 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:53.567738 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m16:44:53.568426 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m16:44:53.568964 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_tmp"
    
    
  as (
    /* NOT USED UPSTREAM. 
    The requested report does not call for user information, so this model is not used anywhere upstream.
	This model is created for completeness of the investigative aspects of the task.
NOT USED UPSTREAM. */

-- Name is a reserved keyword. Renaming.
-- Convert date strings to timestamps and rename
-- Add calculated month fields that will be used downstream
WITH base_users AS (
    SELECT
        id,
        name AS user_name,
        email AS user_email,
        modified::TIMESTAMP AS modified_time
    FROM "postgres"."public"."users"
)
SELECT
    id,
    user_name,
    user_email,
    modified_time,
    
    EXTRACT(MONTH FROM modified_time) AS month_number,
    TO_CHAR(modified_time, 'Month') AS month_name

FROM base_users
  );
[0m16:44:53.572898 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m16:44:53.577351 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m16:44:53.577859 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__users" rename to "stg_pipedrive__users__dbt_backup"
[0m16:44:53.579773 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:44:53.583277 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m16:44:53.584164 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_tmp" rename to "stg_pipedrive__users"
[0m16:44:53.586403 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m16:44:53.588118 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: COMMIT
[0m16:44:53.588614 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m16:44:53.589037 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: COMMIT
[0m16:44:53.591374 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:44:53.594045 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_backup"
[0m16:44:53.594810 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__users"
[0m16:44:53.595256 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__users"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__users__dbt_backup" cascade
[0m16:44:53.597920 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m16:44:53.599496 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__users: Close
[0m16:44:53.600098 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '811d7115-d333-46ff-8e4d-366db989b193', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081d28d0>]}
[0m16:44:53.600825 [info ] [Thread-1 (]: 6 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__users  [[32mCREATE VIEW[0m in 0.07s]
[0m16:44:53.601763 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__users
[0m16:44:53.602341 [debug] [Thread-1 (]: Began running node seed.enpal_assessment_project.minor_stages
[0m16:44:53.603304 [info ] [Thread-1 (]: 7 of 35 START seed file public.minor_stages .................................... [RUN]
[0m16:44:53.603954 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__users, now seed.enpal_assessment_project.minor_stages)
[0m16:44:53.604413 [debug] [Thread-1 (]: Began compiling node seed.enpal_assessment_project.minor_stages
[0m16:44:53.604837 [debug] [Thread-1 (]: Began executing node seed.enpal_assessment_project.minor_stages
[0m16:44:53.635258 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m16:44:53.635849 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: BEGIN
[0m16:44:53.636271 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:53.651639 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m16:44:53.652332 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m16:44:53.652845 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "seed.enpal_assessment_project.minor_stages"} */
truncate table "postgres"."public"."minor_stages"
[0m16:44:53.655203 [debug] [Thread-1 (]: SQL status: TRUNCATE TABLE in 0.002 seconds
[0m16:44:53.727269 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m16:44:53.727863 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: 
          insert into "postgres"."public"."minor_stages" ("id", "activity_type", "stage_id", "minor_stage_id") values
          (%s,%s,%s,%s),(%s,%s,%s,%s)
      ...
[0m16:44:53.729880 [debug] [Thread-1 (]: SQL status: INSERT 0 2 in 0.001 seconds
[0m16:44:53.736696 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.enpal_assessment_project.minor_stages"
[0m16:44:53.739601 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: COMMIT
[0m16:44:53.740135 [debug] [Thread-1 (]: Using postgres connection "seed.enpal_assessment_project.minor_stages"
[0m16:44:53.740568 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: COMMIT
[0m16:44:53.743330 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:44:53.744317 [debug] [Thread-1 (]: On seed.enpal_assessment_project.minor_stages: Close
[0m16:44:53.744928 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '811d7115-d333-46ff-8e4d-366db989b193', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10783ec30>]}
[0m16:44:53.745579 [info ] [Thread-1 (]: 7 of 35 OK loaded seed file public.minor_stages ................................ [[32mINSERT 2[0m in 0.14s]
[0m16:44:53.746398 [debug] [Thread-1 (]: Finished running node seed.enpal_assessment_project.minor_stages
[0m16:44:53.746956 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m16:44:53.747741 [info ] [Thread-1 (]: 8 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__fields_lost_reasons  [RUN]
[0m16:44:53.748354 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.enpal_assessment_project.minor_stages, now model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons)
[0m16:44:53.748826 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m16:44:53.751808 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m16:44:53.752593 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m16:44:53.755990 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m16:44:53.757409 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m16:44:53.758020 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: BEGIN
[0m16:44:53.758501 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:53.774616 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:44:53.775181 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m16:44:53.775680 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_tmp"
    
    
  as (
    -- `base_pipedrive__fields` model has the values buried in a JSON array.
-- Make sure ids are INTEGER and not numeric-looking STRING 
	-- it is better to convert here even though CASTING is also required in the referential test.
	-- because in the real world, collaborators would be confused to see numeric-looking values as STRINGs.
WITH expand_array AS (
	SELECT 
		jsonb_array_elements(field_value_options) AS field_value_options
	FROM "postgres"."public_pipedrive_analytics"."base_pipedrive__fields"
	WHERE field_key = 'lost_reason'
)
SELECT
	CAST(field_value_options ->> 'id' AS INTEGER) AS id,
	field_value_options ->> 'label' AS label
FROM expand_array
  );
[0m16:44:53.778749 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m16:44:53.781997 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m16:44:53.782454 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_tmp" rename to "stg_pipedrive__fields_lost_reasons"
[0m16:44:53.784161 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:44:53.785699 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: COMMIT
[0m16:44:53.786176 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m16:44:53.786618 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: COMMIT
[0m16:44:53.788448 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m16:44:53.790936 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_backup"
[0m16:44:53.791590 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"
[0m16:44:53.792019 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons__dbt_backup" cascade
[0m16:44:53.793569 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m16:44:53.795195 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons: Close
[0m16:44:53.795776 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '811d7115-d333-46ff-8e4d-366db989b193', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108240c80>]}
[0m16:44:53.796511 [info ] [Thread-1 (]: 8 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__fields_lost_reasons  [[32mCREATE VIEW[0m in 0.05s]
[0m16:44:53.797260 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons
[0m16:44:53.797769 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m16:44:53.798509 [info ] [Thread-1 (]: 9 of 35 START sql view model public_pipedrive_analytics.stg_pipedrive__fields_stages  [RUN]
[0m16:44:53.799229 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__fields_lost_reasons, now model.enpal_assessment_project.stg_pipedrive__fields_stages)
[0m16:44:53.799760 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m16:44:53.802627 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m16:44:53.803817 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m16:44:53.807482 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m16:44:53.809044 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m16:44:53.809695 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: BEGIN
[0m16:44:53.810223 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:53.827967 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m16:44:53.828582 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m16:44:53.829116 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_stages"} */

  create view "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_tmp"
    
    
  as (
    -- `base_pipedrive__fields` model has the values buried in a JSON array.
-- Make sure ids are INTEGER and not numeric-looking STRING 
	-- it is better to convert here even though CASTING is also required in the referential test.
	-- because in the real world, collaborators would be confused to see numeric-looking values as STRINGs.
WITH expand_array AS (
	SELECT 
		jsonb_array_elements(field_value_options) AS field_value_options
	FROM "postgres"."public_pipedrive_analytics"."base_pipedrive__fields"
	WHERE field_key = 'stage_id'
)
SELECT
	CAST(field_value_options ->> 'id' AS INTEGER) AS id,
	field_value_options ->> 'label' AS label
FROM expand_array
  );
[0m16:44:53.832472 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m16:44:53.835956 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m16:44:53.836453 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_stages"} */
alter table "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_tmp" rename to "stg_pipedrive__fields_stages"
[0m16:44:53.838207 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:44:53.839733 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: COMMIT
[0m16:44:53.840183 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m16:44:53.840595 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: COMMIT
[0m16:44:53.842635 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:44:53.845163 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_backup"
[0m16:44:53.845961 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.stg_pipedrive__fields_stages"
[0m16:44:53.846730 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.stg_pipedrive__fields_stages"} */
drop view if exists "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages__dbt_backup" cascade
[0m16:44:53.848280 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m16:44:53.850044 [debug] [Thread-1 (]: On model.enpal_assessment_project.stg_pipedrive__fields_stages: Close
[0m16:44:53.850789 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '811d7115-d333-46ff-8e4d-366db989b193', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106fd9dc0>]}
[0m16:44:53.851844 [info ] [Thread-1 (]: 9 of 35 OK created sql view model public_pipedrive_analytics.stg_pipedrive__fields_stages  [[32mCREATE VIEW[0m in 0.05s]
[0m16:44:53.852821 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.stg_pipedrive__fields_stages
[0m16:44:53.853638 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m16:44:53.854341 [info ] [Thread-1 (]: 10 of 35 START test not_null_stg_pipedrive__activity_deal_id ................... [RUN]
[0m16:44:53.855113 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.stg_pipedrive__fields_stages, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e)
[0m16:44:53.855580 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m16:44:53.868501 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m16:44:53.869880 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m16:44:53.888294 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m16:44:53.889282 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m16:44:53.889766 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: BEGIN
[0m16:44:53.890167 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:53.906854 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:44:53.907617 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"
[0m16:44:53.908104 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select deal_id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where deal_id is null



      
    ) dbt_internal_test
[0m16:44:53.910764 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m16:44:53.914380 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: ROLLBACK
[0m16:44:53.915938 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e: Close
[0m16:44:53.916745 [info ] [Thread-1 (]: 10 of 35 PASS not_null_stg_pipedrive__activity_deal_id ......................... [[32mPASS[0m in 0.06s]
[0m16:44:53.917496 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e
[0m16:44:53.918020 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m16:44:53.918471 [info ] [Thread-1 (]: 11 of 35 START test not_null_stg_pipedrive__activity_due_time .................. [RUN]
[0m16:44:53.919214 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_deal_id.baf61bb80e, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191)
[0m16:44:53.919700 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m16:44:53.923825 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m16:44:53.924652 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m16:44:53.927146 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m16:44:53.928015 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m16:44:53.928452 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: BEGIN
[0m16:44:53.928854 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:53.948043 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m16:44:53.948789 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"
[0m16:44:53.949269 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select due_time
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where due_time is null



      
    ) dbt_internal_test
[0m16:44:53.952160 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m16:44:53.954079 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: ROLLBACK
[0m16:44:53.955736 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191: Close
[0m16:44:53.956511 [info ] [Thread-1 (]: 11 of 35 PASS not_null_stg_pipedrive__activity_due_time ........................ [[32mPASS[0m in 0.04s]
[0m16:44:53.957579 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191
[0m16:44:53.958225 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m16:44:53.958917 [info ] [Thread-1 (]: 12 of 35 START test not_null_stg_pipedrive__activity_id ........................ [RUN]
[0m16:44:53.959787 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_due_time.a110302191, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb)
[0m16:44:53.960393 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m16:44:53.964822 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m16:44:53.965725 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m16:44:53.968074 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m16:44:53.968869 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m16:44:53.969310 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: BEGIN
[0m16:44:53.969707 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:53.987051 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:44:53.987785 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"
[0m16:44:53.988285 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where id is null



      
    ) dbt_internal_test
[0m16:44:53.990910 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m16:44:53.992877 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: ROLLBACK
[0m16:44:53.994441 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb: Close
[0m16:44:53.995184 [info ] [Thread-1 (]: 12 of 35 PASS not_null_stg_pipedrive__activity_id .............................. [[32mPASS[0m in 0.04s]
[0m16:44:53.996050 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb
[0m16:44:53.996599 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m16:44:53.997109 [info ] [Thread-1 (]: 13 of 35 START test not_null_stg_pipedrive__activity_is_done ................... [RUN]
[0m16:44:53.997766 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_id.5590c96fbb, now test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543)
[0m16:44:53.998244 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m16:44:54.002406 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m16:44:54.003419 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m16:44:54.005790 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m16:44:54.007046 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m16:44:54.007523 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: BEGIN
[0m16:44:54.007949 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:54.026398 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m16:44:54.027169 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"
[0m16:44:54.027643 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select is_done
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
where is_done is null



      
    ) dbt_internal_test
[0m16:44:54.030116 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m16:44:54.031822 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: ROLLBACK
[0m16:44:54.033090 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543: Close
[0m16:44:54.033808 [info ] [Thread-1 (]: 13 of 35 PASS not_null_stg_pipedrive__activity_is_done ......................... [[32mPASS[0m in 0.04s]
[0m16:44:54.034544 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543
[0m16:44:54.035062 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m16:44:54.035640 [info ] [Thread-1 (]: 14 of 35 START test relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_  [RUN]
[0m16:44:54.036261 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__activity_is_done.1d7811c543, now test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8)
[0m16:44:54.036792 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m16:44:54.046005 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m16:44:54.046878 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m16:44:54.049211 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m16:44:54.050491 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m16:44:54.050970 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: BEGIN
[0m16:44:54.051387 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:54.069402 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m16:44:54.070216 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"
[0m16:44:54.070882 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select activity_type as from_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
    where activity_type is not null
),

parent as (
    select activity_type as to_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m16:44:54.075653 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.004 seconds
[0m16:44:54.077820 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: ROLLBACK
[0m16:44:54.079437 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8: Close
[0m16:44:54.080288 [info ] [Thread-1 (]: 14 of 35 PASS relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_  [[32mPASS[0m in 0.04s]
[0m16:44:54.081203 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8
[0m16:44:54.081788 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m16:44:54.082474 [info ] [Thread-1 (]: 15 of 35 START test accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time  [RUN]
[0m16:44:54.083258 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.relationships_stg_pipedrive__activity_activity_type__activity_type__ref_stg_pipedrive__activity_types_.7370c13ee8, now test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0)
[0m16:44:54.083741 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m16:44:54.095077 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m16:44:54.095967 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m16:44:54.098463 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m16:44:54.099417 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m16:44:54.099893 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: BEGIN
[0m16:44:54.100478 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:54.117884 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:44:54.118651 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"
[0m16:44:54.119169 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        changed_field_key as value_field,
        count(*) as n_records

    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
    group by changed_field_key

)

select *
from all_values
where value_field not in (
    'user_id','stage_id','lost_reason','add_time'
)



      
    ) dbt_internal_test
[0m16:44:54.124006 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.004 seconds
[0m16:44:54.125903 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: ROLLBACK
[0m16:44:54.127399 [debug] [Thread-1 (]: On test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0: Close
[0m16:44:54.128278 [info ] [Thread-1 (]: 15 of 35 PASS accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time  [[32mPASS[0m in 0.04s]
[0m16:44:54.129206 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0
[0m16:44:54.129776 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m16:44:54.130325 [info ] [Thread-1 (]: 16 of 35 START test assert_timestamp_equal_add_time_new_value .................. [RUN]
[0m16:44:54.131075 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.accepted_values_stg_pipedrive__deal_changes_changed_field_key__user_id__stage_id__lost_reason__add_time.84526954c0, now test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value)
[0m16:44:54.131548 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m16:44:54.134355 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m16:44:54.135173 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m16:44:54.139417 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m16:44:54.140292 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m16:44:54.140745 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: BEGIN
[0m16:44:54.141162 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:54.160663 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m16:44:54.161406 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"
[0m16:44:54.161872 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- Proving that the new_value field for add_time changes is redundant. We can just use the change_time.
SELECT * FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
	WHERE changed_field_key = 'add_time'
	AND change_time != new_value::TIMESTAMP
      
    ) dbt_internal_test
[0m16:44:54.167122 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m16:44:54.168906 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: ROLLBACK
[0m16:44:54.170342 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value: Close
[0m16:44:54.171064 [info ] [Thread-1 (]: 16 of 35 PASS assert_timestamp_equal_add_time_new_value ........................ [[32mPASS[0m in 0.04s]
[0m16:44:54.171838 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value
[0m16:44:54.172378 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m16:44:54.172998 [info ] [Thread-1 (]: 17 of 35 START test not_null_stg_pipedrive__deal_changes_change_time ........... [RUN]
[0m16:44:54.173694 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_timestamp_equal_add_time_new_value, now test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d)
[0m16:44:54.174188 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m16:44:54.178402 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m16:44:54.179403 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m16:44:54.181754 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m16:44:54.182572 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m16:44:54.183006 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: BEGIN
[0m16:44:54.183408 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:54.199783 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:44:54.200418 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"
[0m16:44:54.200970 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select change_time
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
where change_time is null



      
    ) dbt_internal_test
[0m16:44:54.204090 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m16:44:54.205826 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: ROLLBACK
[0m16:44:54.207156 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d: Close
[0m16:44:54.207889 [info ] [Thread-1 (]: 17 of 35 PASS not_null_stg_pipedrive__deal_changes_change_time ................. [[32mPASS[0m in 0.03s]
[0m16:44:54.208626 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d
[0m16:44:54.209146 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m16:44:54.209743 [info ] [Thread-1 (]: 18 of 35 START test not_null_stg_pipedrive__deal_changes_deal_id ............... [RUN]
[0m16:44:54.210504 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_change_time.aa9805807d, now test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d)
[0m16:44:54.210991 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m16:44:54.215327 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m16:44:54.216159 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m16:44:54.218510 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m16:44:54.219311 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m16:44:54.219746 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: BEGIN
[0m16:44:54.220148 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:54.237933 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m16:44:54.238632 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"
[0m16:44:54.239117 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select deal_id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
where deal_id is null



      
    ) dbt_internal_test
[0m16:44:54.242136 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m16:44:54.243924 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: ROLLBACK
[0m16:44:54.245265 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d: Close
[0m16:44:54.246211 [info ] [Thread-1 (]: 18 of 35 PASS not_null_stg_pipedrive__deal_changes_deal_id ..................... [[32mPASS[0m in 0.04s]
[0m16:44:54.247097 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d
[0m16:44:54.247616 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m16:44:54.248167 [info ] [Thread-1 (]: 19 of 35 START test not_null_stg_pipedrive__deal_changes_new_value ............. [RUN]
[0m16:44:54.248821 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_deal_id.6ebfdbb65d, now test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96)
[0m16:44:54.249276 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m16:44:54.253395 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m16:44:54.254211 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m16:44:54.256585 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m16:44:54.257419 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m16:44:54.257944 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: BEGIN
[0m16:44:54.258373 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:54.274455 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:44:54.275148 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"
[0m16:44:54.275695 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select new_value
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
where new_value is null



      
    ) dbt_internal_test
[0m16:44:54.279114 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m16:44:54.280940 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: ROLLBACK
[0m16:44:54.282319 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96: Close
[0m16:44:54.283055 [info ] [Thread-1 (]: 19 of 35 PASS not_null_stg_pipedrive__deal_changes_new_value ................... [[32mPASS[0m in 0.03s]
[0m16:44:54.283812 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96
[0m16:44:54.284327 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_change_user_references_user_id
[0m16:44:54.284768 [info ] [Thread-1 (]: 20 of 35 START test assert_change_user_references_user_id ...................... [RUN]
[0m16:44:54.285488 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__deal_changes_new_value.bb225b4f96, now test.enpal_assessment_project.assert_change_user_references_user_id)
[0m16:44:54.286125 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_change_user_references_user_id
[0m16:44:54.290469 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m16:44:54.291367 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_change_user_references_user_id
[0m16:44:54.293989 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m16:44:54.294855 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m16:44:54.295291 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: BEGIN
[0m16:44:54.295687 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:54.311646 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:44:54.312412 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_user_references_user_id"
[0m16:44:54.313321 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_change_user_references_user_id"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- CTE to pre-filter deal_changes for stage_id changes
-- to safely cast new_value to an integer when we're sure all the values can be implicitly casted
WITH deal_change_user AS (
	
SELECT
    changed_field_key,
    new_value
FROM
    "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
WHERE
    changed_field_key = 'user_id'

)
SELECT *
FROM deal_change_user d
LEFT OUTER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__users" u
ON CAST(d.new_value AS INTEGER) = u.id
WHERE u.id IS NULL -- Any non referential values in d will return a NULL s.id
      
    ) dbt_internal_test
[0m16:44:54.319291 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m16:44:54.321044 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: ROLLBACK
[0m16:44:54.322544 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_user_references_user_id: Close
[0m16:44:54.323268 [info ] [Thread-1 (]: 20 of 35 PASS assert_change_user_references_user_id ............................ [[32mPASS[0m in 0.04s]
[0m16:44:54.324091 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_change_user_references_user_id
[0m16:44:54.324615 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m16:44:54.325138 [info ] [Thread-1 (]: 21 of 35 START test not_null_stg_pipedrive__users_id ........................... [RUN]
[0m16:44:54.325889 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_change_user_references_user_id, now test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817)
[0m16:44:54.326365 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m16:44:54.330510 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m16:44:54.331340 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m16:44:54.333609 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m16:44:54.334430 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m16:44:54.334882 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: BEGIN
[0m16:44:54.335363 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:54.353626 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m16:44:54.354247 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"
[0m16:44:54.354736 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select id
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where id is null



      
    ) dbt_internal_test
[0m16:44:54.357602 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m16:44:54.359469 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: ROLLBACK
[0m16:44:54.360817 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817: Close
[0m16:44:54.361530 [info ] [Thread-1 (]: 21 of 35 PASS not_null_stg_pipedrive__users_id ................................. [[32mPASS[0m in 0.04s]
[0m16:44:54.362321 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817
[0m16:44:54.362859 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m16:44:54.363361 [info ] [Thread-1 (]: 22 of 35 START test not_null_stg_pipedrive__users_modified_time ................ [RUN]
[0m16:44:54.364070 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_id.2e370a8817, now test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5)
[0m16:44:54.364531 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m16:44:54.368813 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m16:44:54.370079 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m16:44:54.375150 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m16:44:54.376025 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m16:44:54.376458 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: BEGIN
[0m16:44:54.376864 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:54.393609 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:44:54.394234 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"
[0m16:44:54.394722 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select modified_time
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where modified_time is null



      
    ) dbt_internal_test
[0m16:44:54.397101 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m16:44:54.398805 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: ROLLBACK
[0m16:44:54.400080 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5: Close
[0m16:44:54.400927 [info ] [Thread-1 (]: 22 of 35 PASS not_null_stg_pipedrive__users_modified_time ...................... [[32mPASS[0m in 0.04s]
[0m16:44:54.401762 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5
[0m16:44:54.402284 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m16:44:54.402885 [info ] [Thread-1 (]: 23 of 35 START test not_null_stg_pipedrive__users_user_email ................... [RUN]
[0m16:44:54.403524 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_modified_time.03287111d5, now test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157)
[0m16:44:54.403984 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m16:44:54.408264 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m16:44:54.409131 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m16:44:54.411907 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m16:44:54.412810 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m16:44:54.413256 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: BEGIN
[0m16:44:54.413656 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:54.431071 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:44:54.431847 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"
[0m16:44:54.432365 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select user_email
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where user_email is null



      
    ) dbt_internal_test
[0m16:44:54.435009 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m16:44:54.436799 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: ROLLBACK
[0m16:44:54.439656 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157: Close
[0m16:44:54.440765 [info ] [Thread-1 (]: 23 of 35 PASS not_null_stg_pipedrive__users_user_email ......................... [[32mPASS[0m in 0.04s]
[0m16:44:54.441898 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157
[0m16:44:54.442639 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m16:44:54.443574 [info ] [Thread-1 (]: 24 of 35 START test not_null_stg_pipedrive__users_user_name .................... [RUN]
[0m16:44:54.444780 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_user_email.ea967e8157, now test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5)
[0m16:44:54.445277 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m16:44:54.449609 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m16:44:54.450448 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m16:44:54.452728 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m16:44:54.453528 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m16:44:54.453967 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: BEGIN
[0m16:44:54.454371 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:54.471374 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:44:54.472061 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"
[0m16:44:54.472544 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select user_name
from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
where user_name is null



      
    ) dbt_internal_test
[0m16:44:54.475276 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m16:44:54.477173 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: ROLLBACK
[0m16:44:54.478623 [debug] [Thread-1 (]: On test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5: Close
[0m16:44:54.479403 [info ] [Thread-1 (]: 24 of 35 PASS not_null_stg_pipedrive__users_user_name .......................... [[32mPASS[0m in 0.03s]
[0m16:44:54.480189 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5
[0m16:44:54.480726 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m16:44:54.481266 [info ] [Thread-1 (]: 25 of 35 START test relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_  [RUN]
[0m16:44:54.481895 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.not_null_stg_pipedrive__users_user_name.3145d7edb5, now test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d)
[0m16:44:54.482356 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m16:44:54.488315 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m16:44:54.489231 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m16:44:54.491640 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m16:44:54.492652 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m16:44:54.493271 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: BEGIN
[0m16:44:54.493784 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:54.509752 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:44:54.510695 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"
[0m16:44:54.511263 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with child as (
    select user_id as from_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity"
    where user_id is not null
),

parent as (
    select id as to_field
    from "postgres"."public_pipedrive_analytics"."stg_pipedrive__users"
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



      
    ) dbt_internal_test
[0m16:44:54.516354 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.004 seconds
[0m16:44:54.518243 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: ROLLBACK
[0m16:44:54.519881 [debug] [Thread-1 (]: On test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d: Close
[0m16:44:54.520846 [info ] [Thread-1 (]: 25 of 35 PASS relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_  [[32mPASS[0m in 0.04s]
[0m16:44:54.521779 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d
[0m16:44:54.522323 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m16:44:54.522981 [info ] [Thread-1 (]: 26 of 35 START test assert_change_stage_references_lost_reason_id .............. [RUN]
[0m16:44:54.523937 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.relationships_stg_pipedrive__activity_user_id__id__ref_stg_pipedrive__users_.d7739cfd5d, now test.enpal_assessment_project.assert_change_stage_references_lost_reason_id)
[0m16:44:54.524464 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m16:44:54.527848 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m16:44:54.528717 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m16:44:54.531044 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m16:44:54.531835 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m16:44:54.532274 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: BEGIN
[0m16:44:54.532674 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:54.549453 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:44:54.550186 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"
[0m16:44:54.550708 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_change_stage_references_lost_reason_id"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- new_value field is a STRING type but contains mixed values for other tables/models
-- The CTE will pre-filter the deal_changes to safely cast new_value to an integer for this test
WITH deal_change_reasons AS (
	
SELECT
    changed_field_key,
    new_value
FROM
    "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
WHERE
    changed_field_key = 'lost_reason'

)
SELECT *
FROM deal_change_reasons dcr
LEFT OUTER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons" reasons
ON CAST(dcr.new_value AS INTEGER) = reasons.id
WHERE reasons.id IS NULL -- Any non referential values in dcr will return a NULL reasons.id
      
    ) dbt_internal_test
[0m16:44:54.555804 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m16:44:54.557524 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: ROLLBACK
[0m16:44:54.558986 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_lost_reason_id: Close
[0m16:44:54.559734 [info ] [Thread-1 (]: 26 of 35 PASS assert_change_stage_references_lost_reason_id .................... [[32mPASS[0m in 0.04s]
[0m16:44:54.560516 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_change_stage_references_lost_reason_id
[0m16:44:54.561038 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m16:44:54.561554 [info ] [Thread-1 (]: 27 of 35 START test assert_change_stage_references_stage_id .................... [RUN]
[0m16:44:54.562471 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_change_stage_references_lost_reason_id, now test.enpal_assessment_project.assert_change_stage_references_stage_id)
[0m16:44:54.562996 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m16:44:54.566244 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m16:44:54.567080 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m16:44:54.569494 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m16:44:54.570340 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m16:44:54.570867 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: BEGIN
[0m16:44:54.571455 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:54.587689 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:44:54.588357 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_change_stage_references_stage_id"
[0m16:44:54.588882 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_change_stage_references_stage_id"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- new_value field is a STRING type but contains mixed values for other tables/models
-- The CTE will pre-filter the deal_changes to safely cast new_value to an integer for this test
WITH deal_change_stage AS (
	
SELECT
    changed_field_key,
    new_value
FROM
    "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
WHERE
    changed_field_key = 'stage_id'

)
SELECT *
FROM deal_change_stage dcs
LEFT OUTER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages" stages
ON CAST(dcs.new_value AS INTEGER) = stages.id
WHERE stages.id IS NULL -- Any non referential values in d will return a NULL s.id
      
    ) dbt_internal_test
[0m16:44:54.596206 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.007 seconds
[0m16:44:54.597964 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: ROLLBACK
[0m16:44:54.599365 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_change_stage_references_stage_id: Close
[0m16:44:54.600087 [info ] [Thread-1 (]: 27 of 35 PASS assert_change_stage_references_stage_id .......................... [[32mPASS[0m in 0.04s]
[0m16:44:54.600886 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_change_stage_references_stage_id
[0m16:44:54.601409 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_activity_join_activity_type
[0m16:44:54.601984 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_change_stage_references_stage_id, now model.enpal_assessment_project.int_activity_join_activity_type)
[0m16:44:54.602532 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_activity_join_activity_type
[0m16:44:54.605928 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_activity_join_activity_type"
[0m16:44:54.607025 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_activity_join_activity_type
[0m16:44:54.607518 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m16:44:54.608098 [info ] [Thread-1 (]: 28 of 35 START sql view model public_pipedrive_analytics.int_deal_changes_dedupe_new_deal  [RUN]
[0m16:44:54.608624 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_activity_join_activity_type, now model.enpal_assessment_project.int_deal_changes_dedupe_new_deal)
[0m16:44:54.609072 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m16:44:54.614278 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m16:44:54.615199 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m16:44:54.619049 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m16:44:54.620399 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m16:44:54.621094 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: BEGIN
[0m16:44:54.621592 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:54.638786 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:44:54.639419 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m16:44:54.639951 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"} */

  create view "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_tmp"
    
    
  as (
    -- Assumption: the deals in the final report must have an add_time event in the deal changes table.
	-- This model provides a master set of valid ids to the upstream mart model.

-- This intermediate model does the following:
	-- Separates new deals from the deal_changes model
	-- Deduplicates a handful of dupe deals in the deal_changes model
	  -- Assumption: deals should not have more than one added date
	  -- Assumption: the latest added date is the one that should be presented to the model
	  -- Method: simple MAX

-- materialized view to apply built-in test unique values after dedupe


SELECT
	deal_id, 
	MAX(change_time) AS created_time
FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
WHERE changed_field_key = 'add_time'
GROUP BY
	deal_id
  );
[0m16:44:54.643254 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m16:44:54.646609 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m16:44:54.647089 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"} */
alter table "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_tmp" rename to "int_deal_changes_dedupe_new_deal"
[0m16:44:54.648817 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:44:54.650352 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: COMMIT
[0m16:44:54.650799 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m16:44:54.651216 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: COMMIT
[0m16:44:54.653102 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m16:44:54.655616 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_backup"
[0m16:44:54.656272 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"
[0m16:44:54.656701 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_new_deal"} */
drop view if exists "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal__dbt_backup" cascade
[0m16:44:54.658318 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m16:44:54.660127 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_new_deal: Close
[0m16:44:54.660738 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '811d7115-d333-46ff-8e4d-366db989b193', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107033e00>]}
[0m16:44:54.661467 [info ] [Thread-1 (]: 28 of 35 OK created sql view model public_pipedrive_analytics.int_deal_changes_dedupe_new_deal  [[32mCREATE VIEW[0m in 0.05s]
[0m16:44:54.662263 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_dedupe_new_deal
[0m16:44:54.662786 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_user
[0m16:44:54.663481 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_dedupe_new_deal, now model.enpal_assessment_project.int_deal_changes_user)
[0m16:44:54.664098 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_user
[0m16:44:54.667206 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_user"
[0m16:44:54.668558 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_user
[0m16:44:54.669180 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m16:44:54.669814 [info ] [Thread-1 (]: 29 of 35 START sql view model public_pipedrive_analytics.int_deal_changes_dedupe_lost_reason  [RUN]
[0m16:44:54.670363 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_user, now model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason)
[0m16:44:54.670807 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m16:44:54.674283 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m16:44:54.675047 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m16:44:54.678696 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m16:44:54.680233 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m16:44:54.680846 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: BEGIN
[0m16:44:54.681340 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:54.699663 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m16:44:54.700434 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m16:44:54.701158 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"} */

  create view "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_tmp"
    
    
  as (
    /* NOT USED UPSTREAM. 
    The requested report does not call for lost reason information, so this model is not used anywhere upstream.
	This model is created for completeness and consistent modeling.
NOT USED UPSTREAM. */

-- This intermediate model does the following:
	-- Separates the lost reason from the deal_changes model
	-- Adds the friendly lost reason label to the deal_changes data.
	-- Deduplicates a handful of dupe deals in the deal_changes model
		-- Assumption: deals should not have more than one lost reason
		-- Assumption: the latest lost reason is the one that should be presented to the model
		-- Method: row_number in reverse order and then pick the first row. 
		-- This pattern is better when we don't know how many duplicate rows there could be, but the latest will always be row number 1.
		-- Can't just take MAX(new_value) as was done for new_deals, because that would pick the largest given lost reason id, which would be incorrect.

-- materialized view to apply built-in test unique values after dedupe


WITH deal_changes_lost_reason AS (
	SELECT
		ROW_NUMBER() OVER(PARTITION BY deal_id ORDER BY change_time DESC) AS reverse_order,
		deal_id,
		new_value AS lost_reason_id,
		change_time,
		month_name,
		month_number
	FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
	WHERE changed_field_key = 'lost_reason'
),
deal_changes_lost_reason_cast_id AS (
	SELECT
		deal_id,
		CAST(lost_reason_id AS INTEGER) AS lost_reason_id, -- do it here once rather than twice in the final select & join clauses
		change_time,
		month_name,
		month_number
	FROM deal_changes_lost_reason
	WHERE reverse_order = 1
)
SELECT
dcr.deal_id,
dcr.lost_reason_id,
lost_reasons.label,
dcr.change_time,
dcr.month_name,
dcr.month_number
FROM deal_changes_lost_reason_cast_id dcr
INNER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_lost_reasons" lost_reasons
ON dcr.lost_reason_id = lost_reasons.id
  );
[0m16:44:54.705162 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m16:44:54.708411 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m16:44:54.708869 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"} */
alter table "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_tmp" rename to "int_deal_changes_dedupe_lost_reason"
[0m16:44:54.710789 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:44:54.712568 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: COMMIT
[0m16:44:54.713118 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m16:44:54.713550 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: COMMIT
[0m16:44:54.715928 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:44:54.718583 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_backup"
[0m16:44:54.719299 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"
[0m16:44:54.719752 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason"} */
drop view if exists "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason__dbt_backup" cascade
[0m16:44:54.721256 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m16:44:54.722839 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason: Close
[0m16:44:54.723466 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '811d7115-d333-46ff-8e4d-366db989b193', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a1e660>]}
[0m16:44:54.724365 [info ] [Thread-1 (]: 29 of 35 OK created sql view model public_pipedrive_analytics.int_deal_changes_dedupe_lost_reason  [[32mCREATE VIEW[0m in 0.05s]
[0m16:44:54.725202 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason
[0m16:44:54.725905 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m16:44:54.726731 [info ] [Thread-1 (]: 30 of 35 START sql view model public_pipedrive_analytics.int_deal_changes_dedupe_stage  [RUN]
[0m16:44:54.727393 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_dedupe_lost_reason, now model.enpal_assessment_project.int_deal_changes_dedupe_stage)
[0m16:44:54.727873 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m16:44:54.731849 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m16:44:54.733297 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m16:44:54.737992 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m16:44:54.739073 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m16:44:54.739580 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: BEGIN
[0m16:44:54.740070 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:54.757493 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:44:54.758144 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m16:44:54.758784 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_stage"} */

  create view "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_tmp"
    
    
  as (
    -- This intermediate model does the following:
	-- Separates the stages from the deal_changes model
	-- Adds the friendly stages label to the deal_changes data.
	-- Deduplicates a handful of dupe deals in the deal_changes model
		-- Assumption: deals should not arrive at the same stage more than once
			-- Note: it might be possible in the real world, but this rule was checked by looking at the deals that also had more than one add date, which definitely seems incorrect.
		-- Assumption: the latest lost reason is the one that should be presented to the model
		-- Method: row_number in reverse order and then pick the first row. 
		-- This pattern is better when we don't know how many duplicate rows there could be, but the latest will always be row number 1.
		-- Can't just take MAX(new_value) as was done for new_deals, because that would pick the largest given lost reason id, which would be incorrect.

-- materialized view to apply built-in test unique values after dedupe


WITH deal_changes_stage AS (
	SELECT
		ROW_NUMBER() OVER(PARTITION BY deal_id, new_value ORDER BY new_value, change_time DESC) AS reverse_order,
		deal_id,
		new_value AS stage_id,
		change_time,
		month_name,
		month_number
	FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__deal_changes"
	WHERE changed_field_key = 'stage_id'
),
deal_changes_stage_cast_id AS (
	SELECT
		deal_id,
		CAST(stage_id AS INTEGER) AS stage_id, -- do it here once rather than twice in the final select & join clauses
		change_time,
		month_name,
		month_number
	FROM deal_changes_stage
	WHERE reverse_order = 1
)
SELECT
dcs.deal_id,
dcs.stage_id,
stages.label,
dcs.change_time,
dcs.month_name,
dcs.month_number
FROM deal_changes_stage_cast_id dcs
INNER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__fields_stages" stages
ON dcs.stage_id = stages.id
  );
[0m16:44:54.762993 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m16:44:54.766275 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m16:44:54.766738 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_stage"} */
alter table "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_tmp" rename to "int_deal_changes_dedupe_stage"
[0m16:44:54.768395 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:44:54.769924 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: COMMIT
[0m16:44:54.770367 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m16:44:54.770775 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: COMMIT
[0m16:44:54.772724 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:44:54.777291 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_backup"
[0m16:44:54.778193 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.int_deal_changes_dedupe_stage"
[0m16:44:54.778647 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.int_deal_changes_dedupe_stage"} */
drop view if exists "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage__dbt_backup" cascade
[0m16:44:54.780151 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m16:44:54.781709 [debug] [Thread-1 (]: On model.enpal_assessment_project.int_deal_changes_dedupe_stage: Close
[0m16:44:54.782285 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '811d7115-d333-46ff-8e4d-366db989b193', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108210740>]}
[0m16:44:54.782956 [info ] [Thread-1 (]: 30 of 35 OK created sql view model public_pipedrive_analytics.int_deal_changes_dedupe_stage  [[32mCREATE VIEW[0m in 0.05s]
[0m16:44:54.783762 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_dedupe_stage
[0m16:44:54.784281 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m16:44:54.784915 [info ] [Thread-1 (]: 31 of 35 START test unique_int_deal_changes_dedupe_new_deal_deal_id ............ [RUN]
[0m16:44:54.785529 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_dedupe_stage, now test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc)
[0m16:44:54.786016 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m16:44:54.792641 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m16:44:54.793975 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m16:44:54.796430 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m16:44:54.797303 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m16:44:54.797770 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: BEGIN
[0m16:44:54.798197 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:54.815767 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:44:54.816591 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"
[0m16:44:54.817119 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    deal_id as unique_field,
    count(*) as n_records

from "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal"
where deal_id is not null
group by deal_id
having count(*) > 1



      
    ) dbt_internal_test
[0m16:44:54.822823 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.005 seconds
[0m16:44:54.824588 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: ROLLBACK
[0m16:44:54.826168 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc: Close
[0m16:44:54.826960 [info ] [Thread-1 (]: 31 of 35 PASS unique_int_deal_changes_dedupe_new_deal_deal_id .................. [[32mPASS[0m in 0.04s]
[0m16:44:54.827711 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc
[0m16:44:54.828228 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m16:44:54.828797 [info ] [Thread-1 (]: 32 of 35 START test unique_int_deal_changes_dedupe_lost_reason_deal_id ......... [RUN]
[0m16:44:54.829474 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.unique_int_deal_changes_dedupe_new_deal_deal_id.1fb728a0fc, now test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907)
[0m16:44:54.829983 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m16:44:54.834502 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m16:44:54.835582 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m16:44:54.838097 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m16:44:54.838948 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m16:44:54.839397 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: BEGIN
[0m16:44:54.839804 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:54.856183 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:44:54.856992 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"
[0m16:44:54.857542 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    deal_id as unique_field,
    count(*) as n_records

from "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_lost_reason"
where deal_id is not null
group by deal_id
having count(*) > 1



      
    ) dbt_internal_test
[0m16:44:54.867392 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.009 seconds
[0m16:44:54.869642 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: ROLLBACK
[0m16:44:54.871128 [debug] [Thread-1 (]: On test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907: Close
[0m16:44:54.872115 [info ] [Thread-1 (]: 32 of 35 PASS unique_int_deal_changes_dedupe_lost_reason_deal_id ............... [[32mPASS[0m in 0.04s]
[0m16:44:54.872906 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907
[0m16:44:54.873433 [debug] [Thread-1 (]: Began running node test.enpal_assessment_project.assert_unique_deal_stage
[0m16:44:54.873879 [info ] [Thread-1 (]: 33 of 35 START test assert_unique_deal_stage ................................... [RUN]
[0m16:44:54.874591 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.unique_int_deal_changes_dedupe_lost_reason_deal_id.9dd6535907, now test.enpal_assessment_project.assert_unique_deal_stage)
[0m16:44:54.875119 [debug] [Thread-1 (]: Began compiling node test.enpal_assessment_project.assert_unique_deal_stage
[0m16:44:54.878115 [debug] [Thread-1 (]: Writing injected SQL for node "test.enpal_assessment_project.assert_unique_deal_stage"
[0m16:44:54.879406 [debug] [Thread-1 (]: Began executing node test.enpal_assessment_project.assert_unique_deal_stage
[0m16:44:54.881851 [debug] [Thread-1 (]: Writing runtime sql for node "test.enpal_assessment_project.assert_unique_deal_stage"
[0m16:44:54.882670 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_unique_deal_stage"
[0m16:44:54.883104 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: BEGIN
[0m16:44:54.883495 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:54.900013 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m16:44:54.900790 [debug] [Thread-1 (]: Using postgres connection "test.enpal_assessment_project.assert_unique_deal_stage"
[0m16:44:54.901373 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "test.enpal_assessment_project.assert_unique_deal_stage"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      -- Assert that there are no duplicate deal-stage pairs in the deal changes table
SELECT
    COUNT(*),
    deal_id,
    stage_id
FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage"
GROUP BY
    deal_id,
    stage_id
HAVING COUNT(*) > 1
      
    ) dbt_internal_test
[0m16:44:54.923642 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.022 seconds
[0m16:44:54.925413 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: ROLLBACK
[0m16:44:54.926911 [debug] [Thread-1 (]: On test.enpal_assessment_project.assert_unique_deal_stage: Close
[0m16:44:54.927646 [info ] [Thread-1 (]: 33 of 35 PASS assert_unique_deal_stage ......................................... [[32mPASS[0m in 0.05s]
[0m16:44:54.928378 [debug] [Thread-1 (]: Finished running node test.enpal_assessment_project.assert_unique_deal_stage
[0m16:44:54.928904 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.int_deal_changes_activity
[0m16:44:54.929391 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.enpal_assessment_project.assert_unique_deal_stage, now model.enpal_assessment_project.int_deal_changes_activity)
[0m16:44:54.930036 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.int_deal_changes_activity
[0m16:44:54.936603 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.int_deal_changes_activity"
[0m16:44:54.937870 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.int_deal_changes_activity
[0m16:44:54.938834 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.mrt_deals_stages
[0m16:44:54.939634 [info ] [Thread-1 (]: 34 of 35 START sql table model public_pipedrive_analytics.mrt_deals_stages ..... [RUN]
[0m16:44:54.940481 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.int_deal_changes_activity, now model.enpal_assessment_project.mrt_deals_stages)
[0m16:44:54.941393 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.mrt_deals_stages
[0m16:44:54.951864 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.mrt_deals_stages"
[0m16:44:54.953320 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.mrt_deals_stages
[0m16:44:54.979702 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.mrt_deals_stages"
[0m16:44:54.980610 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m16:44:54.981047 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: BEGIN
[0m16:44:54.981447 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:54.996850 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m16:44:54.997485 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m16:44:54.998099 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */

  
    

  create  table "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_tmp"
  
  
    as
  
  (
    -- This mart model provides a breakdown by month of all deals and their stages, minor stages, and activities.
-- The LEFT OUTER JOIN to the deal_changes model ensures that only deals with an add_time event are included in the final report.
    -- Of course, with different assumptions, we could easily include everything from the activity model.
    -- but the deals that appear only in the activity table don't have an entry point via the Lead Generation stage
    -- and that would make the business logic inconsistent.
    -- A conversation with a stakeholder could lead to a different set of assumptions and a different report.
WITH  __dbt__cte__int_activity_join_activity_type as (
-- Simple intermediate model to join activity and activity_types
-- thus providing the friendly name of the activity type for downstream models
SELECT
	a.user_id,
	a.deal_id,
	t.activity_name,
	ms.stage_id,
	ms.minor_stage_id,
	t.is_active, -- this would be a mart level filter: business logic determines when to include deactivated activity types
	a.is_done, -- this would be a report level filter: analyst determines when to exclude incomplete activities
	a.due_time,
	a.month_name,
	a.month_number
FROM "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity" a
INNER JOIN "postgres"."public_pipedrive_analytics"."stg_pipedrive__activity_types" t
	ON a.activity_type = t.activity_type
INNER JOIN "postgres"."public"."minor_stages" ms
	ON t.activity_type = ms.activity_type
),  __dbt__cte__int_deal_changes_activity as (
-- brings in the activity data for deals in the deal_changes table with the same deal_id
-- These will just be the ones with call activities against them

-- Note that there are very few rows compared to the total number of deals
    -- This is because there are very few matching deal ids in deal_changes and activity tables
    -- I have looked at whether this can be an out by N error on the ids but didn't find a fix
-- Potential problem? Why are there so many rows in the activity table with deal ids that don't exist in the deal_changes table?

SELECT
    nd.deal_id,
    act.activity_name,
    act.stage_id,
    act.minor_stage_id,
    act.is_active, -- this would be a mart level filter: business logic determines when to include deactivated activity types
    act.is_done, -- this would be a report level filter: analyst determines when to exclude incomplete activities
    act.month_number,
    act.month_name
FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal" nd
INNER JOIN __dbt__cte__int_activity_join_activity_type act -- result of INNER JOIN is very few rows. Is it a problem?
ON nd.deal_id = act.deal_id
), all_deal_changes_and_activity AS (
    SELECT
        deal_id,
        stage_id,
        minor_stage_id,
        is_done, -- this would be a report level filter: analyst determines when to exclude incomplete activities
        activity_name AS label,
        month_name,
        month_number
    FROM __dbt__cte__int_deal_changes_activity
    WHERE is_active = TRUE -- Mart level filter, most business users will ignore e.g. 'Follow Up Call' that is set to be inactive
    UNION ALL
    SELECT
        deal_id,
        stage_id,
        NULL AS minor_stage_id,
        NULL AS is_done,
        label,
        month_name,
        month_number
    FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_stage"
)
SELECT
    nd.deal_id,
    dca.stage_id,
    dca.minor_stage_id,
    dca.is_done,
    dca.label,
    dca.month_name,
    dca.month_number
FROM "postgres"."public_pipedrive_analytics"."int_deal_changes_dedupe_new_deal" nd -- Only deals from the deal_changes model (these have a created_time)
LEFT OUTER JOIN all_deal_changes_and_activity dca -- This will pick up the minor stages/activities where they exist for this set of deals
    ON nd.deal_id = dca.deal_id
  );
  
[0m16:44:55.041359 [debug] [Thread-1 (]: SQL status: SELECT 8895 in 0.043 seconds
[0m16:44:55.046409 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m16:44:55.046919 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */
alter table "postgres"."public_pipedrive_analytics"."mrt_deals_stages" rename to "mrt_deals_stages__dbt_backup"
[0m16:44:55.048582 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:44:55.051942 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m16:44:55.052421 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */
alter table "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_tmp" rename to "mrt_deals_stages"
[0m16:44:55.054000 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:44:55.059399 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: COMMIT
[0m16:44:55.059893 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m16:44:55.060308 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: COMMIT
[0m16:44:55.063640 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m16:44:55.066352 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_backup"
[0m16:44:55.069589 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.mrt_deals_stages"
[0m16:44:55.070104 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.mrt_deals_stages"} */
drop table if exists "postgres"."public_pipedrive_analytics"."mrt_deals_stages__dbt_backup" cascade
[0m16:44:55.073908 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.003 seconds
[0m16:44:55.075563 [debug] [Thread-1 (]: On model.enpal_assessment_project.mrt_deals_stages: Close
[0m16:44:55.076167 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '811d7115-d333-46ff-8e4d-366db989b193', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108276210>]}
[0m16:44:55.077120 [info ] [Thread-1 (]: 34 of 35 OK created sql table model public_pipedrive_analytics.mrt_deals_stages  [[32mSELECT 8895[0m in 0.14s]
[0m16:44:55.077973 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.mrt_deals_stages
[0m16:44:55.078839 [debug] [Thread-1 (]: Began running node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m16:44:55.079539 [info ] [Thread-1 (]: 35 of 35 START sql view model public_pipedrive_analytics.rep_sales_funnel_monthly  [RUN]
[0m16:44:55.080096 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.enpal_assessment_project.mrt_deals_stages, now model.enpal_assessment_project.rep_sales_funnel_monthly)
[0m16:44:55.080537 [debug] [Thread-1 (]: Began compiling node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m16:44:55.083592 [debug] [Thread-1 (]: Writing injected SQL for node "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m16:44:55.084868 [debug] [Thread-1 (]: Began executing node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m16:44:55.088830 [debug] [Thread-1 (]: Writing runtime sql for node "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m16:44:55.089708 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m16:44:55.090144 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: BEGIN
[0m16:44:55.090542 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:55.107263 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m16:44:55.108015 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m16:44:55.108683 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.rep_sales_funnel_monthly"} */

  create view "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_tmp"
    
    
  as (
    -- ASSUMPTIONS FOR THIS MODEL:
-- Show the number of deals in each stage of the sales funnel, for each month
	-- I am presenting a historical view, each deal stage at the time it happened
	-- (alternative would have been snapshot of final stages of each deal, that's not what I'm doing here)
    -- Although we have models for users, they are not needed/requested in this model
    -- Although we have models for lost deals
        -- we are showing the stage the deal was in at the time of the activity 
        -- whether or not it was closed in the end
        -- If it was not closed in the end, it just doesn't get counted in the Closing or later stages
        -- so it doesn't appear necessary to use the lost reasons model
	-- As noted in the intermediate model, we are excluding inactive activities
	-- As noted in the intermediate model, there are hardly any activities with deal_ids also in the deal_changes table
		-- this results in very entries for steps 2.1 and 3.1 (only two, in fact)

-- create the funnel steps as requested
WITH funnel_step_from_stages AS (
	SELECT
		deal_id,
		month_number,
		month_name,
		CONCAT(stage_id, 
			CASE
				WHEN minor_stage_id IS NULL THEN ''
				ELSE CONCAT('.', minor_stage_id)
			END
		) AS funnel_step,
		label AS kpi_name
	FROM "postgres"."public_pipedrive_analytics"."mrt_deals_stages" AS funnel
    WHERE COALESCE(is_done, TRUE) -- report level filter: exclude incomplete activities
),
-- aggregate CTE then order, to avoid having to keep the order columns in the view
monthly_agg AS (
	SELECT
		COUNT(deal_id) AS deals_count,
		month_number,
		month_name,
		funnel_step,
		kpi_name
	FROM funnel_step_from_stages
	GROUP BY
		month_number,
		month_name,
		funnel_step,
		kpi_name
)
-- final query with ordering
SELECT
	month_name AS month,
	kpi_name,
	funnel_step,
	deals_count
	FROM monthly_agg
ORDER BY month_number, funnel_step
  );
[0m16:44:55.112614 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m16:44:55.115941 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m16:44:55.116412 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.rep_sales_funnel_monthly"} */
alter table "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_tmp" rename to "rep_sales_funnel_monthly"
[0m16:44:55.118155 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:44:55.119829 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: COMMIT
[0m16:44:55.120327 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m16:44:55.120774 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: COMMIT
[0m16:44:55.122925 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m16:44:55.125633 [debug] [Thread-1 (]: Applying DROP to: "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_backup"
[0m16:44:55.126381 [debug] [Thread-1 (]: Using postgres connection "model.enpal_assessment_project.rep_sales_funnel_monthly"
[0m16:44:55.126848 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "enpal_assessment_project", "target_name": "dev", "node_id": "model.enpal_assessment_project.rep_sales_funnel_monthly"} */
drop view if exists "postgres"."public_pipedrive_analytics"."rep_sales_funnel_monthly__dbt_backup" cascade
[0m16:44:55.128333 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m16:44:55.129931 [debug] [Thread-1 (]: On model.enpal_assessment_project.rep_sales_funnel_monthly: Close
[0m16:44:55.130530 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '811d7115-d333-46ff-8e4d-366db989b193', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106447830>]}
[0m16:44:55.131214 [info ] [Thread-1 (]: 35 of 35 OK created sql view model public_pipedrive_analytics.rep_sales_funnel_monthly  [[32mCREATE VIEW[0m in 0.05s]
[0m16:44:55.131967 [debug] [Thread-1 (]: Finished running node model.enpal_assessment_project.rep_sales_funnel_monthly
[0m16:44:55.133338 [debug] [MainThread]: Using postgres connection "master"
[0m16:44:55.133788 [debug] [MainThread]: On master: BEGIN
[0m16:44:55.134145 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:44:55.149254 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m16:44:55.149944 [debug] [MainThread]: On master: COMMIT
[0m16:44:55.150455 [debug] [MainThread]: Using postgres connection "master"
[0m16:44:55.150820 [debug] [MainThread]: On master: COMMIT
[0m16:44:55.152174 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m16:44:55.152608 [debug] [MainThread]: On master: Close
[0m16:44:55.153105 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:44:55.153486 [debug] [MainThread]: Connection 'model.enpal_assessment_project.rep_sales_funnel_monthly' was properly closed.
[0m16:44:55.153992 [info ] [MainThread]: 
[0m16:44:55.154406 [info ] [MainThread]: Finished running 12 view models, 1 seed, 21 data tests, 1 table model in 0 hours 0 minutes and 2.25 seconds (2.25s).
[0m16:44:55.161775 [debug] [MainThread]: Command end result
[0m16:44:55.200730 [info ] [MainThread]: 
[0m16:44:55.201236 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:44:55.201642 [info ] [MainThread]: 
[0m16:44:55.202053 [info ] [MainThread]: Done. PASS=35 WARN=0 ERROR=0 SKIP=0 TOTAL=35
[0m16:44:55.203919 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 3.7103314, "process_in_blocks": "0", "process_kernel_time": 0.435886, "process_mem_max_rss": "118853632", "process_out_blocks": "0", "process_user_time": 4.154849}
[0m16:44:55.204677 [debug] [MainThread]: Command `dbt build` succeeded at 16:44:55.204509 after 3.71 seconds
[0m16:44:55.205235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067ccec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053cdf40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108137710>]}
[0m16:44:55.205807 [debug] [MainThread]: Flushing usage events
